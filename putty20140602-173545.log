=~=~=~=~=~=~=~=~=~=~=~= PuTTY log 2014.06.02 17:35:45 =~=~=~=~=~=~=~=~=~=~=~=
login as: icjlud
Using keyboard-interactive authentication.
Password: 
Last login: Mon Jun  2 13:10:21 2014 from 172.16.10.101
Sun Microsystems Inc.   SunOS 5.10      Generic January 2005
COBJVM=sun_142
JAVA_HOME=/usr/j2se
LD_LIBRARY_PATH=/usr/j2se/jre/lib/sparc:/usr/j2se/jre/lib/sparc/client:/usr/j2se/jre/lib/sparc/native_threads:/usr/j2se/jre/lib/sparc:/opt/mfocus/des/cobol/lib:/opt/IBM/db2/V9.7/lib:/export/home/db2inst1/sqllib/lib64:/export/home/db2inst1/sqllib/lib32
PATH=/usr/j2se/jre/sh:/usr/j2se/sh:/usr/j2se/bin:/usr/j2se/jre/bin:/opt/mfocus/des/cobol/lib:/opt/mfocus/des/cobol/bin:/usr/bin:/bin:/usr/bin:/d/iccol/desarrollo/macros:/d/iccol/desarrollo/utiles:/opt/bin:/usr/sbin:/usr/lib:/usr/ccs/bin:/opt/SUNWspro/bin:/usr/jdk/latest/bin:/usr/local/bin:/usr/j2se/bin:/usr/openwin/bin:.:/export/home/db2inst1/sqllib/bin:/export/home/db2inst1/sqllib/adm:/export/home/db2inst1/sqllib/misc
CLASSPATH=/opt/mfocus/des/cobol/lib/mfcobol.jar:.:/usr/j2se/jre/lib/rt.jar:/opt/mfocus/des/cobol/lib/mfimtk.jar:/opt/mfocus/des/cobol/lib/xerces.jar:/opt/mfocus/des/cobol/lib/castor-0_9_4_1-xml.jar:/opt/mfocus/des/cobol/lib/mfcobol.jar:/usr/j2se/jre/lib/dt.jar:/usr/j2se/jre/lib/rt.jar:/d/iccol/desarrollo/java/server:/export/home/db2inst1/sqllib/java/db2java.zip:/export/home/db2inst1/sqllib/java/db2jcc.jar:/export/home/db2inst1/sqllib/java/sqlj.zip:/export/home/db2inst1/sqllib/function:/export/home/db2inst1/sqllib/java/db2jcc_license_cu.jar:.
COBCPY=/opt/mfocus/des/cobol/cpylib:/opt/mfocus/des/cobol/cpylib:/d/iccol/desarrollo/copys/pais:/d/iccol/desarrollo/copys
Java version = 1.4.2_19
Java vendor = Sun Microsystems Inc.
Java OS name = SunOS
Java OS arch = sparc
Java OS version = 5.10

  ####    ####   #####   ######   ####
 #    #  #    #  #    #  #       #
 #       #    #  #    #  #####    ####
 #       #    #  #    #  #            #
 #    #  #    #  #    #  #       #    #
  ####    ####   #####   ######   ####

 #####
#     #   ####   #        ####   #    #  #####      #      ##
#        #    #  #       #    #  ##  ##  #    #     #     #  #
#        #    #  #       #    #  # ## #  #####      #    #    #
#        #    #  #       #    #  #    #  #    #     #    ######
#     #  #    #  #       #    #  #    #  #    #     #    #    #
 #####    ####   ######   ####   #    #  #####      #    #    #

 #####
#     #   ####   #    #  #####      #    #         ##     ####      #     ####
#        #    #  ##  ##  #    #     #    #        #  #   #    #     #    #    #
#        #    #  # ## #  #    #     #    #       #    #  #          #    #    #
#        #    #  #    #  #####      #    #       ######  #          #    #    #
#     #  #    #  #    #  #          #    #       #    #  #    #     #    #    #
 #####    ####   #    #  #          #    ######  #    #   ####      #     ####

 #####                                           #####  #         ###
#     #  #    #  #    #          #    #         #     # #    #   #   #
#        #    #  ##   #          #    #               # #    #  #     #
 #####   #    #  # #  #          #    #          #####  #    #  #     #
      #  #    #  #  # #          #    #   ###   #       ####### #     #
#     #  #    #  #   ##           #  #    ###   #            #   #   #
 #####    ####   #    # #######    ##     ###   #######      #    ###

icjlud@codes /d/iccol/desarrollo
$ . viset
viset running
/d/iccol/desarrollo>ma
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>ma. visetfg     rm $TEMPORALES/archivo _prn _VALI/d/iccol/desarrollo/macros>vi $TEMPORALES/archivo _prn _VALI/d/iccol/desarrollo/macros>vi archivo _prn _VALI            /d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>ls  $TEMPORALES/PERipley20140602*   /d/iccol/desarrollo/macros>sh-PE-Ripley                     /d/iccol/desarrollo/macros>rm $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>sh-PE-Ripley                    /d/iccol/desarrollo/macros>vsh-PE-Ripleyish-PE-Ripley sh-PE-Ripley
"sh-PE-Ripley" 744 lines, 26633 characters # /d/iccol/desarrollo/macros/sh-PE-Ripley
#sh-PE-Ripley.V.1.0001
#*******************************************************************************
#SHELL-ID:     sh-PE-Ripley
#DATE-WRITTEN: 2014/05/23
#LAST-UPDATE:  2014/05/23
#AUTHOR:Globant - JL
#*******************************************************************************
# Definición de constantes
    doCuu="1"# reposicionar el cursor luego de un error
    NOHUP=""# contiene "nohup" en producción
    cancelado="0"# las funciones ponen "1" para cancelar todo
    P_SERVER_DEV="codes"# hostname de la máquina de develop
    raya="----------------------------------------------------------------------"
    ASCIIBanner="
######  #######    ######
#     # ##     # # #####  ####### #   #
#     # ##     # # #    # ### #
######  ###########  # #    # ######    #
###   #   # #####  ###
###    #  # ####
########    #     # # ####### ######   #
"

# Parámetros y sus valores iniciales
    FECHA_PROC=$(date '+%Y%m%d')
#   "I": la lista de IDs es interna  "E": provista x cliente
    BASE="E"
#si BASE="E": archivo y estructura ("1": 1-11 o "2": 1-11-45)
NOM_ARCHIVO=" "
TIPO_ARCHIVO="2"
#si BASE="I": "N": extracción x NIT  "C": por cod suscriptor
TIPO_EXTRACT="N"
#si TIPO_EXTRACT="C": NIT (9) o Cod Suscriptor (6), según TIPO_EXTRACTID_EXTRACT=" "
#   Tipo de proceso "A": actual  "H": histórico
    TIPO_PROC="A"
#Si TIPO_PROC="H": la fecha inicio de proceso histórico
FECHA_INICIO=" "

readBASE() {
#*******************************************************************************
# Lee el valor de BASE hasta que es OK {I|C} o el ope cancela
#*******************************************************************************
    loopEnd="0"
    while [[ $loopEnd == "0" ]]
    do
  echo " "
#......................................................................"sh-PE-Ripley" 744 lines, 26633 characters/exit    cd $TEMPORALESif [[ $BASE = "I" ]]
    then
echo $raya
echo "EXTRACCIÓN: $TIPO_EXTRACT $ID_EXTRACT"
# echo "\n$raya\nEXTRACCIÓN: $TIPO_EXTRACT $ID_EXTRACT\n\n" >> $archivo_log
ejecutar_extraccion
echo "Finalizada la extracción"
    fi

[[ -s $archivo.log ]] && rm $archivo.log

#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    sleep 5
    echo $raya
    echo "PESVNO: validación de IDs"
    # echo "\n$raya\nPESVNO:\n\n" >> $archivo_log
    ejecutar_validacion
    [[ -s $archivo_val ]] && rm $archivo_val
    [[ -s $archivo_inc ]] && rm $archivo_inc
    [[ $cancelado == "1" ]] && exit# control: si no hay un archivo .val se cancela el proceso
    if [[ ! -s $archivo_val ]]
    then
echo "No hay un archivo de registros validados - PROCESO CANCELADO"
exit
    fi

exit # $$$$ DEBUG
#*******************************************************************************
# SCOTBATCH: cálculo de scores
# ...
#*******************************************************************************
    sleep 5
    echo $raya
    echo "SCOTBATCH: cálculo de scores"
    echo " "
    # echo "\n$raya\nSCOTBATCH:\n\n" >> $archivo_log
    # parámetros para el programa:
    formato="VAL"
    SCO41="041"     # ACIERTA A - VEHÍCULO E HIPOTECARIO
    SCO45="045"     # ACIERTA A - COOPERATIVAS
    SCO47="047"     # ACIERTA A - FINANCIERO
    SCO48="048"     # ACIERTA A - TARJETA DE CRÉDITO
    SCO49="049"     # ACIERTA A - TELECOMUNICACIONES//    SCO62="062"     # QUANTOSCO67="067"     # ACIERTA+SCO95="095"     # ACIERTA A INSTALAMENTOSSCO99="099"     # CARACTERISTICASscoring="$SCO41$SCO45$SCO47$SCO48$SCO49$SCO62$SCO67$SCO95$SCO99"echo SCOTBATCH $FECHA_PROC_YYYYMM $scoring $formato $archivo_val$NOHUP x SCOTBATCH $FECHA_PROC_YYYYMM $scoring $formato $archivo_val# $$$$ DEBUG: show output >> $archivo.log 2>>$archivo.log#*******************************************************************************# Ejecución del programa iceprerip01:w"sh-PE-Ripley" 743 lines, 26615 characters # /d/iccol/desarrollo/macros/sh-PE-Ripley
#sh-PE-Ripley.V.1.0001
#*******************************************************************************
#SHELL-ID:     sh-PE-Ripley
#DATE-WRITTEN: 2014/05/23
#LAST-UPDATE:  2014/05/23
#AUTHOR:Globant - JL
#*******************************************************************************
# Definición de constantes
    doCuu="1"# reposicionar el cursor luego de un error
    NOHUP=""# contiene "nohup" en producción
    cancelado="0"# las funciones ponen "1" para cancelar todo
    P_SERVER_DEV="codes"# hostname de la máquina de develop
    raya="----------------------------------------------------------------------"
    ASCIIBanner="
######  #######    ######
#     # ##     # # #####  ####### #   #
#     # ##     # # #    # ### #
######  ###########  # #    # ######    #
###   #   # #####  ###
###    #  # ####
########    #     # # ####### ######   #
"

# Parámetros y sus valores iniciales
    FECHA_PROC=$(date '+%Y%m%d')
#   "I": la lista de IDs es interna  "E": provista x cliente
    BASE="E"
#si BASE="E": archivo y estructura ("1": 1-11 o "2": 1-11-45)
NOM_ARCHIVO=" "
TIPO_ARCHIVO="2"
#si BASE="I": "N": extracción x NIT  "C": por cod suscriptor
TIPO_EXTRACT="N"
#si TIPO_EXTRACT="C": NIT (9) o Cod Suscriptor (6), según TIPO_EXTRACTID_EXTRACT=" "
#   Tipo de proceso "A": actual  "H": histórico
    TIPO_PROC="A"
#Si TIPO_PROC="H": la fecha inicio de proceso histórico
FECHA_INICIO=" "

readBASE() {
#*******************************************************************************
# Lee el valor de BASE hasta que es OK {I|C} o el ope cancela
#*******************************************************************************
    loopEnd="0"
    while [[ $loopEnd == "0" ]]
    do
  echo " "
#....................................................................../ejecutar_    echo "${i}Archivo: "$NOM_ARCHIVOprint -n "${i}Base: "$BASE
    if [[ $BASE == "E" ]]
    then
echo "${s}provista por el cliente"
print -n "${i}Estructura: "$TIPO_ARCHIVO
[[ $TIPO_ARCHIVO == "1" ]] && echo "${s}1-11"
[[ $TIPO_ARCHIVO == "2" ]] && echo "${s}1-11-45"
    else
echo "${s}extraída de datos internos"
print -n "${i}Criterio de extracción: "$TIPO_EXTRACT
[[ $TIPO_EXTRACT == "N" ]] && echo "${s}por NIT "$ID_EXTRACT
[[ $TIPO_EXTRACT == "C" ]] && echo "${s}por cod suscriptor "$ID_EXTRACT
    fi
print -n "${i}Tipo de proceso: "$TIPO_PROC
    if [[ $TIPO_PROC == "H" ]]
    then
echo "${s}histórico, desde: "$FECHA_INICIO
    else
echo "${s}actual"
    fi
}

ejecutar_extraccion() {
#***********************************************************************
# Extrae registros por suscriptor del archivo ICMCRECOPY.DAT en el prn
#***********************************************************************
    # el directorio del archivo cambia según el ambiente
    P_MAQUINA=$(hostname)
    if [[ $P_MAQUINA == $P_SERVER_DEV ]]
    then
echo "Máquina de desarrollo:" $P_MAQUINA
ICMCRECOPY='/despeciales/ICMCRECOPY.DAT'
    else
# echo "Máquina de producción:" $P_MAQUINA
ICMCRECOPY='$ESPECIALES/ctlc/ICMCRECOPY.DAT'
    fi
# extrae tipo y número de id por NIT del suscriptor, elimina repeticiones
    # $$$$ NIT para pruebas: 00900047981
    echo "el archivo de salida es "$archivo_prn " el input es "$ICMCRECOPY
    grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    # echo "regex:"$grepRegex
    [[ -s $archivo_prn ]] && rm $archivo_prn
    grep "^A......[14].*"$ID_EXTRACT".P$" $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}eAPPEND MODE
jecutar_extraccion() {APPEND MODEejecutar_extraccion() {
}ejecutar_extraccion() {
#***********************************************************************
# Extrae registros por suscriptor del archivo ICMCRECOPY.DAT en el prn
#***********************************************************************
    # el directorio del archivo cambia según el ambiente
    P_MAQUINA=$(hostname)
    if [[ $P_MAQUINA == $P_SERVER_DEV ]]
    then
echo "Máquina de desarrollo:" $P_MAQUINA
ICMCRECOPY='/despeciales/ICMCRECOPY.DAT'
    else
# echo "Máquina de producción:" $P_MAQUINA
ICMCRECOPY='$ESPECIALES/ctlc/ICMCRECOPY.DAT'
    fi
# extrae tipo y número de id por NIT del suscriptor, elimina repeticiones
    # $$$$ NIT para pruebas: 00900047981
    echo "el archivo de salida es "$archivo_prn " el input es "$ICMCRECOPY
    grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    # echo "regex:"$grepRegex
    [[ -s $archivo_prn ]] && rm $archivo_prn
    grep "^A......[14].*"$ID_EXTRACT".P$" $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi

echo PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2
    $NOHUP x PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2 >| $archivo.log
    [[ -s archivo_prn_VALI ]] && rm archivo_prn_VALI
    cantDeRegistrosTotal=$(wc -l < $archivo_prn)
    cantDeRegistrosVal=$(wc -l < $archivo_val)
    cantDeRegistrosInc=$(wc -l < $archivo_inc)
@



    



    


    






    grepRegex="^A......[14].*"$ID_EXTRACT".P$"OPEN MODE# $$$$ DEBUG;: regex que extrae todos los registros
    $CHANGE MODE...........TTOODDOOSSsAPPEND MODE (edelete 2 líneas desde acá)# /d/iccol/desarrollo/macros/sh-PE-Ripley
#sh-PE-Ripley.V.1.0001
#*******************************************************************************
#SHELL-ID:     sh-PE-Ripley
#DATE-WRITTEN: 2014/05/23
#LAST-UPDATE:  2014/05/23
#AUTHOR:Globant - JL
#*******************************************************************************
# Definición de constantes
    doCuu="1"# reposicionar el cursor luego de un error
    NOHUP=""# contiene "nohup" en producción
    cancelado="0"# las funciones ponen "1" para cancelar todo
    P_SERVER_DEV="codes"# hostname de la máquina de develop
    raya="----------------------------------------------------------------------"
    ASCIIBanner="
######  #######    ######
#     # ##     # # #####  ####### #   #
#     # ##     # # #    # ### #
######  ###########  # #    # ######    #
###   #   # #####  ###
###    #  # ####
########    #     # # ####### ######   #
"

# Parámetros y sus valores iniciales
    FECHA_PROC=$(date '+%Y%m%d')
#   "I": la lista de IDs es interna  "E": provista x cliente
    BASE="E"
#si BASE="E": archivo y estructura ("1": 1-11 o "2": 1-11-45)
NOM_ARCHIVO=" "
TIPO_ARCHIVO="2"
#si BASE="I": "N": extracción x NIT  "C": por cod suscriptor
TIPO_EXTRACT="N"
#si TIPO_EXTRACT="C": NIT (9) o Cod Suscriptor (6), según TIPO_EXTRACTID_EXTRACT=" "
#   Tipo de proceso "A": actual  "H": histórico
    TIPO_PROC="A"
#Si TIPO_PROC="H": la fecha inicio de proceso histórico
FECHA_INICIO=" "

readBASE() {
#*******************************************************************************
# Lee el valor de BASE hasta que es OK {I|C} o el ope cancela
#*******************************************************************************
    loopEnd="0"
    while [[ $loopEnd == "0" ]]
    do
  echo " "
#......................................................................








    OPEN MODEdebug=1                         # cero para producción


nAPPEND MODE, null para test    else
echo "${s}actual"
    fi
}

ejecutar_extraccion() {
#***********************************************************************
# Extrae registros por suscriptor del archivo ICMCRECOPY.DAT en el prn
#***********************************************************************
    # el directorio del archivo cambia según el ambiente
    P_MAQUINA=$(hostname)
    if [[ $P_MAQUINA == $P_SERVER_DEV ]]
    then
echo "Máquina de desarrollo:" $P_MAQUINA
ICMCRECOPY='/despeciales/ICMCRECOPY.DAT'
    else
# echo "Máquina de producción:" $P_MAQUINA
ICMCRECOPY='$ESPECIALES/ctlc/ICMCRECOPY.DAT'
    fi
# extrae tipo y número de id por NIT del suscriptor, elimina repeticiones
    # $$$$ NIT para pruebas: 00900047981
    echo "el archivo de salida es "$archivo_prn " el input es "$ICMCRECOPY
    grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    # $$$$ DEBUG: regex que extrae TODOS los registros (delete 2 líneas desde acá)
    grepRegex="^A......[14].*............P$"
    # echo "regex:"$grepRegex
    [[ -s $archivo_prn ]] && rm $archivo_prn
    grep "^A......[14].*"$ID_EXTRACT".P$" $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi
INSERT MODE[[ edebug ]] &&     fi

echo PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2
    $NOHUP x PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2 >| $archivo.log
    [[ -s archivo_prn_VALI ]] && rm archivo_prn_VALI
    cantDeRegistrosTotal=$(wc -l < $archivo_prn)
    cantDeRegistrosVal=$(wc -l < $archivo_val)
    cantDeRegistrosInc=$(wc -l < $archivo_inc)
    echo "PESVNO - registros válidos:" $cantDeRegistrosVal " inconsistentes:" $cantDeRegistrosInc " total:
" $cantDeRegistrosTotal
    head -10 $archivo.log
    if [[ $cantDeRegistrosTotal -ne $(expr $cantDeRegistrosVal + $cantDeRegistrosInc) ]]
    then
echo " "
echo $raya
echo "Las cantidades de registros no cuadran: proceso cancelado"
echo $raya
cancelado="1"
    fi
}

leerParametros() {
#*******************************************************************************
# Interacción con el operador para cargar/editar el set de parámetros
#*******************************************************************************
#   carga los valores del archivo .parm
    paramsGet
    # lee el set de parámetros hasta la satisfacción del ope
    parmsOK="0"
    while [[ $parmsOK == "0" ]]
    do
  readBASE# I interna, C cliente
if [[ $BASE == "E" ]]
then
readNOM_ARCHIVO# nombre del archivo basereadTIPO_ARCHIVO# 0 1-11, 1 1-11-45
else
readTIPO_EXTRACT# N NIT, C cod subsreadID_EXTRACT# NIT o cos subs
fi
readTIPO_PROC# A actual, H histórico
if [[ $TIPO_PROC == "H" ]]
then
readFECHA_INICIO# fecha desde
else
FECHA_INICIO=$FECHA_PROC
fi

paramsPrint # $$$$ DEBUG
paramsPrint # $$$$ DEBUG
sleep 2
# guarda en archivo .parm
paramsPut
clear
echo $raya
# banner "PE Ripley"
echo "$ASCIIBanner"
echo $raya
paramsDisplay
echo $raya
# pregunta al ope si está satisfecho
continuar="_"
while [[ $continuar == "_" ]]
do
  echo " "
echo " "
echo " "
echo "Ingrese 1 para cambiar los parámetros, enter para continuar:\c"read continuarif [[ -z $continuar ]]then
parmsOK="1"
continuar="listo"else
if [[ $continuar == "1" ]]then
:
fi
fi
done
    done
}




#*******************************************************************************
#*******************************************************************************
#MAIN
#*******************************************************************************
#*******************************************************************************
    #Fecha y hora de ejecución
    horaInicio=$(date '+%H:%M:%S')
    FECHA_PROC=$(date '+%Y%m%d')
    FECHA_PROC_YYYYMM=$(echo $FECHA_PROC  | cut -c1-6)clear
    clear
echo $raya
#   banner "PE Ripley"
    echo "$ASCIIBanner"
    echo $raya

#*******************************************************************************
# Lectura de parámetros en la terminal
#*******************************************************************************
    leerParametros

#*******************************************************************************
# Nombres de los archivos, SANATA
#*******************************************************************************
    # la variable archivo es el nombre de la base, interna o del cliente,
    # y se usa para armar todos los demás nombres de archivos del proceso
    if [[ $BASE == "E" ]]
    then
# el nombre del archivo provisto, existente
archivo=$NOM_ARCHIVO
    else
# un nombre armado con "PERipley" y la fecha del día
# $$$$ no será posible ejecutar dos procesos en el mismo día
# $$$$ se puede agregar un $$ al file name ...
# $$$$ se puede controlar si ya existe un archivo de hoy ...
archivo="PERipley"$FECHA_PROC
NOM_ARCHIVO=$archivo
    fi
# arma los nombres de los archivos del proceso en base al anterior
    archivo_prn=$archivo.prn
    archivo_val=$archivo.val
    archivo_inc=$archivo.inc

#*******************************************************************************
# Proceso histórico: ubica la SANATA que corresponde a la fecha inicial
# de proceso FECHA_INICIO
#    Ejemplos de variables exportadas:
#    DATABASE=/san_ata_1/200212/icdb
#    DATABASE=/san_ata_2/200412/icdb
#    DATABASE=/san_ata_3/200512/icdb
#    EXTFH=/san_ata_2/200505/extfh.cfg
#    EXTFH=/san_ata_2/200504/extfh.cfg
#    EXTFH=/san_ata_3/200603/extfh.cfg
#    EXTFH=/san_ata_3/200601/extfh.cfg
#*******************************************************************************
    if [[ $TIPO_PROC == "H" ]]
    then
FECHA_INICIO_YYYYMM=$(echo $FECHA_INICIO | cut -c1-6 )
paramsPrint # $$$$ DEBUG
sleep 2
# guarda en archivo .parm
paramsPut
clear
echo $raya
# banner "PE Ripley"
echo "$ASCIIBanner"
echo $raya
paramsDisplay
echo $raya
# pregunta al ope si está satisfecho
continuar="_"
while [[ $continuar == "_" ]]
do
  echo " "
echo " "
echo " "
echo "Ingrese 1 para cambiar los parámetros, enter para continuar:\c"read continuarif [[ -z $continuar ]]then
parmsOK="1"
continuar="listo"else
if [[ $continuar == "1" ]]then
:
fi
fi
done
    done
}




#*******************************************************************************
#*******************************************************************************
#MAIN
#*******************************************************************************
#*******************************************************************************
    #Fecha y hora de ejecución
    horaInicio=$(date '+%H:%M:%S')
    FECHA_PROC=$(date '+%Y%m%d')
    FECHA_PROC_YYYYMM=$(echo $FECHA_PROC  | cut -c1-6)clear
OPEN MODEclearecho $raya#   banner "PE Ripley"echo "$ASCIIBanner"echo $raya#*******************************************************************************# Lectura de parámetros en la terminal#*******************************************************************************


    




    


    





OPEN MODEAPPEND MODE    [[ debug ]] && bannser "DEBUG"



:w"sh-PE-Ripley" 747 lines, 26841 characters 



[1] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>vi sh-PE-Ripleyma             vi sh-PE-Ripleysh-PE-Ripley   
sh-PE-Ripley[428]: syntax error at line 447 : `]]' unexpected
/d/iccol/desarrollo/macros>fg
vi sh-PE-Ripley
echo "$ASCIIBanner"echo $raya
paramsDisplay
echo $raya
# pregunta al ope si está satisfecho
continuar="_"
while [[ $continuar == "_" ]]
do
  echo " "
echo " "
echo " "
echo "Ingrese 1 para cambiar los parámetros, enter para continuar:\c"read continuarif [[ -z $continuar ]]then
parmsOK="1"
continuar="listo"else
if [[ $continuar == "1" ]]then
:
fi
fi
done
    done
}




#*******************************************************************************
#*******************************************************************************
#MAIN
#*******************************************************************************
#*******************************************************************************
    #Fecha y hora de ejecución
    horaInicio=$(date '+%H:%M:%S')
    FECHA_PROC=$(date '+%Y%m%d')
    FECHA_PROC_YYYYMM=$(echo $FECHA_PROC  | cut -c1-6)clear
echo $raya
#   banner "PE Ripley"
    echo "$ASCIIBanner"
    echo $raya
    [[ debug ]] && banner "DEBUG"

#*******************************************************************************
# Lectura de parámetros en la terminalecho "${s}actual"fi
}

ejecutar_extraccion() {
#***********************************************************************
# Extrae registros por suscriptor del archivo ICMCRECOPY.DAT en el prn
#***********************************************************************
    # el directorio del archivo cambia según el ambiente
    P_MAQUINA=$(hostname)
    if [[ $P_MAQUINA == $P_SERVER_DEV ]]
    then
echo "Máquina de desarrollo:" $P_MAQUINA
ICMCRECOPY='/despeciales/ICMCRECOPY.DAT'
    else
# echo "Máquina de producción:" $P_MAQUINA
ICMCRECOPY='$ESPECIALES/ctlc/ICMCRECOPY.DAT'
    fi
# extrae tipo y número de id por NIT del suscriptor, elimina repeticiones
    # $$$$ NIT para pruebas: 00900047981
    echo "el archivo de salida es "$archivo_prn " el input es "$ICMCRECOPY
    grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    # $$$$ DEBUG: regex que extrae TODOS los registros (delete 2 líneas desde acá)
    [[ debug ]] && grepRegex="^A......[14].*............P$"
    # echo "regex:"$grepRegex
    [[ -s $archivo_prn ]] && rm $archivo_prn
    grep "^A......[14].*"$ID_EXTRACT".P$" $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi

echo PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2[[ 
    fi
done
    done
}




#*******************************************************************************
#*******************************************************************************
#MAIN
#*******************************************************************************
#*******************************************************************************
    #Fecha y hora de ejecución
    horaInicio=$(date '+%H:%M:%S')
    FECHA_PROC=$(date '+%Y%m%d')
    FECHA_PROC_YYYYMM=$(echo $FECHA_PROC  | cut -c1-6)clear
echo $raya
#   banner "PE Ripley"
    echo "$ASCIIBanner"
    echo $raya
    [[ debug ]] && banner "DEBUG"

#*******************************************************************************
# Lectura de parámetros en la terminal
#*******************************************************************************
    leerParametros

#*******************************************************************************
# Nombres de los archivos, SANATA
#*******************************************************************************
    # la variable archivo es el nombre de la base, interna o del cliente,
    # y se usa para armar todos los demás nombres de archivos del proceso
    if [[ $BASE == "E" ]]
    then
# el nombre del archivo provisto, existente
archivo=$NOM_ARCHIVO
    else
# un nombre armado con "PERipley" y la fecha del día
# $$$$ no será posible ejecutar dos procesos en el mismo día
# $$$$ se puede agregar un $$ al file name ...
# $$$$ se puede controlar si ya existe un archivo de hoy ...
archivo="PERipley"$FECHA_PROC
NOM_ARCHIVO=$archivo
    fi
# arma los nombres de los archivos del proceso en base al anterior
    archivo_prn=$archivo.prn# /d/iccol/desarrollo/macros/sh-PE-Ripley
#sh-PE-Ripley.V.1.0001
#*******************************************************************************
#SHELL-ID:     sh-PE-Ripley
#DATE-WRITTEN: 2014/05/23
#LAST-UPDATE:  2014/05/23
#AUTHOR:Globant - JL
#*******************************************************************************
# Definición de constantes
    debug=1# cero para producción
    doCuu="1"# reposicionar el cursor luego de un error
    NOHUP=""# contiene "nohup" en producción, null para test
    cancelado="0"# las funciones ponen "1" para cancelar todo
    P_SERVER_DEV="codes"# hostname de la máquina de develop
    raya="----------------------------------------------------------------------"
    ASCIIBanner="
######  #######    ######
#     # ##     # # #####  ####### #   #
#     # ##     # # #    # ### #
######  ###########  # #    # ######    #
###   #   # #####  ###
###    #  # ####
########    #     # # ####### ######   #
"

# Parámetros y sus valores iniciales
    FECHA_PROC=$(date '+%Y%m%d')
#   "I": la lista de IDs es interna  "E": provista x cliente
    BASE="E"
#si BASE="E": archivo y estructura ("1": 1-11 o "2": 1-11-45)
NOM_ARCHIVO=" "
TIPO_ARCHIVO="2"
#si BASE="I": "N": extracción x NIT  "C": por cod suscriptor
TIPO_EXTRACT="N"
#si TIPO_EXTRACT="C": NIT (9) o Cod Suscriptor (6), según TIPO_EXTRACTID_EXTRACT=" "
#   Tipo de proceso "A": actual  "H": histórico
    TIPO_PROC="A"
#Si TIPO_PROC="H": la fecha inicio de proceso histórico
FECHA_INICIO=" "

readBASE() {
#*******************************************************************************
# Lee el valor de BASE hasta que es OK {I|C} o el ope cancela
#*******************************************************************************
    loopEnd="0"
    while [[ $loopEnd == "0" ]]
    do
  echo " "/debug/    else
echo "${s}actual"
    fi
}

ejecutar_extraccion() {
#***********************************************************************
# Extrae registros por suscriptor del archivo ICMCRECOPY.DAT en el prn
#***********************************************************************
    # el directorio del archivo cambia según el ambiente
    P_MAQUINA=$(hostname)
    if [[ $P_MAQUINA == $P_SERVER_DEV ]]
    then
echo "Máquina de desarrollo:" $P_MAQUINA
ICMCRECOPY='/despeciales/ICMCRECOPY.DAT'
    else
# echo "Máquina de producción:" $P_MAQUINA
ICMCRECOPY='$ESPECIALES/ctlc/ICMCRECOPY.DAT'
    fi
# extrae tipo y número de id por NIT del suscriptor, elimina repeticiones
    # $$$$ NIT para pruebas: 00900047981
    echo "el archivo de salida es "$archivo_prn " el input es "$ICMCRECOPY
    grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    # $$$$ DEBUG: regex que extrae TODOS los registros (delete 2 líneas desde acá)
    debug && grepRegex="^A......[14].*............P$"
    # echo "regex:"$grepRegex
    [[ -s $archivo_prn ]] && rm $archivo_prn
    grep "^A......[14].*"$ID_EXTRACT".P$" $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi:w"sh-PE-Ripley" 747 lines, 26835 characters [1] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>fgsh-PE-Ripley
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
sh-PE-Ripley[569]: syntax error at line 569 : `]]' unexpected
/d/iccol/desarrollo/macros>fg
vi sh-PE-Ripley
    else
echo "${s}actual"
    fi
}

ejecutar_extraccion() {
#***********************************************************************
# Extrae registros por suscriptor del archivo ICMCRECOPY.DAT en el prn
#***********************************************************************
    # el directorio del archivo cambia según el ambiente
    P_MAQUINA=$(hostname)
    if [[ $P_MAQUINA == $P_SERVER_DEV ]]
    then
echo "Máquina de desarrollo:" $P_MAQUINA
ICMCRECOPY='/despeciales/ICMCRECOPY.DAT'
    else
# echo "Máquina de producción:" $P_MAQUINA
ICMCRECOPY='$ESPECIALES/ctlc/ICMCRECOPY.DAT'
    fi
# extrae tipo y número de id por NIT del suscriptor, elimina repeticiones
    # $$$$ NIT para pruebas: 00900047981
    echo "el archivo de salida es "$archivo_prn " el input es "$ICMCRECOPY
    grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    # $$$$ DEBUG: regex que extrae TODOS los registros (delete 2 líneas desde acá)
    debug && grepRegex="^A......[14].*............P$"
    # echo "regex:"$grepRegex
    [[ -s $archivo_prn ]] && rm $archivo_prn
    grep "^A......[14].*"$ID_EXTRACT".P$" $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fifi
done
    done
}




#*******************************************************************************
#*******************************************************************************
#MAIN
#*******************************************************************************
#*******************************************************************************
    #Fecha y hora de ejecución
    horaInicio=$(date '+%H:%M:%S')
    FECHA_PROC=$(date '+%Y%m%d')
    FECHA_PROC_YYYYMM=$(echo $FECHA_PROC  | cut -c1-6)clear
echo $raya
#   banner "PE Ripley"
    echo "$ASCIIBanner"
    echo $raya
    [[ debug ]] && banner "DEBUG"

#*******************************************************************************
# Lectura de parámetros en la terminal
#*******************************************************************************
    leerParametros

#*******************************************************************************
# Nombres de los archivos, SANATA
#*******************************************************************************
    # la variable archivo es el nombre de la base, interna o del cliente,
    # y se usa para armar todos los demás nombres de archivos del proceso
    if [[ $BASE == "E" ]]
    then
# el nombre del archivo provisto, existente
archivo=$NOM_ARCHIVO
    else
# un nombre armado con "PERipley" y la fecha del día
# $$$$ no será posible ejecutar dos procesos en el mismo día
# $$$$ se puede agregar un $$ al file name ...
# $$$$ se puede controlar si ya existe un archivo de hoy ...
archivo="PERipley"$FECHA_PROC
NOM_ARCHIVO=$archivo
    fi
# arma los nombres de los archivos del proceso en base al anterior
    archivo_prn=$archivo.prn/??#   carga los valores del archivo .parmparamsGet
    # lee el set de parámetros hasta la satisfacción del ope
    parmsOK="0"
    while [[ $parmsOK == "0" ]]
    do
  readBASE# I interna, C cliente
if [[ $BASE == "E" ]]
then
readNOM_ARCHIVO# nombre del archivo basereadTIPO_ARCHIVO# 0 1-11, 1 1-11-45
else
readTIPO_EXTRACT# N NIT, C cod subsreadID_EXTRACT# NIT o cos subs
fi
readTIPO_PROC# A actual, H histórico
if [[ $TIPO_PROC == "H" ]]
then
readFECHA_INICIO# fecha desde
else
FECHA_INICIO=$FECHA_PROC
fi

paramsPrint # $$$$ DEBUG
sleep 2
# guarda en archivo .parm
paramsPut
clear
echo $raya
# banner "PE Ripley"
echo "$ASCIIBanner"
echo $raya
paramsDisplay
echo $raya
# pregunta al ope si está satisfecho
continuar="_"
while [[ $continuar == "_" ]]
do
  echo " "
echo " "
echo " "
echo "Ingrese 1 para cambiar los parámetros, enter para continuar:\c"read continuarif [[ -z $continuar ]]then
parmsOK="1"
continuar="listo"else
if [[ $continuar == "1" ]]?echo "${s}actual"fi
}

ejecutar_extraccion() {
#***********************************************************************
# Extrae registros por suscriptor del archivo ICMCRECOPY.DAT en el prn
#***********************************************************************
    # el directorio del archivo cambia según el ambiente
    P_MAQUINA=$(hostname)
    if [[ $P_MAQUINA == $P_SERVER_DEV ]]
    then
echo "Máquina de desarrollo:" $P_MAQUINA
ICMCRECOPY='/despeciales/ICMCRECOPY.DAT'
    else
# echo "Máquina de producción:" $P_MAQUINA
ICMCRECOPY='$ESPECIALES/ctlc/ICMCRECOPY.DAT'
    fi
# extrae tipo y número de id por NIT del suscriptor, elimina repeticiones
    # $$$$ NIT para pruebas: 00900047981
    echo "el archivo de salida es "$archivo_prn " el input es "$ICMCRECOPY
    grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    # $$$$ DEBUG: regex que extrae TODOS los registros (delete 2 líneas desde acá)
    debug && grepRegex="^A......[14].*............P$"
    # echo "regex:"$grepRegex
    [[ -s $archivo_prn ]] && rm $archivo_prn
    grep "^A......[14].*"$ID_EXTRACT".P$" $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi

echo PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2??# /d/iccol/desarrollo/macros/sh-PE-Ripley
#sh-PE-Ripley.V.1.0001
#*******************************************************************************
#SHELL-ID:     sh-PE-Ripley
#DATE-WRITTEN: 2014/05/23
#LAST-UPDATE:  2014/05/23
#AUTHOR:Globant - JL
#*******************************************************************************
# Definición de constantes
    debug=1# cero para producción
    doCuu="1"# reposicionar el cursor luego de un error
    NOHUP=""# contiene "nohup" en producción, null para test
    cancelado="0"# las funciones ponen "1" para cancelar todo
    P_SERVER_DEV="codes"# hostname de la máquina de develop
    raya="----------------------------------------------------------------------"
    ASCIIBanner="
######  #######    ######
#     # ##     # # #####  ####### #   #
#     # ##     # # #    # ### #
######  ###########  # #    # ######    #
###   #   # #####  ###
###    #  # ####
########    #     # # ####### ######   #
"

# Parámetros y sus valores iniciales
    FECHA_PROC=$(date '+%Y%m%d')
#   "I": la lista de IDs es interna  "E": provista x cliente
    BASE="E"
#si BASE="E": archivo y estructura ("1": 1-11 o "2": 1-11-45)
NOM_ARCHIVO=" "
TIPO_ARCHIVO="2"
#si BASE="I": "N": extracción x NIT  "C": por cod suscriptor
TIPO_EXTRACT="N"
#si TIPO_EXTRACT="C": NIT (9) o Cod Suscriptor (6), según TIPO_EXTRACTID_EXTRACT=" "
#   Tipo de proceso "A": actual  "H": histórico
    TIPO_PROC="A"
#Si TIPO_PROC="H": la fecha inicio de proceso histórico
FECHA_INICIO=" "

readBASE() {
#*******************************************************************************
# Lee el valor de BASE hasta que es OK {I|C} o el ope cancela
#*******************************************************************************
    loopEnd="0"
    while [[ $loopEnd == "0" ]]
    do
  echo " ":w"sh-PE-Ripley" 747 lines, 26829 characters [1] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>fgsh-PE-Ripley
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
sh-PE-Ripley[569]: debug:  not found
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:
 
                         TIPO DE EXTRACCIÓN
----------------------------------------------------------------------
      N) Por NIT
      C) Por codigo de suscriptor
      enter=N
 
            TIPO de EXTRACCIÓN:N
            TIPO de EXTRACCIÓN:
 
                        NIT PARA LA EXTRACCIÓN
----------------------------------------------------------------------
      Ingrese el NIT para extracción (11 dígitos),
      enter=00900047981
 
                    NIT:00900047981
                    NIT:
 
                          TIPO DE PROCESO
----------------------------------------------------------------------
      A) Proceso actual
      H) Proceso histórico
      enter=A
 
            TIPO de PROCESO:A
            TIPO de PROCESO:
BASE=I<
NOM_ARCHIVO=1<
TIPO_ARCHIVO=1<
TIPO_EXTRACT=N<
ID_EXTRACT=00900047981<
TIPO_PROC=A<
FECHA_INICIO=20140602<
I;1;1;N;00900047981;A;20140602
file: sh-PE-Ripley.parm  in: /d/iccol/desarrollo/macros
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
PARÁMETROS del PROCESO
    Fecha=20140602
    Archivo: 1
    Base: I  extraída de datos internos
    Criterio de extracción: N  por NIT 00900047981
    Tipo de proceso: A  actual
----------------------------------------------------------------------
 
 
 
Ingrese 1 para cambiar los parámetros, enter para continuar:
----------------------------------------------------------------------
EXTRACCIÓN: N 00900047981
Máquina de desarrollo: codes
el archivo de salida es PERipley20140602.prn  el input es /despeciales/ICMCRECOPY.DAT
sh-PE-Ripley[19]: debug:  not found
Registros extraídos:  765
Finalizada la extracción
----------------------------------------------------------------------
PESVNO: validación de IDs
Input PESVNO: PERipley20140602.prn
PESVNO PERipley20140602.prn_VALI PERipley20140602.val PERipley20140602.inc 10 2

real    0m0.13s
user    0m0.05s
sys     0m0.05s
PESVNO - registros válidos: 742  inconsistentes: 23  total: 765
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
766
ARCHIVO: PERipley20140602.prn_VALI     
Registro  control==> 000001 (VALIDAR=NO)
Registros Tipo 5           ==> 000742
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000023
Registros Tipo 5 repetidos ==> 000000
No hay un archivo de registros validados - PROCESO CANCELADO
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>sh-PE-Ripley
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
sh-PE-Ripley[569]: debug:  not found
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:^C
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>sh-PE-Ripleyvsh-PE-Ripleyish-PE-Ripley sh-PE-Ripley
"sh-PE-Ripley" 747 lines, 26829 characters # /d/iccol/desarrollo/macros/sh-PE-Ripley
#sh-PE-Ripley.V.1.0001
#*******************************************************************************
#SHELL-ID:     sh-PE-Ripley
#DATE-WRITTEN: 2014/05/23
#LAST-UPDATE:  2014/05/23
#AUTHOR:Globant - JL
#*******************************************************************************
# Definición de constantes
    debug=1# cero para producción
    doCuu="1"# reposicionar el cursor luego de un error
    NOHUP=""# contiene "nohup" en producción, null para test
    cancelado="0"# las funciones ponen "1" para cancelar todo
    P_SERVER_DEV="codes"# hostname de la máquina de develop
    raya="----------------------------------------------------------------------"
    ASCIIBanner="
######  #######    ######
#     # ##     # # #####  ####### #   #
#     # ##     # # #    # ### #
######  ###########  # #    # ######    #
###   #   # #####  ###
###    #  # ####
########    #     # # ####### ######   #
"

# Parámetros y sus valores iniciales
    FECHA_PROC=$(date '+%Y%m%d')
#   "I": la lista de IDs es interna  "E": provista x cliente
    BASE="E"
#si BASE="E": archivo y estructura ("1": 1-11 o "2": 1-11-45)
NOM_ARCHIVO=" "
TIPO_ARCHIVO="2"
#si BASE="I": "N": extracción x NIT  "C": por cod suscriptor
TIPO_EXTRACT="N"
#si TIPO_EXTRACT="C": NIT (9) o Cod Suscriptor (6), según TIPO_EXTRACTID_EXTRACT=" "
#   Tipo de proceso "A": actual  "H": histórico
    TIPO_PROC="A"
#Si TIPO_PROC="H": la fecha inicio de proceso histórico
FECHA_INICIO=" "

readBASE() {
#*******************************************************************************
# Lee el valor de BASE hasta que es OK {I|C} o el ope cancela
#*******************************************************************************
    loopEnd="0"
    while [[ $loopEnd == "0" ]]
    do
  echo " ""sh-PE-Ripley" 747 lines, 26829 characters/No previous regular expression/No previous regular expression/debug/    else
echo "${s}actual"
    fi
}

ejecutar_extraccion() {
#***********************************************************************
# Extrae registros por suscriptor del archivo ICMCRECOPY.DAT en el prn
#***********************************************************************
    # el directorio del archivo cambia según el ambiente
    P_MAQUINA=$(hostname)
    if [[ $P_MAQUINA == $P_SERVER_DEV ]]
    then
echo "Máquina de desarrollo:" $P_MAQUINA
ICMCRECOPY='/despeciales/ICMCRECOPY.DAT'
    else
# echo "Máquina de producción:" $P_MAQUINA
ICMCRECOPY='$ESPECIALES/ctlc/ICMCRECOPY.DAT'
    fi
# extrae tipo y número de id por NIT del suscriptor, elimina repeticiones
    # $$$$ NIT para pruebas: 00900047981
    echo "el archivo de salida es "$archivo_prn " el input es "$ICMCRECOPY
    grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    # $$$$ DEBUG: regex que extrae TODOS los registros (delete 2 líneas desde acá)
    debug && grepRegex="^A......[14].*............P$"
    # echo "regex:"$grepRegex
    [[ -s $archivo_prn ]] && rm $archivo_prn
    grep "^A......[14].*"$ID_EXTRACT".P$" $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi/INSERT MODE$//#   carga los valores del archivo .parmparamsGet
    # lee el set de parámetros hasta la satisfacción del ope
    parmsOK="0"
    while [[ $parmsOK == "0" ]]
    do
  readBASE# I interna, C cliente
if [[ $BASE == "E" ]]
then
readNOM_ARCHIVO# nombre del archivo basereadTIPO_ARCHIVO# 0 1-11, 1 1-11-45
else
readTIPO_EXTRACT# N NIT, C cod subsreadID_EXTRACT# NIT o cos subs
fi
readTIPO_PROC# A actual, H histórico
if [[ $TIPO_PROC == "H" ]]
then
readFECHA_INICIO# fecha desde
else
FECHA_INICIO=$FECHA_PROC
fi

paramsPrint # $$$$ DEBUG
sleep 2
# guarda en archivo .parm
paramsPut
clear
echo $raya
# banner "PE Ripley"
echo "$ASCIIBanner"
echo $raya
paramsDisplay
echo $raya
# pregunta al ope si está satisfecho
continuar="_"
while [[ $continuar == "_" ]]
do
  echo " "
echo " "
echo " "
echo "Ingrese 1 para cambiar los parámetros, enter para continuar:\c"read continuarif [[ -z $continuar ]]then
parmsOK="1"
continuar="listo"else
if [[ $continuar == "1" ]]/fi
done
    done
}




#*******************************************************************************
#*******************************************************************************
#MAIN
#*******************************************************************************
#*******************************************************************************
    #Fecha y hora de ejecución
    horaInicio=$(date '+%H:%M:%S')
    FECHA_PROC=$(date '+%Y%m%d')
    FECHA_PROC_YYYYMM=$(echo $FECHA_PROC  | cut -c1-6)clear
echo $raya
#   banner "PE Ripley"
    echo "$ASCIIBanner"
    echo $raya
    debug && banner "DEBUG"

#*******************************************************************************
# Lectura de parámetros en la terminal
#*******************************************************************************
    leerParametros

#*******************************************************************************
# Nombres de los archivos, SANATA
#*******************************************************************************
    # la variable archivo es el nombre de la base, interna o del cliente,
    # y se usa para armar todos los demás nombres de archivos del proceso
    if [[ $BASE == "E" ]]
    then
# el nombre del archivo provisto, existente
archivo=$NOM_ARCHIVO
    else
# un nombre armado con "PERipley" y la fecha del día
# $$$$ no será posible ejecutar dos procesos en el mismo día
# $$$$ se puede agregar un $$ al file name ...
# $$$$ se puede controlar si ya existe un archivo de hoy ...
archivo="PERipley"$FECHA_PROC
NOM_ARCHIVO=$archivo
    fi
# arma los nombres de los archivos del proceso en base al anterior
    archivo_prn=$archivo.prn$///# SCOTBATCH: cálculo de scores
# ...
#*******************************************************************************
    sleep 5
    echo $raya
    echo "SCOTBATCH: cálculo de scores"
    echo " "
    # echo "\n$raya\nSCOTBATCH:\n\n" >> $archivo_log
    # parámetros para el programa:
    formato="VAL"
    SCO41="041"     # ACIERTA A - VEHÍCULO E HIPOTECARIO
    SCO45="045"     # ACIERTA A - COOPERATIVAS
    SCO47="047"     # ACIERTA A - FINANCIERO
    SCO48="048"     # ACIERTA A - TARJETA DE CRÉDITO
    SCO49="049"     # ACIERTA A - TELECOMUNICACIONES
    SCO62="062"     # QUANTO
    SCO67="067"     # ACIERTA+
    SCO95="095"     # ACIERTA A INSTALAMENTOS
    SCO99="099"     # CARACTERISTICAS
    scoring="$SCO41$SCO45$SCO47$SCO48$SCO49$SCO62$SCO67$SCO95$SCO99"echo SCOTBATCH $FECHA_PROC_YYYYMM $scoring $formato $archivo_val
    $NOHUP x SCOTBATCH $FECHA_PROC_YYYYMM $scoring $formato $archivo_val
    # $$$$ DEBUG: show output >> $archivo.log 2>>$archivo.log

#*******************************************************************************
# Ejecución del programa iceprerip01
#*******************************************************************************
# Los parámetros son:
#    archivo de entrada de validados
#    archivo de entrada de inconsistencias
#    estructura del archivo ????
#    tipo de proceso ????
#    fecha del periodo
    sleep 5
$NOHUP x iceprerip01-test $archivo_val $archivo_inc 2 A $FECHA_PROC
    # $$$$ DEBUG: show output >> $archivo.log 2>>$archivo.log

#*******************************************************************************
# Nombres de los archivos
#*******************************************************************************
    # muestra los nombres de los archivos del proceso
    echo $raya
    echo "ARCHIVOS:"
    echo " "
    # echo "\n$raya\nICEPRERIP01:\n\n" >> $archivo_log
    ls $TEMPORALES/$archivo*
    echo " "//Address search hit BOTTOM without matching pattern:w"sh-PE-Ripley" 747 lines, 26831 characters [2] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>vi sh-PE-Ripleysh-PE-Ripley   sh-PE-Ripley
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
sh-PE-Ripley[569]: 1: cannot execute
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:
 
                         TIPO DE EXTRACCIÓN
----------------------------------------------------------------------
      N) Por NIT
      C) Por codigo de suscriptor
      enter=N
 
            TIPO de EXTRACCIÓN:N
            TIPO de EXTRACCIÓN:
 
                        NIT PARA LA EXTRACCIÓN
----------------------------------------------------------------------
      Ingrese el NIT para extracción (11 dígitos),
      enter=00900047981
 
                    NIT:00900047981
                    NIT:
 
                          TIPO DE PROCESO
----------------------------------------------------------------------
      A) Proceso actual
      H) Proceso histórico
      enter=A
 
            TIPO de PROCESO:A
            TIPO de PROCESO:
BASE=I<
NOM_ARCHIVO=1<
TIPO_ARCHIVO=1<
TIPO_EXTRACT=N<
ID_EXTRACT=00900047981<
TIPO_PROC=A<
FECHA_INICIO=20140602<
I;1;1;N;00900047981;A;20140602
file: sh-PE-Ripley.parm  in: /d/iccol/desarrollo/macros
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
PARÁMETROS del PROCESO
    Fecha=20140602
    Archivo: 1
    Base: I  extraída de datos internos
    Criterio de extracción: N  por NIT 00900047981
    Tipo de proceso: A  actual
----------------------------------------------------------------------
 
 
 
Ingrese 1 para cambiar los parámetros, enter para continuar:^C
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>sh-PE-Ripley
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
sh-PE-Ripley[569]: 1: cannot execute
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:^C
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>sh-PE-Ripleysh-PE-Ripleyvi sh-PE-Ripley
"sh-PE-Ripley" 747 lines, 26831 characters # /d/iccol/desarrollo/macros/sh-PE-Ripley
#sh-PE-Ripley.V.1.0001
#*******************************************************************************
#SHELL-ID:     sh-PE-Ripley
#DATE-WRITTEN: 2014/05/23
#LAST-UPDATE:  2014/05/23
#AUTHOR:Globant - JL
#*******************************************************************************
# Definición de constantes
    debug=1# cero para producción
    doCuu="1"# reposicionar el cursor luego de un error
    NOHUP=""# contiene "nohup" en producción, null para test
    cancelado="0"# las funciones ponen "1" para cancelar todo
    P_SERVER_DEV="codes"# hostname de la máquina de develop
    raya="----------------------------------------------------------------------"
    ASCIIBanner="
######  #######    ######
#     # ##     # # #####  ####### #   #
#     # ##     # # #    # ### #
######  ###########  # #    # ######    #
###   #   # #####  ###
###    #  # ####
########    #     # # ####### ######   #
"

# Parámetros y sus valores iniciales
    FECHA_PROC=$(date '+%Y%m%d')
#   "I": la lista de IDs es interna  "E": provista x cliente
    BASE="E"
#si BASE="E": archivo y estructura ("1": 1-11 o "2": 1-11-45)
NOM_ARCHIVO=" "
TIPO_ARCHIVO="2"
#si BASE="I": "N": extracción x NIT  "C": por cod suscriptor
TIPO_EXTRACT="N"
#si TIPO_EXTRACT="C": NIT (9) o Cod Suscriptor (6), según TIPO_EXTRACTID_EXTRACT=" "
#   Tipo de proceso "A": actual  "H": histórico
    TIPO_PROC="A"
#Si TIPO_PROC="H": la fecha inicio de proceso histórico
FECHA_INICIO=" "

readBASE() {
#*******************************************************************************
# Lee el valor de BASE hasta que es OK {I|C} o el ope cancela
#*******************************************************************************
    loopEnd="0"
    while [[ $loopEnd == "0" ]]
    do
  echo " ""sh-PE-Ripley" 747 lines, 26831 charactersfi
done
    done
}




#*******************************************************************************
#*******************************************************************************
#MAIN
#*******************************************************************************
#*******************************************************************************
    #Fecha y hora de ejecución
    horaInicio=$(date '+%H:%M:%S')
    FECHA_PROC=$(date '+%Y%m%d')
    FECHA_PROC_YYYYMM=$(echo $FECHA_PROC  | cut -c1-6)clear
echo $raya
#   banner "PE Ripley"
    echo "$ASCIIBanner"
    echo $raya
    $debug && banner "DEBUG"

#*******************************************************************************
# Lectura de parámetros en la terminal
#*******************************************************************************
    leerParametros

#*******************************************************************************
# Nombres de los archivos, SANATA
#*******************************************************************************
    # la variable archivo es el nombre de la base, interna o del cliente,
    # y se usa para armar todos los demás nombres de archivos del proceso
    if [[ $BASE == "E" ]]
    then
# el nombre del archivo provisto, existente
archivo=$NOM_ARCHIVO
    else
# un nombre armado con "PERipley" y la fecha del día
# $$$$ no será posible ejecutar dos procesos en el mismo día
# $$$$ se puede agregar un $$ al file name ...
# $$$$ se puede controlar si ya existe un archivo de hoy ...
archivo="PERipley"$FECHA_PROC
NOM_ARCHIVO=$archivo
    fi
# arma los nombres de los archivos del proceso en base al anterior
    archivo_prn=$archivo.prn$&& INSERT MODEecho $([3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>banner "DEBUG"
######  ####### ######  #     #  #####
#     # #       #     # #     # #     #
#     # #       #     # #     # #
#     # #####   ######  #     # #  ####
#     # #       #     # #     # #     #
#     # #       #     # #     # #     #
######  ####### ######   #####   #####

/d/iccol/desarrollo/macros>banner DEBUG
######  ####### ######  #     #  #####
#     # #       #     # #     # #     #
#     # #       #     # #     # #
#     # #####   ######  #     # #  ####
#     # #       #     # #     # #     #
#     # #       #     # #     # #     #
######  ####### ######   #####   #####

/d/iccol/desarrollo/macros>fg
vi sh-PE-Ripley
fi
done
    done
}




#*******************************************************************************
#*******************************************************************************
#MAIN
#*******************************************************************************
#*******************************************************************************
    #Fecha y hora de ejecución
    horaInicio=$(date '+%H:%M:%S')
    FECHA_PROC=$(date '+%Y%m%d')
    FECHA_PROC_YYYYMM=$(echo $FECHA_PROC  | cut -c1-6)clear
echo $raya
#   banner "PE Ripley"
    echo "$ASCIIBanner"
    echo $raya
    $debug && echo $(banner "DEBUG"

#*******************************************************************************
# Lectura de parámetros en la terminal
#*******************************************************************************
    leerParametros

#*******************************************************************************
# Nombres de los archivos, SANATA
#*******************************************************************************
    # la variable archivo es el nombre de la base, interna o del cliente,
    # y se usa para armar todos los demás nombres de archivos del proceso
    if [[ $BASE == "E" ]]
    then
# el nombre del archivo provisto, existente
archivo=$NOM_ARCHIVO
    else
# un nombre armado con "PERipley" y la fecha del día
# $$$$ no será posible ejecutar dos procesos en el mismo día
# $$$$ se puede agregar un $$ al file name ...
# $$$$ se puede controlar si ya existe un archivo de hoy ...
archivo="PERipley"$FECHA_PROC
NOM_ARCHIVO=$archivo
    fi
# arma los nombres de los archivos del proceso en base al anterior
    archivo_prn=$archivo.prn"APPEND MODE)# /d/iccol/desarrollo/macros/sh-PE-Ripley
#sh-PE-Ripley.V.1.0001
#*******************************************************************************
#SHELL-ID:     sh-PE-Ripley
#DATE-WRITTEN: 2014/05/23
#LAST-UPDATE:  2014/05/23
#AUTHOR:Globant - JL
#*******************************************************************************
# Definición de constantes
    debug=1# cero para producción
    doCuu="1"# reposicionar el cursor luego de un error
    NOHUP=""# contiene "nohup" en producción, null para test
    cancelado="0"# las funciones ponen "1" para cancelar todo
    P_SERVER_DEV="codes"# hostname de la máquina de develop
    raya="----------------------------------------------------------------------"
    ASCIIBanner="
######  #######    ######
#     # ##     # # #####  ####### #   #
#     # ##     # # #    # ### #
######  ###########  # #    # ######    #
###   #   # #####  ###
###    #  # ####
########    #     # # ####### ######   #
"

# Parámetros y sus valores iniciales
    FECHA_PROC=$(date '+%Y%m%d')
#   "I": la lista de IDs es interna  "E": provista x cliente
    BASE="E"
#si BASE="E": archivo y estructura ("1": 1-11 o "2": 1-11-45)
NOM_ARCHIVO=" "
TIPO_ARCHIVO="2"
#si BASE="I": "N": extracción x NIT  "C": por cod suscriptor
TIPO_EXTRACT="N"
#si TIPO_EXTRACT="C": NIT (9) o Cod Suscriptor (6), según TIPO_EXTRACTID_EXTRACT=" "
#   Tipo de proceso "A": actual  "H": histórico
    TIPO_PROC="A"
#Si TIPO_PROC="H": la fecha inicio de proceso histórico
FECHA_INICIO=" "

readBASE() {
#*******************************************************************************
# Lee el valor de BASE hasta que es OK {I|C} o el ope cancela
#*******************************************************************************
    loopEnd="0"
    while [[ $loopEnd == "0" ]]
    do
  echo " "fi
done
    done
}




#*******************************************************************************
#*******************************************************************************
#MAIN
#*******************************************************************************
#*******************************************************************************
    #Fecha y hora de ejecución
    horaInicio=$(date '+%H:%M:%S')
    FECHA_PROC=$(date '+%Y%m%d')
    FECHA_PROC_YYYYMM=$(echo $FECHA_PROC  | cut -c1-6)clear
echo $raya
#   banner "PE Ripley"
    echo "$ASCIIBanner"
    echo $raya
    $debug && echo $(banner "DEBUG")

#*******************************************************************************
# Lectura de parámetros en la terminal
#*******************************************************************************
    leerParametros

#*******************************************************************************
# Nombres de los archivos, SANATA
#*******************************************************************************
    # la variable archivo es el nombre de la base, interna o del cliente,
    # y se usa para armar todos los demás nombres de archivos del proceso
    if [[ $BASE == "E" ]]
    then
# el nombre del archivo provisto, existente
archivo=$NOM_ARCHIVO
    else
# un nombre armado con "PERipley" y la fecha del día
# $$$$ no será posible ejecutar dos procesos en el mismo día
# $$$$ se puede agregar un $$ al file name ...
# $$$$ se puede controlar si ya existe un archivo de hoy ...
archivo="PERipley"$FECHA_PROC
NOM_ARCHIVO=$archivo
    fi
# arma los nombres de los archivos del proceso en base al anterior
    archivo_prn=$archivo.prn:w"sh-PE-Ripley" 747 lines, 26839 characters [3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>fgbanner DEBUGbanner "DEBUG"vi sh-PE-Ripleysh-PE-Ripley   
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
sh-PE-Ripley[569]: 1: cannot execute
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:^C
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>sh-PE-Ripleyfg          banner DEBUGbanner "DEBUG"banner DEBUG  fg          sh-PE-Ripleyfg          
vi sh-PE-Ripley
fi
done
    done
}




#*******************************************************************************
#*******************************************************************************
#MAIN
#*******************************************************************************
#*******************************************************************************
    #Fecha y hora de ejecución
    horaInicio=$(date '+%H:%M:%S')
    FECHA_PROC=$(date '+%Y%m%d')
    FECHA_PROC_YYYYMM=$(echo $FECHA_PROC  | cut -c1-6)clear
echo $raya
#   banner "PE Ripley"
    echo "$ASCIIBanner"
    echo $raya
    $debug && echo $(banner "DEBUG")

#*******************************************************************************
# Lectura de parámetros en la terminal
#*******************************************************************************
    leerParametros

#*******************************************************************************
# Nombres de los archivos, SANATA
#*******************************************************************************
    # la variable archivo es el nombre de la base, interna o del cliente,
    # y se usa para armar todos los demás nombres de archivos del proceso
    if [[ $BASE == "E" ]]
    then
# el nombre del archivo provisto, existente
archivo=$NOM_ARCHIVO
    else
# un nombre armado con "PERipley" y la fecha del día
# $$$$ no será posible ejecutar dos procesos en el mismo día
# $$$$ se puede agregar un $$ al file name ...
# $$$$ se puede controlar si ya existe un archivo de hoy ...
archivo="PERipley"$FECHA_PROC
NOM_ARCHIVO=$archivo
    fi
# arma los nombres de los archivos del proceso en base al anterior
    archivo_prn=$archivo.prnarchivo_val=$archivo.val# /d/iccol/desarrollo/macros/sh-PE-Ripley
#sh-PE-Ripley.V.1.0001
#*******************************************************************************
#SHELL-ID:     sh-PE-Ripley
#DATE-WRITTEN: 2014/05/23
#LAST-UPDATE:  2014/05/23
#AUTHOR:Globant - JL
#*******************************************************************************
# Definición de constantes
    debug=1# cero para producción
    doCuu="1"# reposicionar el cursor luego de un error
    NOHUP=""# contiene "nohup" en producción, null para test
    cancelado="0"# las funciones ponen "1" para cancelar todo
    P_SERVER_DEV="codes"# hostname de la máquina de develop
    raya="----------------------------------------------------------------------"
    ASCIIBanner="
######  #######    ######
#     # ##     # # #####  ####### #   #
#     # ##     # # #    # ### #
######  ###########  # #    # ######    #
###   #   # #####  ###
###    #  # ####
########    #     # # ####### ######   #
"

# Parámetros y sus valores iniciales
    FECHA_PROC=$(date '+%Y%m%d')
#   "I": la lista de IDs es interna  "E": provista x cliente
    BASE="E"
#si BASE="E": archivo y estructura ("1": 1-11 o "2": 1-11-45)
NOM_ARCHIVO=" "
TIPO_ARCHIVO="2"
#si BASE="I": "N": extracción x NIT  "C": por cod suscriptor
TIPO_EXTRACT="N"
#si TIPO_EXTRACT="C": NIT (9) o Cod Suscriptor (6), según TIPO_EXTRACTID_EXTRACT=" "
#   Tipo de proceso "A": actual  "H": histórico
    TIPO_PROC="A"
#Si TIPO_PROC="H": la fecha inicio de proceso histórico
FECHA_INICIO=" "

readBASE() {
#*******************************************************************************
# Lee el valor de BASE hasta que es OK {I|C} o el ope cancela
#*******************************************************************************
    loopEnd="0"
    while [[ $loopEnd == "0" ]]
    do
  echo " "








    fi
done
    done
}




#*******************************************************************************
#*******************************************************************************
#MAIN
#*******************************************************************************
#*******************************************************************************
    #Fecha y hora de ejecución
    horaInicio=$(date '+%H:%M:%S')
    FECHA_PROC=$(date '+%Y%m%d')
    FECHA_PROC_YYYYMM=$(echo $FECHA_PROC  | cut -c1-6)clear
echo $raya
#   banner "PE Ripley"
    echo "$ASCIIBanner"
    echo $raya
    $debug && echo $(banner "DEBUG")

#*******************************************************************************
# Lectura de parámetros en la terminal
#*******************************************************************************
    leerParametros

#*******************************************************************************
# Nombres de los archivos, SANATA
#*******************************************************************************
    # la variable archivo es el nombre de la base, interna o del cliente,
    # y se usa para armar todos los demás nombres de archivos del proceso
    if [[ $BASE == "E" ]]
    then
# el nombre del archivo provisto, existente
archivo=$NOM_ARCHIVO
    else
# un nombre armado con "PERipley" y la fecha del día
# $$$$ no será posible ejecutar dos procesos en el mismo día
# $$$$ se puede agregar un $$ al file name ...
# $$$$ se puede controlar si ya existe un archivo de hoy ...
archivo="PERipley"$FECHA_PROC
NOM_ARCHIVO=$archivo
    fi
# arma los nombres de los archivos del proceso en base al anterior
    archivo_prn=$archivo.prn
1 more line$debug && echo "DEBUG")"":w"sh-PE-Ripley" 747 lines, 26829 characters [3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>fgsh-PE-Ripley
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
sh-PE-Ripley[569]: 1: cannot execute
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:^C
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>sh-PE-Ripleyfg          sh-PE-Ripleyfg          
vi sh-PE-Ripley
fi
done
    done
}




#*******************************************************************************
#*******************************************************************************
#MAIN
#*******************************************************************************
#*******************************************************************************
    #Fecha y hora de ejecución
    horaInicio=$(date '+%H:%M:%S')
    FECHA_PROC=$(date '+%Y%m%d')
    FECHA_PROC_YYYYMM=$(echo $FECHA_PROC  | cut -c1-6)clear
echo $raya
#   banner "PE Ripley"
    echo "$ASCIIBanner"
    echo $raya
    $debug && echo "DEBUG"

#*******************************************************************************
# Lectura de parámetros en la terminal
#*******************************************************************************
    leerParametros

#*******************************************************************************
# Nombres de los archivos, SANATA
#*******************************************************************************
    # la variable archivo es el nombre de la base, interna o del cliente,
    # y se usa para armar todos los demás nombres de archivos del proceso
    if [[ $BASE == "E" ]]
    then
# el nombre del archivo provisto, existente
archivo=$NOM_ARCHIVO
    else
# un nombre armado con "PERipley" y la fecha del día
# $$$$ no será posible ejecutar dos procesos en el mismo día
# $$$$ se puede agregar un $$ al file name ...
# $$$$ se puede controlar si ya existe un archivo de hoy ...
archivo="PERipley"$FECHA_PROC
NOM_ARCHIVO=$archivo
    fi
# arma los nombres de los archivos del proceso en base al anterior
    archivo_prn=$archivo.prn    INSERT MODE[[  $debugAPPEND MODE -eq 1 ]] :w"sh-PE-Ripley" 747 lines, 26841 characters [3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>fgsh-PE-Ripley
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
DEBUG
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:
 
                         TIPO DE EXTRACCIÓN
----------------------------------------------------------------------
      N) Por NIT
      C) Por codigo de suscriptor
      enter=N
 
            TIPO de EXTRACCIÓN:N
            TIPO de EXTRACCIÓN:
 
                        NIT PARA LA EXTRACCIÓN
----------------------------------------------------------------------
      Ingrese el NIT para extracción (11 dígitos),
      enter=00900047981
 
                    NIT:00900047981
                    NIT:
 
                          TIPO DE PROCESO
----------------------------------------------------------------------
      A) Proceso actual
      H) Proceso histórico
      enter=A
 
            TIPO de PROCESO:A
            TIPO de PROCESO:
BASE=I<
NOM_ARCHIVO=1<
TIPO_ARCHIVO=1<
TIPO_EXTRACT=N<
ID_EXTRACT=00900047981<
TIPO_PROC=A<
FECHA_INICIO=20140602<
I;1;1;N;00900047981;A;20140602
file: sh-PE-Ripley.parm  in: /d/iccol/desarrollo/macros
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
PARÁMETROS del PROCESO
    Fecha=20140602
    Archivo: 1
    Base: I  extraída de datos internos
    Criterio de extracción: N  por NIT 00900047981
    Tipo de proceso: A  actual
----------------------------------------------------------------------
 
 
 
Ingrese 1 para cambiar los parámetros, enter para continuar:
----------------------------------------------------------------------
EXTRACCIÓN: N 00900047981
Máquina de desarrollo: codes
el archivo de salida es PERipley20140602.prn  el input es /despeciales/ICMCRECOPY.DAT
sh-PE-Ripley[19]: 1: cannot execute
Registros extraídos:  765
Finalizada la extracción
----------------------------------------------------------------------
PESVNO: validación de IDs
Input PESVNO: PERipley20140602.prn
PESVNO PERipley20140602.prn_VALI PERipley20140602.val PERipley20140602.inc 10 2

real    0m0.13s
user    0m0.05s
sys     0m0.05s
PESVNO - registros válidos: 742  inconsistentes: 23  total: 765
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
766
ARCHIVO: PERipley20140602.prn_VALI     
Registro  control==> 000001 (VALIDAR=NO)
Registros Tipo 5           ==> 000742
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000023
Registros Tipo 5 repetidos ==> 000000
No hay un archivo de registros validados - PROCESO CANCELADO
/d/iccol/desarrollo/macros>fg
vi sh-PE-Ripley
fi
done
    done
}




#*******************************************************************************
#*******************************************************************************
#MAIN
#*******************************************************************************
#*******************************************************************************
    #Fecha y hora de ejecución
    horaInicio=$(date '+%H:%M:%S')
    FECHA_PROC=$(date '+%Y%m%d')
    FECHA_PROC_YYYYMM=$(echo $FECHA_PROC  | cut -c1-6)clear
echo $raya
#   banner "PE Ripley"
    echo "$ASCIIBanner"
    echo $raya
    [[ $debug -eq 1 ]] && echo "DEBUG"

#*******************************************************************************
# Lectura de parámetros en la terminal
#*******************************************************************************
    leerParametros

#*******************************************************************************
# Nombres de los archivos, SANATA
#*******************************************************************************
    # la variable archivo es el nombre de la base, interna o del cliente,
    # y se usa para armar todos los demás nombres de archivos del proceso
    if [[ $BASE == "E" ]]
    then
# el nombre del archivo provisto, existente
archivo=$NOM_ARCHIVO
    else
# un nombre armado con "PERipley" y la fecha del día
# $$$$ no será posible ejecutar dos procesos en el mismo día
# $$$$ se puede agregar un $$ al file name ...
# $$$$ se puede controlar si ya existe un archivo de hoy ...
archivo="PERipley"$FECHA_PROC
NOM_ARCHIVO=$archivo
    fi
# arma los nombres de los archivos del proceso en base al anterior
    archivo_prn=$archivo.prn/debug??#   carga los valores del archivo .parmparamsGet
    # lee el set de parámetros hasta la satisfacción del ope
    parmsOK="0"
    while [[ $parmsOK == "0" ]]
    do
  readBASE# I interna, C cliente
if [[ $BASE == "E" ]]
then
readNOM_ARCHIVO# nombre del archivo basereadTIPO_ARCHIVO# 0 1-11, 1 1-11-45
else
readTIPO_EXTRACT# N NIT, C cod subsreadID_EXTRACT# NIT o cos subs
fi
readTIPO_PROC# A actual, H histórico
if [[ $TIPO_PROC == "H" ]]
then
readFECHA_INICIO# fecha desde
else
FECHA_INICIO=$FECHA_PROC
fi

paramsPrint # $$$$ DEBUG
sleep 2
# guarda en archivo .parm
paramsPut
clear
echo $raya
# banner "PE Ripley"
echo "$ASCIIBanner"
echo $raya
paramsDisplay
echo $raya
# pregunta al ope si está satisfecho
continuar="_"
while [[ $continuar == "_" ]]
do
  echo " "
echo " "
echo " "
echo "Ingrese 1 para cambiar los parámetros, enter para continuar:\c"read continuarif [[ -z $continuar ]]then
parmsOK="1"
continuar="listo"else
if [[ $continuar == "1" ]]?echo "${s}actual"fi
}

ejecutar_extraccion() {
#***********************************************************************
# Extrae registros por suscriptor del archivo ICMCRECOPY.DAT en el prn
#***********************************************************************
    # el directorio del archivo cambia según el ambiente
    P_MAQUINA=$(hostname)
    if [[ $P_MAQUINA == $P_SERVER_DEV ]]
    then
echo "Máquina de desarrollo:" $P_MAQUINA
ICMCRECOPY='/despeciales/ICMCRECOPY.DAT'
    else
# echo "Máquina de producción:" $P_MAQUINA
ICMCRECOPY='$ESPECIALES/ctlc/ICMCRECOPY.DAT'
    fi
# extrae tipo y número de id por NIT del suscriptor, elimina repeticiones
    # $$$$ NIT para pruebas: 00900047981
    echo "el archivo de salida es "$archivo_prn " el input es "$ICMCRECOPY
    grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    # $$$$ DEBUG: regex que extrae TODOS los registros (delete 2 líneas desde acá)
    $debug && grepRegex="^A......[14].*............P$"
    # echo "regex:"$grepRegex
    [[ -s $archivo_prn ]] && rm $archivo_prn
    grep "^A......[14].*"$ID_EXTRACT".P$" $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi

echo PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2INSERT MODE[[ gAPPEND MODE -eq 1 ]] :w"sh-PE-Ripley" 747 lines, 26853 characters [3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>fgsh-PE-Ripley
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
DEBUG
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:
 
                         TIPO DE EXTRACCIÓN
----------------------------------------------------------------------
      N) Por NIT
      C) Por codigo de suscriptor
      enter=N
 
            TIPO de EXTRACCIÓN:N
            TIPO de EXTRACCIÓN:
 
                        NIT PARA LA EXTRACCIÓN
----------------------------------------------------------------------
      Ingrese el NIT para extracción (11 dígitos),
      enter=00900047981
 
                    NIT:00900047981
                    NIT:
 
                          TIPO DE PROCESO
----------------------------------------------------------------------
      A) Proceso actual
      H) Proceso histórico
      enter=A
 
            TIPO de PROCESO:A
            TIPO de PROCESO:
BASE=I<
NOM_ARCHIVO=1<
TIPO_ARCHIVO=1<
TIPO_EXTRACT=N<
ID_EXTRACT=00900047981<
TIPO_PROC=A<
FECHA_INICIO=20140602<
I;1;1;N;00900047981;A;20140602
file: sh-PE-Ripley.parm  in: /d/iccol/desarrollo/macros
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
PARÁMETROS del PROCESO
    Fecha=20140602
    Archivo: 1
    Base: I  extraída de datos internos
    Criterio de extracción: N  por NIT 00900047981
    Tipo de proceso: A  actual
----------------------------------------------------------------------
 
 
 
Ingrese 1 para cambiar los parámetros, enter para continuar:
----------------------------------------------------------------------
EXTRACCIÓN: N 00900047981
Máquina de desarrollo: codes
el archivo de salida es PERipley20140602.prn  el input es /despeciales/ICMCRECOPY.DAT
Registros extraídos:  765
Finalizada la extracción
----------------------------------------------------------------------
PESVNO: validación de IDs
Input PESVNO: PERipley20140602.prn
PESVNO PERipley20140602.prn_VALI PERipley20140602.val PERipley20140602.inc 10 2

real    0m0.13s
user    0m0.05s
sys     0m0.05s
PESVNO - registros válidos: 742  inconsistentes: 23  total: 765
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
766
ARCHIVO: PERipley20140602.prn_VALI     
Registro  control==> 000001 (VALIDAR=NO)
Registros Tipo 5           ==> 000742
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000023
Registros Tipo 5 repetidos ==> 000000
No hay un archivo de registros validados - PROCESO CANCELADO
/d/iccol/desarrollo/macros>fg
vi sh-PE-Ripley
echo "${s}actual"fi
}

ejecutar_extraccion() {
#***********************************************************************
# Extrae registros por suscriptor del archivo ICMCRECOPY.DAT en el prn
#***********************************************************************
    # el directorio del archivo cambia según el ambiente
    P_MAQUINA=$(hostname)
    if [[ $P_MAQUINA == $P_SERVER_DEV ]]
    then
echo "Máquina de desarrollo:" $P_MAQUINA
ICMCRECOPY='/despeciales/ICMCRECOPY.DAT'
    else
# echo "Máquina de producción:" $P_MAQUINA
ICMCRECOPY='$ESPECIALES/ctlc/ICMCRECOPY.DAT'
    fi
# extrae tipo y número de id por NIT del suscriptor, elimina repeticiones
    # $$$$ NIT para pruebas: 00900047981
    echo "el archivo de salida es "$archivo_prn " el input es "$ICMCRECOPY
    grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    # $$$$ DEBUG: regex que extrae TODOS los registros (delete 2 líneas desde acá)
    [[ $debug -eq 1 ]] && grepRegex="^A......[14].*............P$"
    # echo "regex:"$grepRegex
    [[ -s $archivo_prn ]] && rm $archivo_prn
    grep "^A......[14].*"$ID_EXTRACT".P$" $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi

echo PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2    [[ $debug -eq 1     INSERT MODE########## :w"sh-PE-Ripley" 747 lines, 26842 characters [3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>fgsh-PE-Ripley
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
DEBUG
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:
 
                         TIPO DE EXTRACCIÓN
----------------------------------------------------------------------
      N) Por NIT
      C) Por codigo de suscriptor
      enter=N
 
            TIPO de EXTRACCIÓN:N
            TIPO de EXTRACCIÓN:
 
                        NIT PARA LA EXTRACCIÓN
----------------------------------------------------------------------
      Ingrese el NIT para extracción (11 dígitos),
      enter=00900047981
 
                    NIT:00900047981
                    NIT:
 
                          TIPO DE PROCESO
----------------------------------------------------------------------
      A) Proceso actual
      H) Proceso histórico
      enter=A
 
            TIPO de PROCESO:A
            TIPO de PROCESO:
BASE=I<
NOM_ARCHIVO=1<
TIPO_ARCHIVO=1<
TIPO_EXTRACT=N<
ID_EXTRACT=00900047981<
TIPO_PROC=A<
FECHA_INICIO=20140602<
I;1;1;N;00900047981;A;20140602
file: sh-PE-Ripley.parm  in: /d/iccol/desarrollo/macros
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
PARÁMETROS del PROCESO
    Fecha=20140602
    Archivo: 1
    Base: I  extraída de datos internos
    Criterio de extracción: N  por NIT 00900047981
    Tipo de proceso: A  actual
----------------------------------------------------------------------
 
 
 
Ingrese 1 para cambiar los parámetros, enter para continuar:
----------------------------------------------------------------------
EXTRACCIÓN: N 00900047981
Máquina de desarrollo: codes
el archivo de salida es PERipley20140602.prn  el input es /despeciales/ICMCRECOPY.DAT
Registros extraídos:  765
Finalizada la extracción
----------------------------------------------------------------------
PESVNO: validación de IDs
Input PESVNO: PERipley20140602.prn
PESVNO PERipley20140602.prn_VALI PERipley20140602.val PERipley20140602.inc 10 2

real    0m0.13s
user    0m0.05s
sys     0m0.05s
PESVNO - registros válidos: 742  inconsistentes: 23  total: 765
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
766
ARCHIVO: PERipley20140602.prn_VALI     
Registro  control==> 000001 (VALIDAR=NO)
Registros Tipo 5           ==> 000742
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000023
Registros Tipo 5 repetidos ==> 000000
No hay un archivo de registros validados - PROCESO CANCELADO
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>sh-PE-Ripleyfg          sh-PE-Ripleyfg          sh-PE-Ripleyfg          sh-PE-Ripleyfg          sh-PE-Ripleyfg          banner DEBUGbanner "DEBUG"vi sh-PE-Ripleysh-PE-Ripley   sh-PE-Ripleyvi sh-PE-Ripleysh-PE-Ripley   sh-PE-Ripleyfg          sh-PE-Ripleyfg          sh-PE-Ripleyvi sh-PE-Ripleyma             . visetfg     rm $TEMPORALES/archivo _prn _VALI/d/iccol/desarrollo/macros>vi $TEMPORALES/archivo _prn _VALI/d/iccol/desarrollo/macros>vi archivo _prn _VALI            /d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>
-rw-rw-r--   1 icjlud   icdatacr    1283 Jun  2 16:00 /d/iccol/desarrollo/temporales/PERipley20140602.log
-rw-rw-r--   1 icjlud   icdatacr    9945 Jun  2 16:00 /d/iccol/desarrollo/temporales/PERipley20140602.prn
-rw-rw-r--   1 icjlud   icdatacr    9969 Jun  2 16:00 /d/iccol/desarrollo/temporales/PERipley20140602.prn_VALI
-rw-rw-r--   1 icjlud   icdatacr       0 Jun  2 16:00 /d/iccol/desarrollo/temporales/PERipley20140602.vre
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros> $TEMPORALES/PERipley20140602*      /d/iccol/desarrollo/macros>r $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>rm $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>rm
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>rm $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>sh-PE-Ripley                        /d/iccol/desarrollo/macros>
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
DEBUG
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:
 
                         TIPO DE EXTRACCIÓN
----------------------------------------------------------------------
      N) Por NIT
      C) Por codigo de suscriptor
      enter=N
 
            TIPO de EXTRACCIÓN:N
            TIPO de EXTRACCIÓN:
 
                        NIT PARA LA EXTRACCIÓN
----------------------------------------------------------------------
      Ingrese el NIT para extracción (11 dígitos),
      enter=00900047981
 
                    NIT:00900047981
                    NIT:
 
                          TIPO DE PROCESO
----------------------------------------------------------------------
      A) Proceso actual
      H) Proceso histórico
      enter=A
 
            TIPO de PROCESO:A
            TIPO de PROCESO:
BASE=I<
NOM_ARCHIVO=1<
TIPO_ARCHIVO=1<
TIPO_EXTRACT=N<
ID_EXTRACT=00900047981<
TIPO_PROC=A<
FECHA_INICIO=20140602<
I;1;1;N;00900047981;A;20140602
file: sh-PE-Ripley.parm  in: /d/iccol/desarrollo/macros
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
PARÁMETROS del PROCESO
    Fecha=20140602
    Archivo: 1
    Base: I  extraída de datos internos
    Criterio de extracción: N  por NIT 00900047981
    Tipo de proceso: A  actual
----------------------------------------------------------------------
 
 
 
Ingrese 1 para cambiar los parámetros, enter para continuar:
----------------------------------------------------------------------
EXTRACCIÓN: N 00900047981
Máquina de desarrollo: codes
el archivo de salida es PERipley20140602.prn  el input es /despeciales/ICMCRECOPY.DAT
Registros extraídos:  765
Finalizada la extracción
----------------------------------------------------------------------
PESVNO: validación de IDs
Input PESVNO: PERipley20140602.prn
PESVNO PERipley20140602.prn_VALI PERipley20140602.val PERipley20140602.inc 10 2

real    0m0.13s
user    0m0.05s
sys     0m0.05s
PESVNO - registros válidos: 742  inconsistentes: 23  total: 765
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
766
ARCHIVO: PERipley20140602.prn_VALI     
Registro  control==> 000001 (VALIDAR=NO)
Registros Tipo 5           ==> 000742
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000023
Registros Tipo 5 repetidos ==> 000000
No hay un archivo de registros validados - PROCESO CANCELADO
/d/iccol/desarrollo/macros>vi  ew /despeciales/ICMCRECOPY.DAT
"/despeciales/ICMCRECOPY.DAT" [Read only] 51108 lines, 2299860 characters C02004710000000042202050693086900860034313FP
C02023310000000042202050412099200890903938FP
A02001110000000053302011212121000900047981FP
A02001410000000053302141212099000860007738FP
C02001410000000053302050999029000860007738FP
C02001410000000053302050701099000860007738FP
C02001410000000053302070703099000860007738FP
C02001410000000053302491012099000860007738FP
C02004710000000053302060681046300860034313FP
C02004710000000053302051292038600860034313FP
A02004710000000053302141212060100860034313FP
C02005010000000053302060608100600860003020FP
A02023310000000053302011212010200890903938FP
A03000510000000053303131212050100900406150FP
C03000510000000053303080903050100900406150FP
C05005910000000053305081104060400900406150FP
C05005910000000053305080401059900900406150FP
C05007410000000053305080104060100900406150FC
C05007410000000053305080108010400900406150FC
C05991410000000053305080406060300860007738FP
C05991410000000053305080607040600860007738FP
C05991410000000053305080510060700860007738FP
A05991410000000053305011112051000860007738FP
A23000110000000053323011212010100830037330SP
C23000110000000053323081005060500830037330SP
C02004710000000096602060906018800860034313FP
C02004710000000096602050296018800860034313FP
C02004710000000096602050206120100860034313FP
C05000510000000096605080895089200860007335FP
C05000510000000096605080898089500860007335FP
C05000510000000096605080199019600860007335FC
C05000510000000096605081199059700860007335FP
C05023210000000096605080312011200890903938FP
A23000110000000096623011212060500830037330SP
C02002010000000173402050103129500860002964FP
C04000310000000173404080200129600860028601RP
C05000510000000173405081195119200860007335FP
C05002010000000173405081097099400860002964FP
C05004810000000173405080595119300860002964FP
C05004810000000173405080797049700860002964FP
C05004810000000173405080198079700860002964FP
C05004810000000173405081298019800860002964FP
C05004810000000173405080497119500860002964FP
C18000710000000173418080703129700860029396FC
C23000410000000173423081198059500800153993SP
A23000410000000173423311212051100800153993SP
A23000410000000173423011212040700800153993SP
A23000510000000173423201212089800800232762SP
C02000610000000197402061296109300860007335FP"/despeciales/ICMCRECOPY.DAT" [Read only] 51108 lines, 2299860 characters:q/d/iccol/desarrollo/macros>fg
vi sh-PE-Ripley
echo "${s}actual"fi
}

ejecutar_extraccion() {
#***********************************************************************
# Extrae registros por suscriptor del archivo ICMCRECOPY.DAT en el prn
#***********************************************************************
    # el directorio del archivo cambia según el ambiente
    P_MAQUINA=$(hostname)
    if [[ $P_MAQUINA == $P_SERVER_DEV ]]
    then
echo "Máquina de desarrollo:" $P_MAQUINA
ICMCRECOPY='/despeciales/ICMCRECOPY.DAT'
    else
# echo "Máquina de producción:" $P_MAQUINA
ICMCRECOPY='$ESPECIALES/ctlc/ICMCRECOPY.DAT'
    fi
# extrae tipo y número de id por NIT del suscriptor, elimina repeticiones
    # $$$$ NIT para pruebas: 00900047981
    echo "el archivo de salida es "$archivo_prn " el input es "$ICMCRECOPY
    ########## grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    # $$$$ DEBUG: regex que extrae TODOS los registros (delete 2 líneas desde acá)
    grepRegex="^A......[14].*............P$"
    # echo "regex:"$grepRegex
    [[ -s $archivo_prn ]] && rm $archivo_prn
    grep "^A......[14].*"$ID_EXTRACT".P$" $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi

echo PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2

"^REPLACE 1 CHAR........[A
    

grep "^.1APPEND MODE2334A4].*"$ID_EXTRACT".P$" $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn    grep "^"$CHANGE MODE$grepRegexREPLACE 1 CHAR.1APPEND MODE23REPLACE 1 CHAR,REPLACE 1 CHAR.
    :w"sh-PE-Ripley" 747 lines, 26820 characters [3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>fgview /despeciales/ICMCRECOPY.DAT/d/iccol/desarrollo/macros>sh-PE-Ripley                    /d/iccol/desarrollo/macros>
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
DEBUG
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:
 
                         TIPO DE EXTRACCIÓN
----------------------------------------------------------------------
      N) Por NIT
      C) Por codigo de suscriptor
      enter=N
 
            TIPO de EXTRACCIÓN:N
            TIPO de EXTRACCIÓN:
 
                        NIT PARA LA EXTRACCIÓN
----------------------------------------------------------------------
      Ingrese el NIT para extracción (11 dígitos),
      enter=00900047981
 
                    NIT:00900047981
                    NIT:
 
                          TIPO DE PROCESO
----------------------------------------------------------------------
      A) Proceso actual
      H) Proceso histórico
      enter=A
 
            TIPO de PROCESO:A
            TIPO de PROCESO:
BASE=I<
NOM_ARCHIVO=1<
TIPO_ARCHIVO=1<
TIPO_EXTRACT=N<
ID_EXTRACT=00900047981<
TIPO_PROC=A<
FECHA_INICIO=20140602<
I;1;1;N;00900047981;A;20140602
file: sh-PE-Ripley.parm  in: /d/iccol/desarrollo/macros
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
PARÁMETROS del PROCESO
    Fecha=20140602
    Archivo: 1
    Base: I  extraída de datos internos
    Criterio de extracción: N  por NIT 00900047981
    Tipo de proceso: A  actual
----------------------------------------------------------------------
 
 
 
Ingrese 1 para cambiar los parámetros, enter para continuar:
----------------------------------------------------------------------
EXTRACCIÓN: N 00900047981
Máquina de desarrollo: codes
el archivo de salida es PERipley20140602.prn  el input es /despeciales/ICMCRECOPY.DAT
regex:^.......[1234].*.............$
Registros extraídos:  2360
Finalizada la extracción
----------------------------------------------------------------------
PESVNO: validación de IDs
Input PESVNO: PERipley20140602.prn
PESVNO PERipley20140602.prn_VALI PERipley20140602.val PERipley20140602.inc 10 2

real    0m0.33s
user    0m0.13s
sys     0m0.09s
PESVNO - registros válidos: 2041  inconsistentes: 319  total: 2360
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
2361
ARCHIVO: PERipley20140602.prn_VALI     
Registro  control==> 000001 (VALIDAR=NO)
Registros Tipo 5           ==> 002041
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000319
Registros Tipo 5 repetidos ==> 000000
No hay un archivo de registros validados - PROCESO CANCELADO
/d/iccol/desarrollo/macros>fg
vi sh-PE-Ripley
echo "${s}actual"fi
}

ejecutar_extraccion() {
#***********************************************************************
# Extrae registros por suscriptor del archivo ICMCRECOPY.DAT en el prn
#***********************************************************************
    # el directorio del archivo cambia según el ambiente
    P_MAQUINA=$(hostname)
    if [[ $P_MAQUINA == $P_SERVER_DEV ]]
    then
echo "Máquina de desarrollo:" $P_MAQUINA
ICMCRECOPY='/despeciales/ICMCRECOPY.DAT'
    else
# echo "Máquina de producción:" $P_MAQUINA
ICMCRECOPY='$ESPECIALES/ctlc/ICMCRECOPY.DAT'
    fi
# extrae tipo y número de id por NIT del suscriptor, elimina repeticiones
    # $$$$ NIT para pruebas: 00900047981
    echo "el archivo de salida es "$archivo_prn " el input es "$ICMCRECOPY
    ########## grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    # $$$$ DEBUG: regex que extrae TODOS los registros (delete 2 líneas desde acá)
    grepRegex="^.......[1234].*.............$"
    echo "regex:"$grepRegex
    [[ -s $archivo_prn ]] && rm $archivo_prn
    grep $grepRegex $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi

echo PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2grepRegex="$CHANGE MODE.*"# /d/iccol/desarrollo/macros/sh-PE-Ripley
#sh-PE-Ripley.V.1.0001
#*******************************************************************************
#SHELL-ID:     sh-PE-Ripley
#DATE-WRITTEN: 2014/05/23
#LAST-UPDATE:  2014/05/23
#AUTHOR:Globant - JL
#*******************************************************************************
# Definición de constantes
    debug=1# cero para producción
    doCuu="1"# reposicionar el cursor luego de un error
    NOHUP=""# contiene "nohup" en producción, null para test
    cancelado="0"# las funciones ponen "1" para cancelar todo
    P_SERVER_DEV="codes"# hostname de la máquina de develop
    raya="----------------------------------------------------------------------"
    ASCIIBanner="
######  #######    ######
#     # ##     # # #####  ####### #   #
#     # ##     # # #    # ### #
######  ###########  # #    # ######    #
###   #   # #####  ###
###    #  # ####
########    #     # # ####### ######   #
"

# Parámetros y sus valores iniciales
    FECHA_PROC=$(date '+%Y%m%d')
#   "I": la lista de IDs es interna  "E": provista x cliente
    BASE="E"
#si BASE="E": archivo y estructura ("1": 1-11 o "2": 1-11-45)
NOM_ARCHIVO=" "
TIPO_ARCHIVO="2"
#si BASE="I": "N": extracción x NIT  "C": por cod suscriptor
TIPO_EXTRACT="N"
#si TIPO_EXTRACT="C": NIT (9) o Cod Suscriptor (6), según TIPO_EXTRACTID_EXTRACT=" "
#   Tipo de proceso "A": actual  "H": histórico
    TIPO_PROC="A"
#Si TIPO_PROC="H": la fecha inicio de proceso histórico
FECHA_INICIO=" "

readBASE() {
#*******************************************************************************
# Lee el valor de BASE hasta que es OK {I|C} o el ope cancela
#*******************************************************************************
    loopEnd="0"
    while [[ $loopEnd == "0" ]]
    do
  echo " "/sleep 5    if [[ $TIPO_PROC == "H" ]]then
FECHA_INICIO_YYYYMM=$(echo $FECHA_INICIO | cut -c1-6 )
sanata=$(grep $FECHA_INICIO_YYYYMM $DATOS/ICSANATA.DAT | cut -c17-17)
echo "sanata para fecha" $FECHA_INICIO_YYYYMM "es" $sanata
if [[ -z "$sanata" ]]
then
echo " "
echo "No se encontró sanata para la fecha $FECHA_INICIO_YYYYMM"echo "Digite san_ata para fecha historica $FECHA_INICIO_YYYYMM ---> \c"read sanata
echo " "
export EXTFH="/san_ata_"$sanata"/"$fecha"/extfh.cfg"echo $EXTFH
export DATABASE="/san_ata_"$sanata"/"$fecha"/icdb"echo $DATABASE
fi
    fi

#*******************************************************************************
# Extracción
# Produce el archivo prn
#*******************************************************************************
    sleep 5
    cd $TEMPORALES
    if [[ $BASE = "I" ]]
    then
echo $raya
echo "EXTRACCIÓN: $TIPO_EXTRACT $ID_EXTRACT"
# echo "\n$raya\nEXTRACCIÓN: $TIPO_EXTRACT $ID_EXTRACT\n\n" >> $archivo_log
ejecutar_extraccion
echo "Finalizada la extracción"
    fi

[[ -s $archivo.log ]] && rm $archivo.log

#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    sleep 5
    echo $raya
    echo "PESVNO: validación de IDs"
    # echo "\n$raya\nPESVNO:\n\n" >> $archivo_log
    ejecutar_validacion
    [[ -s $archivo_val ]] && rm $archivo_val
    [[ -s $archivo_inc ]] && rm $archivo_inc
    [[ $cancelado == "1" ]] && exit# control: si no hay un archivo .val se cancela el proceso


    






    





    

sleep REPLACE 1 CHAR3/if [[ ! -s $archivo_val ]]
then
echo "No hay un archivo de registros validados - PROCESO CANCELADO"
exit
fi

#*******************************************************************************
# SCOTBATCH: cálculo de scores
# ...
#*******************************************************************************
sleep 5    3
/    SCO45="045"     # ACIERTA A - COOPERATIVASSCO47="047"     # ACIERTA A - FINANCIERO
    SCO48="048"     # ACIERTA A - TARJETA DE CRÉDITO
    SCO49="049"     # ACIERTA A - TELECOMUNICACIONES
    SCO62="062"     # QUANTO
    SCO67="067"     # ACIERTA+
    SCO95="095"     # ACIERTA A INSTALAMENTOS
    SCO99="099"     # CARACTERISTICAS
    scoring="$SCO41$SCO45$SCO47$SCO48$SCO49$SCO62$SCO67$SCO95$SCO99"echo SCOTBATCH $FECHA_PROC_YYYYMM $scoring $formato $archivo_val
    $NOHUP x SCOTBATCH $FECHA_PROC_YYYYMM $scoring $formato $archivo_val
    # $$$$ DEBUG: show output >> $archivo.log 2>>$archivo.log

#*******************************************************************************
# Ejecución del programa iceprerip01
#*******************************************************************************
# Los parámetros son:
#    archivo de entrada de validados
#    archivo de entrada de inconsistencias
#    estructura del archivo ????
#    tipo de proceso ????
#    fecha del periodo
    sleep 5
$NOHUP x iceprerip01-test $archivo_val $archivo_inc 2 A $FECHA_PROC
    # $$$$ DEBUG: show output >> $archivo.log 2>>$archivo.log

#*******************************************************************************
# Nombres de los archivos
#*******************************************************************************
    # muestra los nombres de los archivos del proceso
    echo $raya
    echo "ARCHIVOS:"
    echo " "
    # echo "\n$raya\nICEPRERIP01:\n\n" >> $archivo_log
    ls $TEMPORALES/$archivo*
    echo " "

#*******************************************************************************
# Finalmente
#*******************************************************************************
    horaFin=$(date '+%H:%M:%S')
    echo " "
    echo $raya
    echo "fin del proceso "$0
    echo "Iniciado: "$horaInicio " finalizado: "$horaFin
    echo $raya
    exit3/Address search hit BOTTOM without matching pattern:w"sh-PE-Ripley" 746 lines, 26783 characters [3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>fgsh-PE-Ripley
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
DEBUG
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:
 
                         TIPO DE EXTRACCIÓN
----------------------------------------------------------------------
      N) Por NIT
      C) Por codigo de suscriptor
      enter=N
 
            TIPO de EXTRACCIÓN:N
            TIPO de EXTRACCIÓN:
 
                        NIT PARA LA EXTRACCIÓN
----------------------------------------------------------------------
      Ingrese el NIT para extracción (11 dígitos),
      enter=00900047981
 
                    NIT:00900047981
                    NIT:
 
                          TIPO DE PROCESO
----------------------------------------------------------------------
      A) Proceso actual
      H) Proceso histórico
      enter=A
 
            TIPO de PROCESO:A
            TIPO de PROCESO:
BASE=I<
NOM_ARCHIVO=1<
TIPO_ARCHIVO=1<
TIPO_EXTRACT=N<
ID_EXTRACT=00900047981<
TIPO_PROC=A<
FECHA_INICIO=20140602<
I;1;1;N;00900047981;A;20140602
file: sh-PE-Ripley.parm  in: /d/iccol/desarrollo/macros
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
PARÁMETROS del PROCESO
    Fecha=20140602
    Archivo: 1
    Base: I  extraída de datos internos
    Criterio de extracción: N  por NIT 00900047981
    Tipo de proceso: A  actual
----------------------------------------------------------------------
 
 
 
Ingrese 1 para cambiar los parámetros, enter para continuar:
----------------------------------------------------------------------
EXTRACCIÓN: N 00900047981
Máquina de desarrollo: codes
el archivo de salida es PERipley20140602.prn  el input es /despeciales/ICMCRECOPY.DAT
regex:.*
Registros extraídos:  124
Finalizada la extracción
----------------------------------------------------------------------
PESVNO: validación de IDs
Input PESVNO: PERipley20140602.prn
PESVNO PERipley20140602.prn_VALI PERipley20140602.val PERipley20140602.inc 10 2

real    0m0.06s
user    0m0.02s
sys     0m0.01s
PESVNO - registros válidos: 0  inconsistentes: 125  total: 124
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
125
ARCHIVO: PERipley20140602.prn_VALI     
Registro  control==> 000000 (VALIDAR=NO)
Registros Tipo 5           ==> 000000
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000125
Registros Tipo 5 repetidos ==> 000000
 
----------------------------------------------------------------------
Las cantidades de registros no cuadran: proceso cancelado
----------------------------------------------------------------------
/d/iccol/desarrollo/macros>fg
vi sh-PE-Ripley
    SCO45="045"     # ACIERTA A - COOPERATIVASSCO47="047"     # ACIERTA A - FINANCIERO
    SCO48="048"     # ACIERTA A - TARJETA DE CRÉDITO
    SCO49="049"     # ACIERTA A - TELECOMUNICACIONES
    SCO62="062"     # QUANTO
    SCO67="067"     # ACIERTA+
    SCO95="095"     # ACIERTA A INSTALAMENTOS
    SCO99="099"     # CARACTERISTICAS
    scoring="$SCO41$SCO45$SCO47$SCO48$SCO49$SCO62$SCO67$SCO95$SCO99"echo SCOTBATCH $FECHA_PROC_YYYYMM $scoring $formato $archivo_val
    $NOHUP x SCOTBATCH $FECHA_PROC_YYYYMM $scoring $formato $archivo_val
    # $$$$ DEBUG: show output >> $archivo.log 2>>$archivo.log

#*******************************************************************************
# Ejecución del programa iceprerip01
#*******************************************************************************
# Los parámetros son:
#    archivo de entrada de validados
#    archivo de entrada de inconsistencias
#    estructura del archivo ????
#    tipo de proceso ????
#    fecha del periodo
    sleep 3
$NOHUP x iceprerip01-test $archivo_val $archivo_inc 2 A $FECHA_PROC
    # $$$$ DEBUG: show output >> $archivo.log 2>>$archivo.log

#*******************************************************************************
# Nombres de los archivos
#*******************************************************************************
    # muestra los nombres de los archivos del proceso
    echo $raya
    echo "ARCHIVOS:"
    echo " "
    # echo "\n$raya\nICEPRERIP01:\n\n" >> $archivo_log
    ls $TEMPORALES/$archivo*
    echo " "

#*******************************************************************************
# Finalmente
#*******************************************************************************
    horaFin=$(date '+%H:%M:%S')
    echo " "
    echo $raya
    echo "fin del proceso "$0
    echo "Iniciado: "$horaInicio " finalizado: "$horaFin
    echo $raya
    exit# /d/iccol/desarrollo/macros/sh-PE-Ripley
#sh-PE-Ripley.V.1.0001
#*******************************************************************************
#SHELL-ID:     sh-PE-Ripley
#DATE-WRITTEN: 2014/05/23
#LAST-UPDATE:  2014/05/23
#AUTHOR:Globant - JL
#*******************************************************************************
# Definición de constantes
    debug=1# cero para producción
    doCuu="1"# reposicionar el cursor luego de un error
    NOHUP=""# contiene "nohup" en producción, null para test
    cancelado="0"# las funciones ponen "1" para cancelar todo
    P_SERVER_DEV="codes"# hostname de la máquina de develop
    raya="----------------------------------------------------------------------"
    ASCIIBanner="
######  #######    ######
#     # ##     # # #####  ####### #   #
#     # ##     # # #    # ### #
######  ###########  # #    # ######    #
###   #   # #####  ###
###    #  # ####
########    #     # # ####### ######   #
"

# Parámetros y sus valores iniciales
    FECHA_PROC=$(date '+%Y%m%d')
#   "I": la lista de IDs es interna  "E": provista x cliente
    BASE="E"
#si BASE="E": archivo y estructura ("1": 1-11 o "2": 1-11-45)
NOM_ARCHIVO=" "
TIPO_ARCHIVO="2"
#si BASE="I": "N": extracción x NIT  "C": por cod suscriptor
TIPO_EXTRACT="N"
#si TIPO_EXTRACT="C": NIT (9) o Cod Suscriptor (6), según TIPO_EXTRACTID_EXTRACT=" "
#   Tipo de proceso "A": actual  "H": histórico
    TIPO_PROC="A"
#Si TIPO_PROC="H": la fecha inicio de proceso histórico
FECHA_INICIO=" "

readBASE() {
#*******************************************************************************
# Lee el valor de BASE hasta que es OK {I|C} o el ope cancela
#*******************************************************************************
    loopEnd="0"
    while [[ $loopEnd == "0" ]]
    do
  echo " "/regexecho "${s}histórico, desde: "$FECHA_INICIOelse
echo "${s}actual"
    fi
}

ejecutar_extraccion() {
#***********************************************************************
# Extrae registros por suscriptor del archivo ICMCRECOPY.DAT en el prn
#***********************************************************************
    # el directorio del archivo cambia según el ambiente
    P_MAQUINA=$(hostname)
    if [[ $P_MAQUINA == $P_SERVER_DEV ]]
    then
echo "Máquina de desarrollo:" $P_MAQUINA
ICMCRECOPY='/despeciales/ICMCRECOPY.DAT'
    else
# echo "Máquina de producción:" $P_MAQUINA
ICMCRECOPY='$ESPECIALES/ctlc/ICMCRECOPY.DAT'
    fi
# extrae tipo y número de id por NIT del suscriptor, elimina repeticiones
    # $$$$ NIT para pruebas: 00900047981
    echo "el archivo de salida es "$archivo_prn " el input es "$ICMCRECOPY
    ########## grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    # $$$$ DEBUG: regex que extrae TODOS los registros (delete 2 líneas desde acá)
    grepRegex=".*"
    echo "regex:"$grepRegex
    [[ -s $archivo_prn ]] && rm $archivo_prn
    grep $grepRegex $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi
    



    grep $grepRegex $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prnINSERT MODEecho  greYY | cut -c8-19 | sort -u >| $archivo_prn INSERT MODE\\\\| sort -u :w"sh-PE-Ripley" 747 lines, 26845 characters 
.INSERT MODEREPLACE 1 CHAR''.*':w"sh-PE-Ripley" 747 lines, 26845 characters [3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>fgsh-PE-Ripley
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
DEBUG
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:
 
                         TIPO DE EXTRACCIÓN
----------------------------------------------------------------------
      N) Por NIT
      C) Por codigo de suscriptor
      enter=N
 
            TIPO de EXTRACCIÓN:N
            TIPO de EXTRACCIÓN:
 
                        NIT PARA LA EXTRACCIÓN
----------------------------------------------------------------------
      Ingrese el NIT para extracción (11 dígitos),
      enter=00900047981
 
                    NIT:00900047981
                    NIT:
 
                          TIPO DE PROCESO
----------------------------------------------------------------------
      A) Proceso actual
      H) Proceso histórico
      enter=A
 
            TIPO de PROCESO:A
            TIPO de PROCESO:
BASE=I<
NOM_ARCHIVO=1<
TIPO_ARCHIVO=1<
TIPO_EXTRACT=N<
ID_EXTRACT=00900047981<
TIPO_PROC=A<
FECHA_INICIO=20140602<
I;1;1;N;00900047981;A;20140602
file: sh-PE-Ripley.parm  in: /d/iccol/desarrollo/macros
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
PARÁMETROS del PROCESO
    Fecha=20140602
    Archivo: 1
    Base: I  extraída de datos internos
    Criterio de extracción: N  por NIT 00900047981
    Tipo de proceso: A  actual
----------------------------------------------------------------------
 
 
 
Ingrese 1 para cambiar los parámetros, enter para continuar:
----------------------------------------------------------------------
EXTRACCIÓN: N 00900047981
Máquina de desarrollo: codes
el archivo de salida es PERipley20140602.prn  el input es /despeciales/ICMCRECOPY.DAT
regex:.*
grep . .. .LOG-X /despeciales/ICMCRECOPY.DAT | cut -c8-19 | sort -u
Registros extraídos:  124
Finalizada la extracción
----------------------------------------------------------------------
PESVNO: validación de IDs
Input PESVNO: PERipley20140602.prn
PESVNO PERipley20140602.prn_VALI PERipley20140602.val PERipley20140602.inc 10 2

real    0m0.06s
user    0m0.01s
sys     0m0.01s
PESVNO - registros válidos: 0  inconsistentes: 125  total: 124
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
125
ARCHIVO: PERipley20140602.prn_VALI     
Registro  control==> 000000 (VALIDAR=NO)
Registros Tipo 5           ==> 000000
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000125
Registros Tipo 5 repetidos ==> 000000
 
----------------------------------------------------------------------
Las cantidades de registros no cuadran: proceso cancelado
----------------------------------------------------------------------
/d/iccol/desarrollo/macros>fg
vi sh-PE-Ripley
echo "${s}histórico, desde: "$FECHA_INICIOelse
echo "${s}actual"
    fi
}

ejecutar_extraccion() {
#***********************************************************************
# Extrae registros por suscriptor del archivo ICMCRECOPY.DAT en el prn
#***********************************************************************
    # el directorio del archivo cambia según el ambiente
    P_MAQUINA=$(hostname)
    if [[ $P_MAQUINA == $P_SERVER_DEV ]]
    then
echo "Máquina de desarrollo:" $P_MAQUINA
ICMCRECOPY='/despeciales/ICMCRECOPY.DAT'
    else
# echo "Máquina de producción:" $P_MAQUINA
ICMCRECOPY='$ESPECIALES/ctlc/ICMCRECOPY.DAT'
    fi
# extrae tipo y número de id por NIT del suscriptor, elimina repeticiones
    # $$$$ NIT para pruebas: 00900047981
    echo "el archivo de salida es "$archivo_prn " el input es "$ICMCRECOPY
    ########## grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    # $$$$ DEBUG: regex que extrae TODOS los registros (delete 2 líneas desde acá)
    grepRegex='.*'
    echo "regex:"$grepRegex
    [[ -s $archivo_prn ]] && rm $archivo_prn
    echo grep $grepRegex $ICMCRECOPY \| cut -c8-19 \| sort -u
    grep $grepRegex $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn



    grep $grepRegex $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prnINSERT MODE# 
rep CHANGE MODE'.*'grepRegex $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn':w"sh-PE-Ripley" 748 lines, 26912 characters [3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>fgsh-PE-Ripley
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
DEBUG
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:
 
                         TIPO DE EXTRACCIÓN
----------------------------------------------------------------------
      N) Por NIT
      C) Por codigo de suscriptor
      enter=N
 
            TIPO de EXTRACCIÓN:N
            TIPO de EXTRACCIÓN:
 
                        NIT PARA LA EXTRACCIÓN
----------------------------------------------------------------------
      Ingrese el NIT para extracción (11 dígitos),
      enter=00900047981
 
                    NIT:00900047981
                    NIT:
 
                          TIPO DE PROCESO
----------------------------------------------------------------------
      A) Proceso actual
      H) Proceso histórico
      enter=A
 
            TIPO de PROCESO:A
            TIPO de PROCESO:
BASE=I<
NOM_ARCHIVO=1<
TIPO_ARCHIVO=1<
TIPO_EXTRACT=N<
ID_EXTRACT=00900047981<
TIPO_PROC=A<
FECHA_INICIO=20140602<
I;1;1;N;00900047981;A;20140602
file: sh-PE-Ripley.parm  in: /d/iccol/desarrollo/macros
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
PARÁMETROS del PROCESO
    Fecha=20140602
    Archivo: 1
    Base: I  extraída de datos internos
    Criterio de extracción: N  por NIT 00900047981
    Tipo de proceso: A  actual
----------------------------------------------------------------------
 
 
 
Ingrese 1 para cambiar los parámetros, enter para continuar:
----------------------------------------------------------------------
EXTRACCIÓN: N 00900047981
Máquina de desarrollo: codes
el archivo de salida es PERipley20140602.prn  el input es /despeciales/ICMCRECOPY.DAT
regex:.*
grep . .. .LOG-X /despeciales/ICMCRECOPY.DAT | cut -c8-19 | sort -u
Registros extraídos:  2360
Finalizada la extracción
----------------------------------------------------------------------
PESVNO: validación de IDs
Input PESVNO: PERipley20140602.prn
PESVNO PERipley20140602.prn_VALI PERipley20140602.val PERipley20140602.inc 10 2

real    0m0.24s
user    0m0.12s
sys     0m0.09s
PESVNO - registros válidos: 2041  inconsistentes: 319  total: 2360
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
2361
ARCHIVO: PERipley20140602.prn_VALI     
Registro  control==> 000001 (VALIDAR=NO)
Registros Tipo 5           ==> 002041
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000319
Registros Tipo 5 repetidos ==> 000000
No hay un archivo de registros validados - PROCESO CANCELADO
/d/iccol/desarrollo/macros>fg
vi sh-PE-Ripley
echo "${s}histórico, desde: "$FECHA_INICIOelse
echo "${s}actual"
    fi
}

ejecutar_extraccion() {
#***********************************************************************
# Extrae registros por suscriptor del archivo ICMCRECOPY.DAT en el prn
#***********************************************************************
    # el directorio del archivo cambia según el ambiente
    P_MAQUINA=$(hostname)
    if [[ $P_MAQUINA == $P_SERVER_DEV ]]
    then
echo "Máquina de desarrollo:" $P_MAQUINA
ICMCRECOPY='/despeciales/ICMCRECOPY.DAT'
    else
# echo "Máquina de producción:" $P_MAQUINA
ICMCRECOPY='$ESPECIALES/ctlc/ICMCRECOPY.DAT'
    fi
# extrae tipo y número de id por NIT del suscriptor, elimina repeticiones
    # $$$$ NIT para pruebas: 00900047981
    echo "el archivo de salida es "$archivo_prn " el input es "$ICMCRECOPY
    ########## grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    # $$$$ DEBUG: regex que extrae TODOS los registros (delete 2 líneas desde acá)
    grepRegex='.*'
    echo "regex:"$grepRegex
    [[ -s $archivo_prn ]] && rm $archivo_prn
    echo grep $grepRegex $ICMCRECOPY \| cut -c8-19 \| sort -u
    # grep $grepRegex $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    grep '.*' $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else[3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>ICMCRECOPY='/despeciales/ICMCRECOPY.DAT'
/d/iccol/desarrollo/macros>echo $ICMCRECOPY
/despeciales/ICMCRECOPY.DAT
/d/iccol/desarrollo/macros>vi ^[  /d/iccol/desarrollo/macros>vi echo $ICMCRECOPY $ICMCRECOPY    v $ICMCRECOPYi $ICMCRECOPY
"/despeciales/ICMCRECOPY.DAT" 51108 lines, 2299860 characters C02004710000000042202050693086900860034313FP
C02023310000000042202050412099200890903938FP
A02001110000000053302011212121000900047981FP
A02001410000000053302141212099000860007738FP
C02001410000000053302050999029000860007738FP
C02001410000000053302050701099000860007738FP
C02001410000000053302070703099000860007738FP
C02001410000000053302491012099000860007738FP
C02004710000000053302060681046300860034313FP
C02004710000000053302051292038600860034313FP
A02004710000000053302141212060100860034313FP
C02005010000000053302060608100600860003020FP
A02023310000000053302011212010200890903938FP
A03000510000000053303131212050100900406150FP
C03000510000000053303080903050100900406150FP
C05005910000000053305081104060400900406150FP
C05005910000000053305080401059900900406150FP
C05007410000000053305080104060100900406150FC
C05007410000000053305080108010400900406150FC
C05991410000000053305080406060300860007738FP
C05991410000000053305080607040600860007738FP
C05991410000000053305080510060700860007738FP
A05991410000000053305011112051000860007738FP
A23000110000000053323011212010100830037330SP
C23000110000000053323081005060500830037330SP
C02004710000000096602060906018800860034313FP
C02004710000000096602050296018800860034313FP
C02004710000000096602050206120100860034313FP
C05000510000000096605080895089200860007335FP
C05000510000000096605080898089500860007335FP
C05000510000000096605080199019600860007335FC
C05000510000000096605081199059700860007335FP
C05023210000000096605080312011200890903938FP
A23000110000000096623011212060500830037330SP
C02002010000000173402050103129500860002964FP
C04000310000000173404080200129600860028601RP
C05000510000000173405081195119200860007335FP
C05002010000000173405081097099400860002964FP
C05004810000000173405080595119300860002964FP
C05004810000000173405080797049700860002964FP
C05004810000000173405080198079700860002964FP
C05004810000000173405081298019800860002964FP
C05004810000000173405080497119500860002964FP
C18000710000000173418080703129700860029396FC
C23000410000000173423081198059500800153993SP
A23000410000000173423311212051100800153993SP
A23000410000000173423011212040700800153993SP
A23000510000000173423201212089800800232762SP
C02000610000000197402061296109300860007335FP"/despeciales/ICMCRECOPY.DAT" 51108 lines, 2299860 characters:q/d/iccol/desarrollo/macros>grep '.*' $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prnB^[  /d/iccol/desarrollo/macros>| sort -u >| $archivo _prnB                        <                                         /d/iccol/desarrollo/macros>| sort -u | wc -                                  <l
    2360
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>grep '.*' $ICMCRECOPY | cut -c8-19 | sort -u | wc >/d/iccol/desarrollo/macros> $ICMCRECOPY | cut -c8-19 | sort -u | wc -l        /d/iccol/desarrollo/macros>c $ICMCRECOPY | cut -c8-19 | sort -u | wc -l/d/iccol/desarrollo/macros>ca $ICMCRECOPY | cut -c8-19 | sort -u | wc -l/d/iccol/desarrollo/macros>cat $ICMCRECOPY | cut -c8-19 | sort -u | wc -l/d/iccol/desarrollo/macros>cat
    2360
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>cat $ICMCRECOPY | cut -c8-19 | sort -u | wc -l/d/iccol/desarrollo/macros>cat $ICMCRECOPY | cut -c8-19 | wc -l          
   51108
/d/iccol/desarrollo/macros>fg
vi sh-PE-Ripley
echo "${s}histórico, desde: "$FECHA_INICIOelse
echo "${s}actual"
    fi
}

ejecutar_extraccion() {
#***********************************************************************
# Extrae registros por suscriptor del archivo ICMCRECOPY.DAT en el prn
#***********************************************************************
    # el directorio del archivo cambia según el ambiente
    P_MAQUINA=$(hostname)
    if [[ $P_MAQUINA == $P_SERVER_DEV ]]
    then
echo "Máquina de desarrollo:" $P_MAQUINA
ICMCRECOPY='/despeciales/ICMCRECOPY.DAT'
    else
# echo "Máquina de producción:" $P_MAQUINA
ICMCRECOPY='$ESPECIALES/ctlc/ICMCRECOPY.DAT'
    fi
# extrae tipo y número de id por NIT del suscriptor, elimina repeticiones
    # $$$$ NIT para pruebas: 00900047981
    echo "el archivo de salida es "$archivo_prn " el input es "$ICMCRECOPY
    ########## grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    # $$$$ DEBUG: regex que extrae TODOS los registros (delete 2 líneas desde acá)
    grepRegex='.*'
    echo "regex:"$grepRegex
    [[ -s $archivo_prn ]] && rm $archivo_prn
    echo grep $grepRegex $ICMCRECOPY \| cut -c8-19 \| sort -u
    # grep $grepRegex $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    grep '.*' $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
 



PESVNO_INPUT=$archivo_prnEEREPLACE 1 CHAR,
    fi
    ########## grepRegex="^A......[14].*"$ID_EXTRACT".P$"s
    

fi        [[ -s $archivo_prn ]] && rm $archivo_prn    




echo grep INSERT MODE""xAPPEND MODE"
    
    :w"sh-PE-Ripley" 745 lines, 26750 characters [3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>fgcat $ICMCRECOPY | cut -c8-19 | wc -l/d/iccol/desarrollo/macros>cat $ICMCRECOPY | cut -c8-19 | sort -u | wc -l/d/iccol/desarrollo/macros>grep '.*' $ICMCRECOPY | cut -c8-19 | sort -u | wc >/d/iccol/desarrollo/macros>vi $ICMCRECOPY                                     /d/iccol/desarrollo/macros>echo $ICMCRECOPYICMCRECOPY='/despeciales/ICMCRECOPY.DAT'/d/iccol/desarrollo/macros>fg                                      /d/iccol/desarrollo/macros>sh-PE-Ripley
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
DEBUG
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:
 
                         TIPO DE EXTRACCIÓN
----------------------------------------------------------------------
      N) Por NIT
      C) Por codigo de suscriptor
      enter=N
 
            TIPO de EXTRACCIÓN:N
            TIPO de EXTRACCIÓN:
 
                        NIT PARA LA EXTRACCIÓN
----------------------------------------------------------------------
      Ingrese el NIT para extracción (11 dígitos),
      enter=00900047981
 
                    NIT:00900047981
                    NIT:
 
                          TIPO DE PROCESO
----------------------------------------------------------------------
      A) Proceso actual
      H) Proceso histórico
      enter=A
 
            TIPO de PROCESO:A
            TIPO de PROCESO:
BASE=I<
NOM_ARCHIVO=1<
TIPO_ARCHIVO=1<
TIPO_EXTRACT=N<
ID_EXTRACT=00900047981<
TIPO_PROC=A<
FECHA_INICIO=20140602<
I;1;1;N;00900047981;A;20140602
file: sh-PE-Ripley.parm  in: /d/iccol/desarrollo/macros
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
PARÁMETROS del PROCESO
    Fecha=20140602
    Archivo: 1
    Base: I  extraída de datos internos
    Criterio de extracción: N  por NIT 00900047981
    Tipo de proceso: A  actual
----------------------------------------------------------------------
 
 
 
Ingrese 1 para cambiar los parámetros, enter para continuar:
----------------------------------------------------------------------
EXTRACCIÓN: N 00900047981
Máquina de desarrollo: codes
El archivo de salida es PERipley20140602.prn, el input es /despeciales/ICMCRECOPY.DAT
grep .* /despeciales/ICMCRECOPY.DAT | cut -c8-19 | sort -u
Registros extraídos:  124
Finalizada la extracción
----------------------------------------------------------------------
PESVNO: validación de IDs
Input PESVNO: PERipley20140602.prn
PESVNO PERipley20140602.prn_VALI PERipley20140602.val PERipley20140602.inc 10 2

real    0m0.06s
user    0m0.02s
sys     0m0.01s
PESVNO - registros válidos: 0  inconsistentes: 125  total: 124
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
125
ARCHIVO: PERipley20140602.prn_VALI     
Registro  control==> 000000 (VALIDAR=NO)
Registros Tipo 5           ==> 000000
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000125
Registros Tipo 5 repetidos ==> 000000
 
----------------------------------------------------------------------
Las cantidades de registros no cuadran: proceso cancelado
----------------------------------------------------------------------
/d/iccol/desarrollo/macros>fg
vi sh-PE-Ripley
echo "${s}histórico, desde: "$FECHA_INICIOelse
echo "${s}actual"
    fi
}

ejecutar_extraccion() {
#***********************************************************************
# Extrae registros por suscriptor del archivo ICMCRECOPY.DAT en el prn
#***********************************************************************
    # el directorio del archivo cambia según el ambiente
    P_MAQUINA=$(hostname)
    if [[ $P_MAQUINA == $P_SERVER_DEV ]]
    then
echo "Máquina de desarrollo:" $P_MAQUINA
ICMCRECOPY='/despeciales/ICMCRECOPY.DAT'
    else
# echo "Máquina de producción:" $P_MAQUINA
ICMCRECOPY='$ESPECIALES/ctlc/ICMCRECOPY.DAT'
    fi
# extrae tipo y número de id por NIT del suscriptor, elimina repeticiones
    [[ -s $archivo_prn ]] && rm $archivo_prn
    echo "El archivo de salida es "$archivo_prn," el input es "$ICMCRECOPY
    # $$$$ DEBUG: regex que extrae TODOS los registros
    ########## grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    grepRegex='.*'
    echo grep "$grepRegex" $ICMCRECOPY \| cut -c8-19 \| sort -u
    grep $grepRegex $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi

grep APPEND MODE""x":w"sh-PE-Ripley" 745 lines, 26752 characters [3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>fgsh-PE-Ripley
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
DEBUG
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:
 
                         TIPO DE EXTRACCIÓN
----------------------------------------------------------------------
      N) Por NIT
      C) Por codigo de suscriptor
      enter=N
 
            TIPO de EXTRACCIÓN:N
            TIPO de EXTRACCIÓN:
 
                        NIT PARA LA EXTRACCIÓN
----------------------------------------------------------------------
      Ingrese el NIT para extracción (11 dígitos),
      enter=00900047981
 
                    NIT:00900047981
                    NIT:
 
                          TIPO DE PROCESO
----------------------------------------------------------------------
      A) Proceso actual
      H) Proceso histórico
      enter=A
 
            TIPO de PROCESO:A
            TIPO de PROCESO:
BASE=I<
NOM_ARCHIVO=1<
TIPO_ARCHIVO=1<
TIPO_EXTRACT=N<
ID_EXTRACT=00900047981<
TIPO_PROC=A<
FECHA_INICIO=20140602<
I;1;1;N;00900047981;A;20140602
file: sh-PE-Ripley.parm  in: /d/iccol/desarrollo/macros
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
PARÁMETROS del PROCESO
    Fecha=20140602
    Archivo: 1
    Base: I  extraída de datos internos
    Criterio de extracción: N  por NIT 00900047981
    Tipo de proceso: A  actual
----------------------------------------------------------------------
 
 
 
Ingrese 1 para cambiar los parámetros, enter para continuar:
----------------------------------------------------------------------
EXTRACCIÓN: N 00900047981
Máquina de desarrollo: codes
El archivo de salida es PERipley20140602.prn, el input es /despeciales/ICMCRECOPY.DAT
grep .* /despeciales/ICMCRECOPY.DAT | cut -c8-19 | sort -u
Registros extraídos:  2360
Finalizada la extracción
----------------------------------------------------------------------
PESVNO: validación de IDs
Input PESVNO: PERipley20140602.prn
PESVNO PERipley20140602.prn_VALI PERipley20140602.val PERipley20140602.inc 10 2

real    0m0.25s
user    0m0.13s
sys     0m0.09s
PESVNO - registros válidos: 2041  inconsistentes: 319  total: 2360
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
2361
ARCHIVO: PERipley20140602.prn_VALI     
Registro  control==> 000001 (VALIDAR=NO)
Registros Tipo 5           ==> 002041
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000319
Registros Tipo 5 repetidos ==> 000000
No hay un archivo de registros validados - PROCESO CANCELADO
/d/iccol/desarrollo/macros>^[[A  /d/iccol/desarrollo/macros>sh-PE-Ripleyfg          sh-PE-Ripleyfg          cat $ICMCRECOPY | cut -c8-19 | wc -l/d/iccol/desarrollo/macros>cat $ICMCRECOPY | cut -c8-19 | sort -u | wc -l/d/iccol/desarrollo/macros>grep '.*' $ICMCRECOPY | cut -c8-19 | sort -u | wc >/d/iccol/desarrollo/macros>vi $ICMCRECOPY                                     /d/iccol/desarrollo/macros>echo $ICMCRECOPYICMCRECOPY='/despeciales/ICMCRECOPY.DAT'/d/iccol/desarrollo/macros>fg                                      /d/iccol/desarrollo/macros>sh-PE-Ripleyfg          sh-PE-Ripleyfg          sh-PE-Ripleyfg          sh-PE-Ripleyfg          view /despeciales/ICMCRECOPY.DAT/d/iccol/desarrollo/macros>sh-PE-Ripley                    /d/iccol/desarrollo/macros>rm $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>
-rw-rw-r--   1 icjlud   icdatacr    1284 Jun  2 16:26 /d/iccol/desarrollo/temporales/PERipley20140602.log
-rw-rw-r--   1 icjlud   icdatacr   30680 Jun  2 16:26 /d/iccol/desarrollo/temporales/PERipley20140602.prn
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 16:26 /d/iccol/desarrollo/temporales/PERipley20140602.prn_VALI
-rw-rw-r--   1 icjlud   icdatacr       0 Jun  2 16:26 /d/iccol/desarrollo/temporales/PERipley20140602.vre
/d/iccol/desarrollo/macros>cat /d/iccol/desarrollo/temporales/PERipley20140602.log
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
2361
ARCHIVO: PERipley20140602.prn_VALI     
Registro  control==> 000001 (VALIDAR=NO)
Registros Tipo 5           ==> 002041
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000319
Registros Tipo 5 repetidos ==> 000000
REGISTROS LEIDOS                :0002360
REGISTROS CORRECTOS             :0002041
REGISTROS CORRECTOS REPETIDOS   :0000000
REGISTROS NO COINCIDEN BDIIREGI :0000000
  REGISTROS DE FALLECIDOS         :0000000
REGISTROS NO COINCIDEN BDIIDIAN :0000000
REGISTROS NO EXISTEN   BDIIREGI :0000316
REGISTROS NO EXISTEN   BDIIDIAN :0000003
TIPO IDENTIFICACION INVALIDO    :0000000
===================================
ACTUALIZANDO REGIS PARA FACTURACION
===================================
FECHA : 20140602
HORA  : 1626
===================================
ABRIENDO ARCHIVO :$DATOS/LOGPESVNO.DAT                  - 00
RESULTADO OPERACION :$DATOS/LOGPESVNO.DAT                  - 00
Graba Tipo 5    ==> 000000002041
Graba Tipo 6    ==> 000000000000
Graba Tipo 7    ==> 000000000319
Graba Tipo 5 PJ ==> 000000000014
TRANSAC-STATUS-WK: OK

Inicio de Programa:  2014/06/02 16:26:07
Fin de Programa:     2014/06/02 16:26:08

/d/iccol/desarrollo/macros>fg
vi sh-PE-Ripley
echo "${s}histórico, desde: "$FECHA_INICIOelse
echo "${s}actual"
    fi
}

ejecutar_extraccion() {
#***********************************************************************
# Extrae registros por suscriptor del archivo ICMCRECOPY.DAT en el prn
#***********************************************************************
    # el directorio del archivo cambia según el ambiente
    P_MAQUINA=$(hostname)
    if [[ $P_MAQUINA == $P_SERVER_DEV ]]
    then
echo "Máquina de desarrollo:" $P_MAQUINA
ICMCRECOPY='/despeciales/ICMCRECOPY.DAT'
    else
# echo "Máquina de producción:" $P_MAQUINA
ICMCRECOPY='$ESPECIALES/ctlc/ICMCRECOPY.DAT'
    fi
# extrae tipo y número de id por NIT del suscriptor, elimina repeticiones
    [[ -s $archivo_prn ]] && rm $archivo_prn
    echo "El archivo de salida es "$archivo_prn," el input es "$ICMCRECOPY
    # $$$$ DEBUG: regex que extrae TODOS los registros
    ########## grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    grepRegex='.*'
    echo grep "$grepRegex" $ICMCRECOPY \| cut -c8-19 \| sort -u
    grep "$grepRegex" $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi
    






#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi

echo PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2
    $NOHUP x PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2 >| $archivo.log
    [[ -s archivo_prn_VALI ]] && rm archivo_prn_VALI
    cantDeRegistrosTotal=$(wc -l < $archivo_prn)
    cantDeRegistrosVal=$(wc -l < $archivo_val)
    cantDeRegistrosInc=$(wc -l < $archivo_inc)
    echo "PESVNO - registros válidos:" $cantDeRegistrosVal " inconsistentes:" $cantDeRegistrosInc " total:
" $cantDeRegistrosTotal
    head -10 $archivo.log
    if [[ $cantDeRegistrosTotal -ne $(expr $cantDeRegistrosVal + $cantDeRegistrosInc) ]]
    then
echo " "
echo $raya
echo "Las cantidades de registros no cuadran: proceso cancelado"
echo $raya
cancelado="1"
    fi
}

leerParametros() {
#*******************************************************************************
# Interacción con el operador para cargar/editar el set de parámetros
#*******************************************************************************
#   carga los valores del archivo .parm
    paramsGet
    # lee el set de parámetros hasta la satisfacción del ope
    parmsOK="0"
    while [[ $parmsOK == "0" ]]
    do
  readBASE# I interna, C cliente
if [[ $BASE == "E" ]]
then
readNOM_ARCHIVO# nombre del archivo basereadTIPO_ARCHIVO# 0 1-11, 1 1-11-45
elseecho $$archivo_val 10 2$archivo_val $archivo_inc OPEN MODEtouch  $archivo_val $archivo_inc [3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>man touch
Reformatting page.  Please Wait... done

User Commands                                            touch(1)

NAME
     touch, settime - change file access and modification times

SYNOPSIS
     touch [-acm] [-r ref_file | -t time | -d date_time] file...

     touch [-acm] [time_spec] file...

     settime [-f ref_file] [time_spec] file...

DESCRIPTION
     The touch utility sets the access and modification times  of
     each  file.  The  file  operand  is  created  if it does not
     already exist.

     The time used can be specified by -t time, by -d  date_time,
     by  the  corresponding time fields of the file referenced by
     -r ref_file, or by the time_spec operand. If none  of  these
     are specified, touch uses the current time.

     If neither the  -a  nor  -m  options  are  specified,  touch
     updates both the modification and access times.

     A user with write access to a file, but who is not the owner
     of the file or a super-user, can change the modification and
     access times of that file only to the current time. Attempts
     to set a specific time with touch results in an error.

     The settime utility is equivalent to  touch  -c  [time_spec]
     file.

OPTIONS
     The following options are supported in the touch and settime
     utilities:

  touch
     The following options are supported for the touch utility:

     -a

         Changes the access time of file.  Does  not  change  the
         modification time unless -m is also specified.

SunOS 5.10           Last change: 9 Sep 2009                    1

--More--(17%)/d/iccol/desarrollo/macros>fg
vi sh-PE-Ripley
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi

touch $archivo_val $archivo_inc
    echo PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2
    $NOHUP x PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2 >| $archivo.log
    [[ -s archivo_prn_VALI ]] && rm archivo_prn_VALI
    cantDeRegistrosTotal=$(wc -l < $archivo_prn)
    cantDeRegistrosVal=$(wc -l < $archivo_val)
    cantDeRegistrosInc=$(wc -l < $archivo_inc)
    echo "PESVNO - registros válidos:" $cantDeRegistrosVal " inconsistentes:" $cantDeRegistrosInc " total:
" $cantDeRegistrosTotal
    head -10 $archivo.log
    if [[ $cantDeRegistrosTotal -ne $(expr $cantDeRegistrosVal + $cantDeRegistrosInc) ]]
    then
echo " "
echo $raya
echo "Las cantidades de registros no cuadran: proceso cancelado"
echo $raya
cancelado="1"
    fi
}

leerParametros() {
#*******************************************************************************
# Interacción con el operador para cargar/editar el set de parámetros
#*******************************************************************************
#   carga los valores del archivo .parm
    paramsGet
    # lee el set de parámetros hasta la satisfacción del ope
    parmsOK="0"
    while [[ $parmsOK == "0" ]]
    do
  readBASE# I interna, C cliente
if [[ $BASE == "E" ]]
then
readNOM_ARCHIVO# nombre del archivo basereadTIPO_ARCHIVO# 0 1-11, 1 1-11-45"sh-PE-Ripley" [Modified] line 471 of 746 --63%-- :w"sh-PE-Ripley" 746 lines, 26786 characters [3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>fgman touchfg       cat /d/iccol/desarrollo/temporales/PERipley2014060>/d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*               /d/iccol/desarrollo/macros>sh-PE-Ripley                        /d/iccol/desarrollo/macros>fg          sh-PE-Ripley
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
DEBUG
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:
 
                         TIPO DE EXTRACCIÓN
----------------------------------------------------------------------
      N) Por NIT
      C) Por codigo de suscriptor
      enter=N
 
            TIPO de EXTRACCIÓN:N
            TIPO de EXTRACCIÓN:
 
                        NIT PARA LA EXTRACCIÓN
----------------------------------------------------------------------
      Ingrese el NIT para extracción (11 dígitos),
      enter=00900047981
 
                    NIT:00900047981
                    NIT:
 
                          TIPO DE PROCESO
----------------------------------------------------------------------
      A) Proceso actual
      H) Proceso histórico
      enter=A
 
            TIPO de PROCESO:A
            TIPO de PROCESO:
BASE=I<
NOM_ARCHIVO=1<
TIPO_ARCHIVO=1<
TIPO_EXTRACT=N<
ID_EXTRACT=00900047981<
TIPO_PROC=A<
FECHA_INICIO=20140602<
I;1;1;N;00900047981;A;20140602
file: sh-PE-Ripley.parm  in: /d/iccol/desarrollo/macros
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
PARÁMETROS del PROCESO
    Fecha=20140602
    Archivo: 1
    Base: I  extraída de datos internos
    Criterio de extracción: N  por NIT 00900047981
    Tipo de proceso: A  actual
----------------------------------------------------------------------
 
 
 
Ingrese 1 para cambiar los parámetros, enter para continuar:
----------------------------------------------------------------------
EXTRACCIÓN: N 00900047981
Máquina de desarrollo: codes
El archivo de salida es PERipley20140602.prn, el input es /despeciales/ICMCRECOPY.DAT
grep .* /despeciales/ICMCRECOPY.DAT | cut -c8-19 | sort -u
Registros extraídos:  2360
Finalizada la extracción
----------------------------------------------------------------------
PESVNO: validación de IDs
Input PESVNO: PERipley20140602.prn
PESVNO PERipley20140602.prn_VALI PERipley20140602.val PERipley20140602.inc 10 2

real    0m0.25s
user    0m0.13s
sys     0m0.09s
PESVNO - registros válidos: 2041  inconsistentes: 319  total: 2360
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
2361
ARCHIVO: PERipley20140602.prn_VALI     
Registro  control==> 000001 (VALIDAR=NO)
Registros Tipo 5           ==> 002041
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000319
Registros Tipo 5 repetidos ==> 000000
No hay un archivo de registros validados - PROCESO CANCELADO
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>sh-PE-Ripleyfg          man touchfg       cat /d/iccol/desarrollo/temporales/PERipley2014060>/d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*               /d/iccol/desarrollo/macros>sh-PE-Ripley                        /d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>
-rw-rw-r--   1 icjlud   icdatacr    1284 Jun  2 17:12 /d/iccol/desarrollo/temporales/PERipley20140602.log
-rw-rw-r--   1 icjlud   icdatacr   30680 Jun  2 17:12 /d/iccol/desarrollo/temporales/PERipley20140602.prn
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 17:12 /d/iccol/desarrollo/temporales/PERipley20140602.prn_VALI
-rw-rw-r--   1 icjlud   icdatacr       0 Jun  2 17:12 /d/iccol/desarrollo/temporales/PERipley20140602.vre
/d/iccol/desarrollo/macros>touch /d/iccol/desarrollo/temporales/PERipley20140602.val
/d/iccol/desarrollo/macros>/d/iccol/desarrollo/temporales/PERipley20140602.inc^[  /d/iccol/desarrollo/macros>rales/PERipley20140602.inc                        </d/iccol/desarrollo/temporales/PERipley20140602.in>/d/iccol/desarrollo/macros>/d/icol/desarrollo/temporales/PERipley20140602.inc /d/iccol/desarrollo/macros>/d/i col/desarrollo/temporales/PERipley20140602.in>/d/iccol/desarrollo/macros>/d/i ccol/desarrollo/temporales/PERipley20140602.in/d/iccol/desarrollo/macros>/d/ict/d/iccol/desarrollo/temporales/PERipley20140602.i/d/iccol/desarrollo/macros>to/d/iccol/desarrollo/temporales/PERipley20140602./d/iccol/desarrollo/macros>tou/d/iccol/desarrollo/temporales/PERipley20140602/d/iccol/desarrollo/macros>touc/d/iccol/desarrollo/temporales/PERipley2014060/d/iccol/desarrollo/macros>touch/d/iccol/desarrollo/temporales/PERipley201406/d/iccol/desarrollo/macros>touch /d/iccol/desarrollo/temporales/PERipley20140/d/iccol/desarrollo/macros>touch 
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>touch /d/iccol/desarrollo/temporales/PERipley20140>/d/iccol/desarrollo/macros>touch /d/iccol/desarrollo/temporales/PERipley20140/d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*               /d/iccol/desarrollo/macros>
-rw-rw-r--   1 icjlud   icdatacr       0 Jun  2 17:14 /d/iccol/desarrollo/temporales/PERipley20140602.inc
-rw-rw-r--   1 icjlud   icdatacr    1284 Jun  2 17:12 /d/iccol/desarrollo/temporales/PERipley20140602.log
-rw-rw-r--   1 icjlud   icdatacr   30680 Jun  2 17:12 /d/iccol/desarrollo/temporales/PERipley20140602.prn
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 17:12 /d/iccol/desarrollo/temporales/PERipley20140602.prn_VALI
-rw-rw-r--   1 icjlud   icdatacr       0 Jun  2 17:13 /d/iccol/desarrollo/temporales/PERipley20140602.val
-rw-rw-r--   1 icjlud   icdatacr       0 Jun  2 17:12 /d/iccol/desarrollo/temporales/PERipley20140602.vre
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>touch /d/iccol/desarrollo/temporales/PERipley20140>/d/iccol/desarrollo/macros>touch /d/iccol/desarrollo/temporales/PERipley20140/d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*               /d/iccol/desarrollo/macros>sh-PE-Ripley                        /d/iccol/desarrollo/macros>
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
DEBUG
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:
 
                         TIPO DE EXTRACCIÓN
----------------------------------------------------------------------
      N) Por NIT
      C) Por codigo de suscriptor
      enter=N
 
            TIPO de EXTRACCIÓN:N
            TIPO de EXTRACCIÓN:
 
                        NIT PARA LA EXTRACCIÓN
----------------------------------------------------------------------
      Ingrese el NIT para extracción (11 dígitos),
      enter=00900047981
 
                    NIT:00900047981
                    NIT:
 
                          TIPO DE PROCESO
----------------------------------------------------------------------
      A) Proceso actual
      H) Proceso histórico
      enter=A
 
            TIPO de PROCESO:A
            TIPO de PROCESO:
BASE=I<
NOM_ARCHIVO=1<
TIPO_ARCHIVO=1<
TIPO_EXTRACT=N<
ID_EXTRACT=00900047981<
TIPO_PROC=A<
FECHA_INICIO=20140602<
I;1;1;N;00900047981;A;20140602
file: sh-PE-Ripley.parm  in: /d/iccol/desarrollo/macros
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
PARÁMETROS del PROCESO
    Fecha=20140602
    Archivo: 1
    Base: I  extraída de datos internos
    Criterio de extracción: N  por NIT 00900047981
    Tipo de proceso: A  actual
----------------------------------------------------------------------
 
 
 
Ingrese 1 para cambiar los parámetros, enter para continuar:
----------------------------------------------------------------------
EXTRACCIÓN: N 00900047981
Máquina de desarrollo: codes
El archivo de salida es PERipley20140602.prn, el input es /despeciales/ICMCRECOPY.DAT
grep .* /despeciales/ICMCRECOPY.DAT | cut -c8-19 | sort -u
Registros extraídos:  2360
Finalizada la extracción
----------------------------------------------------------------------
PESVNO: validación de IDs
Input PESVNO: PERipley20140602.prn
PESVNO PERipley20140602.prn_VALI PERipley20140602.val PERipley20140602.inc 10 2

real    0m0.25s
user    0m0.13s
sys     0m0.09s
PESVNO - registros válidos: 2041  inconsistentes: 319  total: 2360
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
2361
ARCHIVO: PERipley20140602.prn_VALI     
Registro  control==> 000001 (VALIDAR=NO)
Registros Tipo 5           ==> 002041
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000319
Registros Tipo 5 repetidos ==> 000000
No hay un archivo de registros validados - PROCESO CANCELADO
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>sh-PE-Ripleyls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>
-rw-rw-r--   1 icjlud   icdatacr    1284 Jun  2 17:14 /d/iccol/desarrollo/temporales/PERipley20140602.log
-rw-rw-r--   1 icjlud   icdatacr   30680 Jun  2 17:14 /d/iccol/desarrollo/temporales/PERipley20140602.prn
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 17:14 /d/iccol/desarrollo/temporales/PERipley20140602.prn_VALI
-rw-rw-r--   1 icjlud   icdatacr       0 Jun  2 17:14 /d/iccol/desarrollo/temporales/PERipley20140602.vre
/d/iccol/desarrollo/macros>fg
vi sh-PE-Ripley
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi

touch $archivo_val $archivo_inc
    echo PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2
    $NOHUP x PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2 >| $archivo.log
    [[ -s archivo_prn_VALI ]] && rm archivo_prn_VALI
    cantDeRegistrosTotal=$(wc -l < $archivo_prn)
    cantDeRegistrosVal=$(wc -l < $archivo_val)
    cantDeRegistrosInc=$(wc -l < $archivo_inc)
    echo "PESVNO - registros válidos:" $cantDeRegistrosVal " inconsistentes:" $cantDeRegistrosInc " total:
" $cantDeRegistrosTotal
    head -10 $archivo.log
    if [[ $cantDeRegistrosTotal -ne $(expr $cantDeRegistrosVal + $cantDeRegistrosInc) ]]
    then
echo " "
echo $raya
echo "Las cantidades de registros no cuadran: proceso cancelado"
echo $raya
cancelado="1"
    fi
}

leerParametros() {
#*******************************************************************************
# Interacción con el operador para cargar/editar el set de parámetros
#*******************************************************************************
#   carga los valores del archivo .parm
    paramsGet
    # lee el set de parámetros hasta la satisfacción del ope
    parmsOK="0"
    while [[ $parmsOK == "0" ]]
    do
  readBASE# I interna, C cliente
if [[ $BASE == "E" ]]
then
readNOM_ARCHIVO# nombre del archivo basereadTIPO_ARCHIVO# 0 1-11, 1 1-11-45

    $NOHUP x PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2 >| $archivo.logINSERT MODE# 


INSERT MODE# 
# 
# 
#
: 
l


:w"sh-PE-Ripley" 747 lines, 26870 characters [3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>fgls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>sh-PE-Ripley                        /d/iccol/desarrollo/macros>
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
DEBUG
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:
 
                         TIPO DE EXTRACCIÓN
----------------------------------------------------------------------
      N) Por NIT
      C) Por codigo de suscriptor
      enter=N
 
            TIPO de EXTRACCIÓN:N
            TIPO de EXTRACCIÓN:
 
                        NIT PARA LA EXTRACCIÓN
----------------------------------------------------------------------
      Ingrese el NIT para extracción (11 dígitos),
      enter=00900047981
 
                    NIT:00900047981
                    NIT:
 
                          TIPO DE PROCESO
----------------------------------------------------------------------
      A) Proceso actual
      H) Proceso histórico
      enter=A
 
            TIPO de PROCESO:A
            TIPO de PROCESO:
BASE=I<
NOM_ARCHIVO=1<
TIPO_ARCHIVO=1<
TIPO_EXTRACT=N<
ID_EXTRACT=00900047981<
TIPO_PROC=A<
FECHA_INICIO=20140602<
I;1;1;N;00900047981;A;20140602
file: sh-PE-Ripley.parm  in: /d/iccol/desarrollo/macros
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
PARÁMETROS del PROCESO
    Fecha=20140602
    Archivo: 1
    Base: I  extraída de datos internos
    Criterio de extracción: N  por NIT 00900047981
    Tipo de proceso: A  actual
----------------------------------------------------------------------
 
 
 
Ingrese 1 para cambiar los parámetros, enter para continuar:
----------------------------------------------------------------------
EXTRACCIÓN: N 00900047981
Máquina de desarrollo: codes
El archivo de salida es PERipley20140602.prn, el input es /despeciales/ICMCRECOPY.DAT
grep .* /despeciales/ICMCRECOPY.DAT | cut -c8-19 | sort -u
Registros extraídos:  2360
Finalizada la extracción
----------------------------------------------------------------------
PESVNO: validación de IDs
Input PESVNO: PERipley20140602.prn
PESVNO PERipley20140602.prn_VALI PERipley20140602.val PERipley20140602.inc 10 2

real    0m0.25s
user    0m0.13s
sys     0m0.09s
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
2361
ARCHIVO: PERipley20140602.prn_VALI     
Registro  control==> 000001 (VALIDAR=NO)
Registros Tipo 5           ==> 002041
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000319
Registros Tipo 5 repetidos ==> 000000
expr: syntax error
expr: syntax error
No hay un archivo de registros validados - PROCESO CANCELADO
/d/iccol/desarrollo/macros>fg
vi sh-PE-Ripley
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi

touch $archivo_val $archivo_inc
    echo PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2
    # $NOHUP x PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2 >| $archivo.log
    x PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2 >| $archivo.log
    [[ -s archivo_prn_VALI ]] && rm archivo_prn_VALI
    # cantDeRegistrosTotal=$(wc -l < $archivo_prn)
    # cantDeRegistrosVal=$(wc -l < $archivo_val)
    # cantDeRegistrosInc=$(wc -l < $archivo_inc)
    # echo "PESVNO - registros válidos:" $cantDeRegistrosVal " inconsistentes:" $cantDeRegistrosInc " tota
l:" $cantDeRegistrosTotal
    head -10 $archivo.log
    if [[ $cantDeRegistrosTotal -ne $(expr $cantDeRegistrosVal + $cantDeRegistrosInc) ]]
    then
echo " "
echo $raya
echo "Las cantidades de registros no cuadran: proceso cancelado"
echo $raya
cancelado="1"
    fi
}

leerParametros() {
#*******************************************************************************
# Interacción con el operador para cargar/editar el set de parámetros
#*******************************************************************************
#   carga los valores del archivo .parm
    paramsGet
    # lee el set de parámetros hasta la satisfacción del ope
    parmsOK="0"
    while [[ $parmsOK == "0" ]]
    do
  readBASE# I interna, C cliente
if [[ $BASE == "E" ]]
then
readNOM_ARCHIVO# nombre del archivo baseecho "PESVNO - registros válidos:" $cantDeRegistrosVal " inconsistentes:" $cantDeRegistrosInc " total:
" $cantDeRegistrosTotal# echo "PESVNO - registros válidos:" $cantDeRegistrosVal " inconsistentes:" $cantDeRegistrosInc " tota
l:" $cantDeRegistrosTotalecho "PESVNO - registros válidos:" $cantDeRegistrosVal " inconsistentes:" $cantDeRegistrosInc " total:
" $cantDeRegistrosTotal


readTIPO_ARCHIVO# 0 1-11, 1 1-11-45$[3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>fgsh-PE-Ripleyfg          ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>
-rw-rw-r--   1 icjlud   icdatacr    1284 Jun  2 17:20 /d/iccol/desarrollo/temporales/PERipley20140602.log
-rw-rw-r--   1 icjlud   icdatacr   30680 Jun  2 17:20 /d/iccol/desarrollo/temporales/PERipley20140602.prn
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 17:20 /d/iccol/desarrollo/temporales/PERipley20140602.prn_VALI
-rw-rw-r--   1 icjlud   icdatacr       0 Jun  2 17:20 /d/iccol/desarrollo/temporales/PERipley20140602.vre
/d/iccol/desarrollo/macros>x PESVNO PERipley20140602.prn_VALI PERipley20140602.val PERipley20140602.inc 10 2
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
2361
ARCHIVO: PERipley20140602.prn_VALI     
Registro  control==> 000001 (VALIDAR=NO)
Registros Tipo 5           ==> 002041
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000319
Registros Tipo 5 repetidos ==> 000000
REGISTROS LEIDOS                :0002360
REGISTROS CORRECTOS             :0002041
REGISTROS CORRECTOS REPETIDOS   :0000000
REGISTROS NO COINCIDEN BDIIREGI :0000000
  REGISTROS DE FALLECIDOS         :0000000
REGISTROS NO COINCIDEN BDIIDIAN :0000000
REGISTROS NO EXISTEN   BDIIREGI :0000316
REGISTROS NO EXISTEN   BDIIDIAN :0000003
TIPO IDENTIFICACION INVALIDO    :0000000
===================================
ACTUALIZANDO REGIS PARA FACTURACION
===================================
FECHA : 20140602
HORA  : 1738
===================================
ABRIENDO ARCHIVO :$DATOS/LOGPESVNO.DAT                  - 00
RESULTADO OPERACION :$DATOS/LOGPESVNO.DAT                  - 00
Graba Tipo 5    ==> 000000002041
Graba Tipo 6    ==> 000000000000
Graba Tipo 7    ==> 000000000319
Graba Tipo 5 PJ ==> 000000000014
TRANSAC-STATUS-WK: OK

real    0m0.25s
user    0m0.13s
sys     0m0.09s

Inicio de Programa:  2014/06/02 17:38:20
Fin de Programa:     2014/06/02 17:38:20

/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>x PESVNO PERipley20140602.prn _VALI PERipley2014060>/d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*               /d/iccol/desarrollo/macros>
-rw-rw-r--   1 icjlud   icdatacr   49126 Jun  2 17:38 /d/iccol/desarrollo/temporales/PERipley20140602.inc
-rw-rw-r--   1 icjlud   icdatacr    1284 Jun  2 17:20 /d/iccol/desarrollo/temporales/PERipley20140602.log
-rw-rw-r--   1 icjlud   icdatacr   30680 Jun  2 17:20 /d/iccol/desarrollo/temporales/PERipley20140602.prn
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 17:38 /d/iccol/desarrollo/temporales/PERipley20140602.prn_VALI
-rw-rw-r--   1 icjlud   icdatacr  217525 Jun  2 17:38 /d/iccol/desarrollo/temporales/PERipley20140602.val
-rw-rw-r--   1 icjlud   icdatacr       0 Jun  2 17:38 /d/iccol/desarrollo/temporales/PERipley20140602.vre
/d/iccol/desarrollo/macros>fg
vi sh-PE-Ripley
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=$archivo_prn"_VALI"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi

touch $archivo_val $archivo_inc
    echo PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2
    $NOHUP x PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2 >| $archivo.log
    [[ -s archivo_prn_VALI ]] && rm archivo_prn_VALI
    cantDeRegistrosTotal=$(wc -l < $archivo_prn)
    cantDeRegistrosVal=$(wc -l < $archivo_val)
    cantDeRegistrosInc=$(wc -l < $archivo_inc)
    echo "PESVNO - registros válidos:" $cantDeRegistrosVal " inconsistentes:" $cantDeRegistrosInc " total:
" $cantDeRegistrosTotal
    head -10 $archivo.log
    if [[ $cantDeRegistrosTotal -ne $(expr $cantDeRegistrosVal + $cantDeRegistrosInc) ]]
    then
echo " "
echo $raya
echo "Las cantidades de registros no cuadran: proceso cancelado"
echo $raya
cancelado="1"
    fi
}

leerParametros() {
#*******************************************************************************
# Interacción con el operador para cargar/editar el set de parámetros
#*******************************************************************************
#   carga los valores del archivo .parm
    paramsGet
    # lee el set de parámetros hasta la satisfacción del ope
    parmsOK="0"
    while [[ $parmsOK == "0" ]]
    do
  readBASE# I interna, C cliente
if [[ $BASE == "E" ]]
then
readNOM_ARCHIVO# nombre del archivo basereadTIPO_ARCHIVO# 0 1-11, 1 1-11-45




    PESVNO_INPUT=$archivoINSERT MODE}INSERT MODE{{{archivo}INSERT MODE""VALI"APPEND MODE.$CHANGE MODE.prn":w"sh-PE-Ripley" 746 lines, 26787 characters [3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>fgls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>
-rw-rw-r--   1 icjlud   icdatacr   49126 Jun  2 17:38 /d/iccol/desarrollo/temporales/PERipley20140602.inc
-rw-rw-r--   1 icjlud   icdatacr    1284 Jun  2 17:20 /d/iccol/desarrollo/temporales/PERipley20140602.log
-rw-rw-r--   1 icjlud   icdatacr   30680 Jun  2 17:20 /d/iccol/desarrollo/temporales/PERipley20140602.prn
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 17:38 /d/iccol/desarrollo/temporales/PERipley20140602.prn_VALI
-rw-rw-r--   1 icjlud   icdatacr  217525 Jun  2 17:38 /d/iccol/desarrollo/temporales/PERipley20140602.val
-rw-rw-r--   1 icjlud   icdatacr       0 Jun  2 17:38 /d/iccol/desarrollo/temporales/PERipley20140602.vre
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros> $TEMPORALES/PERipley20140602*      /d/iccol/desarrollo/macros>r $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>rm $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>rm  $TEMPORALES/PERipley20140602*
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>rm  $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>fg                                  /d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>x PESVNO PERipley20140602.prn _VALI PERipley2014060>/d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*               /d/iccol/desarrollo/macros>fg                                  /d/iccol/desarrollo/macros>sh-PE-Ripley
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
DEBUG
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:
 
                         TIPO DE EXTRACCIÓN
----------------------------------------------------------------------
      N) Por NIT
      C) Por codigo de suscriptor
      enter=N
 
            TIPO de EXTRACCIÓN:N
            TIPO de EXTRACCIÓN:
 
                        NIT PARA LA EXTRACCIÓN
----------------------------------------------------------------------
      Ingrese el NIT para extracción (11 dígitos),
      enter=00900047981
 
                    NIT:00900047981
                    NIT:
 
                          TIPO DE PROCESO
----------------------------------------------------------------------
      A) Proceso actual
      H) Proceso histórico
      enter=A
 
            TIPO de PROCESO:A
            TIPO de PROCESO:
BASE=I<
NOM_ARCHIVO=1<
TIPO_ARCHIVO=1<
TIPO_EXTRACT=N<
ID_EXTRACT=00900047981<
TIPO_PROC=A<
FECHA_INICIO=20140602<
I;1;1;N;00900047981;A;20140602
file: sh-PE-Ripley.parm  in: /d/iccol/desarrollo/macros
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
PARÁMETROS del PROCESO
    Fecha=20140602
    Archivo: 1
    Base: I  extraída de datos internos
    Criterio de extracción: N  por NIT 00900047981
    Tipo de proceso: A  actual
----------------------------------------------------------------------
 
 
 
Ingrese 1 para cambiar los parámetros, enter para continuar:
----------------------------------------------------------------------
EXTRACCIÓN: N 00900047981
Máquina de desarrollo: codes
El archivo de salida es PERipley20140602.prn, el input es /despeciales/ICMCRECOPY.DAT
grep .* /despeciales/ICMCRECOPY.DAT | cut -c8-19 | sort -u
Registros extraídos:  2360
Finalizada la extracción
----------------------------------------------------------------------
PESVNO: validación de IDs
Input PESVNO: PERipley20140602.prn
PESVNO PERipley20140602VALI.prn PERipley20140602.val PERipley20140602.inc 10 2

real    0m0.25s
user    0m0.13s
sys     0m0.09s
PESVNO - registros válidos: 2041  inconsistentes: 319  total: 2360
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
2361
ARCHIVO: PERipley20140602VALI.prn      
Registro  control==> 000001 (VALIDAR=NO)
Registros Tipo 5           ==> 002041
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000319
Registros Tipo 5 repetidos ==> 000000
No hay un archivo de registros validados - PROCESO CANCELADO
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>sh-PE-Ripleyrm  $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>
-rw-rw-r--   1 icjlud   icdatacr    1284 Jun  2 17:45 /d/iccol/desarrollo/temporales/PERipley20140602.log
-rw-rw-r--   1 icjlud   icdatacr   30680 Jun  2 17:45 /d/iccol/desarrollo/temporales/PERipley20140602.prn
-rw-rw-r--   1 icjlud   icdatacr       0 Jun  2 17:45 /d/iccol/desarrollo/temporales/PERipley20140602.vre
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 17:45 /d/iccol/desarrollo/temporales/PERipley20140602VALI.prn
/d/iccol/desarrollo/macros>fg
vi sh-PE-Ripley
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=${archivo}"VALI.prn"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi

touch $archivo_val $archivo_inc
    echo PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2
    $NOHUP x PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2 >| $archivo.log
    [[ -s archivo_prn_VALI ]] && rm archivo_prn_VALI
    cantDeRegistrosTotal=$(wc -l < $archivo_prn)
    cantDeRegistrosVal=$(wc -l < $archivo_val)
    cantDeRegistrosInc=$(wc -l < $archivo_inc)
    echo "PESVNO - registros válidos:" $cantDeRegistrosVal " inconsistentes:" $cantDeRegistrosInc " total:
" $cantDeRegistrosTotal
    head -10 $archivo.log
    if [[ $cantDeRegistrosTotal -ne $(expr $cantDeRegistrosVal + $cantDeRegistrosInc) ]]
    then
echo " "
echo $raya
echo "Las cantidades de registros no cuadran: proceso cancelado"
echo $raya
cancelado="1"
    fi
}

leerParametros() {
#*******************************************************************************
# Interacción con el operador para cargar/editar el set de parámetros
#*******************************************************************************
#   carga los valores del archivo .parm
    paramsGet
    # lee el set de parámetros hasta la satisfacción del ope
    parmsOK="0"
    while [[ $parmsOK == "0" ]]
    do
  readBASE# I interna, C cliente
if [[ $BASE == "E" ]]
then
readNOM_ARCHIVO# nombre del archivo basereadTIPO_ARCHIVO# 0 1-11, 1 1-11-45PESVNO_INPUT=${archivo}"VALI.prn"cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi

touch $archivo_val $archivo_inc
    echo PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2
    $NOHUP x PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2 >| $archivo.log
    [[ -s archivo_prn_VALI ]] && rm archivo_prn_VALI
    cantDeRegistrosTotal=$(wc -l < $archivo_prn)
    cantDeRegistrosVal=$(wc -l < $archivo_val)
    cantDeRegistrosInc=$(wc -l < $archivo_inc)
    echo "PESVNO - registros válidos:" $cantDeRegistrosVal " inconsistentes:" $cantDeRegistrosInc " total:" $
cantDeRegistrosTotal
    head -10 $archivo.log
    if [[ $cantDeRegistrosTotal -ne $(expr $cantDeRegistrosVal + $cantDeRegistrosInc) ]]
    then
echo " "
echo $raya
echo "Las cantidades de registros no cuadran: proceso cancelado"
echo $raya
cancelado="1"
    fi
}

leerParametros() {
#*******************************************************************************
# Interacción con el operador para cargar/editar el set de parámetros
#*******************************************************************************
#   carga los valores del archivo .parm
    paramsGet
    # lee el set de parámetros hasta la satisfacción del ope
    parmsOK="0"
    while [[ $parmsOK == "0" ]]
    do
  readBASE# I interna, C cliente
if [[ $BASE == "E" ]]
then
readNOM_ARCHIVO# nombre del archivo basereadTIPO_ARCHIVO# 0 1-11, 1 1-11-45
else
readTIPO_EXTRACT# N NIT, C cod subsreadID_EXTRACT# NIT o cos subs
fi
readTIPO_PROC# A actual, H histórico
if [[ $TIPO_PROC == "H" ]]
then
readFECHA_INICIO# fecha desde[3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>fgls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>sh-PE-Ripley                        /d/iccol/desarrollo/macros>rm  $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>fg                                  /d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>x PESVNO PERipley20140602.prn _VALI PERipley2014060>/d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*               /d/iccol/desarrollo/macros>x PESVNO PERipley20140602.prn _VALI PERipley2014060>/d/iccol/desarrollo/macros>                                                   /d/iccol/desarrollo/macros>fgls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>sh-PE-Ripley                        /d/iccol/desarrollo/macros>rm  $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>fg                                  /d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>x PESVNO PERipley20140602.prn _VALI PERipley2014060>/d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*               /d/iccol/desarrollo/macros>x PESVNO PERipley20140602.prn _VALI PERipley2014060>/d/iccol/desarrollo/macros>x PESVNO PERipleyV20140602.prn _VALI PERipley201406A20140602.prn _VALI PERipley20140L20140602.prn _VALI PERipley2014I20140602.prn _VALI PERipley201I20140602.prn PERipley20140602
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
wc: cannot open /d/iccol/desarrollo/temporales/PERipleyVALI20140602.prn
ARCHIVO: PERipleyVALI20140602.prn      
sort: can't stat /d/iccol/desarrollo/temporales/PERipleyVALI20140602.prn: No such file or directory
ERROR ORDENANDO UNICOS PERipleyVALI20140602.prn      

real    0m0.04s
user    0m0.01s
sys     0m0.01s

Inicio de Programa:  2014/06/02 18:00:33
Fin de Programa:     2014/06/02 18:00:33

/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>x PESVNO PERipleyVALI20140602.prn PERipley20140602>/d/iccol/desarrollo/macros>fg                                                 /d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>
-rw-rw-r--   1 icjlud   icdatacr    1284 Jun  2 17:45 /d/iccol/desarrollo/temporales/PERipley20140602.log
-rw-rw-r--   1 icjlud   icdatacr   30680 Jun  2 17:45 /d/iccol/desarrollo/temporales/PERipley20140602.prn
-rw-rw-r--   1 icjlud   icdatacr       0 Jun  2 17:45 /d/iccol/desarrollo/temporales/PERipley20140602.vre
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 17:45 /d/iccol/desarrollo/temporales/PERipley20140602VALI.prn
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>x PESVNO PERipleyVALI20140602.prn PERipley20140602>/d/iccol/desarrollo/macros>x PESVNO PERipley20140602.prn PERipley20140602.val20140602VALI.prn PERipley20140602
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
2361
ARCHIVO: PERipley20140602VALI.prn      
Registro  control==> 000001 (VALIDAR=NO)
Registros Tipo 5           ==> 002041
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000319
Registros Tipo 5 repetidos ==> 000000
REGISTROS LEIDOS                :0002360
REGISTROS CORRECTOS             :0002041
REGISTROS CORRECTOS REPETIDOS   :0000000
REGISTROS NO COINCIDEN BDIIREGI :0000000
  REGISTROS DE FALLECIDOS         :0000000
REGISTROS NO COINCIDEN BDIIDIAN :0000000
REGISTROS NO EXISTEN   BDIIREGI :0000316
REGISTROS NO EXISTEN   BDIIDIAN :0000003
TIPO IDENTIFICACION INVALIDO    :0000000
===================================
ACTUALIZANDO REGIS PARA FACTURACION
===================================
FECHA : 20140602
HORA  : 1801
===================================
ABRIENDO ARCHIVO :$DATOS/LOGPESVNO.DAT                  - 00
RESULTADO OPERACION :$DATOS/LOGPESVNO.DAT                  - 00
Graba Tipo 5    ==> 000000002041
Graba Tipo 6    ==> 000000000000
Graba Tipo 7    ==> 000000000319
Graba Tipo 5 PJ ==> 000000000014
TRANSAC-STATUS-WK: OK

real    0m0.25s
user    0m0.13s
sys     0m0.09s

Inicio de Programa:  2014/06/02 18:01:10
Fin de Programa:     2014/06/02 18:01:10

/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>x PESVNO PERipley20140602VALI.prn PERipley20140602>/d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*               /d/iccol/desarrollo/macros>
-rw-rw-r--   1 icjlud   icdatacr   49126 Jun  2 18:01 /d/iccol/desarrollo/temporales/PERipley20140602.inc
-rw-rw-r--   1 icjlud   icdatacr    1284 Jun  2 17:45 /d/iccol/desarrollo/temporales/PERipley20140602.log
-rw-rw-r--   1 icjlud   icdatacr   30680 Jun  2 17:45 /d/iccol/desarrollo/temporales/PERipley20140602.prn
-rw-rw-r--   1 icjlud   icdatacr  217525 Jun  2 18:01 /d/iccol/desarrollo/temporales/PERipley20140602.val
-rw-rw-r--   1 icjlud   icdatacr       0 Jun  2 18:01 /d/iccol/desarrollo/temporales/PERipley20140602.vre
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 18:01 /d/iccol/desarrollo/temporales/PERipley20140602VALI.prn
/d/iccol/desarrollo/macros>fg
vi sh-PE-Ripley
PESVNO_INPUT=${archivo}"VALI.prn"cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi

touch $archivo_val $archivo_inc
    echo PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2
    $NOHUP x PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2 >| $archivo.log
    [[ -s archivo_prn_VALI ]] && rm archivo_prn_VALI
    cantDeRegistrosTotal=$(wc -l < $archivo_prn)
    cantDeRegistrosVal=$(wc -l < $archivo_val)
    cantDeRegistrosInc=$(wc -l < $archivo_inc)
    echo "PESVNO - registros válidos:" $cantDeRegistrosVal " inconsistentes:" $cantDeRegistrosInc " total:" $
cantDeRegistrosTotal
    head -10 $archivo.log
    if [[ $cantDeRegistrosTotal -ne $(expr $cantDeRegistrosVal + $cantDeRegistrosInc) ]]
    then
echo " "
echo $raya
echo "Las cantidades de registros no cuadran: proceso cancelado"
echo $raya
cancelado="1"
    fi
}

leerParametros() {
#*******************************************************************************
# Interacción con el operador para cargar/editar el set de parámetros
#*******************************************************************************
#   carga los valores del archivo .parm
    paramsGet
    # lee el set de parámetros hasta la satisfacción del ope
    parmsOK="0"
    while [[ $parmsOK == "0" ]]
    do
  readBASE# I interna, C cliente
if [[ $BASE == "E" ]]
then
readNOM_ARCHIVO# nombre del archivo basereadTIPO_ARCHIVO# 0 1-11, 1 1-11-45
else
readTIPO_EXTRACT# N NIT, C cod subsreadID_EXTRACT# NIT o cos subs
fi
readTIPO_PROC# A actual, H histórico
if [[ $TIPO_PROC == "H" ]]
then
readFECHA_INICIO# fecha desde    fi
# extrae tipo y número de id por NIT del suscriptor, elimina repeticiones
    [[ -s $archivo_prn ]] && rm $archivo_prn
    echo "El archivo de salida es "$archivo_prn," el input es "$ICMCRECOPY
    # $$$$ DEBUG: regex que extrae TODOS los registros
    ########## grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    grepRegex='.*'
    echo grep "$grepRegex" $ICMCRECOPY \| cut -c8-19 \| sort -u
    grep "$grepRegex" $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=${archivo}"VALI.prn"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi

touch $archivo_val $archivo_inc
    echo PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2
    $NOHUP x PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2 >| $archivo.log
    [[ -s archivo_prn_VALI ]] && rm archivo_prn_VALI
    cantDeRegistrosTotal=$(wc -l < $archivo_prn)
    cantDeRegistrosVal=$(wc -l < $archivo_val)
    cantDeRegistrosInc=$(wc -l < $archivo_inc)
    echo "PESVNO - registros válidos:" $cantDeRegistrosVal " inconsistentes:" $cantDeRegistrosInc " total:" $
cantDeRegistrosTotal
    head -10 $archivo.log
    if [[ $cantDeRegistrosTotal -ne $(expr $cantDeRegistrosVal + $cantDeRegistrosInc) ]]
    then
echo " "
echo $raya
echo "Las cantidades de registros no cuadran: proceso cancelado"
echo $raya
cancelado="1"
    fi
}


leerParametros() {    # extrae tipo y número de id por NIT del suscriptor, elimina repeticiones


    


        OPEN MODE
    


    


cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUTcat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT    
 $PESVNO_INPUT $PESVNO_INPUTT $archivo_prn >| APPEND MODE>| n

    

$x CHANGE MODE$ARCarchivo_prn PESVNO_INPUT $archivo_val $archivo_inc 10 2 >| $archivo.log 
    INSERT MODE# :w"sh-PE-Ripley" 748 lines, 26825 characters [3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>fgls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>x PESVNO PERipley20140602VALI.prn PERipley20140602>/d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*               /d/iccol/desarrollo/macros>x PESVNO PERipleyVALI20140602.prn PERipley20140602>/d/iccol/desarrollo/macros>fg                                                 /d/iccol/desarrollo/macros>ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>sh-PE-Ripley                        /d/iccol/desarrollo/macros>
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
DEBUG
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:
 
                         TIPO DE EXTRACCIÓN
----------------------------------------------------------------------
      N) Por NIT
      C) Por codigo de suscriptor
      enter=N
 
            TIPO de EXTRACCIÓN:N
            TIPO de EXTRACCIÓN:
 
                        NIT PARA LA EXTRACCIÓN
----------------------------------------------------------------------
      Ingrese el NIT para extracción (11 dígitos),
      enter=00900047981
 
                    NIT:00900047981
                    NIT:
 
                          TIPO DE PROCESO
----------------------------------------------------------------------
      A) Proceso actual
      H) Proceso histórico
      enter=A
 
            TIPO de PROCESO:A
            TIPO de PROCESO:
BASE=I<
NOM_ARCHIVO=1<
TIPO_ARCHIVO=1<
TIPO_EXTRACT=N<
ID_EXTRACT=00900047981<
TIPO_PROC=A<
FECHA_INICIO=20140602<
I;1;1;N;00900047981;A;20140602
file: sh-PE-Ripley.parm  in: /d/iccol/desarrollo/macros
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
PARÁMETROS del PROCESO
    Fecha=20140602
    Archivo: 1
    Base: I  extraída de datos internos
    Criterio de extracción: N  por NIT 00900047981
    Tipo de proceso: A  actual
----------------------------------------------------------------------
 
 
 
Ingrese 1 para cambiar los parámetros, enter para continuar:
----------------------------------------------------------------------
EXTRACCIÓN: N 00900047981
Máquina de desarrollo: codes
El archivo de salida es PERipley20140602.prn, el input es /despeciales/ICMCRECOPY.DAT
grep .* /despeciales/ICMCRECOPY.DAT | cut -c8-19 | sort -u
Registros extraídos:  2360
Finalizada la extracción
----------------------------------------------------------------------
PESVNO: validación de IDs
Input PESVNO: PERipley20140602.prn
PESVNO PERipley20140602VALI.prn PERipley20140602.val PERipley20140602.inc 10 2

real    0m0.24s
user    0m0.13s
sys     0m0.09s
PESVNO - registros válidos: 2041  inconsistentes: 319  total: 2361
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
2361
ARCHIVO: PERipley20140602.prn          
Registro  control==> 000001 (VALIDAR=NO)
Registros Tipo 5           ==> 002041
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000319
Registros Tipo 5 repetidos ==> 000000
 
----------------------------------------------------------------------
Las cantidades de registros no cuadran: proceso cancelado
----------------------------------------------------------------------
/d/iccol/desarrollo/macros>fg
vi sh-PE-Ripley
    # extrae tipo y número de id por NIT del suscriptor, elimina repeticiones[[ -s $archivo_prn ]] && rm $archivo_prn
    echo "El archivo de salida es "$archivo_prn," el input es "$ICMCRECOPY
    # $$$$ DEBUG: regex que extrae TODOS los registros
    ########## grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    grepRegex='.*'
    echo grep "$grepRegex" $ICMCRECOPY \| cut -c8-19 \| sort -u
    grep "$grepRegex" $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=${archivo}"VALI.prn"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi

cat  $PESVNO_INPUT >| $archivo_prntouch $archivo_val $archivo_inc
    echo PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2
    $NOHUP x PESVNO $archivo_prn $archivo_val $archivo_inc 10 2 >| $archivo.log
    # [[ -s archivo_prn_VALI ]] && rm archivo_prn_VALI
    cantDeRegistrosTotal=$(wc -l < $archivo_prn)
    cantDeRegistrosVal=$(wc -l < $archivo_val)
    cantDeRegistrosInc=$(wc -l < $archivo_inc)
    echo "PESVNO - registros válidos:" $cantDeRegistrosVal " inconsistentes:" $cantDeRegistrosInc " total:" $
cantDeRegistrosTotal
    head -10 $archivo.log
    if [[ $cantDeRegistrosTotal -ne $(expr $cantDeRegistrosVal + $cantDeRegistrosInc) ]]
    then
echo " "
echo $raya
echo "Las cantidades de registros no cuadran: proceso cancelado"
echo $raya
cancelado="1"
    fi








    



INSERT MODE# $$$$ DEBUG; 

:w"sh-PE-Ripley" 748 lines, 26839 characters 

[3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>fgsh-PE-Ripley
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
DEBUG
>>>> params:  I;1;1;N;00900047981;A;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=I
 
            BASE:I
            BASE:
 
                         TIPO DE EXTRACCIÓN
----------------------------------------------------------------------
      N) Por NIT
      C) Por codigo de suscriptor
      enter=N
 
            TIPO de EXTRACCIÓN:N
            TIPO de EXTRACCIÓN:
 
                        NIT PARA LA EXTRACCIÓN
----------------------------------------------------------------------
      Ingrese el NIT para extracción (11 dígitos),
      enter=00900047981
 
                    NIT:00900047981
                    NIT:
 
                          TIPO DE PROCESO
----------------------------------------------------------------------
      A) Proceso actual
      H) Proceso histórico
      enter=A
 
            TIPO de PROCESO:A
            TIPO de PROCESO:
BASE=I<
NOM_ARCHIVO=1<
TIPO_ARCHIVO=1<
TIPO_EXTRACT=N<
ID_EXTRACT=00900047981<
TIPO_PROC=A<
FECHA_INICIO=20140602<
I;1;1;N;00900047981;A;20140602
file: sh-PE-Ripley.parm  in: /d/iccol/desarrollo/macros
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
PARÁMETROS del PROCESO
    Fecha=20140602
    Archivo: 1
    Base: I  extraída de datos internos
    Criterio de extracción: N  por NIT 00900047981
    Tipo de proceso: A  actual
----------------------------------------------------------------------
 
 
 
Ingrese 1 para cambiar los parámetros, enter para continuar:
----------------------------------------------------------------------
EXTRACCIÓN: N 00900047981
Máquina de desarrollo: codes
El archivo de salida es PERipley20140602.prn, el input es /despeciales/ICMCRECOPY.DAT
grep .* /despeciales/ICMCRECOPY.DAT | cut -c8-19 | sort -u
Registros extraídos:  2360
Finalizada la extracción
----------------------------------------------------------------------
PESVNO: validación de IDs
Input PESVNO: PERipley20140602.prn
PESVNO PERipley20140602VALI.prn PERipley20140602.val PERipley20140602.inc 10 2

real    0m0.25s
user    0m0.13s
sys     0m0.09s
PESVNO - registros válidos: 2041  inconsistentes: 319  total: 2361
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
2361
ARCHIVO: PERipley20140602.prn          
Registro  control==> 000001 (VALIDAR=NO)
Registros Tipo 5           ==> 002041
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000319
Registros Tipo 5 repetidos ==> 000000
 
----------------------------------------------------------------------
Las cantidades de registros no cuadran: proceso cancelado
----------------------------------------------------------------------
No hay un archivo de registros validados - PROCESO CANCELADO
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>sh-PE-Ripleyfg          sh-PE-Ripleyfg          ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/macros>
-rw-rw-r--   1 icjlud   icdatacr    1284 Jun  2 18:08 /d/iccol/desarrollo/temporales/PERipley20140602.log
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 18:08 /d/iccol/desarrollo/temporales/PERipley20140602.prn
-rw-rw-r--   1 icjlud   icdatacr       0 Jun  2 18:08 /d/iccol/desarrollo/temporales/PERipley20140602.vre
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 18:08 /d/iccol/desarrollo/temporales/PERipley20140602VALI.prn
/d/iccol/desarrollo/macros>ls -l | grep "18:08"
-rwxrwxr-x   1 icjlud   icdatacr   26839 Jun  2 18:08 sh-PE-Ripley
-rw-rw-r--   1 icjlud   icdatacr      31 Jun  2 18:08 sh-PE-Ripley.parm
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>ls -l | grep "18:08"                    cd $TEMPORALES
/d/iccol/desarrollo/temporales>^[  /d/iccol/desarrollo/temporales>cd $TEMPORALESls -l | grep "18:08"
-rw-rw-r--   1 icjlud   icdatacr    1284 Jun  2 18:08 PERipley20140602.log
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 18:08 PERipley20140602.prn
-rw-rw-r--   1 icjlud   icdatacr       0 Jun  2 18:08 PERipley20140602.vre
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 18:08 PERipley20140602VALI.prn
/d/iccol/desarrollo/temporales>^[  /d/iccol/desarrollo/temporales>ls -l | grep "18:08"ls -l | grep        icjlud
-rw-rw-r--   1 icjlud   icdatacr   36370 Jun  2 11:00 CAR-00DEM-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr  856269 Jun  2 11:00 CAR-01ACP-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr   11884 Jun  2 11:00 CAR-01DEM-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr 3602910 Jun  2 11:00 CAR-01END-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr  285431 Jun  2 11:00 CAR-01EXP-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr   38050 Jun  2 11:00 CAR-01INQ-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr 1648738 Jun  2 11:00 CAR-01MOR-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr  500666 Jun  2 11:00 CAR-01NUM-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr   17078 Jun  2 11:00 CAR-02ACP-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr 2241328 Jun  2 11:00 CAR-02END-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr  454179 Jun  2 11:00 CAR-02EXP-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr   10386 Jun  2 11:00 CAR-02INQ-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr 1857457 Jun  2 11:00 CAR-02NUM-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr    1284 Jun  2 18:08 PERipley20140602.log
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 18:08 PERipley20140602.prn
-rw-rw-r--   1 icjlud   icdatacr       0 Jun  2 18:08 PERipley20140602.vre
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 18:08 PERipley20140602VALI.prn
/d/iccol/desarrollo/temporales>fg
vi sh-PE-Ripley
    # extrae tipo y número de id por NIT del suscriptor, elimina repeticiones[[ -s $archivo_prn ]] && rm $archivo_prn
    echo "El archivo de salida es "$archivo_prn," el input es "$ICMCRECOPY
    # $$$$ DEBUG: regex que extrae TODOS los registros
    ########## grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    grepRegex='.*'
    echo grep "$grepRegex" $ICMCRECOPY \| cut -c8-19 \| sort -u
    grep "$grepRegex" $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=${archivo}"VALI.prn"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi

cat  $PESVNO_INPUT >| $archivo_prntouch $archivo_val $archivo_inc
    echo PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2
    $NOHUP x PESVNO $archivo_prn $archivo_val $archivo_inc 10 2 >| $archivo.log
    # [[ -s archivo_prn_VALI ]] && rm archivo_prn_VALI
    cantDeRegistrosTotal=$(wc -l < $archivo_prn)
    cantDeRegistrosVal=$(wc -l < $archivo_val)
    cantDeRegistrosInc=$(wc -l < $archivo_inc)
    echo "PESVNO - registros válidos:" $cantDeRegistrosVal " inconsistentes:" $cantDeRegistrosInc " total:" $
cantDeRegistrosTotal
    head -10 $archivo.log
    if [[ $cantDeRegistrosTotal -ne $(expr $cantDeRegistrosVal + $cantDeRegistrosInc) ]]
    then
echo " "
echo $raya
echo "Las cantidades de registros no cuadran: proceso cancelado"
echo $raya
# $$$$ DEBUG; cancelado="1"
    fi
    $NOHUP x PESVNO $archivo_prn $archivo_val $archivo_inc 10 2 >| $archivo.logINSERT MODE# :w"sh-PE-Ripley" 749 lines, 26914 characters [3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/temporales>^[  /d/iccol/desarrollo/temporales>fgls -l | grep icjludls -l | grep "18:08"cd $TEMPORALES      ls -l | grep "18:08"ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/temporales>sh-PE-Ripley                        /d/iccol/desarrollo/temporales>
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
DEBUG
>>>> params:  
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=
 
            BASE:
            BASE:
 
                         TIPO DE EXTRACCIÓN
----------------------------------------------------------------------
      N) Por NIT
      C) Por codigo de suscriptor
      enter=
 
            TIPO de EXTRACCIÓN:
            TIPO de EXTRACCIÓN:
 
                COD SUSCRIPTOR PARA LA EXTRACCIÓN
----------------------------------------------------------------------
      Ingrese elCOD SUSCRIPTOR para extracción (6 dígitos),
      enter=
 
            COD SUSCRIPTOR:
            COD SUSCRIPTOR:
 
                          TIPO DE PROCESO
----------------------------------------------------------------------
      A) Proceso actual
      H) Proceso histórico
      enter=
 
            TIPO de PROCESO:
            TIPO de PROCESO:
BASE=<
NOM_ARCHIVO=<
TIPO_ARCHIVO=<
TIPO_EXTRACT=<
ID_EXTRACT=<
TIPO_PROC=<
FECHA_INICIO=20140602<
;N/A;N/A;N/A;N/A;;20140602
file: sh-PE-Ripley.parm  in: /d/iccol/desarrollo/temporales
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
PARÁMETROS del PROCESO
    Fecha=20140602
    Archivo: 
    Base:   extraída de datos internos
    Criterio de extracción:     Tipo de proceso:   actual
----------------------------------------------------------------------
 
 
 
Ingrese 1 para cambiar los parámetros, enter para continuar:^C
/d/iccol/desarrollo/temporales>^[  /d/iccol/desarrollo/temporales>sh-PE-Ripley
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
DEBUG
>>>> params:  ;N/A;N/A;N/A;N/A;;20140602
 
                       ORIGEN DE LA BASE
----------------------------------------------------------------------
      I) Interna
      E) Externa, provista por el Cliente
      enter=
 
            BASE:
            BASE:i
 
                         TIPO DE EXTRACCIÓN
----------------------------------------------------------------------
      N) Por NIT
      C) Por codigo de suscriptor
      enter=N/A
 
            TIPO de EXTRACCIÓN:N/A
            TIPO de EXTRACCIÓN:n
 
                        NIT PARA LA EXTRACCIÓN
----------------------------------------------------------------------
      Ingrese el NIT para extracción (11 dígitos),
      enter=N/A
 
                    NIT:N/A
                    NIT:00900047981
 
                          TIPO DE PROCESO
----------------------------------------------------------------------
      A) Proceso actual
      H) Proceso histórico
      enter=
 
            TIPO de PROCESO:
            TIPO de PROCESO:a
BASE=I<
NOM_ARCHIVO=N/A<
TIPO_ARCHIVO=N/A<
TIPO_EXTRACT=N<
ID_EXTRACT=00900047981<
TIPO_PROC=A<
FECHA_INICIO=20140602<
I;N/A;N/A;N;00900047981;A;20140602
file: sh-PE-Ripley.parm  in: /d/iccol/desarrollo/temporales
----------------------------------------------------------------------

        ######  #######    ######
        #     # #          #     # # #####  #      ###### #   #
        #     # #          #     # # #    # #      #       # #
        ######  #####      ######  # #    # #      #####    #
        #       #          #   #   # #####  #      #        #
        #       #          #    #  # #      #      #        #
        #       #######    #     # # #      ###### ######   #

----------------------------------------------------------------------
PARÁMETROS del PROCESO
    Fecha=20140602
    Archivo: N/A
    Base: I  extraída de datos internos
    Criterio de extracción: N  por NIT 00900047981
    Tipo de proceso: A  actual
----------------------------------------------------------------------
 
 
 
Ingrese 1 para cambiar los parámetros, enter para continuar:
----------------------------------------------------------------------
EXTRACCIÓN: N 00900047981
Máquina de desarrollo: codes
El archivo de salida es PERipley20140602.prn, el input es /despeciales/ICMCRECOPY.DAT
grep .* /despeciales/ICMCRECOPY.DAT | cut -c8-19 | sort -u
Registros extraídos:  2360
Finalizada la extracción
----------------------------------------------------------------------
PESVNO: validación de IDs
Input PESVNO: PERipley20140602.prn
PESVNO PERipley20140602VALI.prn PERipley20140602.val PERipley20140602.inc 10 2

real    0m0.25s
user    0m0.13s
sys     0m0.09s
PESVNO - registros válidos: 2041  inconsistentes: 319  total: 2361
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
2361
ARCHIVO: PERipley20140602.prn          
Registro  control==> 000001 (VALIDAR=NO)
Registros Tipo 5           ==> 002041
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000319
Registros Tipo 5 repetidos ==> 000000
 
----------------------------------------------------------------------
Las cantidades de registros no cuadran: proceso cancelado
----------------------------------------------------------------------
No hay un archivo de registros validados - PROCESO CANCELADO
/d/iccol/desarrollo/temporales>^[  /d/iccol/desarrollo/temporales>sh-PE-Ripleysh-PE-Ripleyfg          ls -l | grep icjludls -l | grep "18:08"ls -l | grep icjlud 
-rw-rw-r--   1 icjlud   icdatacr   36370 Jun  2 11:00 CAR-00DEM-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr  856269 Jun  2 11:00 CAR-01ACP-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr   11884 Jun  2 11:00 CAR-01DEM-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr 3602910 Jun  2 11:00 CAR-01END-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr  285431 Jun  2 11:00 CAR-01EXP-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr   38050 Jun  2 11:00 CAR-01INQ-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr 1648738 Jun  2 11:00 CAR-01MOR-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr  500666 Jun  2 11:00 CAR-01NUM-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr   17078 Jun  2 11:00 CAR-02ACP-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr 2241328 Jun  2 11:00 CAR-02END-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr  454179 Jun  2 11:00 CAR-02EXP-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr   10386 Jun  2 11:00 CAR-02INQ-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr 1857457 Jun  2 11:00 CAR-02NUM-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr    1284 Jun  2 18:14 PERipley20140602.log
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 18:14 PERipley20140602.prn
-rw-rw-r--   1 icjlud   icdatacr       0 Jun  2 18:14 PERipley20140602.vre
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 18:14 PERipley20140602VALI.prn
-rw-rw-r--   1 icjlud   icdatacr      35 Jun  2 18:14 sh-PE-Ripley.parm
/d/iccol/desarrollo/temporales>ca  t sh-PE-Ripley.parm
I;N/A;N/A;N;00900047981;A;20140602
/d/iccol/desarrollo/temporales>u cd
/d/iccol/desarrollo>ma
/d/iccol/desarrollo/macros>^[  /d/iccol/desarrollo/macros>macdcat sh-PE-Ripley.parmls -l | grep icjlud  sh-PE-Ripley       sh-PE-Ripleyfg          ls -l | grep icjludls -l | grep "18:08"cd $TEMPORALES      
/d/iccol/desarrollo/temporales>^[  /d/iccol/desarrollo/temporales>cd $TEMPORALESma            cdcat sh-PE-Ripley.parmls -l | grep icjlud  
-rw-rw-r--   1 icjlud   icdatacr   36370 Jun  2 11:00 CAR-00DEM-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr  856269 Jun  2 11:00 CAR-01ACP-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr   11884 Jun  2 11:00 CAR-01DEM-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr 3602910 Jun  2 11:00 CAR-01END-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr  285431 Jun  2 11:00 CAR-01EXP-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr   38050 Jun  2 11:00 CAR-01INQ-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr 1648738 Jun  2 11:00 CAR-01MOR-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr  500666 Jun  2 11:00 CAR-01NUM-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr   17078 Jun  2 11:00 CAR-02ACP-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr 2241328 Jun  2 11:00 CAR-02END-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr  454179 Jun  2 11:00 CAR-02EXP-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr   10386 Jun  2 11:00 CAR-02INQ-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr 1857457 Jun  2 11:00 CAR-02NUM-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr    1284 Jun  2 18:14 PERipley20140602.log
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 18:14 PERipley20140602.prn
-rw-rw-r--   1 icjlud   icdatacr       0 Jun  2 18:14 PERipley20140602.vre
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 18:14 PERipley20140602VALI.prn
-rw-rw-r--   1 icjlud   icdatacr      35 Jun  2 18:14 sh-PE-Ripley.parm
/d/iccol/desarrollo/temporales>cat PERipley20140602.log
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
2361
ARCHIVO: PERipley20140602.prn          
Registro  control==> 000001 (VALIDAR=NO)
Registros Tipo 5           ==> 002041
Registros Tipo 6           ==> 000000
Registros Tipo 7           ==> 000319
Registros Tipo 5 repetidos ==> 000000
REGISTROS LEIDOS                :0002360
REGISTROS CORRECTOS             :0002041
REGISTROS CORRECTOS REPETIDOS   :0000000
REGISTROS NO COINCIDEN BDIIREGI :0000000
  REGISTROS DE FALLECIDOS         :0000000
REGISTROS NO COINCIDEN BDIIDIAN :0000000
REGISTROS NO EXISTEN   BDIIREGI :0000316
REGISTROS NO EXISTEN   BDIIDIAN :0000003
TIPO IDENTIFICACION INVALIDO    :0000000
===================================
ACTUALIZANDO REGIS PARA FACTURACION
===================================
FECHA : 20140602
HORA  : 1814
===================================
ABRIENDO ARCHIVO :$DATOS/LOGPESVNO.DAT                  - 00
RESULTADO OPERACION :$DATOS/LOGPESVNO.DAT                  - 00
Graba Tipo 5    ==> 000000002041
Graba Tipo 6    ==> 000000000000
Graba Tipo 7    ==> 000000000319
Graba Tipo 5 PJ ==> 000000000014
TRANSAC-STATUS-WK: OK

Inicio de Programa:  2014/06/02 18:14:25
Fin de Programa:     2014/06/02 18:14:26

/d/iccol/desarrollo/temporales>^[  /d/iccol/desarrollo/temporales>cat PERipley20140602.logls -l | grep icjlud     cd $TEMPORALES     ma            cdcat sh-PE-Ripley.parmls -l | grep icjlud  sh-PE-Ripley       sh-PE-Ripleyfg          ls -l | grep icjludls -l | grep "18:08"cd $TEMPORALES      ls -l | grep "18:08"ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/temporales>sh-PE-Ripley                        /d/iccol/desarrollo/temporales>fg          sh-PE-Ripleyls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/temporales>sh-PE-Ripley                        /d/iccol/desarrollo/temporales>fg          sh-PE-Ripleyfg          ls  -l $TEMPORALES/PERipley20140602*/d/iccol/desarrollo/temporales>x PESVNO PERipley20140602VALI.prn PERipley2014>/d/iccol/desarrollo/temporales>ls  -l $TEMPORALES/PERipley20140602*           /d/iccol/desarrollo/temporales>x PESVNO PERipley20140602VALI.prn PERipley2014>/d/iccol/desarrollo/temporales>x PESVNO PERi PERipley20140602.val PERipley201 PERi PERipley20140602.inc 10 2   2 PERipley20140602.inc 10 22 PERi 10 2                3 10 2
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
wc: cannot open /d/iccol/desarrollo/temporales/PERi
ARCHIVO: PERi                          
sort: can't stat /d/iccol/desarrollo/temporales/PERi: No such file or directory
ERROR ORDENANDO UNICOS PERi                          

real    0m0.04s
user    0m0.01s
sys     0m0.01s

Inicio de Programa:  2014/06/02 18:22:59
Fin de Programa:     2014/06/02 18:22:59

/d/iccol/desarrollo/temporales>^[  /d/iccol/desarrollo/temporales>x PESVNO PERi PERi2 PERi3 10 2cat PERipley20140602.log      ls -l | grep icjlud     cd $TEMPORALES     ma            cdcat sh-PE-Ripley.parmls -l | grep icjlud  sh-PE-Ripley       sh-PE-Ripleyfg          ls -l | grep icjludls -l | grep "18:08"cd $TEMPORALES      ls -l | grep "18:08"ls -l | grep        icjlud
-rw-rw-r--   1 icjlud   icdatacr   36370 Jun  2 11:00 CAR-00DEM-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr  856269 Jun  2 11:00 CAR-01ACP-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr   11884 Jun  2 11:00 CAR-01DEM-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr 3602910 Jun  2 11:00 CAR-01END-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr  285431 Jun  2 11:00 CAR-01EXP-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr   38050 Jun  2 11:00 CAR-01INQ-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr 1648738 Jun  2 11:00 CAR-01MOR-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr  500666 Jun  2 11:00 CAR-01NUM-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr   17078 Jun  2 11:00 CAR-02ACP-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr 2241328 Jun  2 11:00 CAR-02END-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr  454179 Jun  2 11:00 CAR-02EXP-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr   10386 Jun  2 11:00 CAR-02INQ-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr 1857457 Jun  2 11:00 CAR-02NUM-201406-PERipley20140602
-rw-rw-r--   1 icjlud   icdatacr    1284 Jun  2 18:14 PERipley20140602.log
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 18:14 PERipley20140602.prn
-rw-rw-r--   1 icjlud   icdatacr       0 Jun  2 18:14 PERipley20140602.vre
-rw-rw-r--   1 icjlud   icdatacr   30704 Jun  2 18:14 PERipley20140602VALI.prn
-rw-rw-r--   1 icjlud   icdatacr      35 Jun  2 18:14 sh-PE-Ripley.parm
/d/iccol/desarrollo/temporales>cp PERipley20140602VALI.prn PWEi   ERi
/d/iccol/desarrollo/temporales>^[  /d/iccol/desarrollo/temporales>cp PERipley20140602VALI.prn PERi/d/iccol/desarrollo/temporales>ls -l | grep icjlud             /d/iccol/desarrollo/temporales>x PESVNO PERi PERi2 PERi3 10 2
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
2361
ARCHIVO: PERi                          

I/O error : file '$TEMPORALES/PERi2'
error code: 9/065 (ANS74), pc=0, call=1, seg=0
 65     File locked 


real    0m0.39s
user    0m0.03s
sys     0m0.08s

Inicio de Programa:  2014/06/02 18:24:08
Fin de Programa:     2014/06/02 18:24:08

/d/iccol/desarrollo/temporales>jobs
[3] + Stopped (SIGTSTP)        vi sh-PE-Ripley
[2] - Stopped (SIGTSTP)        vi sh-PE-Ripley
[1]   Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/temporales>fg
vi sh-PE-Ripley
    # extrae tipo y número de id por NIT del suscriptor, elimina repeticiones[[ -s $archivo_prn ]] && rm $archivo_prn
    echo "El archivo de salida es "$archivo_prn," el input es "$ICMCRECOPY
    # $$$$ DEBUG: regex que extrae TODOS los registros
    ########## grepRegex="^A......[14].*"$ID_EXTRACT".P$"
    grepRegex='.*'
    echo grep "$grepRegex" $ICMCRECOPY \| cut -c8-19 \| sort -u
    grep "$grepRegex" $ICMCRECOPY | cut -c8-19 | sort -u >| $archivo_prn
    # cuenta los registros extraídos
    cantRegsExtraidos=$(wc -l < $archivo_prn)
    echo "Registros extraídos: "$cantRegsExtraidos
    TIPO_ARCHIVO="1"  # es un archivo 1-11
}

ejecutar_validacion() {
#*******************************************************************************
# PESVNO: validación de IDs
# Valida los registtros del archivo .prn y graba archivos .val y .inc
#*******************************************************************************
    echo "Input PESVNO: "$archivo_prn
    # si el input tiene estructura 1-11 le antepone el REGPESVNO.VALI
    if [[ $TIPO_ARCHIVO == "1" ]]
    then
PESVNO_INPUT=${archivo}"VALI.prn"
cat $DATOS/REGPESVNO.VALI $archivo_prn >| $PESVNO_INPUT
    else
PESVNO_INPUT=$archivo_prn
    fi

cat  $PESVNO_INPUT >| $archivo_prntouch $archivo_val $archivo_inc
    echo PESVNO $PESVNO_INPUT $archivo_val $archivo_inc 10 2
    # $NOHUP x PESVNO $archivo_prn $archivo_val $archivo_inc 10 2 >| $archivo.log
    x PESVNO $archivo_prn $archivo_val $archivo_inc 10 2 >| $archivo.log
    # [[ -s archivo_prn_VALI ]] && rm archivo_prn_VALI
    cantDeRegistrosTotal=$(wc -l < $archivo_prn)
    cantDeRegistrosVal=$(wc -l < $archivo_val)
    cantDeRegistrosInc=$(wc -l < $archivo_inc)
    echo "PESVNO - registros válidos:" $cantDeRegistrosVal " inconsistentes:" $cantDeRegistrosInc " total:" $
cantDeRegistrosTotal
    head -10 $archivo.log
    if [[ $cantDeRegistrosTotal -ne $(expr $cantDeRegistrosVal + $cantDeRegistrosInc) ]]
    then
echo " "
echo $raya
echo "Las cantidades de registros no cuadran: proceso cancelado"
echo $raya
# $$$$ DEBUG; cancelado="1""sh-PE-Ripley" line 475 of 749 --63%-- :q/d/iccol/desarrollo/temporales>jobs
[2] + Stopped (SIGTSTP)        vi sh-PE-Ripley
[1] - Stopped (SIGTSTP)        vi sh-PE-Ripley
/d/iccol/desarrollo/temporales>fg
vi sh-PE-Ripley
# SCOTBATCH: cálculo de scores
# ...
#*******************************************************************************
    sleep 5
    echo $raya
    echo "SCOTBATCH: cálculo de scores"
    echo " "
    # echo "\n$raya\nSCOTBATCH:\n\n" >> $archivo_log
    # parámetros para el programa:
    formato="VAL"
    SCO41="041"     # ACIERTA A - VEHÍCULO E HIPOTECARIO
    SCO45="045"     # ACIERTA A - COOPERATIVAS
    SCO47="047"     # ACIERTA A - FINANCIERO
    SCO48="048"     # ACIERTA A - TARJETA DE CRÉDITO
    SCO49="049"     # ACIERTA A - TELECOMUNICACIONES
    SCO62="062"     # QUANTO
    SCO67="067"     # ACIERTA+
    SCO95="095"     # ACIERTA A INSTALAMENTOS
    SCO99="099"     # CARACTERISTICAS
    scoring="$SCO41$SCO45$SCO47$SCO48$SCO49$SCO62$SCO67$SCO95$SCO99"echo SCOTBATCH $FECHA_PROC_YYYYMM $scoring $formato $archivo_val
    $NOHUP x SCOTBATCH $FECHA_PROC_YYYYMM $scoring $formato $archivo_val
    # $$$$ DEBUG: show output >> $archivo.log 2>>$archivo.log

#*******************************************************************************
# Ejecución del programa iceprerip01
#*******************************************************************************
# Los parámetros son:
#    archivo de entrada de validados
#    archivo de entrada de inconsistencias
#    estructura del archivo ????
#    tipo de proceso ????
#    fecha del periodo
    sleep 5
$NOHUP x iceprerip01-test $archivo_val $archivo_inc 2 A $FECHA_PROC
    # $$$$ DEBUG: show output >> $archivo.log 2>>$archivo.log

#*******************************************************************************
# Nombres de los archivos
#*******************************************************************************
    # muestra los nombres de los archivos del proceso
    echo $raya
    echo "ARCHIVOS:"
    echo " "
    # echo "\n$raya\nICEPRERIP01:\n\n" >> $archivo_log
    ls $TEMPORALES/$archivo*
    echo " ""sh-PE-Ripley" line 703 of 747 --94%-- :q/d/iccol/desarrollo/temporales>fg
vi sh-PE-Ripley
# /d/iccol/desarrollo/macros/sh-PE-Ripley
#sh-PE-Ripley.V.1.0001
#*******************************************************************************
#SHELL-ID:     sh-PE-Ripley
#DATE-WRITTEN: 2014/05/23
#LAST-UPDATE:  2014/05/23
#AUTHOR:Globant - JL
#*******************************************************************************
# Definición de constantes
    debug=1# cero para producción
    doCuu="1"# reposicionar el cursor luego de un error
    NOHUP=""# contiene "nohup" en producción, null para test
    cancelado="0"# las funciones ponen "1" para cancelar todo
    P_SERVER_DEV="codes"# hostname de la máquina de develop
    raya="----------------------------------------------------------------------"
    ASCIIBanner="
######  #######    ######
#     # ##     # # #####  ####### #   #
#     # ##     # # #    # ### #
######  ###########  # #    # ######    #
###   #   # #####  ###
###    #  # ####
########    #     # # ####### ######   #
"

# Parámetros y sus valores iniciales
    FECHA_PROC=$(date '+%Y%m%d')
#   "I": la lista de IDs es interna  "E": provista x cliente
    BASE="E"
#si BASE="E": archivo y estructura ("1": 1-11 o "2": 1-11-45)
NOM_ARCHIVO=" "
TIPO_ARCHIVO="2"
#si BASE="I": "N": extracción x NIT  "C": por cod suscriptor
TIPO_EXTRACT="N"
#si TIPO_EXTRACT="C": NIT (9) o Cod Suscriptor (6), según TIPO_EXTRACTID_EXTRACT=" "
#   Tipo de proceso "A": actual  "H": histórico
    TIPO_PROC="A"
#Si TIPO_PROC="H": la fecha inicio de proceso histórico
FECHA_INICIO=" "

readBASE() {
#*******************************************************************************
# Lee el valor de BASE hasta que es OK {I|C} o el ope cancela
#*******************************************************************************
    loopEnd="0"
    while [[ $loopEnd == "0" ]]
    do
  echo " ""sh-PE-Ripley" line 10 of 747 --1%-- :q/d/iccol/desarrollo/temporales>^[  /d/iccol/desarrollo/temporales>fgfgjobsfg  jobsx PESVNO PERi PERi2 PERi3 10 2                              /vi vi $ICMCRECOPYecho $ICMCRECOPYICMCRECOPY='/despeciales/ICMCRECOPY.DAT'/d/iccol/desarrollo/temporales>                                        /d/iccol/desarrollo/temporales>/vi shvi sh-PE-Ripley
"sh-PE-Ripley" [New file] 
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~"sh-PE-Ripley" [New file]:q/d/iccol/desarrollo/temporales>^[  /d/iccol/desarrollo/temporales>vi sh-PE-Ripleyfg             fgjobsfg  jobsx PESVNO PERi PERi2 PERi3 10 2
!!........EL ORDEN DE LOS PARAMETROS ES ........!!
!!..ENTRADA CORRECTOS INCORRECTOS TARIFA BLOQUES.!!
REGISTROS RECIBIDOS ORIGINALMENTE:
2361
ARCHIVO: PERi                          

I/O error : file '$TEMPORALES/PERi2'
error code: 9/065 (ANS74), pc=0, call=1, seg=0
 65     File locked 


real    0m0.17s
user    0m0.03s
sys     0m0.08s

Inicio de Programa:  2014/06/02 18:26:40
Fin de Programa:     2014/06/02 18:26:40

/d/iccol/desarrollo/temporales>^D
