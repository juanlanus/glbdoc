=~=~=~=~=~=~=~=~=~=~=~= PuTTY log 2014.05.16 11:47:19 =~=~=~=~=~=~=~=~=~=~=~=
login as: icdgd
Using keyboard-interactive authentication.
Password: 
Last login: Fri May 16 08:02:56 2014 from 172.16.10.54
Sun Microsystems Inc.   SunOS 5.10      Generic January 2005
You have new mail.
COBJVM=sun_142
JAVA_HOME=/usr/j2se
LD_LIBRARY_PATH=/usr/j2se/jre/lib/sparc:/usr/j2se/jre/lib/sparc/client:/usr/j2se/jre/lib/sparc/native_threads:/usr/j2se/jre/lib/sparc:/opt/mfocus/des/cobol/lib:/opt/IBM/db2/V9.7/lib:/export/home/db2inst1/sqllib/lib64:/export/home/db2inst1/sqllib/lib32
PATH=/usr/j2se/jre/sh:/usr/j2se/sh:/usr/j2se/bin:/usr/j2se/jre/bin:/opt/mfocus/des/cobol/lib:/opt/mfocus/des/cobol/bin:/usr/bin:/bin:/usr/bin:/d/iccol/desarrollo/macros:/d/iccol/desarrollo/utiles:/opt/bin:/usr/sbin:/usr/lib:/usr/ccs/bin:/opt/SUNWspro/bin:/usr/jdk/latest/bin:/usr/local/bin:/usr/j2se/bin:/usr/openwin/bin:.:/export/home/db2inst1/sqllib/bin:/export/home/db2inst1/sqllib/adm:/export/home/db2inst1/sqllib/misc
CLASSPATH=/opt/mfocus/des/cobol/lib/mfcobol.jar:.:/usr/j2se/jre/lib/rt.jar:/opt/mfocus/des/cobol/lib/mfimtk.jar:/opt/mfocus/des/cobol/lib/xerces.jar:/opt/mfocus/des/cobol/lib/castor-0_9_4_1-xml.jar:/opt/mfocus/des/cobol/lib/mfcobol.jar:/usr/j2se/jre/lib/dt.jar:/usr/j2se/jre/lib/rt.jar:/d/iccol/desarrollo/java/server:/export/home/db2inst1/sqllib/java/db2java.zip:/export/home/db2inst1/sqllib/java/db2jcc.jar:/export/home/db2inst1/sqllib/java/sqlj.zip:/export/home/db2inst1/sqllib/function:/export/home/db2inst1/sqllib/java/db2jcc_license_cu.jar:.
COBCPY=/opt/mfocus/des/cobol/cpylib:/opt/mfocus/des/cobol/cpylib:/d/iccol/desarrollo/copys/pais:/d/iccol/desarrollo/copys
Java version = 1.4.2_19
Java vendor = Sun Microsystems Inc.
Java OS name = SunOS
Java OS arch = sparc
Java OS version = 5.10

  ####    ####   #####   ######   ####
 #    #  #    #  #    #  #       #
 #       #    #  #    #  #####    ####
 #       #    #  #    #  #            #
 #    #  #    #  #    #  #       #    #
  ####    ####   #####   ######   ####

 #####
#     #   ####   #        ####   #    #  #####      #      ##
#        #    #  #       #    #  ##  ##  #    #     #     #  #
#        #    #  #       #    #  # ## #  #####      #    #    #
#        #    #  #       #    #  #    #  #    #     #    ######
#     #  #    #  #       #    #  #    #  #    #     #    #    #
 #####    ####   ######   ####   #    #  #####      #    #    #

 #####
#     #   ####   #    #  #####      #    #         ##     ####      #     ####
#        #    #  ##  ##  #    #     #    #        #  #   #    #     #    #    #
#        #    #  # ## #  #    #     #    #       #    #  #          #    #    #
#        #    #  #    #  #####      #    #       ######  #          #    #    #
#     #  #    #  #    #  #          #    #       #    #  #    #     #    #    #
 #####    ####   #    #  #          #    ######  #    #   ####      #     ####

 #####                                           #####  #         ###
#     #  #    #  #    #          #    #         #     # #    #   #   #
#        #    #  ##   #          #    #               # #    #  #     #
 #####   #    #  # #  #          #    #          #####  #    #  #     #
      #  #    #  #  # #          #    #   ###   #       ####### #     #
#     #  #    #  #   ##           #  #    ###   #            #   #   #
 #####    ####   #    # #######    ##     ###   #######      #    ###

icdgd@codes /d/iccol/desarrollo
$ . viset
viset running
/d/iccol/desarrollo $^[  /d/iccol/desarrollo $. visetx CARGAJUR 9999991000905140101.txt/d/iccol/desarrollo $des-c-v CARGAJUR                  /d/iccol/desarrollo $fg              x CARGAJUR 9999991000905140101.txt/d/iccol/desarrollo $des-c-v CARGAJUR                  /d/iccol/desarrollo $fg              x CARGAJUR 9999991000905140101.txt/d/iccol/desarrollo $cls                               /d/iccol/desarrollo $/d/iccol/desarrollo $Fin de Programa:     2014/05/16 08:25:30/d/iccol/desarrollo $Inicio de Programa:  2014/05/16 08:25:30/d/iccol/desarrollo $sys     0m0.01s                         /d/iccol/desarrollo $               vi CARGAJUR.CBL
"CARGAJUR.CBL" [New file] 
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~"CARGAJUR.CBL" [New file]:q/d/iccol/desarrollo $fu
/d/iccol/desarrollo $^[  /d/iccol/desarrollo $fuvi CARGAJUR.CBL
"CARGAJUR.CBL" 1163 lines, 49511 characters $SET LIST SETTINGIDENTIFICATION DIVISION.
PROGRAM-ID.    ACTALEJUR.
******************************************************************
* Actualizacion del archivo de alertas con los datos provistos
* por Jurad
* Procesa el archivo JURAD. Controla cada registro: si es OK usa
* los datos para actualizar BDIIALE, si tiene defecto lo graba en
* el archivo ERRS.
******************************************************************
AUTHOR.Globant JL.
DATE-WRITTEN.
DATE-COMPILED.
CONFIGURATION section.
SOURCE-COMPUTER. microfocus.
OBJECT-COMPUTER. microfocus.
INPUT-OUTPUT section.
FILE-CONTROL.******************************************************************
******************************************************************
select JURAD assign to P-file-nameorganization is line sequentialfile status is JURAD-fs.******************************************************************
******************************************************************
select ERRS assign to ERRS-file-nameorganization is line sequentialfile status is ERRS-fs.******************************************************************
******************************************************************copy BDIIREGI.FS.
* TODO: debe compilar con file status******************************************************************
******************************************************************
copy BDIIDIAN.FS.******************************************************************
******************************************************************
copy BDIIDAS.FS.******************************************************************
******************************************************************copy BDIIALE.FS replacing == on record.== by == on recordfile status is EST-BDIIALE.==."CARGAJUR.CBL" 1163 lines, 49511 characters
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
1163 lines deletedNo lines in bufferAPPEND MODE      $SET LIST SETTING 

       IDENTIFICATION DIVISION.


       PROGRAM-ID.    ACTALEJUR.



      ******************************************************************
      * Actualizacion del archivo de alertas con los datos provistos
      * por Jurad
      * Procesa el archivo JURAD. Controla cada registro: si es OK usa
      * los datos para actualizar BDIIALE, si tiene defecto lo graba en
      * el archivo ERRS.
      ******************************************************************
       AUTHOR.        Globant JL.
       DATE-WRITTEN.
       DATE-COMPILED.
       CONFIGURATION section.
       SOURCE-COMPUTER. microfocus.
       OBJECT-COMPUTER. microfocus.
       INPUT-OUTPUT section.
       FILE-CONTROL.

      ******************************************************************
      ******************************************************************
       select JURAD assign to P-file-name
           organization is line sequential
           file status is JURAD-fs.

      ******************************************************************
      ******************************************************************
       select ERRS assign to ERRS-file-name
           organization is line sequential
           file status is ERRS-fs.

      ******************************************************************
      ******************************************************************
           copy BDIIREGI.FS.
      * TODO: debe compilar con file status

      ******************************************************************
      ******************************************************************
       copy BDIIDIAN.FS.
 
      ******************************************************************
      ******************************************************************
       copy BDIIDAS.FS.

      ******************************************************************
      ******************************************************************
           copy BDIIALE.FS replacing == on record.== by == on record
              file status is EST-BDIIALE.==.



APPEND MODE      ******************************************************************

APPEND MODE      ******************************************************************

APPEND MODE

~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
51 fewer linesAPPEND MODE      $SET LIST SETTING 

       IDENTIFICATION DIVISION.


       PROGRAM-ID.    ACTALEJUR.



      ******************************************************************
      * Actualizacion del archivo de alertas con los datos provistos
      * por Jurad
      * Procesa el archivo JURAD. Controla cada registro: si es OK usa
      * los datos para actualizar BDIIALE, si tiene defecto lo graba en
      * el archivo ERRS.
      ******************************************************************
       AUTHOR.        Globant JL.
       DATE-WRITTEN.
       DATE-COMPILED.
       CONFIGURATION section.
       SOURCE-COMPUTER. microfocus.
       OBJECT-COMPUTER. microfocus.
       INPUT-OUTPUT section.
       FILE-CONTROL.

      ******************************************************************
      ******************************************************************
       select JURAD assign to P-file-name
           organization is line sequential
           file status is JURAD-fs.

      ******************************************************************
      ******************************************************************
       select ERRS assign to ERRS-file-name
           organization is line sequential
           file status is ERRS-fs.

      ******************************************************************
      ******************************************************************
           copy BDIIREGI.FS.
      * TODO: debe compilar con file status

      ******************************************************************
      ******************************************************************
       copy BDIIDIAN.FS.
 
      ******************************************************************
      ******************************************************************
       copy BDIIDAS.FS.

      ******************************************************************
      ******************************************************************
           copy BDIIALE.FS replacing == on record.== by == on record
              file status is EST-BDIIALE.==.



APPEND MODE      ******************************************************************

APPEND MODE      ******************************************************************

APPEND MODE       DATA DIVISION.

APPEND MODE       FILE section.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Archivo de entrada con los datos de demandas y embargos de JURAD

APPEND MODE      ******************************************************************

APPEND MODE       FD JURAD.

APPEND MODE       01  JURAD-reg.

APPEND MODE      * Registros de movimientos I, M, E

APPEND MODE      *    Tipo de Novedad {I, M, E} Inser/Modif/Elim

APPEND MODE           03 JURAD-tipo-novedad        pic x.

APPEND MODE      *    Tipo de identificacion Numero {1, 2, 3, 4}

APPEND MODE           03 JURAD-id-tipo             pic x.

APPEND MODE      *    Numero de identificacion

APPEND MODE           03 JURAD-id-numeroX          pic x(11).

APPEND MODE           03 JURAD-id-numero           redefines JURAD-id-numeroX

APPEND MODE                                        pic 9(11).

APPEND MODE      *    Nombres y Apellidos

APPEND MODE           03 JURAD-nombre              pic x(45).

APPEND MODE      *    Numero de demandas vigentes

APPEND MODE           03 JURAD-demandas-vigentes   pic 999.

APPEND MODE      *    Numero de demandas terminadas

APPEND MODE           03 JURAD-demandas-terminadas pic 999.

APPEND MODE      *    Fecha ultima demanda vigente YYYYMMDD

APPEND MODE           03 JURAD-demandas-fecha-ultima pic x(8).

APPEND MODE      *    Numero de embargos vigentes

APPEND MODE           03 JURAD-embargos-vigentes   pic 999.

APPEND MODE      *    Numero de embargos terminados

APPEND MODE           03 JURAD-embargos-terminados pic 999.

APPEND MODE      *    Fecha ultimo embargo vigente YYYYMMDD

APPEND MODE           03 JURAD-embargos-fecha-ultimo pic x(8).

APPEND MODE

APPEND MODE       01  JURADT-reg.

APPEND MODE      * Registro de totales de control T

APPEND MODE      *    Tipo de Novedad = "T"

APPEND MODE           03 JURADT-tipo-novedad       pic x.

APPEND MODE           03                           pic x.

APPEND MODE      *    Cantidad de registros

APPEND MODE           03 JURADT-registros          pic 9(11).

APPEND MODE           03                           pic x.

APPEND MODE      *    Total numero de demandas vigentes

APPEND MODE           03 JURADT-demandas-vigentes  pic 9(7).

APPEND MODE           03                           pic x.

APPEND MODE      *    Total numero de demandas terminadas

APPEND MODE           03 JURADT-demandas-terminadas pic 9(7).

APPEND MODE           03                           pic x.

APPEND MODE      *    Total numero de embargos vigentes

APPEND MODE           03 JURADT-embargos-vigentes  pic 9(7).

APPEND MODE           03                           pic x.

APPEND MODE      *    Total numero de embargos terminados

APPEND MODE           03 JURADT-embargos-terminados pic 9(7).

APPEND MODE           03                           pic x(41).

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Archivo de salida con los registros defectuosos del arch JURAD

APPEND MODE      ******************************************************************

APPEND MODE       FD ERRS.

APPEND MODE       01  ERRS-reg.

APPEND MODE      *    Tipo de Novedad {I, M, E, T} Inser/Modif/Elim/Totales

APPEND MODE           03 ERRS-tipo-novedad         pic x.

APPEND MODE      *    Tipo de identificacion Numero {1, 2, 3, 4}

APPEND MODE           03 ERRS-id-tipo              pic x.

APPEND MODE      *    Numero de identificacion

APPEND MODE           03 ERRS-id-numero            pic x(11).

APPEND MODE      *    Nombres y Apellidos

APPEND MODE           03 ERRS-nombre               pic x(45).

APPEND MODE      *    Numero de demandas vigentes

APPEND MODE           03 ERRS-demandas-vigentes    pic 999.

APPEND MODE      *    Numero de demandas terminadas

APPEND MODE           03 ERRS-demandas-terminadas  pic 999.

APPEND MODE      *    Fecha ultima demanda vigente YYMMDD

APPEND MODE           03 ERRS-demandas-fecha-ultima pic x(6).

APPEND MODE      *    Numero de embargos vigentes

APPEND MODE           03 ERRS-embargos-vigentes    pic 999.

APPEND MODE      *    Numero de embargos terminados

APPEND MODE           03 ERRS-embargos-terminados  pic 999.

APPEND MODE      *    Fecha ultimo embargo vigente YYMMDD

APPEND MODE           03 ERRS-embargos-fecha-ultimo pic x(6).

APPEND MODE      *    Causa del rechazo

APPEND MODE           03 ERRS-causa-rechazo        pic x(100).

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Contiene los ids y nombres de personas

APPEND MODE      ******************************************************************

APPEND MODE       copy BDIIREGI.FD.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Maestro de personas juridicas nacionales y extranjeras reportada

APPEND MODE      * por la DIAN

APPEND MODE      ******************************************************************

APPEND MODE       copy BDIIDIAN.FD.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Archivo maestro de cedulas de extranjeria suministrado por DAS

APPEND MODE      ******************************************************************

APPEND MODE       copy BDIIDAS.FD.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Maestro de alertas reportadas por suscriptores

APPEND MODE      ******************************************************************

APPEND MODE       copy BDIIALE.FD.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE       WORKING-STORAGE section.

APPEND MODE      ******************************************************************

APPEND MODE      * Nombre del programa

APPEND MODE       01  pgm                          pic x(10) value "CARGAJUR".

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Variables para rutina de validacion de identificaciones

APPEND MODE      ******************************************************************

APPEND MODE       copy BDIIVIDE.WS.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Variables relacionadas con las alertas del sistema

APPEND MODE      ******************************************************************

APPEND MODE       copy BDIIALE.WS.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Datos para las rutinas de validacion de nombres de VALNOM.PROC

APPEND MODE      ******************************************************************

APPEND MODE       copy VALNOM.WS.

APPEND MODE

APPEND MODE      *****************************************************************

APPEND MODE      * Direcciones de los archivos en el file system

APPEND MODE      *****************************************************************

APPEND MODE       copy ICFILE.WS.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Indica que se termino el proceso, por agotamiento del archivo

APPEND MODE      * de entrada (normal) o alguna otra condicion (error)

APPEND MODE       01  IND-fin-proceso              pic xx value "NO".

APPEND MODE

APPEND MODE      * Copia del ultimo reg de input, para mensajes (Ult reg: ...)

APPEND MODE       01  JURAD-reg-anterior           pic x(100) value "(vacio)".

APPEND MODE       01  JURAD-fs                     pic xx value spaces.

APPEND MODE

APPEND MODE       01  ERRS-fs                      pic xx value spaces.

APPEND MODE

APPEND MODE      * Datos de demandas o embargos que van en el registro BDIIALE

APPEND MODE       01 D-datahost.

APPEND MODE           05 D-vigentes                pic 9(5).

APPEND MODE           05 D-terminados              pic 9(5).

APPEND MODE           05 D-fecha-ultima            pic x(8).

APPEND MODE      ******************************************************************

APPEND MODE      * Parametros iniciales, de la linea de comando

APPEND MODE      * La linea de comando que contiene los parametros

APPEND MODE       01 P-command-line                pic x(80) value spaces.

APPEND MODE       01 P-parametros.

APPEND MODE      *    Proceso real: contiene "SI" para activar 

APPEND MODE      * TODO: fijo en "NO" para pruebas

APPEND MODE           03 P-proceso-real            pic xx value "NO".

APPEND MODE           88 PROCESO-REAL              value "SI".

APPEND MODE

APPEND MODE      *    Nombre del archivo de entrada JJJJJJaaaDDMMAAbbXX.txt

APPEND MODE           03 P-file-name               pic x(80) value spaces.

APPEND MODE           03 P-file-name-R             redefines P-file-name.

APPEND MODE      *        JJJJJJ = Codigo de suscriptor JURAD en Experian

APPEND MODE               05 P-cod-suscriptor      pic 9(6).

APPEND MODE      *        aaa = Codificacion del producto ("100")

APPEND MODE               05 P-producto            pic xxx.

APPEND MODE      *        DDMMAA = Fecha de proceso

APPEND MODE               05 P-fecha-proceso       pic x(6).

APPEND MODE      *        bb =  01 a CI

APPEND MODE               05 P-ci-bi               pic xx.

APPEND MODE      *        XX = Tipo de proceso

APPEND MODE      *        01 Envio Original - Carga TOTAL - primera vez

APPEND MODE      *        02 Archivo Semanal - Carga PARCIAL

APPEND MODE      *        03 Archivo Mensual - Carga PARCIAL

APPEND MODE      *        04 Refresque Total - Carga TOTAL

APPEND MODE               05 P-tipo-proceso        pic xx.

APPEND MODE      *        extension del archivo ".txt"

APPEND MODE               05 P-extension           pic x(4).

APPEND MODE               05                       pic x(57).

APPEND MODE      * Nombre del archivo de errores JJJJJJaaaDDMMAAbbXX_ERRORES.txt

APPEND MODE          03 ERRS-file-name             pic x(80) value spaces.

APPEND MODE

APPEND MODE      * Fecha de proceso editada YYYYMMDD

APPEND MODE       01 P-fecha-proceso-YYYYMMDD      pic x(8).

APPEND MODE      * Fecha de proceso + 50 años

APPEND MODE       01 P-fecha-proceso-50.

APPEND MODE           03  P-fecha-proceso-50YYYY   pic 9999.

APPEND MODE           03                           pic x(4).

APPEND MODE      ******************************************************************

APPEND MODE      * Datos para el reporte final

APPEND MODE       01 W-tiempo.

APPEND MODE           03 W-hora-inicio             pic 9(8).

APPEND MODE           03 W-hora-fin                pic 9(8).

APPEND MODE       01 N-edit                        pic z(8)B.

APPEND MODE       01 N-contadores.

APPEND MODE      *    Registros en el archivo de entrada

APPEND MODE           03 N-reg-leidos              pic 9(8) value zero.

APPEND MODE      *    Registros procesados sin error

APPEND MODE           03 N-reg-OK                  pic 9(8) value zero.

APPEND MODE      *    Registros con error

APPEND MODE           03 N-reg-con-error           pic 9(8) value zero.

APPEND MODE

APPEND MODE      *    Cantidades de registros por tipo de novedad

APPEND MODE           03 N-reg-tipo-I-OK           pic 9(8) value zero.

APPEND MODE           03 N-reg-tipo-M-OK           pic 9(8) value zero.

APPEND MODE           03 N-reg-tipo-E-OK           pic 9(8) value zero.

APPEND MODE           03 N-reg-tipo-I-err          pic 9(8) value zero.

APPEND MODE           03 N-reg-tipo-M-err          pic 9(8) value zero.

APPEND MODE           03 N-reg-tipo-E-err          pic 9(8) value zero.

APPEND MODE

APPEND MODE      *    Alertas borradas previo al refresque total

APPEND MODE           03 N-ale-borradas            pic 9(8) value zero.

APPEND MODE      *    Alertas insertadas

APPEND MODE           03 N-ale-insertadas          pic 9(8) value zero.

APPEND MODE      *    Alertas modificadas

APPEND MODE           03 N-ale-modificadas         pic 9(8) value zero.

APPEND MODE      *    Alertas eliminadas

APPEND MODE           03 N-ale-eliminadas          pic 9(8) value zero.

APPEND MODE      *    Insercion de alerta existente

APPEND MODE           03 N-ale-ya-existe           pic 9(8) value zero.

APPEND MODE      *    Modificacion o eliminacion de alerta inexistente

APPEND MODE           03 N-ale-no-existe           pic 9(8) value zero.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Armado de las lineas de alerta

APPEND MODE       01 LA-lineas-alerta.

APPEND MODE      *    Los modelos a continuacion deberan obtenerse de un 

APPEND MODE      *    archivo, como BDIIALE-ALERTAS

APPEND MODE           03 LAend                     pic 999 comp value 0.

APPEND MODE           03 LA-modelos.

APPEND MODE      *         12345678901234567890123456789012345678901234567890

APPEND MODE               05 pic x(50) value

APPEND MODE               "TIENE &&& DEMANDAS CERRADAS Y &&& ABIERTAS        ".

APPEND MODE               05 pic x(50) value

APPEND MODE               "LA ABIERTA MAS RECIENTE SE INSTAURO EL [&&&&&&&&]".

APPEND MODE               05 pic x(50) value

APPEND MODE               "TIENE &&& EMBARGOS CANCELADOS Y &&& VIGENTES      ".

APPEND MODE               05 pic x(50) value

APPEND MODE               "EL EMBARGO MAS RECIENTE SE INSTAURO EL [&&&&&&&&] ".

APPEND MODE               05 pic x(50) value high-values. *> end marker

APPEND MODE           03 LA-modelos2               redefines LA-modelos.

APPEND MODE               05 LA-modelo             pic x(50) occurs 5 

APPEND MODE                                        indexed LAm.

APPEND MODE      *    Funcionamiento de los templates.

APPEND MODE      *    Hay dos templates por de alerta, uno por linea.

APPEND MODE      *    Cada template consiste en hasta 10 frases fijas con

APPEND MODE      *    ampersands (&) donde se van a reemplazar los valores.

APPEND MODE      *    Por ejemplo: 

APPEND MODE      *    TIENE &&& DEMANDAS CERRADAS Y &&& ABIERTAS

APPEND MODE      *    tiene 3 frases fijas y 2 reemplazos. 

APPEND MODE      *    La cantidad de ampersands es irrelevante, pero parece

APPEND MODE      *    conveniente que informe sobre el tamanio del contenido.

APPEND MODE           03 LA-templates.

APPEND MODE               05 LA-template           occurs 4 indexed LAx.

APPEND MODE                   07 LA-parte          pic x(50)

APPEND MODE                                        occurs 10 indexed LAy.

APPEND MODE      *    Las dos lineas armadas

APPEND MODE           03 LA-lineas.

APPEND MODE               05 LA-linea1             pic x(50).

APPEND MODE               05 LA-linea2             pic x(50).

APPEND MODE      *    Los valores a insertar en una linea

APPEND MODE           03 LA-valores.

APPEND MODE               05 LA-valor              pic x(50) 

APPEND MODE                                        occurs 10 indexed LAv.

APPEND MODE      *    Datos para editar valores a insertar

APPEND MODE           03 LA-num                    pic -(11)0.

APPEND MODE           03 LA-numX                   redefines LA-num

APPEND MODE                                        pic x(12).

APPEND MODE           03 LA-descarte               pic x(50).

APPEND MODE

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Errores de consistencia del input

APPEND MODE      * Cada error tiene un codigo de 2 digitos, un espacio, contador

APPEND MODE      * de ocurrencias de 7 digitos, un espacio, y descripcion de 59

APPEND MODE       01 E-errores.

APPEND MODE      *    indica si el registro actual tiene error

APPEND MODE           03 E-hay-error               pic xx value "NO".

APPEND MODE      *    errores del registro actual

APPEND MODE           03 E-errores                 pic x(100) value spaces.

APPEND MODE      *    contador de registros con error

APPEND MODE           03 E-cont-regs-con-error     pic 9(8) value zero.

APPEND MODE      *    tabla de errores

APPEND MODE           03 pic x(11) value "01 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Tipo de movimiento invalido, debe ser I M E T".

APPEND MODE           03 pic x(11) value "02 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Tipo de identificacion invalido, debe ser 1 2 3 4".

APPEND MODE           03 pic x(11) value "03 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Numero de identificacion invalido, debe ser numerico".

APPEND MODE           03 pic x(11) value "04 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Tipo de identificacion debe ser mayor que cero".

APPEND MODE           03 pic x(11) value "05 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Falta el nombre o denominacion".

APPEND MODE           03 pic x(11) value "06 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Numero de demandas vigentes: debe ser numerico".

APPEND MODE           03 pic x(11) value "07 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Numero de demandas terminadas: debe ser numerico".

APPEND MODE           03 pic x(11) value "08 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Fecha ultima demanda vigente YYYYMMDD: debe ser numerica".

APPEND MODE           03 pic x(11) value "09 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Fecha ultima demanda vigente YYYYMMDD: fuera de rango".

APPEND MODE           03 pic x(11) value "10 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Numero de embargos vigentes: debe ser numerico".

APPEND MODE           03 pic x(11) value "11 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Numero de embargos terminados: debe ser numerico".

APPEND MODE           03 pic x(11) value "12 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Fecha ultimo embargo vigente YYYYMMDD: debe ser numerica".

APPEND MODE           03 pic x(11) value "13 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Fecha ultimo embargo vigente YYYYMMDD: fuera de rango".

APPEND MODE           03 pic x(11) value "14 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "El numero de id no se encuentra en el archivo maestro".

APPEND MODE           03 pic x(11) value "15 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "El nombre en el input no coincide con el registrado".

APPEND MODE           03 pic x(11) value "16 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Numero de id fuera del rango del tipo de id informado".

APPEND MODE      *----------------- insertar nuevos items aqui -------------------

APPEND MODE           03 pic x(11) value "00 0000000 ".

APPEND MODE           03 pic x(59) value "--- fin de la lista (cod 00) ---".

APPEND MODE           03                           pic x(3500). *> los 50 items

APPEND MODE       01 E-errores-2                   redefines E-errores.

APPEND MODE           03                           pic xx.

APPEND MODE           03                           pic 9(8).

APPEND MODE           03 E-error                   occurs 50 indexed Ex.

APPEND MODE               05 E-codigo              pic xx.

APPEND MODE               05                       pic x.

APPEND MODE               05 E-contador            pic 9(7).

APPEND MODE               05                       pic x.

APPEND MODE               05 E-descripcion         pic x(59).

APPEND MODE       01 E-edit                        pic z(8)B.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Control de rangos de valores de las fechas del input

APPEND MODE       01 VALIDACIONES-FECHAS.

APPEND MODE           02 ANO-VAL-X                 pic 9(04).

APPEND MODE              88 ANO-VAL                value 1900 thru 2050.

APPEND MODE           02 MES-VAL-X                 pic 9(02).

APPEND MODE              88 MES-VAL                value 01   thru 12.

APPEND MODE           02 DIA-VAL-X                 pic 9(02).

APPEND MODE              88 DIA-VAL                value 01   thru 31.

APPEND MODE

APPEND MODE      /*****************************************************************

APPEND MODE      ******************************************************************

APPEND MODE       PROCEDURE DIVISION.

APPEND MODE      *    0000-PROGRAMA-PRINCIPAL

APPEND MODE      *    4000-PROCESAR-REGISTRO

APPEND MODE      *    4000-PROCESAR-REGISTRO-2

APPEND MODE      *    4100-VALIDACION-FORMAL

APPEND MODE      *    4200-VALIDACION-SEMANTICA

APPEND MODE      *    4300-MODIFICAR-BDIIALE

APPEND MODE      *    4300-MODIFICAR-BDIIALE-DATOS

APPEND MODE      *    4300-MODIFICAR-BDIIALE-I

APPEND MODE      *    4300-MODIFICAR-BDIIALE-M

APPEND MODE      *    4300-MODIFICAR-BDIIALE-E

APPEND MODE      *    4333-LEER-BDIIALE-RANDOM

APPEND MODE      *    4333-GRABAR-BDIIALE

APPEND MODE      *    4333-REGRABAR-BDIIALE

APPEND MODE      *    4333-ELIMINAR-BDIIALE

APPEND MODE      *    4900-GRABAR-ERROR

APPEND MODE      *    4320-ARMAR-TEXTO-ALERTA

APPEND MODE      *    1000-RUTINA-INICIAL

APPEND MODE      *    1001-ELIMINAR-TODO

APPEND MODE      *    7000-RUTINA-FINAL

APPEND MODE      *    9000-CANCELAR-PROGRAMA

APPEND MODE

APPEND MODE

APPEND MODE       0000-PROGRAMA-PRINCIPAL.

APPEND MODE      ******************************************************************

APPEND MODE      *    inicializa el ambiente y abre los archivos

APPEND MODE           perform 1000-RUTINA-INICIAL

APPEND MODE      *    procesa cada uno de los registros del archivo JURAD hasta

APPEND MODE      *    encontrar el registro "T" de totales

APPEND MODE           perform 4000-PROCESAR-REGISTRO until IND-fin-proceso = "SI"

APPEND MODE      *    cierra archivos y produce el reporte final

APPEND MODE           perform 7000-RUTINA-FINAL

APPEND MODE           goback.

APPEND MODE

APPEND MODE       4000-PROCESAR-REGISTRO.

APPEND MODE      ****************************************************************

APPEND MODE      * Proceso de un registro del archivo de entrada JURAD

APPEND MODE      * Lectura y control del file status del archivo

APPEND MODE      ****************************************************************

APPEND MODE      *    lectura del proximo registro

APPEND MODE           read JURAD

APPEND MODE           evaluate JURAD-fs

APPEND MODE           when "00"

APPEND MODE      *        controla el reg y lo aplica si es OK

APPEND MODE               perform 4000-PROCESAR-REGISTRO-2

APPEND MODE               move JURAD-reg to JURAD-reg-anterior

APPEND MODE           when "10"

APPEND MODE      *        fin del archivo de input:

APPEND MODE      *        esto es un error, no se encontro el registro "T" antes

APPEND MODE      *        de que se terminara el archivo

APPEND MODE               display "Falta el reg de totales del archivo JURAD "

APPEND MODE               display "Nombre del archivo: " P-file-name

APPEND MODE               display "File status: " JURAD-fs

APPEND MODE               display "Ultimo registro leido: " N-reg-leidos

APPEND MODE               display JURAD-reg-anterior

APPEND MODE               perform 9000-CANCELAR-PROGRAMA

APPEND MODE           when other

APPEND MODE      *        error de lectura: cancelacion del proceso

APPEND MODE               display "Error en lectura del archivo JURAD "

APPEND MODE               display "Nombre del archivo: " P-file-name

APPEND MODE               display "File status: " JURAD-fs

APPEND MODE               display "Ultimo registro leido: " N-reg-leidos

APPEND MODE               display JURAD-reg-anterior

APPEND MODE               perform 9000-CANCELAR-PROGRAMA

APPEND MODE           end-evaluate.

APPEND MODE

APPEND MODE

APPEND MODE       4000-PROCESAR-REGISTRO-2.

APPEND MODE      ****************************************************************

APPEND MODE      * Controla los datos de un registro de JURAD y si es OK lo usa

APPEND MODE      * para actualizar el archivo de alertas en linea

APPEND MODE      * La informacion esta leida en JURAD-reg

APPEND MODE      ****************************************************************

APPEND MODE           move "NO" to E-hay-error

APPEND MODE

APPEND MODE      *    validacion del tipo de movimiento

APPEND MODE           if JURAD-tipo-novedad not = "I" and "M" and "E" and "T" 

APPEND MODE               call "PONERR" using "01" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE

APPEND MODE      *    si es el registro "T" hay que senialar el fin de proceso

APPEND MODE           if JURAD-tipo-novedad = "T" 

APPEND MODE               move "SI" to IND-fin-proceso

APPEND MODE               exit paragraph

APPEND MODE           end-if

APPEND MODE

APPEND MODE           add 1 to N-reg-leidos

APPEND MODE

APPEND MODE      *    validacion formal de los datos

APPEND MODE           perform 4100-VALIDACION-FORMAL

APPEND MODE           if E-hay-error = "SI"

APPEND MODE               exit paragraph

APPEND MODE           end-if

APPEND MODE

APPEND MODE      *    si la validacion formal dio OK se hace validacion semantica

APPEND MODE           perform 4200-VALIDACION-SEMANTICA

APPEND MODE           if E-hay-error = "SI"

APPEND MODE               exit paragraph

APPEND MODE           end-if

APPEND MODE

APPEND MODE      *    actualizacion de BDIIALE o grabacion en arch ERRS de defectos

APPEND MODE           if E-hay-error = "SI"

APPEND MODE               perform 4900-GRABAR-ERROR

APPEND MODE               add 1 to N-reg-con-error

APPEND MODE           else

APPEND MODE               perform 4300-MODIFICAR-BDIIALE

APPEND MODE               add 1 to N-reg-OK

APPEND MODE           end-if.

APPEND MODE

APPEND MODE

APPEND MODE

APPEND MODE       4100-VALIDACION-FORMAL.

APPEND MODE      ******************************************************************

APPEND MODE      * Validacion formal de los datos del input

APPEND MODE      ******************************************************************

APPEND MODE      *    Tipo de identificacion Numero {1, 2, 3, 4}

APPEND MODE           if JURAD-id-tipo not = "1" and "2" and "3" and "4"

APPEND MODE               call "PONERR" using "02" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE      *    Numero de identificacion

APPEND MODE           if JURAD-id-numeroX is not numeric

APPEND MODE               call "PONERR" using "03" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE           if JURAD-id-numero not > 0

APPEND MODE               call "PONERR" using "04" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE      *    si el movimiento es una eliminacion los datos subsiguientes

APPEND MODE      *    no se controlan

APPEND MODE           if JURAD-tipo-novedad = "E"

APPEND MODE               exit paragraph

APPEND MODE           end-if

APPEND MODE      *    Nombres y Apellidos

APPEND MODE           if JURAD-nombre = spaces

APPEND MODE               call "PONERR" using "05" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE      *    Numero de demandas vigentes

APPEND MODE           if JURAD-demandas-vigentes is not numeric

APPEND MODE               call "PONERR" using "06" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE      *    Numero de demandas terminadas

APPEND MODE           if JURAD-demandas-terminadas is not numeric

APPEND MODE               call "PONERR" using "07" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE      *    Fecha ultima demanda vigente YYMMDD

APPEND MODE           if JURAD-demandas-fecha-ultima is not numeric

APPEND MODE               call "PONERR" using "08" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE           move JURAD-demandas-fecha-ultima to VALIDACIONES-FECHAS

APPEND MODE           if not ANO-VAL or not MES-VAL or not DIA-VAL

APPEND MODE               call "PONERR" using "09" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE      *    Numero de embargos vigentes

APPEND MODE           if JURAD-embargos-vigentes not numeric

APPEND MODE               call "PONERR" using "10" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE      *    Numero de embargos terminados

APPEND MODE           if JURAD-embargos-terminados not numeric

APPEND MODE               call "PONERR" using "11" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE      *    Fecha ultimo embargo vigente YYMMDD

APPEND MODE           if JURAD-embargos-fecha-ultimo is not numeric

APPEND MODE               call "PONERR" using "12" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE           move JURAD-embargos-fecha-ultimo to VALIDACIONES-FECHAS

APPEND MODE           if not ANO-VAL or not MES-VAL or not DIA-VAL

APPEND MODE               call "PONERR" using "13" JURAD-reg E-errores

APPEND MODE           end-if.

APPEND MODE

APPEND MODE

APPEND MODE       4200-VALIDACION-SEMANTICA.

APPEND MODE      ****************************************************************

APPEND MODE      * Validacion del numero de identificacion y de su relacion con

APPEND MODE      * el nombre

APPEND MODE      ****************************************************************

APPEND MODE           move JURAD-id-tipo to TIP-IDE-BDIIVIDE

APPEND MODE           move JURAD-id-numero to NUM-IDE-BDIIVIDE-R

APPEND MODE           move JURAD-nombre to NOMBRE-BDIIVIDE

APPEND MODE           move 1 to SW-VERIFNOM-BDIIVIDE

APPEND MODE           move 0 to SW-DIGCHEQUEO-BDIIVIDE SW-ASGTIPID-BDIIVIDE

APPEND MODE           perform 80100-VALIDAR-IDENTIFICACION

APPEND MODE      *    a ver si la validacion cambio el tipo de ide

APPEND MODE           if JURAD-id-tipo not = TIP-IDE-BDIIVIDE

APPEND MODE               call "PONERR" using "16" JURAD-reg E-errores

APPEND MODE               display "Tipo ide cambiado de " JURAD-id-tipo " a " 

APPEND MODE               TIP-IDE-BDIIVIDE " num ide: " JURAD-id-numero

APPEND MODE           end-if

APPEND MODE      *    SW-ID-BDIIVIDE: 0 si existe el id, 1 si no existe

APPEND MODE           if SW-ID-BDIIVIDE = 1

APPEND MODE               call "PONERR" using "14" JURAD-reg E-errores

APPEND MODE           else

APPEND MODE      *        existe id, a ver si el nombre coincide

APPEND MODE               if SW-NOMBRES-BDIIVIDE = 1    *> nombre no coincide

APPEND MODE                   call "PONERR" using "15" JURAD-reg E-errores

APPEND MODE                   display "novedad:  " JURAD-nombre

APPEND MODE                   display "registro: " NOM-LEIDO-BDIIVIDE

APPEND MODE               end-if

APPEND MODE           end-if.

APPEND MODE

APPEND MODE

APPEND MODE       4300-MODIFICAR-BDIIALE.

APPEND MODE      ******************************************************************

APPEND MODE      * Se impacta el archivo BDIIALE con una o dos inserciones, 

APPEND MODE      * modificaciones o eliminaciones segun haya o no demandas y 

APPEND MODE      * embargos

APPEND MODE      ******************************************************************

APPEND MODE           initialize REG-BDIIALE

APPEND MODE

APPEND MODE      *    si hay demandas

APPEND MODE           if JURAD-demandas-vigentes > zero

APPEND MODE           or JURAD-demandas-terminadas > zero 

APPEND MODE               move "J001" to LLASEC-BDIIALE

APPEND MODE      *        arma datos de demandas

APPEND MODE               move JURAD-demandas-vigentes to D-vigentes

APPEND MODE               move JURAD-demandas-terminadas to D-terminados

APPEND MODE               string "20" JURAD-demandas-fecha-ultima 

APPEND MODE               delimited size into D-fecha-ultima

APPEND MODE               perform 4300-MODIFICAR-BDIIALE-DATOS 

APPEND MODE           end-if.

APPEND MODE

APPEND MODE      *    si hay embargos

APPEND MODE           if JURAD-embargos-vigentes > zero

APPEND MODE           or JURAD-embargos-terminados > zero 

APPEND MODE               move "J002" to LLASEC-BDIIALE

APPEND MODE      *        arma datos de embargos

APPEND MODE               move JURAD-embargos-vigentes to D-vigentes

APPEND MODE               move JURAD-embargos-terminados to D-terminados

APPEND MODE               string "20" JURAD-embargos-fecha-ultimo

APPEND MODE               delimited size into D-fecha-ultima

APPEND MODE               perform 4300-MODIFICAR-BDIIALE-DATOS 

APPEND MODE           end-if.

APPEND MODE

APPEND MODE

APPEND MODE

APPEND MODE       4300-MODIFICAR-BDIIALE-DATOS.

APPEND MODE      ******************************************************************

APPEND MODE      * Parte de la carga de datos en el registro BDIIALE y grabacion

APPEND MODE      * del mismo que es comun a demandas y embargos

APPEND MODE      * El dato LLASEC-BDIIALE ya tiene "J001" o "J002"

APPEND MODE      ******************************************************************

APPEND MODE      *    completa la clave e intenta leer la alerta, si se leyo OK

APPEND MODE      *    el file status de BDIIALE queda con "00"

APPEND MODE           perform 4333-LEER-BDIIALE-RANDOM

APPEND MODE

APPEND MODE      *    procesa segun el tipo de novedad I M E

APPEND MODE           evaluate JURAD-tipo-novedad

APPEND MODE           when "I"

APPEND MODE               add 1 to N-reg-tipo-I-OK

APPEND MODE               perform 4300-MODIFICAR-BDIIALE-I

APPEND MODE           when "M"

APPEND MODE               add 1 to N-reg-tipo-M-OK

APPEND MODE               perform 4300-MODIFICAR-BDIIALE-M

APPEND MODE           when "E"

APPEND MODE               add 1 to N-reg-tipo-E-OK

APPEND MODE               perform 4300-MODIFICAR-BDIIALE-E

APPEND MODE           when other

APPEND MODE      *        esto es "imposible" por control de consistencia anterior

APPEND MODE               display "error de logica: tipo-novedad="

APPEND MODE               JURAD-tipo-novedad " reg n\202°: " N-reg-leidos

APPEND MODE               display "Registro de JURAD: " display JURAD-reg

APPEND MODE               perform 9000-CANCELAR-PROGRAMA

APPEND MODE           end-evaluate.

APPEND MODE

APPEND MODE

APPEND MODE       4300-MODIFICAR-BDIIALE-I.

APPEND MODE      ******************************************************************

APPEND MODE      * Insercion de una alerta nueva

APPEND MODE      * Si ya existia muestra un mensaje y continua

APPEND MODE      ******************************************************************

APPEND MODE      *    si el registro existia es un error

APPEND MODE           if EST-BDIIALE = "00"

APPEND MODE               display "Insercion de alerta nueva que ya existe "

APPEND MODE               " key: " LLAVE-BDIIALE

APPEND MODE               display "Registro de input: "

APPEND MODE               display JURAD-reg

APPEND MODE               display "Datos en la alerta: " INF-DATAHOST-BDIIALE

APPEND MODE               add 1 to N-ale-ya-existe

APPEND MODE           end-if

APPEND MODE

APPEND MODE      *    completa los datos del registro

APPEND MODE           initialize ENCABEZADO-BDIIALE

APPEND MODE           move P-fecha-proceso-YYYYMMDD to FEC-NOV-BDIIALE

APPEND MODE           FEC-REP-BDIIALE 

APPEND MODE           move P-fecha-proceso-50 to FEC-VEN-BDIIALE

APPEND MODE           move 0 to BLOQUEO-BDIIALE

APPEND MODE           move D-datahost to INF-DATAHOST-BDIIALE

APPEND MODE           perform 4320-ARMAR-TEXTO-ALERTA

APPEND MODE           if EST-BDIIALE = "00"

APPEND MODE               perform 4333-REGRABAR-BDIIALE

APPEND MODE           else

APPEND MODE               perform 4333-GRABAR-BDIIALE

APPEND MODE           end-if.

APPEND MODE

APPEND MODE

APPEND MODE       4300-MODIFICAR-BDIIALE-M.

APPEND MODE      ******************************************************************

APPEND MODE      * Modificacion de una alerta existente

APPEND MODE      * Si no existia muestra un mensaje y continua

APPEND MODE      ******************************************************************

APPEND MODE      *    si el registro no existia es un error

APPEND MODE           if EST-BDIIALE not = "00"

APPEND MODE               display "Modificacion de alerta inexistente "

APPEND MODE               " key: " LLAVE-BDIIALE

APPEND MODE               display "Registro de input: "

APPEND MODE               display JURAD-reg

APPEND MODE               display "Datos en la alerta: " INF-DATAHOST-BDIIALE

APPEND MODE               add 1 to N-ale-no-existe

APPEND MODE           end-if

APPEND MODE      *    reemplaza la fecha de reporte y los valores

APPEND MODE           move P-fecha-proceso-YYYYMMDD to FEC-REP-BDIIALE 

APPEND MODE           move D-datahost to INF-DATAHOST-BDIIALE

APPEND MODE           perform 4320-ARMAR-TEXTO-ALERTA

APPEND MODE           if EST-BDIIALE = "00"

APPEND MODE               perform 4333-REGRABAR-BDIIALE

APPEND MODE           else

APPEND MODE               perform 4333-GRABAR-BDIIALE

APPEND MODE           end-if.

APPEND MODE

APPEND MODE

APPEND MODE       4300-MODIFICAR-BDIIALE-E.

APPEND MODE      ******************************************************************

APPEND MODE      * Eliminacion de una alerta

APPEND MODE      * Si no existia muestra un mensaje y continua

APPEND MODE      ******************************************************************

APPEND MODE      *    elimina el registro

APPEND MODE           if EST-BDIIALE = "00"

APPEND MODE               perform 4333-ELIMINAR-BDIIALE

APPEND MODE           else

APPEND MODE               display "Eliminacion de alerta inexistente "

APPEND MODE               " key: " LLAVE-BDIIALE

APPEND MODE               display "Registro de input: "

APPEND MODE               display JURAD-reg

APPEND MODE               add 1 to N-ale-no-existe

APPEND MODE           end-if.

APPEND MODE

APPEND MODE

APPEND MODE       4333-LEER-BDIIALE-RANDOM.

APPEND MODE      ******************************************************************

APPEND MODE      * Arma clave exacta y lee un registro de BDIIALE

APPEND MODE      * Usa los datos del reg input, excepto LLASEC que esta precargado

APPEND MODE      * Cuando pudo leer OK el file status EST-BDIIALE queda con "00"

APPEND MODE      ******************************************************************

APPEND MODE           move JURAD-id-tipo to TIP-IDE-BDIIALE

APPEND MODE           move JURAD-id-numero to NUM-IDE-BDIIALE

APPEND MODE           move P-cod-suscriptor to FUENTE-BDIIALE

APPEND MODE           move 000 to COD-ALERTA-BDIIALE

APPEND MODE

APPEND MODE           read BDIIALE

APPEND MODE           evaluate EST-BDIIALE

APPEND MODE           when "00"

APPEND MODE               continue

APPEND MODE           when "20" thru "29"

APPEND MODE               continue

APPEND MODE           when other

APPEND MODE               display "Error al leer BDIIALE fs: " EST-BDIIALE

APPEND MODE               " key: " LLAVE-BDIIALE

APPEND MODE               display "Ultimo registro procesado: "

APPEND MODE               display JURAD-reg-anterior

APPEND MODE               perform 9000-CANCELAR-PROGRAMA

APPEND MODE           end-evaluate.

APPEND MODE

APPEND MODE

APPEND MODE       4333-GRABAR-BDIIALE.

APPEND MODE      ******************************************************************

APPEND MODE      * Inserta un registro nuevo en BDIIALE

APPEND MODE      ******************************************************************

APPEND MODE           if not PROCESO-REAL

APPEND MODE               exit paragraph

APPEND MODE           end-if

APPEND MODE           write REG-BDIIALE

APPEND MODE           evaluate EST-BDIIALE

APPEND MODE           when "00"

APPEND MODE               add 1 to N-ale-insertadas

APPEND MODE           when other

APPEND MODE               display "Error al grabar BDIIALE fs: " EST-BDIIALE

APPEND MODE               " key: " LLAVE-BDIIALE

APPEND MODE               display "Registro BDIIALE: "

APPEND MODE               display REG-BDIIALE

APPEND MODE               perform 9000-CANCELAR-PROGRAMA

APPEND MODE           end-evaluate.

APPEND MODE

APPEND MODE

APPEND MODE       4333-REGRABAR-BDIIALE.

APPEND MODE      ******************************************************************

APPEND MODE      * Regraba un registro modificado en BDIIALE

APPEND MODE      ******************************************************************

APPEND MODE           if not PROCESO-REAL

APPEND MODE               exit paragraph

APPEND MODE           end-if

APPEND MODE           rewrite REG-BDIIALE

APPEND MODE           evaluate EST-BDIIALE

APPEND MODE           when "00"

APPEND MODE               add 1 to N-ale-modificadas

APPEND MODE           when other

APPEND MODE               display "Error al regrabar BDIIALE fs: " EST-BDIIALE

APPEND MODE               " key: " LLAVE-BDIIALE

APPEND MODE               display "Registro BDIIALE: "

APPEND MODE               display REG-BDIIALE

APPEND MODE               perform 9000-CANCELAR-PROGRAMA

APPEND MODE           end-evaluate.

APPEND MODE

APPEND MODE

APPEND MODE       4333-ELIMINAR-BDIIALE.

APPEND MODE      ******************************************************************

APPEND MODE      * Elimina un registro de BDIIALE

APPEND MODE      ******************************************************************

APPEND MODE           if not PROCESO-REAL

APPEND MODE               exit paragraph

APPEND MODE           end-if

APPEND MODE           delete BDIIALE

APPEND MODE           evaluate EST-BDIIALE

APPEND MODE           when "00"

APPEND MODE               add 1 to N-ale-eliminadas

APPEND MODE           when other

APPEND MODE               display "Error al regrabar BDIIALE fs: " EST-BDIIALE

APPEND MODE               " key: " LLAVE-BDIIALE

APPEND MODE               display "Registro BDIIALE: "

APPEND MODE               display REG-BDIIALE

APPEND MODE               perform 9000-CANCELAR-PROGRAMA

APPEND MODE           end-evaluate.

APPEND MODE

APPEND MODE

APPEND MODE       4900-GRABAR-ERROR.

APPEND MODE      ******************************************************************

APPEND MODE      * El registro de JURAD tiene error: se graba en el archivo ERRS

APPEND MODE      * con indicacion del error detectado

APPEND MODE      ******************************************************************

APPEND MODE           move JURAD-reg to ERRS-reg

APPEND MODE      *    lista de los codigos de los errores del registro

APPEND MODE           move E-errores to ERRS-causa-rechazo

APPEND MODE           write ERRS

APPEND MODE           evaluate ERRS-fs

APPEND MODE               when "00"

APPEND MODE                   continue

APPEND MODE               when other

APPEND MODE                   display "Error al grabar el archivo de errores "

APPEND MODE                   display "Nombre del archivo: " ERRS-file-name

APPEND MODE                   display "File status: " ERRS-fs

APPEND MODE                   perform 9000-CANCELAR-PROGRAMA

APPEND MODE                   goback

APPEND MODE           end-evaluate.

APPEND MODE 

APPEND MODE

APPEND MODE       4320-ARMAR-TEXTO-ALERTA.

APPEND MODE      ****************************************************************

APPEND MODE      * Hace el reemplazo de los valores adecuados en los templates

APPEND MODE      * de las linea de alerta que corresponde

APPEND MODE      ****************************************************************

APPEND MODE      *    segun se trate de demandas o embargos

APPEND MODE           if JURAD-demandas-vigentes not = 0 

APPEND MODE           or JURAD-demandas-terminadas not = 0

APPEND MODE               set LAx to 1

APPEND MODE               move high-values to LA-valores

APPEND MODE               move JURAD-demandas-vigentes to LA-num

APPEND MODE      * >>>> esto esta anulado x que no se como hacer para que lo compile

APPEND MODE      *        unstring LA-numX into LA-descarte LA-valor(1)

APPEND MODE      *        delimited by all space

APPEND MODE               move LA-numx(9:12) to LA-valor(1)

APPEND MODE               move JURAD-demandas-terminadas to LA-num

APPEND MODE      * >>>> esto esta anulado x que no se como hacer para que lo compile

APPEND MODE      *        unstring LA-numX into LA-descarte LA-valor(2)

APPEND MODE      *        delimited by all space

APPEND MODE               move LA-numx(9:12) to LA-valor(2)

APPEND MODE

APPEND MODE      * >>>> esto esta anulado x que no se como hacer para que lo compile

APPEND MODE      * >>>> da error en el end-if

APPEND MODE      *        string LA-parte(LAx, 1) LA-valor(1)

APPEND MODE      *        LA-parte(LAx, 2) LA-valor(2) LA-parte(LAx, 3) LA-valor(3)

APPEND MODE      *        LA-parte(LAx, 4) LA-valor(4) LA-parte(LAx, 5) LA-valor(5)

APPEND MODE      *        LA-parte(LAx, 6) LA-valor(6) LA-parte(LAx, 7) LA-valor(7)

APPEND MODE      *        LA-parte(LAx, 8) LA-valor(8) LA-parte(LAx, 9) LA-valor(9)

APPEND MODE      *        LA-parte(LAx, 10) LA-valor(10)

APPEND MODE      *        delimited by high-value

APPEND MODE           end-if.

APPEND MODE

APPEND MODE

APPEND MODE       1000-RUTINA-INICIAL.

APPEND MODE      ******************************************************************

APPEND MODE      * Todas las operaciones que se realizan una sola vez, al comienzo

APPEND MODE      * del programa:

APPEND MODE      *   - obtencion de los parametros

APPEND MODE      *   - apertura del archivo de entrada

APPEND MODE      *   - apertura de todos los demas archivos

APPEND MODE      *   - eliminacion de datos existentes si es refresque completo

APPEND MODE      ******************************************************************

APPEND MODE      * Registra hora de inicio

APPEND MODE           accept W-hora-inicio from time

APPEND MODE

APPEND MODE      * El programa se anuncia en la consola

APPEND MODE      * TODO: se usa un anuncio mas vistoso

APPEND MODE           display pgm " - Carga de archivo JURAD" W-hora-inicio

APPEND MODE

APPEND MODE      * Obtiene informacion sobre la corrida de la linea de comando: el

APPEND MODE      * nombre del archivo de entrada (que contiene el tipo de proceso)

APPEND MODE           accept P-command-line from COMMAND-LINE

APPEND MODE           display "Parametros: " P-command-line

APPEND MODE           unstring P-command-line delimited by all " " into

APPEND MODE           P-file-name P-proceso-real

APPEND MODE      * TODO: controlar los componentes del filename

APPEND MODE           evaluate P-tipo-proceso

APPEND MODE           when "01" *> 01 Envio Original - Carga TOTAL 1a vez

APPEND MODE               display "01 Envio Original - Carga TOTAL 1a vez"

APPEND MODE           when "02" *> 02 Archivo Semanal - Carga PARCIAL

APPEND MODE               display "02 Archivo Semanal - Carga PARCIAL"

APPEND MODE           when "03" *> 03 Archivo Mensual - Carga PARCIAL

APPEND MODE               display "03 Archivo Mensual - Carga PARCIAL"

APPEND MODE           when "04" *> 04 Refresque Total - Carga TOTAL

APPEND MODE               display "04 Refresque Total - Carga TOTAL"

APPEND MODE           when other

APPEND MODE      *       valor invalido

APPEND MODE               display "El tipo de proceso " P-tipo-proceso

APPEND MODE               " es invalido (debe ser 01 02 03 o 04)"

APPEND MODE               perform 9000-CANCELAR-PROGRAMA

APPEND MODE           end-evaluate.

APPEND MODE

APPEND MODE      * Edita la fecha de proceso DDMMAA del parametro en formato

APPEND MODE      * YYYYMMDD 

APPEND MODE           string "20" P-fecha-proceso(5:6) P-fecha-proceso(3:4)

APPEND MODE           P-fecha-proceso(1:2) delimited size 

APPEND MODE           into P-fecha-proceso-YYYYMMDD

APPEND MODE

APPEND MODE      * Calcula una decha 50 anios posterior a la de proceso

APPEND MODE           move P-fecha-proceso-YYYYMMDD to P-fecha-proceso-50

APPEND MODE           add 50 to P-fecha-proceso-50YYYY

APPEND MODE

APPEND MODE      * Apertura del archivo de entrada

APPEND MODE           open input JURAD

APPEND MODE           evaluate JURAD-fs

APPEND MODE               when "00"

APPEND MODE                    continue

APPEND MODE               when other

APPEND MODE                   display "Error en open del archivo jurad "

APPEND MODE                   display "Nombre del archivo: " P-file-name

APPEND MODE                   display "File status: " JURAD-fs

APPEND MODE                   perform 9000-CANCELAR-PROGRAMA *> no retorna

APPEND MODE                   goback

APPEND MODE           end-evaluate.

APPEND MODE

APPEND MODE      * Apertura del archivo de errores

APPEND MODE           string P-file-name(1:19) "_ERRORES.txt" into

APPEND MODE           ERRS-file-name

APPEND MODE           open output ERRS

APPEND MODE           evaluate ERRS-fs

APPEND MODE               when "00"

APPEND MODE                    continue

APPEND MODE               when other

APPEND MODE                   display "Error en open del archivo de errores "

APPEND MODE                   display "Nombre del archivo: " ERRS-file-name

APPEND MODE                   display "File status: " ERRS-fs

APPEND MODE                   perform 9000-CANCELAR-PROGRAMA *> no retorna

APPEND MODE                   goback

APPEND MODE           end-evaluate.

APPEND MODE

APPEND MODE      * Apertura de los archivos maestros

APPEND MODE      * TODO: falta capturar el status de estas operaciones?

APPEND MODE           open input BDIIREGI

APPEND MODE           open input BDIIDIAN

APPEND MODE           open input BDIIDAS.

APPEND MODE

APPEND MODE      * Apertura del archivo de alertas en linea

APPEND MODE           if PROCESO-REAL

APPEND MODE               open i-o BDIIALE

APPEND MODE           else

APPEND MODE               open input BDIIALE

APPEND MODE           end-if.

APPEND MODE

APPEND MODE      * Si es un refresque total (codigo 04) se eliminan los registros

APPEND MODE      * de Jurad existentes

APPEND MODE           if P-tipo-proceso = "04" and PROCESO-REAL

APPEND MODE               perform 1001-ELIMINAR-TODO

APPEND MODE           end-if.

APPEND MODE

APPEND MODE       1000-NOT-USED.

APPEND MODE      * >>>> esto da un error de compilacion que no puedo resolver

APPEND MODE      * >>>> por ahora esta anulado

APPEND MODE      ******************************************************************

APPEND MODE      * Carga de los templates para armar el texto de alertas

APPEND MODE      * TODO: por ahora los templates son literales

APPEND MODE           set LAx to 0

APPEND MODE           move high-values to LA-templates

APPEND MODE           perform varying LAm from 1 by 1 

APPEND MODE           until LA-modelo(LAm) = high-values

APPEND MODE               set LAx up by 1

APPEND MODE      *        separa las partes de la linea

APPEND MODE      *        unstring LA-modelo(LAm) into LA-parte(LAx, 1)

APPEND MODE      *        LA-parte(LAx, 2) LA-parte(LAx, 3) LA-parte(LAx, 4)

APPEND MODE      *        LA-parte(LAx, 5) LA-parte(LAx, 6) LA-parte(LAx, 7)

APPEND MODE      *        LA-parte(LAx, 8) LA-parte(LAx, 9) LA-parte(LAx, 10)

APPEND MODE      *        delimited by all "&"

APPEND MODE      *        prepara para omitir los espacios al final de c/parte

APPEND MODE               perform varying LAy from 1 by 1 until LAy > 10

APPEND MODE                   inspect LA-parte(LAx, LAy) replacing trailing

APPEND MODE                   spaces by high-values

APPEND MODE                   inspect LA-parte(LAx, LAy) replacing first

APPEND MODE                   high-value by space

APPEND MODE               end-perform

APPEND MODE           end-perform.

APPEND MODE

APPEND MODE

APPEND MODE

APPEND MODE       1001-ELIMINAR-TODO.

APPEND MODE      ******************************************************************

APPEND MODE      * Elimina los registros de alertas existentes en el archivo de

APPEND MODE      * alertas en linea, previo a un refresque total

APPEND MODE      ******************************************************************

APPEND MODE           display "Eliminando toda la informacion con fuente JURAD"

APPEND MODE      *    posiciona en el primer reg de JURAD

APPEND MODE           move zero to TIP-IDE-BDIIALE

APPEND MODE           move zero to NUM-IDE-BDIIALE

APPEND MODE           move P-cod-suscriptor to FUENTE-BDIIALE

APPEND MODE           move zeros to COD-ALERTA-BDIIALE

APPEND MODE           move low-values to LLASEC-BDIIALE

APPEND MODE           start BDIIALE key > LLAVE-BDIIALE invalid key

APPEND MODE      *        no hay registros

APPEND MODE               exit paragraph

APPEND MODE

APPEND MODE      *    lee secuencialmente y elimina los registros de JURAD

APPEND MODE      *    hasta el fin del archivo

APPEND MODE           perform until EST-BDIIALE not = "00"

APPEND MODE               read BDIIALE next record

APPEND MODE               evaluate EST-BDIIALE

APPEND MODE               when "00"

APPEND MODE                   if FUENTE-BDIIALE = P-cod-suscriptor

APPEND MODE      *                es un alerta de JURAD

APPEND MODE                       delete BDIIALE

APPEND MODE                       if EST-BDIIALE = "00"

APPEND MODE                           add 1 to N-ale-borradas

APPEND MODE                       else

APPEND MODE      *                    error en la eliminacion

APPEND MODE                           display "Error al eliminar un registro de "

APPEND MODE                           "BDIIALE vaciando los datos"

APPEND MODE                           display "Clave: " LLAVE-BDIIALE

APPEND MODE                           display "Reg borrados: " N-ale-borradas

APPEND MODE                           perform 9000-CANCELAR-PROGRAMA

APPEND MODE                       end-if

APPEND MODE                   end-if

APPEND MODE               when "10"

APPEND MODE      *            fin de archivo: sale normalmente

APPEND MODE                   continue

APPEND MODE               when other

APPEND MODE      *            lectura anormal: cancelacion del programa

APPEND MODE                   display "Error en lectura del archivo de alertas "

APPEND MODE                   "online"

APPEND MODE                   display "File status: " EST-BDIIALE

APPEND MODE                   perform 9000-CANCELAR-PROGRAMA *> no retorna

APPEND MODE               end-evaluate

APPEND MODE           end-perform.

APPEND MODE           display "Termino la eliminacion total de JURAD"

APPEND MODE           display "Reg borrados: " N-ale-borradas. 

APPEND MODE

APPEND MODE

APPEND MODE       7000-RUTINA-FINAL.

APPEND MODE      ******************************************************************

APPEND MODE      * Registra hora de finalizacion

APPEND MODE           accept W-hora-fin from time

APPEND MODE

APPEND MODE      * Leer JURAD a ver si hay registros despues del "T"

APPEND MODE

APPEND MODE      * Close todos los archivos

APPEND MODE           close JURAD ERRS BDIIREGI BDIIDIAN BDIIDAS BDIIALE.

APPEND MODE      

APPEND MODE      * Emision de contadores de registros

APPEND MODE           display " "

APPEND MODE           display "Totales de registros:"

APPEND MODE           move N-reg-leidos to N-edit 

APPEND MODE           display N-edit "Registros IME en el archivo de entrada"

APPEND MODE           move N-reg-OK to N-edit 

APPEND MODE           display N-edit "Registros procesados sin error"

APPEND MODE

APPEND MODE           move N-reg-tipo-I-OK to N-edit

APPEND MODE           display N-edit "Registros tipo I aceptados"

APPEND MODE           move N-reg-tipo-M-OK to N-edit

APPEND MODE           display N-edit "Registros tipo M aceptados"

APPEND MODE           move N-reg-tipo-E-OK to N-edit

APPEND MODE           display N-edit "Registros tipo E aceptados"

APPEND MODE

APPEND MODE           move E-cont-regs-con-error to N-reg-con-error

APPEND MODE           move N-reg-con-error to N-edit 

APPEND MODE           display N-edit "Registros con error"

APPEND MODE           move N-ale-borradas to N-edit 

APPEND MODE           display N-edit "Alertas borradas previo al refresque total"

APPEND MODE           move N-ale-insertadas to N-edit 

APPEND MODE           display N-edit "Alertas insertadas"

APPEND MODE           move N-ale-modificadas to N-edit 

APPEND MODE           display N-edit "Alertas modificadas"

APPEND MODE           move N-ale-eliminadas to N-edit 

APPEND MODE           display N-edit "Alertas eliminadas"

APPEND MODE           move N-ale-ya-existe to N-edit 

APPEND MODE           display N-edit "Insercion de alerta existente"

APPEND MODE           move N-ale-no-existe to N-edit 

APPEND MODE           display N-edit "Modif o elim de alerta inexistente".

APPEND MODE

APPEND MODE      * Emision del reporte de errores

APPEND MODE           display " "

APPEND MODE           display "Totales por tipo de error detectado:"

APPEND MODE           perform varying Ex from 1 by 1 until Ex > 50

APPEND MODE           or E-codigo(Ex) = "00"

APPEND MODE               if E-contador(Ex) not = 0 

APPEND MODE                   move E-contador(ex) to E-edit

APPEND MODE                   display E-edit E-codigo "-" E-descripcion(Ex)

APPEND MODE               end-if

APPEND MODE           end-perform.

APPEND MODE

APPEND MODE

APPEND MODE       9000-CANCELAR-PROGRAMA.

APPEND MODE      ******************************************************************

APPEND MODE      * Procedimiento standard de cancelacion de programa batch

APPEND MODE      ******************************************************************

APPEND MODE      * TODO: hay un standard para comunicar una cancelacion de proceso?

APPEND MODE           display pgm " - proceso cancelado"

APPEND MODE           goback returning 99.

APPEND MODE

APPEND MODE

APPEND MODE           copy BDIIVIDE.PROC.

APPEND MODE

APPEND MODE

APPEND MODE           copy VALNOM.PROC.

APPEND MODE

APPEND MODE

APPEND MODE      /

APPEND MODE       IDENTIFICATION DIVISION.

APPEND MODE       PROGRAM-ID. PONERR.

APPEND MODE      ******************************************************************

APPEND MODE      * Rutina de conveniencia para procesar un error detectado en un

APPEND MODE      * registro de input

APPEND MODE      * Contabiliza el error en la tabla de errores, activa el indicador

APPEND MODE      * de registro con error, muestra el mensaje en la pantalla, cuenta

APPEND MODE      * el registro erroneo

APPEND MODE      ******************************************************************

APPEND MODE       ENVIRONMENT DIVISION.

APPEND MODE       DATA DIVISION.

APPEND MODE       WORKING-STORAGE SECTION.

APPEND MODE      ******************************************************************

APPEND MODE      * Registro de input (primeros 86 caracteres)

APPEND MODE       01  reg-input-anterior           pic x(86) value low-values.

APPEND MODE      * Posicion del proximo error en la lista de errores del reg

APPEND MODE       01  errIndex                     pic 999 comp.

APPEND MODE      ******************************************************************

APPEND MODE

APPEND MODE       LINKAGE SECTION.

APPEND MODE      ******************************************************************

APPEND MODE      * Codigo del error detectado

APPEND MODE       01  cod-error                    pic xx.

APPEND MODE      ******************************************************************

APPEND MODE      * Registro de input (primeros 86 caracteres)

APPEND MODE       01  reg-input                    pic x(86).

APPEND MODE      ******************************************************************

APPEND MODE      * Tabla de errores de consistencia del input

APPEND MODE       01 E-errores.

APPEND MODE      *    indica si el registro actual tiene error

APPEND MODE           03 E-hay-error               pic xx.

APPEND MODE      *    errores del registro actual

APPEND MODE           03 E-errores                 pic x(100).

APPEND MODE      *    contador de registros con error

APPEND MODE           03 E-cont-regs-con-error     pic 9(8).

APPEND MODE      *    tabla de errores

APPEND MODE           03 E-error                   occurs 50 indexed Ex.

APPEND MODE               05 E-codigo              pic xx.

APPEND MODE               05                       pic x.

APPEND MODE               05 E-contador            pic 9(7).

APPEND MODE               05                       pic x.

APPEND MODE               05 E-descripcion         pic x(59).

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE

APPEND MODE       PROCEDURE DIVISION using cod-error reg-input E-errores.

APPEND MODE       00.

APPEND MODE      *    marca al reg actual como erroneo

APPEND MODE           move "SI" to E-hay-error

APPEND MODE

APPEND MODE      *    cuenta y muestra el registro de input

APPEND MODE           if reg-input(1:86) not = reg-input-anterior

APPEND MODE               add 1 to E-cont-regs-con-error

APPEND MODE               display " "

APPEND MODE               display reg-input(1:86)

APPEND MODE               move reg-input(1:86) to reg-input-anterior

APPEND MODE               move spaces to E-errores

APPEND MODE           end-if

APPEND MODE

APPEND MODE      *    contabiliza el error en la tabla de errores

APPEND MODE           set Ex to 1

APPEND MODE           search E-error varying Ex

APPEND MODE           at end

APPEND MODE               display "--- falla en la tabla de errores ---" cod-error

APPEND MODE           when E-codigo(Ex) = "00"

APPEND MODE               add 1 to E-contador(Ex)

APPEND MODE               display "--- error tipo exotico: " cod-error

APPEND MODE           when E-codigo(Ex) = cod-error

APPEND MODE               add 1 to E-contador(Ex)

APPEND MODE               display "Error " cod-error " " E-descripcion(Ex)

APPEND MODE           end-search

APPEND MODE

APPEND MODE      *    agrega a la lista de errores del registro

APPEND MODE           if errIndex < 99

APPEND MODE               move cod-error to E-errores(errIndex:2)

APPEND MODE               add 3 to errindex

APPEND MODE           end-if

APPEND MODE

APPEND MODE           exit program.

APPEND MODE

APPEND MODE

APPEND MODE       end program PONERR.

APPEND MODE

APPEND MODE       end program ACTALEJUR.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      ******************************************************************

APPEND MODE

[1] + Stopped (SIGTSTP)        vi CARGAJUR.CBL
/d/iccol/desarrollo $^[  /d/iccol/desarrollo $vi CARGAJUR.CBLfu             vi CARGAJUR.CBL. viset        x CARGAJUR 9999991000905140101.txt/d/iccol/desarrollo $des-c-v CARGAJUR                  /d/iccol/desarrollo $
Ejecucion de la macro de compilacion cobol para desarrollo
cob64 -C nolist -CC -KPIC -A -KPIC -N PIC -uv -g -P -C sourceasm /d/iccol/desarrollo/fuentes/CARGAJUR.CBL 
* Micro Focus Server Express         V5.1 revision 000           Compiler
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
* Accepted - VERBOSE
* Accepted - NOANIM
* Accepted - NOBOUND
* Accepted - NOALTER
* Accepted - COMP
* Accepted - TRUNC
* Accepted - int("CARGAJUR.int")
* Accepted - anim
* Accepted - csi
* Accepted - verbose
* Accepted - nolist
* Accepted - sourceasm
* Accepted - list("CARGAJUR.lst")
* Compiling /d/iccol/desarrollo/fuentes/CARGAJUR.CBL
".............COMPILANDO BDIIREGI SIN STATUS.........."
".............COMPILANDO BDIIDIAN SIN STATUS.........."
".............COMPILANDO BDIIDAS SIN STATUS.........."
".............COMPILANDO BDIIALE SIN STATUS.........."
* Total Messages:     0
* Data:       23648     Code:       22856
* Micro Focus Server Express V5.1.00 Code Generator
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
* Accepted - verbose
* Accepted - anim
* Accepted - PIC
* Generating CARGAJUR
* Data:     23384  Code:     44116  Literals:      1808  Dynamic:   1409024

>>> DATACREDITO: TERMINO OK COMPILACION DE CARGAJUR.CBL

/d/iccol/desarrollo $fu
/d/iccol/desarrollo $^[  /d/iccol/desarrollo $fudes-c-v CARGAJURvi CARGAJUR.CBL fu             vi CARGAJUR.CBL. viset        x CARGAJUR 9999991000905140101.txt/d/iccol/desarrollo $
CARGAJUR   - Carga de archivo JURAD09544879
Parametros: 9999991000905140101.txt                                                         
01 Envio Original - Carga TOTAL 1a vez
 
I100000149123JOSE MISAEL AREVALO SANCHEZ                  0010012013040500905720130411
Error 14 El numero de id no se encuentra en el archivo maestro      
 
I100000262135LIBARDO ANTONIO GARZON TORRE                 0150202013020602204520120406
Error 14 El numero de id no se encuentra en el archivo maestro      
 
I100000958212LUIS GUILLERMO AVENDAnO RODR                 0020442013050603302020000406
Error 14 El numero de id no se encuentra en el archivo maestro      
 
I100001327130GONZALO PATInO MORENO                        0030062013010604407619984069
Error 13 Fecha ultimo embargo vigente YYYYMMDD: fuera de rango      
 
I100002859753ERNESTO RICO                                 0050672013040602206720100435
Error 13 Fecha ultimo embargo vigente YYYYMMDD: fuera de rango      
 
I100002865767MIGUEL ANTONIO LAVERDE NIETO                 0060452011040603303320111406
Error 13 Fecha ultimo embargo vigente YYYYMMDD: fuera de rango      
 
I100003044362MANUEL CASTRO MUnETON                        0070rt2011010605300120130406
Error 07 Numero de demandas terminadas: debe ser numerico           
 
I100003448867JAIRO DE JESUS HENAO VILLEGA                 0090572013041104550030100806
Error 13 Fecha ultimo embargo vigente YYYYMMDD: fuera de rango      
 
I200811046741SALUD AXIAL LTDA                             0440761998406903400219990101
Error 09 Fecha ultima demanda vigente YYYYMMDD: fuera de rango      
 
I200860013816INSTITUTO DE SEGUROS SOCIALE                 0220672010043503300220131206
Error 09 Fecha ultima demanda vigente YYYYMMDD: fuera de rango      
 
I200860024151COMPUTEC SA                                  0330332011140604500120110402
Error 09 Fecha ultima demanda vigente YYYYMMDD: fuera de rango      
 
I200860034313BANCO DAVIVIENDA SA                          0533000013040601102320110411
Error 09 Fecha ultima demanda vigente YYYYMMDD: fuera de rango      
 
I200890300546COLGATE PALMOLIVE COMPAIA                    2322000011050603304320131010
Error 09 Fecha ultima demanda vigente YYYYMMDD: fuera de rango      
 
I300600003115xxxxxx                                       0150542014010600400320120406
Error 15 El nombre en el input no coincide con el registrado        
novedad:  xxxxxx                                       
registro: FERNANDEZ PENA JULIO ANTONIO                                     
 
I400000266423SIMONE MARTINEZ                              033002201312060070rt20110106
Error 11 Numero de embargos terminados: debe ser numerico           
 
I400000244359PATRICIO ALEJANDRO HERRERA C                 0450012011040200804520130111
Error 14 El numero de id no se encuentra en el archivo maestro      
 
I400000163598xxxxxx                                       0330432013101002204520120406
Error 15 El nombre en el input no coincide con el registrado        
novedad:  xxxxxx                                       
registro: KARAN  ABBOUD NAJAH                                              
 
Totales de registros:
      28 Registros en el archivo de entrada
      10 Registros procesados sin error
      17 Registros con error
         Alertas borradas previo al refresque total
         Alertas insertadas
         Alertas modificadas
         Alertas eliminadas
         Insercion de alerta existente
         Modif o elim de alerta inexistente
 
Totales por tipo de error detectado:
       1 Numero de demandas terminadas: debe ser numerico           
       5 Fecha ultima demanda vigente YYYYMMDD: fuera de rango      
       1 Numero de embargos terminados: debe ser numerico           
       4 Fecha ultimo embargo vigente YYYYMMDD: fuera de rango      
       4 El numero de id no se encuentra en el archivo maestro      
       2 El nombre en el input no coincide con el registrado        

real    0m0.03s
user    0m0.01s
sys     0m0.01s

Inicio de Programa:  2014/05/16 09:54:48
Fin de Programa:     2014/05/16 09:54:48

/d/iccol/desarrollo $
/d/iccol/desarrollo $
shell will timeout in 60 seconds due to inactivity

/d/iccol/desarrollo $
/d/iccol/desarrollo $fg
vi CARGAJUR.CBL
05 E-contadorpic 9(7).05pic x.05 E-descripcionpic x(59).******************************************************************PROCEDURE DIVISION using cod-error reg-input E-errores.
00.
*    marca al reg actual como erroneomove "SI" to E-hay-error*    cuenta y muestra el registro de inputif reg-input(1:86) not = reg-input-anterioradd 1 to E-cont-regs-con-errordisplay " "
display reg-input(1:86)move reg-input(1:86) to reg-input-anteriormove spaces to E-erroresend-if*    contabiliza el error en la tabla de erroresset Ex to 1
search E-error varying Exat end
display "--- falla en la tabla de errores ---" cod-errorwhen E-codigo(Ex) = "00"add 1 to E-contador(Ex)display "--- error tipo exotico: " cod-errorwhen E-codigo(Ex) = cod-erroradd 1 to E-contador(Ex)display "Error " cod-error " " E-descripcion(Ex)end-search*    agrega a la lista de errores del registroif errIndex < 99
move cod-error to E-errores(errIndex:2)add 3 to errindexend-if

exit program.end program PONERR.end program ACTALEJUR.******************************************************************
******************************************************************

/\<lax\>Address search hit BOTTOM without matching pattern
?end-if.1000-NOT-USED.
* >>>> esto da un error de compilacion que no puedo resolver
* >>>> por ahora esta anulado
******************************************************************
* Carga de los templates para armar el texto de alertas
* TODO: por ahora los templates son literalesset LAx to 0
move high-values to LA-templatesperform varying LAm from 1 by 1until LA-modelo(LAm) = high-valuesset LAx up by 1
*separa las partes de la linea
*unstring LA-modelo(LAm) into LA-parte(LAx, 1)
*LA-parte(LAx, 2) LA-parte(LAx, 3) LA-parte(LAx, 4)
*LA-parte(LAx, 5) LA-parte(LAx, 6) LA-parte(LAx, 7)
*LA-parte(LAx, 8) LA-parte(LAx, 9) LA-parte(LAx, 10)
*delimited by all "&"
*prepara para omitir los espacios al final de c/parteperform varying LAy from 1 by 1 until LAy > 10inspect LA-parte(LAx, LAy) replacing trailingspaces by high-valuesinspect LA-parte(LAx, LAy) replacing firsthigh-value by spaceend-performend-perform.1001-ELIMINAR-TODO.
******************************************************************
* Elimina los registros de alertas existentes en el archivo de
* alertas en linea, previo a un refresque total
******************************************************************display "Eliminando toda la informacion con fuente JURAD"
*    posiciona en el primer reg de JURADmove zero to TIP-IDE-BDIIALEmove zero to NUM-IDE-BDIIALEmove P-cod-suscriptor to FUENTE-BDIIALEmove zeros to COD-ALERTA-BDIIALEmove low-values to LLASEC-BDIIALEstart BDIIALE key > LLAVE-BDIIALE invalid key
*no hay registros
exit paragraph*    lee secuencialmente y elimina los registros de JURAD
*    hasta el fin del archivoperform until EST-BDIIALE not = "00"/
7 lines yanked*separa las partes de la linea
*unstring LA-modelo(LAm) into LA-parte(LAx, 1)
*LA-parte(LAx, 2) LA-parte(LAx, 3) LA-parte(LAx, 4)
*LA-parte(LAx, 5) LA-parte(LAx, 6) LA-parte(LAx, 7)
*LA-parte(LAx, 8) LA-parte(LAx, 9) LA-parte(LAx, 10)
*delimited by all "&"
*prepara para omitir los espacios al final de c/parte7 more lines
REPLACE 1 CHAR 
 
 
 
 
OPEN MODE/
??/LA$CHANGE MODE1/LA$1/LA$1/LA$1/LA$1/LA$1/LA$1/LA$1/LA$1/LA$1o(LA$1:w"CARGAJUR.CBL" 1219 lines, 51755 characters [1] + Stopped (SIGTSTP)        vi CARGAJUR.CBL
/d/iccol/desarrollo $^[  /d/iccol/desarrollo $fgx CARGAJUR 9999991000905140101.txt/d/iccol/desarrollo $fu                                /d/iccol/desarrollo $des-c-v CARGAJUR
Ejecucion de la macro de compilacion cobol para desarrollo
cob64 -C nolist -CC -KPIC -A -KPIC -N PIC -uv -g -P -C sourceasm /d/iccol/desarrollo/fuentes/CARGAJUR.CBL 
* Micro Focus Server Express         V5.1 revision 000           Compiler
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
* Accepted - VERBOSE
* Accepted - NOANIM
* Accepted - NOBOUND
* Accepted - NOALTER
* Accepted - COMP
* Accepted - TRUNC
* Accepted - int("CARGAJUR.int")
* Accepted - anim
* Accepted - csi
* Accepted - verbose
* Accepted - nolist
* Accepted - sourceasm
* Accepted - list("CARGAJUR.lst")
* Compiling /d/iccol/desarrollo/fuentes/CARGAJUR.CBL
".............COMPILANDO BDIIREGI SIN STATUS.........."
".............COMPILANDO BDIIDIAN SIN STATUS.........."
".............COMPILANDO BDIIDAS SIN STATUS.........."
".............COMPILANDO BDIIALE SIN STATUS.........."
* Total Messages:    23
* Unrecoverable :     0                    Severe  :    22
* Errors        :     1                    Warnings:     0
* Informational :     0                    Flags   :     0
* Data:       23580     Code:           0

>>> DATACREDITO: ** COMPILANDO CARGAJUR.CBL HUBO ERRORES...
** ESTAN EN EL ARCHIVO CARGAJUR.CBL.err


/d/iccol/desarrollo $cat  CARGAJUR.CBL.err
* Rejected - OPT
  1236         call "PONERR" using "01" JURAD-reg E-errores
*   5-S****************************************************            (   0)**
**    User-name E-ERRORES not unique
  1276         call "PONERR" using "02" JURAD-reg E-errores
*   5-S****************************************************            (  23)**
**    User-name E-ERRORES not unique
  1280         call "PONERR" using "03" JURAD-reg E-errores
*   5-S****************************************************            (  24)**
**    User-name E-ERRORES not unique
  1283         call "PONERR" using "04" JURAD-reg E-errores
*   5-S****************************************************            (  24)**
**    User-name E-ERRORES not unique
  1292         call "PONERR" using "05" JURAD-reg E-errores
*   5-S****************************************************            (  24)**
**    User-name E-ERRORES not unique
  1296         call "PONERR" using "06" JURAD-reg E-errores
*   5-S****************************************************            (  24)**
**    User-name E-ERRORES not unique
  1300         call "PONERR" using "07" JURAD-reg E-errores
*   5-S****************************************************            (  24)**
**    User-name E-ERRORES not unique
  1304         call "PONERR" using "08" JURAD-reg E-errores
*   5-S****************************************************            (  24)**
**    User-name E-ERRORES not unique
  1308         call "PONERR" using "09" JURAD-reg E-errores
*   5-S****************************************************            (  24)**
**    User-name E-ERRORES not unique
  1312         call "PONERR" using "10" JURAD-reg E-errores
*   5-S****************************************************            (  24)**
**    User-name E-ERRORES not unique
  1316         call "PONERR" using "11" JURAD-reg E-errores
*   5-S****************************************************            (  24)**
**    User-name E-ERRORES not unique
  1320         call "PONERR" using "12" JURAD-reg E-errores
*   5-S****************************************************            (  25)**
**    User-name E-ERRORES not unique
  1324         call "PONERR" using "13" JURAD-reg E-errores
*   5-S****************************************************            (  25)**
**    User-name E-ERRORES not unique
  1341         call "PONERR" using "16" JURAD-reg E-errores
*   5-S****************************************************            (  25)**
**    User-name E-ERRORES not unique
  1347         call "PONERR" using "14" JURAD-reg E-errores
*   5-S****************************************************            (  25)**
**    User-name E-ERRORES not unique
  1351             call "PONERR" using "15" JURAD-reg E-errores
*   5-S********************************************************        (  25)**
**    User-name E-ERRORES not unique
  1587     move E-errores to ERRS-causa-rechazo
*   5-S******************                                              (  25)**
**    User-name E-ERRORES not unique
  1588     write ERRS
* 330-S**************                                                  (  29)**
**    Not a record name
  1747         delimited by all "&"
* 301-S*****************                                               (  30)**
**    Unrecognized verb
  1865             display E-edit E-codigo "-" E-descripcion(Ex)
*1022-E***********************************                             (  32)**
**    Table item not subscripted or indexed.  First occurrence assumed.
  2638 PROCEDURE DIVISION using cod-error reg-input E-errores.
*   5-S******************************************************          (  34)**
**    User-name E-ERRORES not unique
  2649         move spaces to E-errores
*   5-S********************************                                (  48)**
**    User-name E-ERRORES not unique
  2667         move cod-error to E-errores(errIndex:2)
*   5-S***********************************                             (  49)**
**    User-name E-ERRORES not unique
cob64: error(s) in compilation: /d/iccol/desarrollo/fuentes/CARGAJUR.CBL
/d/iccol/desarrollo $fg
vi CARGAJUR.CBL
end-if.1000-NOT-USED.
* >>>> esto da un error de compilacion que no puedo resolver
* >>>> por ahora esta anulado
******************************************************************
* Carga de los templates para armar el texto de alertas
* TODO: por ahora los templates son literalesset LAx to 0
move high-values to LA-templatesperform varying LAm from 1 by 1until LA-modelo(LAm) = high-valuesset LAx up by 1*separa las partes de la lineaunstring LA-modelo(1) into LA-parte(1, 1)LA-parte(1, 2) LA-parte(1, 3) LA-parte(1, 4)LA-parte(1, 5) LA-parte(1, 6) LA-parte(1, 7)LA-parte(1, 8) LA-parte(1, 9) LA-parte(1, 10)delimited by all "&"*separa las partes de la linea
*unstring LA-modelo(LAm) into LA-parte(LAx, 1)
*LA-parte(LAx, 2) LA-parte(LAx, 3) LA-parte(LAx, 4)
*LA-parte(LAx, 5) LA-parte(LAx, 6) LA-parte(LAx, 7)
*LA-parte(LAx, 8) LA-parte(LAx, 9) LA-parte(LAx, 10)
*delimited by all "&"
*prepara para omitir los espacios al final de c/parteperform varying LAy from 1 by 1 until LAy > 10inspect LA-parte(LAx, LAy) replacing trailingspaces by high-valuesinspect LA-parte(LAx, LAy) replacing firsthigh-value by spaceend-performend-perform.1001-ELIMINAR-TODO.
******************************************************************
* Elimina los registros de alertas existentes en el archivo de
* alertas en linea, previo a un refresque total
******************************************************************display "Eliminando toda la informacion con fuente JURAD"
*    posiciona en el primer reg de JURADmove zero to TIP-IDE-BDIIALEmove zero to NUM-IDE-BDIIALEmove P-cod-suscriptor to FUENTE-BDIIALEmove zeros to COD-ALERTA-BDIIALE$SET LIST SETTINGIDENTIFICATION DIVISION.
PROGRAM-ID.    ACTALEJUR.
******************************************************************
* Actualizacion del archivo de alertas con los datos provistos
* por Jurad
* Procesa el archivo JURAD. Controla cada registro: si es OK usa
* los datos para actualizar BDIIALE, si tiene defecto lo graba en
* el archivo ERRS.
******************************************************************
AUTHOR.Globant JL.
DATE-WRITTEN.
DATE-COMPILED.
CONFIGURATION section.
SOURCE-COMPUTER. microfocus.
OBJECT-COMPUTER. microfocus.
INPUT-OUTPUT section.
FILE-CONTROL.******************************************************************
******************************************************************
select JURAD assign to P-file-nameorganization is line sequentialfile status is JURAD-fs.******************************************************************
******************************************************************
select ERRS assign to ERRS-file-nameorganization is line sequentialfile status is ERRS-fs.******************************************************************
******************************************************************copy BDIIREGI.FS.
* TODO: debe compilar con file status******************************************************************
******************************************************************
copy BDIIDIAN.FS.******************************************************************
******************************************************************
copy BDIIDAS.FS.******************************************************************
******************************************************************copy BDIIALE.FS replacing == on record.== by == on recordfile status is EST-BDIIALE.==./e-rerrores03 LA-templates.
05 LA-templateoccurs 4 indexed LAx.07 LA-partepic x(50)
occurs 10 indexed LAy.
*    Las dos lineas armadas03 LA-lineas.
05 LA-linea1pic x(50).05 LA-linea2pic x(50).
*    Los valores a insertar en una linea03 LA-valores.
05 LA-valorpic x(50)
occurs 10 indexed LAv.
*    Datos para editar valores a insertar03 LA-numpic -(11)0.03 LA-numXredefines LA-num
pic x(12).03 LA-descartepic x(50).******************************************************************
* Errores de consistencia del input
* Cada error tiene un codigo de 2 digitos, un espacio, contador
* de ocurrencias de 7 digitos, un espacio, y descripcion de 59
01 E-errores.
*    indica si el registro actual tiene error03 E-hay-errorpic xx value "NO".
*    errores del registro actual03 E-errorespic x(100) value spaces.
*    contador de registros con error03 E-cont-regs-con-error     pic 9(8) value zero.
*    tabla de errores03 pic x(11) value "01 0000000 ".03 pic x(59) value"Tipo de movimiento invalido, debe ser I M E T".03 pic x(11) value "02 0000000 ".03 pic x(59) value"Tipo de identificacion invalido, debe ser 1 2 3 4".03 pic x(11) value "03 0000000 ".03 pic x(59) value"Numero de identificacion invalido, debe ser numerico".03 pic x(11) value "04 0000000 ".03 pic x(59) value"Tipo de identificacion debe ser mayor que cero".03 pic x(11) value "05 0000000 ".03 pic x(59) value"Falta el nombre o denominacion".03 pic x(11) value "06 0000000 ".03 pic x(59) value"Numero de demandas vigentes: debe ser numerico"./REPLACE 1 CHAREsREPLACE MODE-reg/"Numero de embargos vigentes: debe ser numerico".03 pic x(11) value "11 0000000 ".03 pic x(59) value"Numero de embargos terminados: debe ser numerico".03 pic x(11) value "12 0000000 ".03 pic x(59) value"Fecha ultimo embargo vigente YYYYMMDD: debe ser numerica".03 pic x(11) value "13 0000000 ".03 pic x(59) value"Fecha ultimo embargo vigente YYYYMMDD: fuera de rango".03 pic x(11) value "14 0000000 ".03 pic x(59) value"El numero de id no se encuentra en el archivo maestro".03 pic x(11) value "15 0000000 ".03 pic x(59) value"El nombre en el input no coincide con el registrado".03 pic x(11) value "16 0000000 ".03 pic x(59) value"Numero de id fuera del rango del tipo de id informado".
*----------------- insertar nuevos items aqui -------------------03 pic x(11) value "00 0000000 ".03 pic x(59) value "--- fin de la lista (cod 00) ---".03pic x(3500). *> los 50 items
01 E-errores-2redefines E-errores.03pic xx.03pic 9(8).03 E-erroroccurs 50 indexed Ex.05 E-codigopic xx.05pic x.05 E-contadorpic 9(7).05pic x.05 E-descripcionpic x(59).
01 E-editpic z(8)B.******************************************************************
* Control de rangos de valores de las fechas del input
01 VALIDACIONES-FECHAS.02 ANO-VAL-Xpic 9(04).88 ANO-VALvalue 1900 thru 2050.02 MES-VAL-Xpic 9(02).88 MES-VALvalue 01   thru 12.02 DIA-VAL-Xpic 9(02).88 DIA-VALvalue 01   thru 31./*****************************************************************
******************************************************************
PROCEDURE DIVISION.
*    0000-PROGRAMA-PRINCIPAL
*    4000-PROCESAR-REGISTRO//display JURAD-reg-anteriorperform 9000-CANCELAR-PROGRAMAwhen other
*error de lectura: cancelacion del procesodisplay "Error en lectura del archivo JURAD "display "Nombre del archivo: " P-file-namedisplay "File status: " JURAD-fsdisplay "Ultimo registro leido: " N-reg-leidosdisplay JURAD-reg-anteriorperform 9000-CANCELAR-PROGRAMAend-evaluate.4000-PROCESAR-REGISTRO-2.
****************************************************************
* Controla los datos de un registro de JURAD y si es OK lo usa
* para actualizar el archivo de alertas en linea
* La informacion esta leida en JURAD-reg
****************************************************************move "NO" to E-hay-error*    validacion del tipo de movimientoif JURAD-tipo-novedad not = "I" and "M" and "E" and "T"call "PONERR" using "01" JURAD-reg E-erroresend-if*    si es el registro "T" hay que senialar el fin de procesoif JURAD-tipo-novedad = "T"move "SI" to IND-fin-procesoexit paragraphend-if

add 1 to N-reg-leidos*    validacion formal de los datosperform 4100-VALIDACION-FORMALif E-hay-error = "SI"exit paragraphend-if*    si la validacion formal dio OK se hace validacion semanticaperform 4200-VALIDACION-SEMANTICAif E-hay-error = "SI"exit paragraphend-if*    actualizacion de BDIIALE o grabacion en arch ERRS de defectosif E-hay-error = "SI"perform 4900-GRABAR-ERROR/add 1 to N-reg-con-error
else
perform 4300-MODIFICAR-BDIIALE
add 1 to N-reg-OK
end-if.



4100-VALIDACION-FORMAL.
******************************************************************
* Validacion formal de los datos del input
******************************************************************
*    Tipo de identificacion Numero {1, 2, 3, 4}
if JURAD-id-tipo not = "1" and "2" and "3" and "4"
call "PONERR" using "02" JURAD-reg E-errorescall "PONERR" using "02" JURAD-reg E-erroresend-if
*    Numero de identificacionif JURAD-id-numeroX is not numericcall "PONERR" using "03" JURAD-reg E-erroresend-if
if JURAD-id-numero not > 0call "PONERR" using "04" JURAD-reg E-erroresend-if
*    si el movimiento es una eliminacion los datos subsiguientes
*    no se controlanif JURAD-tipo-novedad = "E"exit paragraphend-if
*    Nombres y Apellidosif JURAD-nombre = spacescall "PONERR" using "05" JURAD-reg E-erroresend-if
*    Numero de demandas vigentesif JURAD-demandas-vigentes is not numericcall "PONERR" using "06" JURAD-reg E-erroresend-if
*    Numero de demandas terminadasif JURAD-demandas-terminadas is not numericcall "PONERR" using "07" JURAD-reg E-erroresend-if
*    Fecha ultima demanda vigente YYMMDDif JURAD-demandas-fecha-ultima is not numericcall "PONERR" using "08" JURAD-reg E-erroresend-if
move JURAD-demandas-fecha-ultima to VALIDACIONES-FECHASif not ANO-VAL or not MES-VAL or not DIA-VALcall "PONERR" using "09" JURAD-reg E-erroresend-if
*    Numero de embargos vigentesif JURAD-embargos-vigentes not numericcall "PONERR" using "10" JURAD-reg E-erroresend-if
*    Numero de embargos terminadosif JURAD-embargos-terminados not numericcall "PONERR" using "11" JURAD-reg E-erroresend-if
*    Fecha ultimo embargo vigente YYMMDDif JURAD-embargos-fecha-ultimo is not numericcall "PONERR" using "12" JURAD-reg E-erroresend-if
move JURAD-embargos-fecha-ultimo to VALIDACIONES-FECHASif not ANO-VAL or not MES-VAL or not DIA-VALcall "PONERR" using "13" JURAD-reg E-errorescall "PONERR" using "13" JURAD-reg E-erroresend-if.4200-VALIDACION-SEMANTICA.
****************************************************************
* Validacion del numero de identificacion y de su relacion con
* el nombre
****************************************************************move JURAD-id-tipo to TIP-IDE-BDIIVIDEmove JURAD-id-numero to NUM-IDE-BDIIVIDE-Rmove JURAD-nombre to NOMBRE-BDIIVIDEmove 1 to SW-VERIFNOM-BDIIVIDEmove 0 to SW-DIGCHEQUEO-BDIIVIDE SW-ASGTIPID-BDIIVIDEperform 80100-VALIDAR-IDENTIFICACION
*    a ver si la validacion cambio el tipo de ideif JURAD-id-tipo not = TIP-IDE-BDIIVIDEcall "PONERR" using "16" JURAD-reg E-erroresdisplay "Tipo ide cambiado de " JURAD-id-tipo " a "TIP-IDE-BDIIVIDE " num ide: " JURAD-id-numeroend-if
*    SW-ID-BDIIVIDE: 0 si existe el id, 1 si no existeif SW-ID-BDIIVIDE = 1call "PONERR" using "14" JURAD-reg E-erroreselse
*existe id, a ver si el nombre coincideif SW-NOMBRES-BDIIVIDE = 1    *> nombre no coincidecall "PONERR" using "15" JURAD-reg E-erroresdisplay "novedad:  " JURAD-nombredisplay "registro: " NOM-LEIDO-BDIIVIDEend-if
end-if.4300-MODIFICAR-BDIIALE.
******************************************************************
* Se impacta el archivo BDIIALE con una o dos inserciones,
* modificaciones o eliminaciones segun haya o no demandas y
* embargos
******************************************************************initialize REG-BDIIALE*    si hay demandasif JURAD-demandas-vigentes > zeroor JURAD-demandas-terminadas > zeromove "J001" to LLASEC-BDIIALE
*arma datos de demandasmove JURAD-demandas-vigentes to D-vigentesmove JURAD-demandas-terminadas to D-terminados
/if not PROCESO-REAL
exit paragraphend-if
delete BDIIALEevaluate EST-BDIIALEwhen "00"
add 1 to N-ale-eliminadaswhen other
display "Error al regrabar BDIIALE fs: " EST-BDIIALE" key: " LLAVE-BDIIALEdisplay "Registro BDIIALE: "display REG-BDIIALEperform 9000-CANCELAR-PROGRAMAend-evaluate.4900-GRABAR-ERROR.
******************************************************************
* El registro de JURAD tiene error: se graba en el archivo ERRS
* con indicacion del error detectado
******************************************************************move JURAD-reg to ERRS-reg
*    lista de los codigos de los errores del registromove E-errores to ERRS-causa-rechazowrite ERRS
evaluate ERRS-fs
when "00"
continue
when other
display "Error al grabar el archivo de errores "display "Nombre del archivo: " ERRS-file-namedisplay "File status: " ERRS-fsperform 9000-CANCELAR-PROGRAMAgobackend-evaluate.4320-ARMAR-TEXTO-ALERTA.
****************************************************************
* Hace el reemplazo de los valores adecuados en los templates
* de las linea de alerta que corresponde
****************************************************************
*    segun se trate de demandas o embargosif JURAD-demandas-vigentes not = 0or JURAD-demandas-terminadas not = 0set LAx to 1
move high-values to LA-valoresmove JURAD-demandas-vigentes to LA-num
* >>>> esto esta anulado x que no se como hacer para que lo compilesAPPEND MODE-regSAPPEND MODE-reg/* Contabiliza el error en la tabla de errores, activa el indicador* de registro con error, muestra el mensaje en la pantalla, cuenta
* el registro erroneo
******************************************************************
ENVIRONMENT DIVISION.
DATA DIVISION.
WORKING-STORAGE SECTION.
******************************************************************
* Registro de input (primeros 86 caracteres)
01  reg-input-anteriorpic x(86) value low-values.
* Posicion del proximo error en la lista de errores del reg
01  errIndexpic 999 comp.
******************************************************************LINKAGE SECTION.
******************************************************************
* Codigo del error detectado
01  cod-errorpic xx.
******************************************************************
* Registro de input (primeros 86 caracteres)
01  reg-inputpic x(86).
******************************************************************
* Tabla de errores de consistencia del input
01 E-errores.
*    indica si el registro actual tiene error03 E-hay-errorpic xx.
*    errores del registro actual03 E-errorespic x(100).
*    contador de registros con error03 E-cont-regs-con-error     pic 9(8).
*    tabla de errores03 E-erroroccurs 50 indexed Ex.05 E-codigopic xx.05pic x.05 E-contadorpic 9(7).05pic x.05 E-descripcionpic x(59).******************************************************************PROCEDURE DIVISION using cod-error reg-input E-errores.
00.
*    marca al reg actual como erroneomove "SI" to E-hay-error*    cuenta y muestra el registro de inputif reg-input(1:86) not = reg-input-anterioradd 1 to E-cont-regs-con-errordisplay " "/sREPLACE MODE-reg:w"CARGAJUR.CBL" 1219 lines, 51763 characters [1] + Stopped (SIGTSTP)        vi CARGAJUR.CBL
/d/iccol/desarrollo $^[  /d/iccol/desarrollo $fgcat  CARGAJUR.CBL.errdes-c-v CARGAJUR     
Ejecucion de la macro de compilacion cobol para desarrollo
cob64 -C nolist -CC -KPIC -A -KPIC -N PIC -uv -g -P -C sourceasm /d/iccol/desarrollo/fuentes/CARGAJUR.CBL 
* Micro Focus Server Express         V5.1 revision 000           Compiler
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
* Accepted - VERBOSE
* Accepted - NOANIM
* Accepted - NOBOUND
* Accepted - NOALTER
* Accepted - COMP
* Accepted - TRUNC
* Accepted - int("CARGAJUR.int")
* Accepted - anim
* Accepted - csi
* Accepted - verbose
* Accepted - nolist
* Accepted - sourceasm
* Accepted - list("CARGAJUR.lst")
* Compiling /d/iccol/desarrollo/fuentes/CARGAJUR.CBL
".............COMPILANDO BDIIREGI SIN STATUS.........."
".............COMPILANDO BDIIDIAN SIN STATUS.........."
".............COMPILANDO BDIIDAS SIN STATUS.........."
".............COMPILANDO BDIIALE SIN STATUS.........."
* Total Messages:     2
* Unrecoverable :     0                    Severe  :     1
* Errors        :     1                    Warnings:     0
* Informational :     0                    Flags   :     0
* Data:       23580     Code:           0

>>> DATACREDITO: ** COMPILANDO CARGAJUR.CBL HUBO ERRORES...
** ESTAN EN EL ARCHIVO CARGAJUR.CBL.err


/d/iccol/desarrollo $^[  /d/iccol/desarrollo $des-c-v CARGAJURfg              cat  CARGAJUR.CBL.err
* Rejected - OPT
  1747         delimited by all "&"
* 301-S*****************                                               (   0)**
**    Unrecognized verb
  1865             display E-edit E-codigo "-" E-descripcion(Ex)
*1022-E***********************************                             (  32)**
**    Table item not subscripted or indexed.  First occurrence assumed.
cob64: error(s) in compilation: /d/iccol/desarrollo/fuentes/CARGAJUR.CBL
/d/iccol/desarrollo $fg
vi CARGAJUR.CBL
* Contabiliza el error en la tabla de errores, activa el indicador* de registro con error, muestra el mensaje en la pantalla, cuenta
* el registro erroneo
******************************************************************
ENVIRONMENT DIVISION.
DATA DIVISION.
WORKING-STORAGE SECTION.
******************************************************************
* Registro de input (primeros 86 caracteres)
01  reg-input-anteriorpic x(86) value low-values.
* Posicion del proximo error en la lista de errores del reg
01  errIndexpic 999 comp.
******************************************************************LINKAGE SECTION.
******************************************************************
* Codigo del error detectado
01  cod-errorpic xx.
******************************************************************
* Registro de input (primeros 86 caracteres)
01  reg-inputpic x(86).
******************************************************************
* Tabla de errores de consistencia del input
01 E-errores.
*    indica si el registro actual tiene error03 E-hay-errorpic xx.
*    errores del registro actual03 E-errores-regpic x(100).
*    contador de registros con error03 E-cont-regs-con-error     pic 9(8).
*    tabla de errores03 E-erroroccurs 50 indexed Ex.05 E-codigopic xx.05pic x.05 E-contadorpic 9(7).05pic x.05 E-descripcionpic x(59).******************************************************************PROCEDURE DIVISION using cod-error reg-input E-errores.
00.
*    marca al reg actual como erroneomove "SI" to E-hay-error*    cuenta y muestra el registro de inputif reg-input(1:86) not = reg-input-anterioradd 1 to E-cont-regs-con-errordisplay " "/display E-edit E-codigoAddress search hit BOTTOM without matching pattern?move E-cont-regs-con-error to N-reg-con-errormove N-reg-con-error to N-editdisplay N-edit "Registros con error"move N-ale-borradas to N-editdisplay N-edit "Alertas borradas previo al refresque total"move N-ale-insertadas to N-editdisplay N-edit "Alertas insertadas"move N-ale-modificadas to N-editdisplay N-edit "Alertas modificadas"move N-ale-eliminadas to N-editdisplay N-edit "Alertas eliminadas"move N-ale-ya-existe to N-editdisplay N-edit "Insercion de alerta existente"move N-ale-no-existe to N-editdisplay N-edit "Modif o elim de alerta inexistente".* Emision del reporte de erroresdisplay " "
display "Totales por tipo de error detectado:"perform varying Ex from 1 by 1 until Ex > 50or E-codigo(Ex) = "00"if E-contador(Ex) not = 0move E-contador(ex) to E-editdisplay E-edit E-codigo "-" E-descripcion(Ex)end-if
end-perform.9000-CANCELAR-PROGRAMA.
******************************************************************
* Procedimiento standard de cancelacion de programa batch
******************************************************************
* TODO: hay un standard para comunicar una cancelacion de proceso?display pgm " - proceso cancelado"goback returning 99.copy BDIIVIDE.PROC.copy VALNOM.PROC./
IDENTIFICATION DIVISION.
PROGRAM-ID. PONERR.
******************************************************************
* Rutina de conveniencia para procesar un error detectado en un
* registro de input/Address search hit BOTTOM without matching pattern?Address search hit TOP without matching patternINSERT MODE" " :w"CARGAJUR.CBL" 1219 lines, 51767 characters [1] + Stopped (SIGTSTP)        vi CARGAJUR.CBL
/d/iccol/desarrollo $^[  /d/iccol/desarrollo $fgcat  CARGAJUR.CBL.errdes-c-v CARGAJUR     
Ejecucion de la macro de compilacion cobol para desarrollo
cob64 -C nolist -CC -KPIC -A -KPIC -N PIC -uv -g -P -C sourceasm /d/iccol/desarrollo/fuentes/CARGAJUR.CBL 
* Micro Focus Server Express         V5.1 revision 000           Compiler
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
* Accepted - VERBOSE
* Accepted - NOANIM
* Accepted - NOBOUND
* Accepted - NOALTER
* Accepted - COMP
* Accepted - TRUNC
* Accepted - int("CARGAJUR.int")
* Accepted - anim
* Accepted - csi
* Accepted - verbose
* Accepted - nolist
* Accepted - sourceasm
* Accepted - list("CARGAJUR.lst")
* Compiling /d/iccol/desarrollo/fuentes/CARGAJUR.CBL
".............COMPILANDO BDIIREGI SIN STATUS.........."
".............COMPILANDO BDIIDIAN SIN STATUS.........."
".............COMPILANDO BDIIDAS SIN STATUS.........."
".............COMPILANDO BDIIALE SIN STATUS.........."
* Total Messages:     2
* Unrecoverable :     0                    Severe  :     1
* Errors        :     1                    Warnings:     0
* Informational :     0                    Flags   :     0
* Data:       23580     Code:           0

>>> DATACREDITO: ** COMPILANDO CARGAJUR.CBL HUBO ERRORES...
** ESTAN EN EL ARCHIVO CARGAJUR.CBL.err


/d/iccol/desarrollo $^[  /d/iccol/desarrollo $kkkkk
ksh: kkk:  not found
/d/iccol/desarrollo $^[  /d/iccol/desarrollo $kkkdes-c-v CARGAJURfg              cat  CARGAJUR.CBL.err
* Rejected - OPT
  1747         delimited by all "&"
* 301-S*****************                                               (   0)**
**    Unrecognized verb
  1865             display " " E-edit E-codigo "-" E-descripcion(Ex)
*1022-E***************************************                         (  32)**
**    Table item not subscripted or indexed.  First occurrence assumed.
cob64: error(s) in compilation: /d/iccol/desarrollo/fuentes/CARGAJUR.CBL
/d/iccol/desarrollo $fg
vi CARGAJUR.CBL
move E-cont-regs-con-error to N-reg-con-errormove N-reg-con-error to N-editdisplay N-edit "Registros con error"move N-ale-borradas to N-editdisplay N-edit "Alertas borradas previo al refresque total"move N-ale-insertadas to N-editdisplay N-edit "Alertas insertadas"move N-ale-modificadas to N-editdisplay N-edit "Alertas modificadas"move N-ale-eliminadas to N-editdisplay N-edit "Alertas eliminadas"move N-ale-ya-existe to N-editdisplay N-edit "Insercion de alerta existente"move N-ale-no-existe to N-editdisplay N-edit "Modif o elim de alerta inexistente".* Emision del reporte de erroresdisplay " "
display "Totales por tipo de error detectado:"perform varying Ex from 1 by 1 until Ex > 50or E-codigo(Ex) = "00"if E-contador(Ex) not = 0move E-contador(ex) to E-editdisplay " " E-edit E-codigo "-" E-descripcion(Ex)end-if
end-perform.9000-CANCELAR-PROGRAMA.
******************************************************************
* Procedimiento standard de cancelacion de programa batch
******************************************************************
* TODO: hay un standard para comunicar una cancelacion de proceso?display pgm " - proceso cancelado"goback returning 99.copy BDIIVIDE.PROC.copy VALNOM.PROC./
IDENTIFICATION DIVISION.
PROGRAM-ID. PONERR.
******************************************************************
* Rutina de conveniencia para procesar un error detectado en un
* registro de input/ display " " E-edit E-codigo "-" E-descripcion(Ex)(Ex)Address search hit BOTTOM without matching pattern E-edit E-codigo "-"$SET LIST SETTINGIDENTIFICATION DIVISION.
PROGRAM-ID.    ACTALEJUR.
******************************************************************
* Actualizacion del archivo de alertas con los datos provistos
* por Jurad
* Procesa el archivo JURAD. Controla cada registro: si es OK usa
* los datos para actualizar BDIIALE, si tiene defecto lo graba en
* el archivo ERRS.
******************************************************************
AUTHOR.Globant JL.
DATE-WRITTEN.
DATE-COMPILED.
CONFIGURATION section.
SOURCE-COMPUTER. microfocus.
OBJECT-COMPUTER. microfocus.
INPUT-OUTPUT section.
FILE-CONTROL.******************************************************************
******************************************************************
select JURAD assign to P-file-nameorganization is line sequentialfile status is JURAD-fs.******************************************************************
******************************************************************
select ERRS assign to ERRS-file-nameorganization is line sequentialfile status is ERRS-fs.******************************************************************
******************************************************************copy BDIIREGI.FS.
* TODO: debe compilar con file status******************************************************************
******************************************************************
copy BDIIDIAN.FS.******************************************************************
******************************************************************
copy BDIIDAS.FS.******************************************************************
******************************************************************copy BDIIALE.FS replacing == on record.== by == on recordfile status is EST-BDIIALE.==./e-descripcion03 pic x(59) value"Fecha ultimo embargo vigente YYYYMMDD: fuera de rango".03 pic x(11) value "14 0000000 ".03 pic x(59) value"El numero de id no se encuentra en el archivo maestro".03 pic x(11) value "15 0000000 ".03 pic x(59) value"El nombre en el input no coincide con el registrado".03 pic x(11) value "16 0000000 ".03 pic x(59) value"Numero de id fuera del rango del tipo de id informado".
*----------------- insertar nuevos items aqui -------------------03 pic x(11) value "00 0000000 ".03 pic x(59) value "--- fin de la lista (cod 00) ---".03pic x(3500). *> los 50 items
01 E-errores-2redefines E-errores.03pic xx.03pic 9(8).03 E-erroroccurs 50 indexed Ex.05 E-codigopic xx.05pic x.05 E-contadorpic 9(7).05pic x.05 E-descripcionpic x(59).
01 E-editpic z(8)B.******************************************************************
* Control de rangos de valores de las fechas del input
01 VALIDACIONES-FECHAS.02 ANO-VAL-Xpic 9(04).88 ANO-VALvalue 1900 thru 2050.02 MES-VAL-Xpic 9(02).88 MES-VALvalue 01   thru 12.02 DIA-VAL-Xpic 9(02).88 DIA-VALvalue 01   thru 31./*****************************************************************
******************************************************************
PROCEDURE DIVISION.
*    0000-PROGRAMA-PRINCIPAL
*    4000-PROCESAR-REGISTRO
*    4000-PROCESAR-REGISTRO-2
*    4100-VALIDACION-FORMAL
*    4200-VALIDACION-SEMANTICA
*    4300-MODIFICAR-BDIIALE
*    4300-MODIFICAR-BDIIALE-DATOS
*    4300-MODIFICAR-BDIIALE-I
*    4300-MODIFICAR-BDIIALE-M
*    4300-MODIFICAR-BDIIALE-E/move E-cont-regs-con-error to N-reg-con-errormove N-reg-con-error to N-editdisplay N-edit "Registros con error"move N-ale-borradas to N-editdisplay N-edit "Alertas borradas previo al refresque total"move N-ale-insertadas to N-editdisplay N-edit "Alertas insertadas"move N-ale-modificadas to N-editdisplay N-edit "Alertas modificadas"move N-ale-eliminadas to N-editdisplay N-edit "Alertas eliminadas"move N-ale-ya-existe to N-editdisplay N-edit "Insercion de alerta existente"move N-ale-no-existe to N-editdisplay N-edit "Modif o elim de alerta inexistente".* Emision del reporte de erroresdisplay " "
display "Totales por tipo de error detectado:"perform varying Ex from 1 by 1 until Ex > 50or E-codigo(Ex) = "00"if E-contador(Ex) not = 0move E-contador(ex) to E-editdisplay " " E-edit E-codigo "-" E-descripcion(Ex)end-if
end-perform.9000-CANCELAR-PROGRAMA.
******************************************************************
* Procedimiento standard de cancelacion de programa batch
******************************************************************
* TODO: hay un standard para comunicar una cancelacion de proceso?display pgm " - proceso cancelado"goback returning 99.copy BDIIVIDE.PROC.copy VALNOM.PROC./
IDENTIFICATION DIVISION.
PROGRAM-ID. PONERR.
******************************************************************
* Rutina de conveniencia para procesar un error detectado en un
* registro de input?03 pic x(59) value"Fecha ultimo embargo vigente YYYYMMDD: fuera de rango".03 pic x(11) value "14 0000000 ".03 pic x(59) value"El numero de id no se encuentra en el archivo maestro".03 pic x(11) value "15 0000000 ".03 pic x(59) value"El nombre en el input no coincide con el registrado".03 pic x(11) value "16 0000000 ".03 pic x(59) value"Numero de id fuera del rango del tipo de id informado".
*----------------- insertar nuevos items aqui -------------------03 pic x(11) value "00 0000000 ".03 pic x(59) value "--- fin de la lista (cod 00) ---".03pic x(3500). *> los 50 items
01 E-errores-2redefines E-errores.03pic xx.03pic 9(8).03 E-erroroccurs 50 indexed Ex.05 E-codigopic xx.05pic x.05 E-contadorpic 9(7).05pic x.05 E-descripcionpic x(59).
01 E-editpic z(8)B.******************************************************************
* Control de rangos de valores de las fechas del input
01 VALIDACIONES-FECHAS.02 ANO-VAL-Xpic 9(04).88 ANO-VALvalue 1900 thru 2050.02 MES-VAL-Xpic 9(02).88 MES-VALvalue 01   thru 12.02 DIA-VAL-Xpic 9(02).88 DIA-VALvalue 01   thru 31./*****************************************************************
******************************************************************
PROCEDURE DIVISION.
*    0000-PROGRAMA-PRINCIPAL
*    4000-PROCESAR-REGISTRO
*    4000-PROCESAR-REGISTRO-2
*    4100-VALIDACION-FORMAL
*    4200-VALIDACION-SEMANTICA
*    4300-MODIFICAR-BDIIALE
*    4300-MODIFICAR-BDIIALE-DATOS
*    4300-MODIFICAR-BDIIALE-I
*    4300-MODIFICAR-BDIIALE-M
*    4300-MODIFICAR-BDIIALE-E/move E-cont-regs-con-error to N-reg-con-errormove N-reg-con-error to N-editdisplay N-edit "Registros con error"move N-ale-borradas to N-editdisplay N-edit "Alertas borradas previo al refresque total"move N-ale-insertadas to N-editdisplay N-edit "Alertas insertadas"move N-ale-modificadas to N-editdisplay N-edit "Alertas modificadas"move N-ale-eliminadas to N-editdisplay N-edit "Alertas eliminadas"move N-ale-ya-existe to N-editdisplay N-edit "Insercion de alerta existente"move N-ale-no-existe to N-editdisplay N-edit "Modif o elim de alerta inexistente".* Emision del reporte de erroresdisplay " "
display "Totales por tipo de error detectado:"perform varying Ex from 1 by 1 until Ex > 50or E-codigo(Ex) = "00"if E-contador(Ex) not = 0move E-contador(ex) to E-editdisplay " " E-edit E-codigo "-" E-descripcion(Ex)end-if
end-perform.9000-CANCELAR-PROGRAMA.
******************************************************************
* Procedimiento standard de cancelacion de programa batch
******************************************************************
* TODO: hay un standard para comunicar una cancelacion de proceso?display pgm " - proceso cancelado"goback returning 99.copy BDIIVIDE.PROC.copy VALNOM.PROC./
IDENTIFICATION DIVISION.
PROGRAM-ID. PONERR.
******************************************************************
* Rutina de conveniencia para procesar un error detectado en un
* registro de input$SET LIST SETTINGIDENTIFICATION DIVISION.
PROGRAM-ID.    ACTALEJUR.
******************************************************************
* Actualizacion del archivo de alertas con los datos provistos
* por Jurad
* Procesa el archivo JURAD. Controla cada registro: si es OK usa
* los datos para actualizar BDIIALE, si tiene defecto lo graba en
* el archivo ERRS.
******************************************************************
AUTHOR.Globant JL.
DATE-WRITTEN.
DATE-COMPILED.
CONFIGURATION section.
SOURCE-COMPUTER. microfocus.
OBJECT-COMPUTER. microfocus.
INPUT-OUTPUT section.
FILE-CONTROL.******************************************************************
******************************************************************
select JURAD assign to P-file-nameorganization is line sequentialfile status is JURAD-fs.******************************************************************
******************************************************************
select ERRS assign to ERRS-file-nameorganization is line sequentialfile status is ERRS-fs.******************************************************************
******************************************************************copy BDIIREGI.FS.
* TODO: debe compilar con file status******************************************************************
******************************************************************
copy BDIIDIAN.FS.******************************************************************
******************************************************************
copy BDIIDAS.FS.******************************************************************
******************************************************************copy BDIIALE.FS replacing == on record.== by == on recordfile status is EST-BDIIALE.==./03 pic x(59) value"Fecha ultimo embargo vigente YYYYMMDD: fuera de rango".03 pic x(11) value "14 0000000 ".03 pic x(59) value"El numero de id no se encuentra en el archivo maestro".03 pic x(11) value "15 0000000 ".03 pic x(59) value"El nombre en el input no coincide con el registrado".03 pic x(11) value "16 0000000 ".03 pic x(59) value"Numero de id fuera del rango del tipo de id informado".
*----------------- insertar nuevos items aqui -------------------03 pic x(11) value "00 0000000 ".03 pic x(59) value "--- fin de la lista (cod 00) ---".03pic x(3500). *> los 50 items
01 E-errores-2redefines E-errores.03pic xx.03pic 9(8).03 E-erroroccurs 50 indexed Ex.05 E-codigopic xx.05pic x.05 E-contadorpic 9(7).05pic x.05 E-descripcionpic x(59).
01 E-editpic z(8)B.******************************************************************
* Control de rangos de valores de las fechas del input
01 VALIDACIONES-FECHAS.02 ANO-VAL-Xpic 9(04).88 ANO-VALvalue 1900 thru 2050.02 MES-VAL-Xpic 9(02).88 MES-VALvalue 01   thru 12.02 DIA-VAL-Xpic 9(02).88 DIA-VALvalue 01   thru 31./*****************************************************************
******************************************************************
PROCEDURE DIVISION.
*    0000-PROGRAMA-PRINCIPAL
*    4000-PROCESAR-REGISTRO
*    4000-PROCESAR-REGISTRO-2
*    4100-VALIDACION-FORMAL
*    4200-VALIDACION-SEMANTICA
*    4300-MODIFICAR-BDIIALE
*    4300-MODIFICAR-BDIIALE-DATOS
*    4300-MODIFICAR-BDIIALE-I
*    4300-MODIFICAR-BDIIALE-M
*    4300-MODIFICAR-BDIIALE-E/move E-cont-regs-con-error to N-reg-con-errormove N-reg-con-error to N-editdisplay N-edit "Registros con error"move N-ale-borradas to N-editdisplay N-edit "Alertas borradas previo al refresque total"move N-ale-insertadas to N-editdisplay N-edit "Alertas insertadas"move N-ale-modificadas to N-editdisplay N-edit "Alertas modificadas"move N-ale-eliminadas to N-editdisplay N-edit "Alertas eliminadas"move N-ale-ya-existe to N-editdisplay N-edit "Insercion de alerta existente"move N-ale-no-existe to N-editdisplay N-edit "Modif o elim de alerta inexistente".* Emision del reporte de erroresdisplay " "
display "Totales por tipo de error detectado:"perform varying Ex from 1 by 1 until Ex > 50or E-codigo(Ex) = "00"if E-contador(Ex) not = 0move E-contador(ex) to E-editdisplay " " E-edit E-codigo "-" E-descripcion(Ex)end-if
end-perform.9000-CANCELAR-PROGRAMA.
******************************************************************
* Procedimiento standard de cancelacion de programa batch
******************************************************************
* TODO: hay un standard para comunicar una cancelacion de proceso?display pgm " - proceso cancelado"goback returning 99.copy BDIIVIDE.PROC.copy VALNOM.PROC./
IDENTIFICATION DIVISION.
PROGRAM-ID. PONERR.
******************************************************************
* Rutina de conveniencia para procesar un error detectado en un
* registro de input/
LINKAGE SECTION.
******************************************************************
* Codigo del error detectado
01  cod-errorpic xx.
******************************************************************
* Registro de input (primeros 86 caracteres)
01  reg-inputpic x(86).
******************************************************************
* Tabla de errores de consistencia del input
01 E-errores.
*    indica si el registro actual tiene error03 E-hay-errorpic xx.
*    errores del registro actual03 E-errores-regpic x(100).
*    contador de registros con error03 E-cont-regs-con-error     pic 9(8).
*    tabla de errores03 E-erroroccurs 50 indexed Ex.05 E-codigopic xx.05pic x.05 E-contadorpic 9(7).05pic x.05 E-descripcionpic x(59).******************************************************************PROCEDURE DIVISION using cod-error reg-input E-errores.
00.
*    marca al reg actual como erroneomove "SI" to E-hay-error*    cuenta y muestra el registro de inputif reg-input(1:86) not = reg-input-anterioradd 1 to E-cont-regs-con-errordisplay " "
display reg-input(1:86)move reg-input(1:86) to reg-input-anteriormove spaces to E-erroresend-if*    contabiliza el error en la tabla de erroresset Ex to 1
search E-error varying Exat end
display "--- falla en la tabla de errores ---" cod-errorwhen E-codigo(Ex) = "00"add 1 to E-contador(Ex)display "--- error tipo exotico: " cod-error/when E-codigo(Ex) = cod-error
add 1 to E-contador(Ex)
display "Error " cod-error " " E-descripcion(Ex)
/Address search hit BOTTOM without matching pattern
??move E-cont-regs-con-error to N-reg-con-errormove N-reg-con-error to N-editdisplay N-edit "Registros con error"move N-ale-borradas to N-editdisplay N-edit "Alertas borradas previo al refresque total"move N-ale-insertadas to N-editdisplay N-edit "Alertas insertadas"move N-ale-modificadas to N-editdisplay N-edit "Alertas modificadas"move N-ale-eliminadas to N-editdisplay N-edit "Alertas eliminadas"move N-ale-ya-existe to N-editdisplay N-edit "Insercion de alerta existente"move N-ale-no-existe to N-editdisplay N-edit "Modif o elim de alerta inexistente".* Emision del reporte de erroresdisplay " "
display "Totales por tipo de error detectado:"perform varying Ex from 1 by 1 until Ex > 50or E-codigo(Ex) = "00"if E-contador(Ex) not = 0move E-contador(ex) to E-editdisplay " " E-edit E-codigo "-" E-descripcion(Ex)end-if
end-perform.9000-CANCELAR-PROGRAMA.
******************************************************************
* Procedimiento standard de cancelacion de programa batch
******************************************************************
* TODO: hay un standard para comunicar una cancelacion de proceso?display pgm " - proceso cancelado"goback returning 99.copy BDIIVIDE.PROC.copy VALNOM.PROC./
IDENTIFICATION DIVISION.
PROGRAM-ID. PONERR.
******************************************************************
* Rutina de conveniencia para procesar un error detectado en un
* registro de input?03 pic x(59) value"Fecha ultimo embargo vigente YYYYMMDD: fuera de rango".03 pic x(11) value "14 0000000 ".03 pic x(59) value"El numero de id no se encuentra en el archivo maestro".03 pic x(11) value "15 0000000 ".03 pic x(59) value"El nombre en el input no coincide con el registrado".03 pic x(11) value "16 0000000 ".03 pic x(59) value"Numero de id fuera del rango del tipo de id informado".
*----------------- insertar nuevos items aqui -------------------03 pic x(11) value "00 0000000 ".03 pic x(59) value "--- fin de la lista (cod 00) ---".03pic x(3500). *> los 50 items
01 E-errores-2redefines E-errores.03pic xx.03pic 9(8).03 E-erroroccurs 50 indexed Ex.05 E-codigopic xx.05pic x.05 E-contadorpic 9(7).05pic x.05 E-descripcionpic x(59).
01 E-editpic z(8)B.******************************************************************
* Control de rangos de valores de las fechas del input
01 VALIDACIONES-FECHAS.02 ANO-VAL-Xpic 9(04).88 ANO-VALvalue 1900 thru 2050.02 MES-VAL-Xpic 9(02).88 MES-VALvalue 01   thru 12.02 DIA-VAL-Xpic 9(02).88 DIA-VALvalue 01   thru 31./*****************************************************************
******************************************************************
PROCEDURE DIVISION.
*    0000-PROGRAMA-PRINCIPAL
*    4000-PROCESAR-REGISTRO
*    4000-PROCESAR-REGISTRO-2
*    4100-VALIDACION-FORMAL
*    4200-VALIDACION-SEMANTICA
*    4300-MODIFICAR-BDIIALE
*    4300-MODIFICAR-BDIIALE-DATOS
*    4300-MODIFICAR-BDIIALE-I
*    4300-MODIFICAR-BDIIALE-M
*    4300-MODIFICAR-BDIIALE-E/move E-cont-regs-con-error to N-reg-con-errormove N-reg-con-error to N-editdisplay N-edit "Registros con error"move N-ale-borradas to N-editdisplay N-edit "Alertas borradas previo al refresque total"move N-ale-insertadas to N-editdisplay N-edit "Alertas insertadas"move N-ale-modificadas to N-editdisplay N-edit "Alertas modificadas"move N-ale-eliminadas to N-editdisplay N-edit "Alertas eliminadas"move N-ale-ya-existe to N-editdisplay N-edit "Insercion de alerta existente"move N-ale-no-existe to N-editdisplay N-edit "Modif o elim de alerta inexistente".* Emision del reporte de erroresdisplay " "
display "Totales por tipo de error detectado:"perform varying Ex from 1 by 1 until Ex > 50or E-codigo(Ex) = "00"if E-contador(Ex) not = 0move E-contador(ex) to E-editdisplay " " E-edit E-codigo "-" E-descripcion(Ex)end-if
end-perform.9000-CANCELAR-PROGRAMA.
******************************************************************
* Procedimiento standard de cancelacion de programa batch
******************************************************************
* TODO: hay un standard para comunicar una cancelacion de proceso?display pgm " - proceso cancelado"goback returning 99.copy BDIIVIDE.PROC.copy VALNOM.PROC./
IDENTIFICATION DIVISION.
PROGRAM-ID. PONERR.
******************************************************************
* Rutina de conveniencia para procesar un error detectado en un
* registro de input?03 pic x(59) value"Fecha ultimo embargo vigente YYYYMMDD: fuera de rango".03 pic x(11) value "14 0000000 ".03 pic x(59) value"El numero de id no se encuentra en el archivo maestro".03 pic x(11) value "15 0000000 ".03 pic x(59) value"El nombre en el input no coincide con el registrado".03 pic x(11) value "16 0000000 ".03 pic x(59) value"Numero de id fuera del rango del tipo de id informado".
*----------------- insertar nuevos items aqui -------------------03 pic x(11) value "00 0000000 ".03 pic x(59) value "--- fin de la lista (cod 00) ---".03pic x(3500). *> los 50 items
01 E-errores-2redefines E-errores.03pic xx.03pic 9(8).03 E-erroroccurs 50 indexed Ex.05 E-codigopic xx.05pic x.05 E-contadorpic 9(7).05pic x.05 E-descripcionpic x(59).
01 E-editpic z(8)B.******************************************************************
* Control de rangos de valores de las fechas del input
01 VALIDACIONES-FECHAS.02 ANO-VAL-Xpic 9(04).88 ANO-VALvalue 1900 thru 2050.02 MES-VAL-Xpic 9(02).88 MES-VALvalue 01   thru 12.02 DIA-VAL-Xpic 9(02).88 DIA-VALvalue 01   thru 31./*****************************************************************
******************************************************************
PROCEDURE DIVISION.
*    0000-PROGRAMA-PRINCIPAL
*    4000-PROCESAR-REGISTRO
*    4000-PROCESAR-REGISTRO-2
*    4100-VALIDACION-FORMAL
*    4200-VALIDACION-SEMANTICA
*    4300-MODIFICAR-BDIIALE
*    4300-MODIFICAR-BDIIALE-DATOS
*    4300-MODIFICAR-BDIIALE-I
*    4300-MODIFICAR-BDIIALE-M
*    4300-MODIFICAR-BDIIALE-E/move E-cont-regs-con-error to N-reg-con-errormove N-reg-con-error to N-editdisplay N-edit "Registros con error"move N-ale-borradas to N-editdisplay N-edit "Alertas borradas previo al refresque total"move N-ale-insertadas to N-editdisplay N-edit "Alertas insertadas"move N-ale-modificadas to N-editdisplay N-edit "Alertas modificadas"move N-ale-eliminadas to N-editdisplay N-edit "Alertas eliminadas"move N-ale-ya-existe to N-editdisplay N-edit "Insercion de alerta existente"move N-ale-no-existe to N-editdisplay N-edit "Modif o elim de alerta inexistente".* Emision del reporte de erroresdisplay " "
display "Totales por tipo de error detectado:"perform varying Ex from 1 by 1 until Ex > 50or E-codigo(Ex) = "00"if E-contador(Ex) not = 0move E-contador(ex) to E-editdisplay " " E-edit E-codigo "-" E-descripcion(Ex)end-if
end-perform.9000-CANCELAR-PROGRAMA.
******************************************************************
* Procedimiento standard de cancelacion de programa batch
******************************************************************
* TODO: hay un standard para comunicar una cancelacion de proceso?display pgm " - proceso cancelado"goback returning 99.copy BDIIVIDE.PROC.copy VALNOM.PROC./
IDENTIFICATION DIVISION.
PROGRAM-ID. PONERR.
******************************************************************
* Rutina de conveniencia para procesar un error detectado en un
* registro de input?03 pic x(59) value"Fecha ultimo embargo vigente YYYYMMDD: fuera de rango".03 pic x(11) value "14 0000000 ".03 pic x(59) value"El numero de id no se encuentra en el archivo maestro".03 pic x(11) value "15 0000000 ".03 pic x(59) value"El nombre en el input no coincide con el registrado".03 pic x(11) value "16 0000000 ".03 pic x(59) value"Numero de id fuera del rango del tipo de id informado".
*----------------- insertar nuevos items aqui -------------------03 pic x(11) value "00 0000000 ".03 pic x(59) value "--- fin de la lista (cod 00) ---".03pic x(3500). *> los 50 items
01 E-errores-2redefines E-errores.03pic xx.03pic 9(8).03 E-erroroccurs 50 indexed Ex.05 E-codigopic xx.05pic x.05 E-contadorpic 9(7).05pic x.05 E-descripcionpic x(59).
01 E-editpic z(8)B.******************************************************************
* Control de rangos de valores de las fechas del input
01 VALIDACIONES-FECHAS.02 ANO-VAL-Xpic 9(04).88 ANO-VALvalue 1900 thru 2050.02 MES-VAL-Xpic 9(02).88 MES-VALvalue 01   thru 12.02 DIA-VAL-Xpic 9(02).88 DIA-VALvalue 01   thru 31./*****************************************************************
******************************************************************
PROCEDURE DIVISION.
*    0000-PROGRAMA-PRINCIPAL
*    4000-PROCESAR-REGISTRO
*    4000-PROCESAR-REGISTRO-2
*    4100-VALIDACION-FORMAL
*    4200-VALIDACION-SEMANTICA
*    4300-MODIFICAR-BDIIALE
*    4300-MODIFICAR-BDIIALE-DATOS
*    4300-MODIFICAR-BDIIALE-I
*    4300-MODIFICAR-BDIIALE-M
*    4300-MODIFICAR-BDIIALE-E/move E-cont-regs-con-error to N-reg-con-errormove N-reg-con-error to N-editdisplay N-edit "Registros con error"move N-ale-borradas to N-editdisplay N-edit "Alertas borradas previo al refresque total"move N-ale-insertadas to N-editdisplay N-edit "Alertas insertadas"move N-ale-modificadas to N-editdisplay N-edit "Alertas modificadas"move N-ale-eliminadas to N-editdisplay N-edit "Alertas eliminadas"move N-ale-ya-existe to N-editdisplay N-edit "Insercion de alerta existente"move N-ale-no-existe to N-editdisplay N-edit "Modif o elim de alerta inexistente".* Emision del reporte de erroresdisplay " "
display "Totales por tipo de error detectado:"perform varying Ex from 1 by 1 until Ex > 50or E-codigo(Ex) = "00"if E-contador(Ex) not = 0move E-contador(ex) to E-editdisplay " " E-edit E-codigo "-" E-descripcion(Ex)end-if
end-perform.9000-CANCELAR-PROGRAMA.
******************************************************************
* Procedimiento standard de cancelacion de programa batch
******************************************************************
* TODO: hay un standard para comunicar una cancelacion de proceso?display pgm " - proceso cancelado"goback returning 99.copy BDIIVIDE.PROC.copy VALNOM.PROC./
IDENTIFICATION DIVISION.
PROGRAM-ID. PONERR.
******************************************************************
* Rutina de conveniencia para procesar un error detectado en un
* registro de inputINSERT MODE(Ex)$:w"CARGAJUR.CBL" 1219 lines, 51767 characters [1] + Stopped (SIGTSTP)        vi CARGAJUR.CBL
/d/iccol/desarrollo $^[  /d/iccol/desarrollo $fgcat  CARGAJUR.CBL.errkkk                  des-c-v CARGAJUR
Ejecucion de la macro de compilacion cobol para desarrollo
cob64 -C nolist -CC -KPIC -A -KPIC -N PIC -uv -g -P -C sourceasm /d/iccol/desarrollo/fuentes/CARGAJUR.CBL 
* Micro Focus Server Express         V5.1 revision 000           Compiler
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
* Accepted - VERBOSE
* Accepted - NOANIM
* Accepted - NOBOUND
* Accepted - NOALTER
* Accepted - COMP
* Accepted - TRUNC
* Accepted - int("CARGAJUR.int")
* Accepted - anim
* Accepted - csi
* Accepted - verbose
* Accepted - nolist
* Accepted - sourceasm
* Accepted - list("CARGAJUR.lst")
* Compiling /d/iccol/desarrollo/fuentes/CARGAJUR.CBL
".............COMPILANDO BDIIREGI SIN STATUS.........."
".............COMPILANDO BDIIDIAN SIN STATUS.........."
".............COMPILANDO BDIIDAS SIN STATUS.........."
".............COMPILANDO BDIIALE SIN STATUS.........."
* Total Messages:     1
* Unrecoverable :     0                    Severe  :     1
* Errors        :     0                    Warnings:     0
* Informational :     0                    Flags   :     0
* Data:       23580     Code:           0

>>> DATACREDITO: ** COMPILANDO CARGAJUR.CBL HUBO ERRORES...
** ESTAN EN EL ARCHIVO CARGAJUR.CBL.err


/d/iccol/desarrollo $^[  /d/iccol/desarrollo $des-c-v CARGAJURfg              cat  CARGAJUR.CBL.err
* Rejected - OPT
  1747         delimited by all "&"
* 301-S*****************                                               (   0)**
**    Unrecognized verb
cob64: error(s) in compilation: /d/iccol/desarrollo/fuentes/CARGAJUR.CBL
/d/iccol/desarrollo $fg
vi CARGAJUR.CBL
move E-cont-regs-con-error to N-reg-con-errormove N-reg-con-error to N-editdisplay N-edit "Registros con error"move N-ale-borradas to N-editdisplay N-edit "Alertas borradas previo al refresque total"move N-ale-insertadas to N-editdisplay N-edit "Alertas insertadas"move N-ale-modificadas to N-editdisplay N-edit "Alertas modificadas"move N-ale-eliminadas to N-editdisplay N-edit "Alertas eliminadas"move N-ale-ya-existe to N-editdisplay N-edit "Insercion de alerta existente"move N-ale-no-existe to N-editdisplay N-edit "Modif o elim de alerta inexistente".* Emision del reporte de erroresdisplay " "
display "Totales por tipo de error detectado:"perform varying Ex from 1 by 1 until Ex > 50or E-codigo(Ex) = "00"if E-contador(Ex) not = 0move E-contador(ex) to E-editdisplay E-edit E-codigo(Ex) "-" E-descripcion(Ex)end-if
end-perform.9000-CANCELAR-PROGRAMA.
******************************************************************
* Procedimiento standard de cancelacion de programa batch
******************************************************************
* TODO: hay un standard para comunicar una cancelacion de proceso?display pgm " - proceso cancelado"goback returning 99.copy BDIIVIDE.PROC.copy VALNOM.PROC./
IDENTIFICATION DIVISION.
PROGRAM-ID. PONERR.
******************************************************************
* Rutina de conveniencia para procesar un error detectado en un
* registro de input/delimited by all "&"Address search hit BOTTOM without matching pattern/delimited by all "&"Address search hit BOTTOM without matching pattern?* >>>> esto da un error de compilacion que no puedo resolver* >>>> por ahora esta anulado
******************************************************************
* Carga de los templates para armar el texto de alertas
* TODO: por ahora los templates son literalesset LAx to 0
move high-values to LA-templatesperform varying LAm from 1 by 1until LA-modelo(LAm) = high-valuesset LAx up by 1*separa las partes de la lineaunstring LA-modelo(1) into LA-parte(1, 1)LA-parte(1, 2) LA-parte(1, 3) LA-parte(1, 4)LA-parte(1, 5) LA-parte(1, 6) LA-parte(1, 7)LA-parte(1, 8) LA-parte(1, 9) LA-parte(1, 10)delimited by all "&"*separa las partes de la linea
*unstring LA-modelo(LAm) into LA-parte(LAx, 1)
*LA-parte(LAx, 2) LA-parte(LAx, 3) LA-parte(LAx, 4)
*LA-parte(LAx, 5) LA-parte(LAx, 6) LA-parte(LAx, 7)
*LA-parte(LAx, 8) LA-parte(LAx, 9) LA-parte(LAx, 10)
*delimited by all "&"
*prepara para omitir los espacios al final de c/parteperform varying LAy from 1 by 1 until LAy > 10inspect LA-parte(LAx, LAy) replacing trailingspaces by high-valuesinspect LA-parte(LAx, LAy) replacing firsthigh-value by spaceend-performend-perform.1001-ELIMINAR-TODO.
******************************************************************
* Elimina los registros de alertas existentes en el archivo de
* alertas en linea, previo a un refresque total
******************************************************************display "Eliminando toda la informacion con fuente JURAD"
*    posiciona en el primer reg de JURADmove zero to TIP-IDE-BDIIALEmove zero to NUM-IDE-BDIIALEmove P-cod-suscriptor to FUENTE-BDIIALEmove zeros to COD-ALERTA-BDIIALEmove low-values to LLASEC-BDIIALEstart BDIIALE key > LLAVE-BDIIALE invalid key
*no hay registros

exit paragraph*    lee secuencialmente y elimina los registros de JURAD
*    hasta el fin del archivoperform until EST-BDIIALE not = "00"read BDIIALE next recordevaluate EST-BDIIALEwhen "00"
8 lines deleted:w"CARGAJUR.CBL" 1211 lines, 51446 characters [1] + Stopped (SIGTSTP)        vi CARGAJUR.CBL
/d/iccol/desarrollo $^[  /d/iccol/desarrollo $fgcat  CARGAJUR.CBL.errdes-c-v CARGAJUR     
Ejecucion de la macro de compilacion cobol para desarrollo
cob64 -C nolist -CC -KPIC -A -KPIC -N PIC -uv -g -P -C sourceasm /d/iccol/desarrollo/fuentes/CARGAJUR.CBL 
* Micro Focus Server Express         V5.1 revision 000           Compiler
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
* Accepted - VERBOSE
* Accepted - NOANIM
* Accepted - NOBOUND
* Accepted - NOALTER
* Accepted - COMP
* Accepted - TRUNC
* Accepted - int("CARGAJUR.int")
* Accepted - anim
* Accepted - csi
* Accepted - verbose
* Accepted - nolist
* Accepted - sourceasm
* Accepted - list("CARGAJUR.lst")
* Compiling /d/iccol/desarrollo/fuentes/CARGAJUR.CBL
".............COMPILANDO BDIIREGI SIN STATUS.........."
".............COMPILANDO BDIIDIAN SIN STATUS.........."
".............COMPILANDO BDIIDAS SIN STATUS.........."
".............COMPILANDO BDIIALE SIN STATUS.........."
* Total Messages:     0
* Data:       23800     Code:       23534
* Micro Focus Server Express V5.1.00 Code Generator
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
* Accepted - verbose
* Accepted - anim
* Accepted - PIC
* Generating CARGAJUR
* Data:     23536  Code:     45204  Literals:      1920  Dynamic:   1425408

>>> DATACREDITO: TERMINO OK COMPILACION DE CARGAJUR.CBL

/d/iccol/desarrollo $^[  /d/iccol/desarrollo $des-c-v CARGAJURfg              cat  CARGAJUR.CBL.errdes-c-v CARGAJUR     fg              cat  CARGAJUR.CBL.errkkk                  des-c-v CARGAJURfg              cat  CARGAJUR.CBL.errdes-c-v CARGAJUR     fg              cat  CARGAJUR.CBL.errdes-c-v CARGAJUR     fg              x CARGAJUR 9999991000905140101.txt/d/iccol/desarrollo $
CARGAJUR   - Carga de archivo JURAD11301465
Parametros: 9999991000905140101.txt                                                         
01 Envio Original - Carga TOTAL 1a vez
 
I100000149123JOSE MISAEL AREVALO SANCHEZ                  0010012013040500905720130411
--- falla en la tabla de errores ---14
 
I100000262135LIBARDO ANTONIO GARZON TORRE                 0150202013020602204520120406
--- falla en la tabla de errores ---14
 
I100000958212LUIS GUILLERMO AVENDAnO RODR                 0020442013050603302020000406
--- falla en la tabla de errores ---14
 
I100001327130GONZALO PATInO MORENO                        0030062013010604407619984069
--- falla en la tabla de errores ---13
--- falla en la tabla de errores ---14
 
I100002859753ERNESTO RICO                                 0050672013040602206720100435
--- falla en la tabla de errores ---13
 
I100002865767MIGUEL ANTONIO LAVERDE NIETO                 0060452011040603303320111406
--- falla en la tabla de errores ---13
 
I100003044362MANUEL CASTRO MUnETON                        0070rt2011010605300120130406
--- falla en la tabla de errores ---07
 
I100003448867JAIRO DE JESUS HENAO VILLEGA                 0090572013041104550030100806
--- falla en la tabla de errores ---13
 
I200811046741SALUD AXIAL LTDA                             0440761998406903400219990101
--- falla en la tabla de errores ---09
 
I200860013816INSTITUTO DE SEGUROS SOCIALE                 0220672010043503300220131206
--- falla en la tabla de errores ---09
 
I200860024151COMPUTEC SA                                  0330332011140604500120110402
--- falla en la tabla de errores ---09
 
I200860034313BANCO DAVIVIENDA SA                          0533000013040601102320110411
--- falla en la tabla de errores ---09
 
I200890300546COLGATE PALMOLIVE COMPAIA                    2322000011050603304320131010
--- falla en la tabla de errores ---09
 
I300600003115xxxxxx                                       0150542014010600400320120406
--- falla en la tabla de errores ---15
novedad:  xxxxxx                                       
registro: FERNANDEZ PENA JULIO ANTONIO                                     
 
I400000266423SIMONE MARTINEZ                              033002201312060070rt20110106
--- falla en la tabla de errores ---11
 
I400000244359PATRICIO ALEJANDRO HERRERA C                 0450012011040200804520130111
--- falla en la tabla de errores ---14
 
I400000163598xxxxxx                                       0330432013101002204520120406
--- falla en la tabla de errores ---15
novedad:  xxxxxx                                       
registro: KARAN  ABBOUD NAJAH                                              
 
Totales de registros:
      27 Registros IME en el archivo de entrada
      26 Registros procesados sin error
      52 Registros tipo I aceptados
         Registros tipo M aceptados
         Registros tipo E aceptados
         Registros con error
         Alertas borradas previo al refresque total
         Alertas insertadas
         Alertas modificadas
         Alertas eliminadas
         Insercion de alerta existente
         Modif o elim de alerta inexistente
 
Totales por tipo de error detectado:
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           

real    0m0.04s
user    0m0.01s
sys     0m0.01s

Inicio de Programa:  2014/05/16 11:30:14
Fin de Programa:     2014/05/16 11:30:14

/d/iccol/desarrollo $fg
vi CARGAJUR.CBL
* >>>> esto da un error de compilacion que no puedo resolver* >>>> por ahora esta anulado
******************************************************************
* Carga de los templates para armar el texto de alertas
* TODO: por ahora los templates son literalesset LAx to 0
move high-values to LA-templatesperform varying LAm from 1 by 1until LA-modelo(LAm) = high-valuesset LAx up by 1
*separa las partes de la linea
*unstring LA-modelo(LAm) into LA-parte(LAx, 1)
*LA-parte(LAx, 2) LA-parte(LAx, 3) LA-parte(LAx, 4)
*LA-parte(LAx, 5) LA-parte(LAx, 6) LA-parte(LAx, 7)
*LA-parte(LAx, 8) LA-parte(LAx, 9) LA-parte(LAx, 10)
*delimited by all "&"
*prepara para omitir los espacios al final de c/parteperform varying LAy from 1 by 1 until LAy > 10inspect LA-parte(LAx, LAy) replacing trailingspaces by high-valuesinspect LA-parte(LAx, LAy) replacing firsthigh-value by spaceend-performend-perform.1001-ELIMINAR-TODO.
******************************************************************
* Elimina los registros de alertas existentes en el archivo de
* alertas en linea, previo a un refresque total
******************************************************************display "Eliminando toda la informacion con fuente JURAD"
*    posiciona en el primer reg de JURADmove zero to TIP-IDE-BDIIALEmove zero to NUM-IDE-BDIIALEmove P-cod-suscriptor to FUENTE-BDIIALEmove zeros to COD-ALERTA-BDIIALEmove low-values to LLASEC-BDIIALEstart BDIIALE key > LLAVE-BDIIALE invalid key
*no hay registros
exit paragraph*    lee secuencialmente y elimina los registros de JURAD
*    hasta el fin del archivoperform until EST-BDIIALE not = "00"read BDIIALE next recordevaluate EST-BDIIALEwhen "00"$SET LIST SETTINGIDENTIFICATION DIVISION.
PROGRAM-ID.    ACTALEJUR.
******************************************************************
* Actualizacion del archivo de alertas con los datos provistos
* por Jurad
* Procesa el archivo JURAD. Controla cada registro: si es OK usa
* los datos para actualizar BDIIALE, si tiene defecto lo graba en
* el archivo ERRS.
******************************************************************
AUTHOR.Globant JL.
DATE-WRITTEN.
DATE-COMPILED.
CONFIGURATION section.
SOURCE-COMPUTER. microfocus.
OBJECT-COMPUTER. microfocus.
INPUT-OUTPUT section.
FILE-CONTROL.******************************************************************
******************************************************************
select JURAD assign to P-file-nameorganization is line sequentialfile status is JURAD-fs.******************************************************************
******************************************************************
select ERRS assign to ERRS-file-nameorganization is line sequentialfile status is ERRS-fs.******************************************************************
******************************************************************copy BDIIREGI.FS.
* TODO: debe compilar con file status******************************************************************
******************************************************************
copy BDIIDIAN.FS.******************************************************************
******************************************************************
copy BDIIDAS.FS.******************************************************************
******************************************************************copy BDIIALE.FS replacing == on record.== by == on recordfile status is EST-BDIIALE.==.
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
1211 lines deletedNo lines in bufferAPPEND MODE      $SET LIST SETTING 

       IDENTIFICATION DIVISION.


       PROGRAM-ID.    ACTALEJUR.



      ******************************************************************
      * Actualizacion del archivo de alertas con los datos provistos
      * por Jurad
      * Procesa el archivo JURAD. Controla cada registro: si es OK usa
      * los datos para actualizar BDIIALE, si tiene defecto lo graba en
      * el archivo ERRS.
      ******************************************************************
       AUTHOR.        Globant JL.
       DATE-WRITTEN.
       DATE-COMPILED.
       CONFIGURATION section.
       SOURCE-COMPUTER. microfocus.
       OBJECT-COMPUTER. microfocus.
       INPUT-OUTPUT section.
       FILE-CONTROL.

      ******************************************************************
      ******************************************************************
       select JURAD assign to P-file-name
           organization is line sequential
           file status is JURAD-fs.

      ******************************************************************
      ******************************************************************
       select ERRS assign to ERRS-file-name
           organization is line sequential
           file status is ERRS-fs.

      ******************************************************************
      ******************************************************************
           copy BDIIREGI.FS.
      * TODO: debe compilar con file status

      ******************************************************************
      ******************************************************************
       copy BDIIDIAN.FS.
 
      ******************************************************************
      ******************************************************************
       copy BDIIDAS.FS.

      ******************************************************************
      ******************************************************************
           copy BDIIALE.FS replacing == on record.== by == on record
              file status is EST-BDIIALE.==.



APPEND MODE      ******************************************************************

APPEND MODE      ******************************************************************

APPEND MODE       DATA DIVISION.

APPEND MODE       FILE section.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Archivo de entrada con los datos de demandas y embargos de JURAD

APPEND MODE      ******************************************************************

APPEND MODE       FD JURAD.

APPEND MODE       01  JURAD-reg.

APPEND MODE      * Registros de movimientos I, M, E

APPEND MODE      *    Tipo de Novedad {I, M, E} Inser/Modif/Elim

APPEND MODE           03 JURAD-tipo-novedad        pic x.

APPEND MODE      *    Tipo de identificacion Numero {1, 2, 3, 4}

APPEND MODE           03 JURAD-id-tipo             pic x.

APPEND MODE      *    Numero de identificacion

APPEND MODE           03 JURAD-id-numeroX          pic x(11).

APPEND MODE           03 JURAD-id-numero           redefines JURAD-id-numeroX

APPEND MODE                                        pic 9(11).

APPEND MODE      *    Nombres y Apellidos

APPEND MODE           03 JURAD-nombre              pic x(45).

APPEND MODE      *    Numero de demandas vigentes

APPEND MODE           03 JURAD-demandas-vigentes   pic 999.

APPEND MODE      *    Numero de demandas terminadas

APPEND MODE           03 JURAD-demandas-terminadas pic 999.

APPEND MODE      *    Fecha ultima demanda vigente YYYYMMDD

APPEND MODE           03 JURAD-demandas-fecha-ultima pic x(8).

APPEND MODE      *    Numero de embargos vigentes

APPEND MODE           03 JURAD-embargos-vigentes   pic 999.

APPEND MODE      *    Numero de embargos terminados

APPEND MODE           03 JURAD-embargos-terminados pic 999.

APPEND MODE      *    Fecha ultimo embargo vigente YYYYMMDD

APPEND MODE           03 JURAD-embargos-fecha-ultimo pic x(8).

APPEND MODE

APPEND MODE       01  JURADT-reg.

APPEND MODE      * Registro de totales de control T

APPEND MODE      *    Tipo de Novedad = "T"

APPEND MODE           03 JURADT-tipo-novedad       pic x.

APPEND MODE           03                           pic x.

APPEND MODE      *    Cantidad de registros

APPEND MODE           03 JURADT-registros          pic 9(11).

APPEND MODE           03                           pic x.

APPEND MODE      *    Total numero de demandas vigentes

APPEND MODE           03 JURADT-demandas-vigentes  pic 9(7).

APPEND MODE           03                           pic x.

APPEND MODE      *    Total numero de demandas terminadas

APPEND MODE           03 JURADT-demandas-terminadas pic 9(7).

APPEND MODE           03                           pic x.

APPEND MODE      *    Total numero de embargos vigentes

APPEND MODE           03 JURADT-embargos-vigentes  pic 9(7).

APPEND MODE           03                           pic x.

APPEND MODE      *    Total numero de embargos terminados

APPEND MODE           03 JURADT-embargos-terminados pic 9(7).

APPEND MODE           03                           pic x(41).

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Archivo de salida con los registros defectuosos del arch JURAD

APPEND MODE      ******************************************************************

APPEND MODE       FD ERRS.

APPEND MODE       01  ERRS-reg.

APPEND MODE      *    Tipo de Novedad {I, M, E, T} Inser/Modif/Elim/Totales

APPEND MODE           03 ERRS-tipo-novedad         pic x.

APPEND MODE      *    Tipo de identificacion Numero {1, 2, 3, 4}

APPEND MODE           03 ERRS-id-tipo              pic x.

APPEND MODE      *    Numero de identificacion

APPEND MODE           03 ERRS-id-numero            pic x(11).

APPEND MODE      *    Nombres y Apellidos

APPEND MODE           03 ERRS-nombre               pic x(45).

APPEND MODE      *    Numero de demandas vigentes

APPEND MODE           03 ERRS-demandas-vigentes    pic 999.

APPEND MODE      *    Numero de demandas terminadas

APPEND MODE           03 ERRS-demandas-terminadas  pic 999.

APPEND MODE      *    Fecha ultima demanda vigente YYMMDD

APPEND MODE           03 ERRS-demandas-fecha-ultima pic x(6).

APPEND MODE      *    Numero de embargos vigentes

APPEND MODE           03 ERRS-embargos-vigentes    pic 999.

APPEND MODE      *    Numero de embargos terminados

APPEND MODE           03 ERRS-embargos-terminados  pic 999.

APPEND MODE      *    Fecha ultimo embargo vigente YYMMDD

APPEND MODE           03 ERRS-embargos-fecha-ultimo pic x(6).

APPEND MODE      *    Causa del rechazo

APPEND MODE           03 ERRS-causa-rechazo        pic x(100).

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Contiene los ids y nombres de personas

APPEND MODE      ******************************************************************

APPEND MODE       copy BDIIREGI.FD.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Maestro de personas juridicas nacionales y extranjeras reportada

APPEND MODE      * por la DIAN

APPEND MODE      ******************************************************************

APPEND MODE       copy BDIIDIAN.FD.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Archivo maestro de cedulas de extranjeria suministrado por DAS

APPEND MODE      ******************************************************************

APPEND MODE       copy BDIIDAS.FD.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Maestro de alertas reportadas por suscriptores

APPEND MODE      ******************************************************************

APPEND MODE       copy BDIIALE.FD.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE       WORKING-STORAGE section.

APPEND MODE      ******************************************************************

APPEND MODE      * Nombre del programa

APPEND MODE       01  pgm                          pic x(10) value "CARGAJUR".

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Variables para rutina de validacion de identificaciones

APPEND MODE      ******************************************************************

APPEND MODE       copy BDIIVIDE.WS.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Variables relacionadas con las alertas del sistema

APPEND MODE      ******************************************************************

APPEND MODE       copy BDIIALE.WS.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Datos para las rutinas de validacion de nombres de VALNOM.PROC

APPEND MODE      ******************************************************************

APPEND MODE       copy VALNOM.WS.

APPEND MODE

APPEND MODE      *****************************************************************

APPEND MODE      * Direcciones de los archivos en el file system

APPEND MODE      *****************************************************************

APPEND MODE       copy ICFILE.WS.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Indica que se termino el proceso, por agotamiento del archivo

APPEND MODE      * de entrada (normal) o alguna otra condicion (error)

APPEND MODE       01  IND-fin-proceso              pic xx value "NO".

APPEND MODE

APPEND MODE      * Copia del ultimo reg de input, para mensajes (Ult reg: ...)

APPEND MODE       01  JURAD-reg-anterior           pic x(100) value "(vacio)".

APPEND MODE       01  JURAD-fs                     pic xx value spaces.

APPEND MODE

APPEND MODE       01  ERRS-fs                      pic xx value spaces.

APPEND MODE

APPEND MODE      * Datos de demandas o embargos que van en el registro BDIIALE

APPEND MODE       01 D-datahost.

APPEND MODE           05 D-vigentes                pic 9(5).

APPEND MODE           05 D-terminados              pic 9(5).

APPEND MODE           05 D-fecha-ultima            pic x(8).

APPEND MODE      ******************************************************************

APPEND MODE      * Parametros iniciales, de la linea de comando

APPEND MODE      * La linea de comando que contiene los parametros

APPEND MODE       01 P-command-line                pic x(80) value spaces.

APPEND MODE       01 P-parametros.

APPEND MODE      *    Proceso real: contiene "SI" para activar 

APPEND MODE      * TODO: fijo en "NO" para pruebas

APPEND MODE           03 P-proceso-real            pic xx value "NO".

APPEND MODE           88 PROCESO-REAL              value "SI".

APPEND MODE

APPEND MODE      *    Nombre del archivo de entrada JJJJJJaaaDDMMAAbbXX.txt

APPEND MODE           03 P-file-name               pic x(80) value spaces.

APPEND MODE           03 P-file-name-R             redefines P-file-name.

APPEND MODE      *        JJJJJJ = Codigo de suscriptor JURAD en Experian

APPEND MODE               05 P-cod-suscriptor      pic 9(6).

APPEND MODE      *        aaa = Codificacion del producto ("100")

APPEND MODE               05 P-producto            pic xxx.

APPEND MODE      *        DDMMAA = Fecha de proceso

APPEND MODE               05 P-fecha-proceso       pic x(6).

APPEND MODE      *        bb =  01 a CI

APPEND MODE               05 P-ci-bi               pic xx.

APPEND MODE      *        XX = Tipo de proceso

APPEND MODE      *        01 Envio Original - Carga TOTAL - primera vez

APPEND MODE      *        02 Archivo Semanal - Carga PARCIAL

APPEND MODE      *        03 Archivo Mensual - Carga PARCIAL

APPEND MODE      *        04 Refresque Total - Carga TOTAL

APPEND MODE               05 P-tipo-proceso        pic xx.

APPEND MODE      *        extension del archivo ".txt"

APPEND MODE               05 P-extension           pic x(4).

APPEND MODE               05                       pic x(57).

APPEND MODE      * Nombre del archivo de errores JJJJJJaaaDDMMAAbbXX_ERRORES.txt

APPEND MODE          03 ERRS-file-name             pic x(80) value spaces.

APPEND MODE

APPEND MODE      * Fecha de proceso editada YYYYMMDD

APPEND MODE       01 P-fecha-proceso-YYYYMMDD      pic x(8).

APPEND MODE      * Fecha de proceso + 50 años

APPEND MODE       01 P-fecha-proceso-50.

APPEND MODE           03  P-fecha-proceso-50YYYY   pic 9999.

APPEND MODE           03                           pic x(4).

APPEND MODE      ******************************************************************

APPEND MODE      * Datos para el reporte final

APPEND MODE       01 W-tiempo.

APPEND MODE           03 W-hora-inicio             pic 9(8).

APPEND MODE           03 W-hora-fin                pic 9(8).

APPEND MODE       01 N-edit                        pic z(8)B.

APPEND MODE       01 N-contadores.

APPEND MODE      *    Registros en el archivo de entrada

APPEND MODE           03 N-reg-leidos              pic 9(8) value zero.

APPEND MODE      *    Registros procesados sin error

APPEND MODE           03 N-reg-OK                  pic 9(8) value zero.

APPEND MODE      *    Registros con error

APPEND MODE           03 N-reg-con-error           pic 9(8) value zero.

APPEND MODE

APPEND MODE      *    Cantidades de registros por tipo de novedad

APPEND MODE           03 N-reg-tipo-I-OK           pic 9(8) value zero.

APPEND MODE           03 N-reg-tipo-M-OK           pic 9(8) value zero.

APPEND MODE           03 N-reg-tipo-E-OK           pic 9(8) value zero.

APPEND MODE           03 N-reg-tipo-I-err          pic 9(8) value zero.

APPEND MODE           03 N-reg-tipo-M-err          pic 9(8) value zero.

APPEND MODE           03 N-reg-tipo-E-err          pic 9(8) value zero.

APPEND MODE

APPEND MODE      *    Alertas borradas previo al refresque total

APPEND MODE           03 N-ale-borradas            pic 9(8) value zero.

APPEND MODE      *    Alertas insertadas

APPEND MODE           03 N-ale-insertadas          pic 9(8) value zero.

APPEND MODE      *    Alertas modificadas

APPEND MODE           03 N-ale-modificadas         pic 9(8) value zero.

APPEND MODE      *    Alertas eliminadas

APPEND MODE           03 N-ale-eliminadas          pic 9(8) value zero.

APPEND MODE      *    Insercion de alerta existente

APPEND MODE           03 N-ale-ya-existe           pic 9(8) value zero.

APPEND MODE      *    Modificacion o eliminacion de alerta inexistente

APPEND MODE           03 N-ale-no-existe           pic 9(8) value zero.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Armado de las lineas de alerta

APPEND MODE       01 LA-lineas-alerta.

APPEND MODE      *    Los modelos a continuacion deberan obtenerse de un 

APPEND MODE      *    archivo, como BDIIALE-ALERTAS

APPEND MODE           03 LAend                     pic 999 comp value 0.

APPEND MODE           03 LA-modelos.

APPEND MODE      *         12345678901234567890123456789012345678901234567890

APPEND MODE               05 pic x(50) value

APPEND MODE               "TIENE &&& DEMANDAS CERRADAS Y &&& ABIERTAS        ".

APPEND MODE               05 pic x(50) value

APPEND MODE               "LA ABIERTA MAS RECIENTE SE INSTAURO EL [&&&&&&&&]".

APPEND MODE               05 pic x(50) value

APPEND MODE               "TIENE &&& EMBARGOS CANCELADOS Y &&& VIGENTES      ".

APPEND MODE               05 pic x(50) value

APPEND MODE               "EL EMBARGO MAS RECIENTE SE INSTAURO EL [&&&&&&&&] ".

APPEND MODE               05 pic x(50) value high-values. *> end marker

APPEND MODE           03 LA-modelos2               redefines LA-modelos.

APPEND MODE               05 LA-modelo             pic x(50) occurs 5 

APPEND MODE                                        indexed LAm.

APPEND MODE      *    Funcionamiento de los templates.

APPEND MODE      *    Hay dos templates por de alerta, uno por linea.

APPEND MODE      *    Cada template consiste en hasta 10 frases fijas con

APPEND MODE      *    ampersands (&) donde se van a reemplazar los valores.

APPEND MODE      *    Por ejemplo: 

APPEND MODE      *    TIENE &&& DEMANDAS CERRADAS Y &&& ABIERTAS

APPEND MODE      *    tiene 3 frases fijas y 2 reemplazos. 

APPEND MODE      *    La cantidad de ampersands es irrelevante, pero parece

APPEND MODE      *    conveniente que informe sobre el tamanio del contenido.

APPEND MODE           03 LA-templates.

APPEND MODE               05 LA-template           occurs 4 indexed LAx.

APPEND MODE                   07 LA-parte          pic x(50)

APPEND MODE                                        occurs 10 indexed LAy.

APPEND MODE      *    Las dos lineas armadas

APPEND MODE           03 LA-lineas.

APPEND MODE               05 LA-linea1             pic x(50).

APPEND MODE               05 LA-linea2             pic x(50).

APPEND MODE      *    Los valores a insertar en una linea

APPEND MODE           03 LA-valores.

APPEND MODE               05 LA-valor              pic x(50) 

APPEND MODE                                        occurs 10 indexed LAv.

APPEND MODE      *    Datos para editar valores a insertar

APPEND MODE           03 LA-num                    pic -(11)0.

APPEND MODE           03 LA-numX                   redefines LA-num

APPEND MODE                                        pic x(12).

APPEND MODE           03 LA-descarte               pic x(50).

APPEND MODE

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Errores de consistencia del input

APPEND MODE      * Cada error tiene un codigo de 2 digitos, un espacio, contador

APPEND MODE      * de ocurrencias de 7 digitos, un espacio, y descripcion de 59

APPEND MODE       01 E-errores.

APPEND MODE      *    indica si el registro actual tiene error

APPEND MODE           03 E-hay-error               pic xx value "NO".

APPEND MODE      *    errores del registro actual

APPEND MODE           03 E-errores-reg             pic x(100) value spaces.

APPEND MODE      *    contador de registros con error

APPEND MODE           03 E-cont-regs-con-error     pic 9(8) value zero.

APPEND MODE      *    tabla de errores

APPEND MODE           03 pic x(11) value "01 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Tipo de movimiento invalido, debe ser I M E T".

APPEND MODE           03 pic x(11) value "02 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Tipo de identificacion invalido, debe ser 1 2 3 4".

APPEND MODE           03 pic x(11) value "03 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Numero de identificacion invalido, debe ser numerico".

APPEND MODE           03 pic x(11) value "04 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Tipo de identificacion debe ser mayor que cero".

APPEND MODE           03 pic x(11) value "05 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Falta el nombre o denominacion".

APPEND MODE           03 pic x(11) value "06 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Numero de demandas vigentes: debe ser numerico".

APPEND MODE           03 pic x(11) value "07 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Numero de demandas terminadas: debe ser numerico".

APPEND MODE           03 pic x(11) value "08 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Fecha ultima demanda vigente YYYYMMDD: debe ser numerica".

APPEND MODE           03 pic x(11) value "09 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Fecha ultima demanda vigente YYYYMMDD: fuera de rango".

APPEND MODE           03 pic x(11) value "10 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Numero de embargos vigentes: debe ser numerico".

APPEND MODE           03 pic x(11) value "11 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Numero de embargos terminados: debe ser numerico".

APPEND MODE           03 pic x(11) value "12 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Fecha ultimo embargo vigente YYYYMMDD: debe ser numerica".

APPEND MODE           03 pic x(11) value "13 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Fecha ultimo embargo vigente YYYYMMDD: fuera de rango".

APPEND MODE           03 pic x(11) value "14 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "El numero de id no se encuentra en el archivo maestro".

APPEND MODE           03 pic x(11) value "15 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "El nombre en el input no coincide con el registrado".

APPEND MODE           03 pic x(11) value "16 0000000 ".

APPEND MODE           03 pic x(59) value

APPEND MODE           "Numero de id fuera del rango del tipo de id informado".

APPEND MODE      *----------------- insertar nuevos items aqui -------------------

APPEND MODE           03 pic x(11) value "00 0000000 ".

APPEND MODE           03 pic x(59) value "--- fin de la lista (cod 00) ---".

APPEND MODE           03                           pic x(3500). *> los 50 items

APPEND MODE       01 E-errores-2                   redefines E-errores.

APPEND MODE           03                           pic xx.

APPEND MODE           03                           pic 9(8).

APPEND MODE           03 E-error                   occurs 50 indexed Ex.

APPEND MODE               05 E-codigo              pic xx.

APPEND MODE               05                       pic x.

APPEND MODE               05 E-contador            pic 9(7).

APPEND MODE               05                       pic x.

APPEND MODE               05 E-descripcion         pic x(59).

APPEND MODE       01 E-edit                        pic z(8)B.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      * Control de rangos de valores de las fechas del input

APPEND MODE       01 VALIDACIONES-FECHAS.

APPEND MODE           02 ANO-VAL-X                 pic 9(04).

APPEND MODE              88 ANO-VAL                value 1900 thru 2050.

APPEND MODE           02 MES-VAL-X                 pic 9(02).

APPEND MODE              88 MES-VAL                value 01   thru 12.

APPEND MODE           02 DIA-VAL-X                 pic 9(02).

APPEND MODE              88 DIA-VAL                value 01   thru 31.

APPEND MODE

APPEND MODE      /*****************************************************************

APPEND MODE      ******************************************************************

APPEND MODE       PROCEDURE DIVISION.

APPEND MODE      *    0000-PROGRAMA-PRINCIPAL

APPEND MODE      *    4000-PROCESAR-REGISTRO

APPEND MODE      *    4000-PROCESAR-REGISTRO-2

APPEND MODE      *    4100-VALIDACION-FORMAL

APPEND MODE      *    4200-VALIDACION-SEMANTICA

APPEND MODE      *    4300-MODIFICAR-BDIIALE

APPEND MODE      *    4300-MODIFICAR-BDIIALE-DATOS

APPEND MODE      *    4300-MODIFICAR-BDIIALE-I

APPEND MODE      *    4300-MODIFICAR-BDIIALE-M

APPEND MODE      *    4300-MODIFICAR-BDIIALE-E

APPEND MODE      *    4333-LEER-BDIIALE-RANDOM

APPEND MODE      *    4333-GRABAR-BDIIALE

APPEND MODE      *    4333-REGRABAR-BDIIALE

APPEND MODE      *    4333-ELIMINAR-BDIIALE

APPEND MODE      *    4900-GRABAR-ERROR

APPEND MODE      *    4320-ARMAR-TEXTO-ALERTA

APPEND MODE      *    1000-RUTINA-INICIAL

APPEND MODE      *    1001-ELIMINAR-TODO

APPEND MODE      *    7000-RUTINA-FINAL

APPEND MODE      *    9000-CANCELAR-PROGRAMA

APPEND MODE

APPEND MODE

APPEND MODE       0000-PROGRAMA-PRINCIPAL.

APPEND MODE      ******************************************************************

APPEND MODE      *    inicializa el ambiente y abre los archivos

APPEND MODE           perform 1000-RUTINA-INICIAL

APPEND MODE      *    procesa cada uno de los registros del archivo JURAD hasta

APPEND MODE      *    encontrar el registro "T" de totales

APPEND MODE           perform 4000-PROCESAR-REGISTRO until IND-fin-proceso = "SI"

APPEND MODE      *    cierra archivos y produce el reporte final

APPEND MODE           perform 7000-RUTINA-FINAL

APPEND MODE           goback.

APPEND MODE

APPEND MODE       4000-PROCESAR-REGISTRO.

APPEND MODE      ****************************************************************

APPEND MODE      * Proceso de un registro del archivo de entrada JURAD

APPEND MODE      * Lectura y control del file status del archivo

APPEND MODE      ****************************************************************

APPEND MODE      *    lectura del proximo registro

APPEND MODE           read JURAD

APPEND MODE           evaluate JURAD-fs

APPEND MODE           when "00"

APPEND MODE      *        controla el reg y lo aplica si es OK

APPEND MODE               perform 4000-PROCESAR-REGISTRO-2

APPEND MODE               move JURAD-reg to JURAD-reg-anterior

APPEND MODE           when "10"

APPEND MODE      *        fin del archivo de input:

APPEND MODE      *        esto es un error, no se encontro el registro "T" antes

APPEND MODE      *        de que se terminara el archivo

APPEND MODE               display "Falta el reg de totales del archivo JURAD "

APPEND MODE               display "Nombre del archivo: " P-file-name

APPEND MODE               display "File status: " JURAD-fs

APPEND MODE               display "Ultimo registro leido: " N-reg-leidos

APPEND MODE               display JURAD-reg-anterior

APPEND MODE               perform 9000-CANCELAR-PROGRAMA

APPEND MODE           when other

APPEND MODE      *        error de lectura: cancelacion del proceso

APPEND MODE               display "Error en lectura del archivo JURAD "

APPEND MODE               display "Nombre del archivo: " P-file-name

APPEND MODE               display "File status: " JURAD-fs

APPEND MODE               display "Ultimo registro leido: " N-reg-leidos

APPEND MODE               display JURAD-reg-anterior

APPEND MODE               perform 9000-CANCELAR-PROGRAMA

APPEND MODE           end-evaluate.

APPEND MODE

APPEND MODE

APPEND MODE       4000-PROCESAR-REGISTRO-2.

APPEND MODE      ****************************************************************

APPEND MODE      * Controla los datos de un registro de JURAD y si es OK lo usa

APPEND MODE      * para actualizar el archivo de alertas en linea

APPEND MODE      * La informacion esta leida en JURAD-reg

APPEND MODE      ****************************************************************

APPEND MODE           move "NO" to E-hay-error

APPEND MODE

APPEND MODE      *    validacion del tipo de movimiento

APPEND MODE           if JURAD-tipo-novedad not = "I" and "M" and "E" and "T" 

APPEND MODE               call "PONERR" using "01" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE

APPEND MODE      *    si es el registro "T" hay que senialar el fin de proceso

APPEND MODE           if JURAD-tipo-novedad = "T" 

APPEND MODE               move "SI" to IND-fin-proceso

APPEND MODE               exit paragraph

APPEND MODE           end-if

APPEND MODE

APPEND MODE           add 1 to N-reg-leidos

APPEND MODE

APPEND MODE      *    validacion formal de los datos

APPEND MODE           perform 4100-VALIDACION-FORMAL

APPEND MODE           if E-hay-error = "SI"

APPEND MODE               exit paragraph

APPEND MODE           end-if

APPEND MODE

APPEND MODE      *    si la validacion formal dio OK se hace validacion semantica

APPEND MODE           perform 4200-VALIDACION-SEMANTICA

APPEND MODE           if E-hay-error = "SI"

APPEND MODE               exit paragraph

APPEND MODE           end-if

APPEND MODE

APPEND MODE      *    actualizacion de BDIIALE o grabacion en arch ERRS de defectos

APPEND MODE           if E-hay-error = "SI"

APPEND MODE               perform 4900-GRABAR-ERROR

APPEND MODE               add 1 to N-reg-con-error

APPEND MODE           else

APPEND MODE               perform 4300-MODIFICAR-BDIIALE

APPEND MODE               add 1 to N-reg-OK

APPEND MODE           end-if.

APPEND MODE

APPEND MODE

APPEND MODE

APPEND MODE       4100-VALIDACION-FORMAL.

APPEND MODE      ******************************************************************

APPEND MODE      * Validacion formal de los datos del input

APPEND MODE      ******************************************************************

APPEND MODE      *    Tipo de identificacion Numero {1, 2, 3, 4}

APPEND MODE           if JURAD-id-tipo not = "1" and "2" and "3" and "4"

APPEND MODE               call "PONERR" using "02" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE      *    Numero de identificacion

APPEND MODE           if JURAD-id-numeroX is not numeric

APPEND MODE               call "PONERR" using "03" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE           if JURAD-id-numero not > 0

APPEND MODE               call "PONERR" using "04" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE      *    si el movimiento es una eliminacion los datos subsiguientes

APPEND MODE      *    no se controlan

APPEND MODE           if JURAD-tipo-novedad = "E"

APPEND MODE               exit paragraph

APPEND MODE           end-if

APPEND MODE      *    Nombres y Apellidos

APPEND MODE           if JURAD-nombre = spaces

APPEND MODE               call "PONERR" using "05" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE      *    Numero de demandas vigentes

APPEND MODE           if JURAD-demandas-vigentes is not numeric

APPEND MODE               call "PONERR" using "06" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE      *    Numero de demandas terminadas

APPEND MODE           if JURAD-demandas-terminadas is not numeric

APPEND MODE               call "PONERR" using "07" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE      *    Fecha ultima demanda vigente YYMMDD

APPEND MODE           if JURAD-demandas-fecha-ultima is not numeric

APPEND MODE               call "PONERR" using "08" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE           move JURAD-demandas-fecha-ultima to VALIDACIONES-FECHAS

APPEND MODE           if not ANO-VAL or not MES-VAL or not DIA-VAL

APPEND MODE               call "PONERR" using "09" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE      *    Numero de embargos vigentes

APPEND MODE           if JURAD-embargos-vigentes not numeric

APPEND MODE               call "PONERR" using "10" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE      *    Numero de embargos terminados

APPEND MODE           if JURAD-embargos-terminados not numeric

APPEND MODE               call "PONERR" using "11" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE      *    Fecha ultimo embargo vigente YYMMDD

APPEND MODE           if JURAD-embargos-fecha-ultimo is not numeric

APPEND MODE               call "PONERR" using "12" JURAD-reg E-errores

APPEND MODE           end-if

APPEND MODE           move JURAD-embargos-fecha-ultimo to VALIDACIONES-FECHAS

APPEND MODE           if not ANO-VAL or not MES-VAL or not DIA-VAL

APPEND MODE               call "PONERR" using "13" JURAD-reg E-errores

APPEND MODE           end-if.

APPEND MODE

APPEND MODE

APPEND MODE       4200-VALIDACION-SEMANTICA.

APPEND MODE      ****************************************************************

APPEND MODE      * Validacion del numero de identificacion y de su relacion con

APPEND MODE      * el nombre

APPEND MODE      ****************************************************************

APPEND MODE           move JURAD-id-tipo to TIP-IDE-BDIIVIDE

APPEND MODE           move JURAD-id-numero to NUM-IDE-BDIIVIDE-R

APPEND MODE           move JURAD-nombre to NOMBRE-BDIIVIDE

APPEND MODE           move 1 to SW-VERIFNOM-BDIIVIDE

APPEND MODE           move 0 to SW-DIGCHEQUEO-BDIIVIDE SW-ASGTIPID-BDIIVIDE

APPEND MODE           perform 80100-VALIDAR-IDENTIFICACION

APPEND MODE      *    a ver si la validacion cambio el tipo de ide

APPEND MODE           if JURAD-id-tipo not = TIP-IDE-BDIIVIDE

APPEND MODE               call "PONERR" using "16" JURAD-reg E-errores

APPEND MODE               display "Tipo ide cambiado de " JURAD-id-tipo " a " 

APPEND MODE               TIP-IDE-BDIIVIDE " num ide: " JURAD-id-numero

APPEND MODE           end-if

APPEND MODE      *    SW-ID-BDIIVIDE: 0 si existe el id, 1 si no existe

APPEND MODE           if SW-ID-BDIIVIDE = 1

APPEND MODE               call "PONERR" using "14" JURAD-reg E-errores

APPEND MODE           else

APPEND MODE      *        existe id, a ver si el nombre coincide

APPEND MODE               if SW-NOMBRES-BDIIVIDE = 1    *> nombre no coincide

APPEND MODE                   call "PONERR" using "15" JURAD-reg E-errores

APPEND MODE                   display "novedad:  " JURAD-nombre

APPEND MODE                   display "registro: " NOM-LEIDO-BDIIVIDE

APPEND MODE               end-if

APPEND MODE           end-if.

APPEND MODE

APPEND MODE

APPEND MODE       4300-MODIFICAR-BDIIALE.

APPEND MODE      ******************************************************************

APPEND MODE      * Se impacta el archivo BDIIALE con una o dos inserciones, 

APPEND MODE      * modificaciones o eliminaciones segun haya o no demandas y 

APPEND MODE      * embargos

APPEND MODE      ******************************************************************

APPEND MODE           initialize REG-BDIIALE

APPEND MODE

APPEND MODE      *    si hay demandas

APPEND MODE           if JURAD-demandas-vigentes > zero

APPEND MODE           or JURAD-demandas-terminadas > zero 

APPEND MODE               move "J001" to LLASEC-BDIIALE

APPEND MODE      *        arma datos de demandas

APPEND MODE               move JURAD-demandas-vigentes to D-vigentes

APPEND MODE               move JURAD-demandas-terminadas to D-terminados

APPEND MODE               string "20" JURAD-demandas-fecha-ultima 

APPEND MODE               delimited size into D-fecha-ultima

APPEND MODE               perform 4300-MODIFICAR-BDIIALE-DATOS 

APPEND MODE           end-if.

APPEND MODE

APPEND MODE      *    si hay embargos

APPEND MODE           if JURAD-embargos-vigentes > zero

APPEND MODE           or JURAD-embargos-terminados > zero 

APPEND MODE               move "J002" to LLASEC-BDIIALE

APPEND MODE      *        arma datos de embargos

APPEND MODE               move JURAD-embargos-vigentes to D-vigentes

APPEND MODE               move JURAD-embargos-terminados to D-terminados

APPEND MODE               string "20" JURAD-embargos-fecha-ultimo

APPEND MODE               delimited size into D-fecha-ultima

APPEND MODE               perform 4300-MODIFICAR-BDIIALE-DATOS 

APPEND MODE           end-if.

APPEND MODE

APPEND MODE

APPEND MODE

APPEND MODE       4300-MODIFICAR-BDIIALE-DATOS.

APPEND MODE      ******************************************************************

APPEND MODE      * Parte de la carga de datos en el registro BDIIALE y grabacion

APPEND MODE      * del mismo que es comun a demandas y embargos

APPEND MODE      * El dato LLASEC-BDIIALE ya tiene "J001" o "J002"

APPEND MODE      ******************************************************************

APPEND MODE      *    completa la clave e intenta leer la alerta, si se leyo OK

APPEND MODE      *    el file status de BDIIALE queda con "00"

APPEND MODE           perform 4333-LEER-BDIIALE-RANDOM

APPEND MODE

APPEND MODE      *    procesa segun el tipo de novedad I M E

APPEND MODE           evaluate JURAD-tipo-novedad

APPEND MODE           when "I"

APPEND MODE               add 1 to N-reg-tipo-I-OK

APPEND MODE               perform 4300-MODIFICAR-BDIIALE-I

APPEND MODE           when "M"

APPEND MODE               add 1 to N-reg-tipo-M-OK

APPEND MODE               perform 4300-MODIFICAR-BDIIALE-M

APPEND MODE           when "E"

APPEND MODE               add 1 to N-reg-tipo-E-OK

APPEND MODE               perform 4300-MODIFICAR-BDIIALE-E

APPEND MODE           when other

APPEND MODE      *        esto es "imposible" por control de consistencia anterior

APPEND MODE               display "error de logica: tipo-novedad="

APPEND MODE               JURAD-tipo-novedad " reg n\202°: " N-reg-leidos

APPEND MODE               display "Registro de JURAD: " display JURAD-reg

APPEND MODE               perform 9000-CANCELAR-PROGRAMA

APPEND MODE           end-evaluate.

APPEND MODE

APPEND MODE

APPEND MODE       4300-MODIFICAR-BDIIALE-I.

APPEND MODE      ******************************************************************

APPEND MODE      * Insercion de una alerta nueva

APPEND MODE      * Si ya existia muestra un mensaje y continua

APPEND MODE      ******************************************************************

APPEND MODE      *    si el registro existia es un error

APPEND MODE           if EST-BDIIALE = "00"

APPEND MODE               display "Insercion de alerta nueva que ya existe "

APPEND MODE               " key: " LLAVE-BDIIALE

APPEND MODE               display "Registro de input: "

APPEND MODE               display JURAD-reg

APPEND MODE               display "Datos en la alerta: " INF-DATAHOST-BDIIALE

APPEND MODE               add 1 to N-ale-ya-existe

APPEND MODE           end-if

APPEND MODE

APPEND MODE      *    completa los datos del registro

APPEND MODE           initialize ENCABEZADO-BDIIALE

APPEND MODE           move P-fecha-proceso-YYYYMMDD to FEC-NOV-BDIIALE

APPEND MODE           FEC-REP-BDIIALE 

APPEND MODE           move P-fecha-proceso-50 to FEC-VEN-BDIIALE

APPEND MODE           move 0 to BLOQUEO-BDIIALE

APPEND MODE           move D-datahost to INF-DATAHOST-BDIIALE

APPEND MODE           perform 4320-ARMAR-TEXTO-ALERTA

APPEND MODE           if EST-BDIIALE = "00"

APPEND MODE               perform 4333-REGRABAR-BDIIALE

APPEND MODE           else

APPEND MODE               perform 4333-GRABAR-BDIIALE

APPEND MODE           end-if.

APPEND MODE

APPEND MODE

APPEND MODE       4300-MODIFICAR-BDIIALE-M.

APPEND MODE      ******************************************************************

APPEND MODE      * Modificacion de una alerta existente

APPEND MODE      * Si no existia muestra un mensaje y continua

APPEND MODE      ******************************************************************

APPEND MODE      *    si el registro no existia es un error

APPEND MODE           if EST-BDIIALE not = "00"

APPEND MODE               display "Modificacion de alerta inexistente "

APPEND MODE               " key: " LLAVE-BDIIALE

APPEND MODE               display "Registro de input: "

APPEND MODE               display JURAD-reg

APPEND MODE               display "Datos en la alerta: " INF-DATAHOST-BDIIALE

APPEND MODE               add 1 to N-ale-no-existe

APPEND MODE           end-if

APPEND MODE      *    reemplaza la fecha de reporte y los valores

APPEND MODE           move P-fecha-proceso-YYYYMMDD to FEC-REP-BDIIALE 

APPEND MODE           move D-datahost to INF-DATAHOST-BDIIALE

APPEND MODE           perform 4320-ARMAR-TEXTO-ALERTA

APPEND MODE           if EST-BDIIALE = "00"

APPEND MODE               perform 4333-REGRABAR-BDIIALE

APPEND MODE           else

APPEND MODE               perform 4333-GRABAR-BDIIALE

APPEND MODE           end-if.

APPEND MODE

APPEND MODE

APPEND MODE       4300-MODIFICAR-BDIIALE-E.

APPEND MODE      ******************************************************************

APPEND MODE      * Eliminacion de una alerta

APPEND MODE      * Si no existia muestra un mensaje y continua

APPEND MODE      ******************************************************************

APPEND MODE      *    elimina el registro

APPEND MODE           if EST-BDIIALE = "00"

APPEND MODE               perform 4333-ELIMINAR-BDIIALE

APPEND MODE           else

APPEND MODE               display "Eliminacion de alerta inexistente "

APPEND MODE               " key: " LLAVE-BDIIALE

APPEND MODE               display "Registro de input: "

APPEND MODE               display JURAD-reg

APPEND MODE               add 1 to N-ale-no-existe

APPEND MODE           end-if.

APPEND MODE

APPEND MODE

APPEND MODE       4333-LEER-BDIIALE-RANDOM.

APPEND MODE      ******************************************************************

APPEND MODE      * Arma clave exacta y lee un registro de BDIIALE

APPEND MODE      * Usa los datos del reg input, excepto LLASEC que esta precargado

APPEND MODE      * Cuando pudo leer OK el file status EST-BDIIALE queda con "00"

APPEND MODE      ******************************************************************

APPEND MODE           move JURAD-id-tipo to TIP-IDE-BDIIALE

APPEND MODE           move JURAD-id-numero to NUM-IDE-BDIIALE

APPEND MODE           move P-cod-suscriptor to FUENTE-BDIIALE

APPEND MODE           move 000 to COD-ALERTA-BDIIALE

APPEND MODE

APPEND MODE           read BDIIALE

APPEND MODE           evaluate EST-BDIIALE

APPEND MODE           when "00"

APPEND MODE               continue

APPEND MODE           when "20" thru "29"

APPEND MODE               continue

APPEND MODE           when other

APPEND MODE               display "Error al leer BDIIALE fs: " EST-BDIIALE

APPEND MODE               " key: " LLAVE-BDIIALE

APPEND MODE               display "Ultimo registro procesado: "

APPEND MODE               display JURAD-reg-anterior

APPEND MODE               perform 9000-CANCELAR-PROGRAMA

APPEND MODE           end-evaluate.

APPEND MODE

APPEND MODE

APPEND MODE       4333-GRABAR-BDIIALE.

APPEND MODE      ******************************************************************

APPEND MODE      * Inserta un registro nuevo en BDIIALE

APPEND MODE      ******************************************************************

APPEND MODE           if not PROCESO-REAL

APPEND MODE               exit paragraph

APPEND MODE           end-if

APPEND MODE           write REG-BDIIALE

APPEND MODE           evaluate EST-BDIIALE

APPEND MODE           when "00"

APPEND MODE               add 1 to N-ale-insertadas

APPEND MODE           when other

APPEND MODE               display "Error al grabar BDIIALE fs: " EST-BDIIALE

APPEND MODE               " key: " LLAVE-BDIIALE

APPEND MODE               display "Registro BDIIALE: "

APPEND MODE               display REG-BDIIALE

APPEND MODE               perform 9000-CANCELAR-PROGRAMA

APPEND MODE           end-evaluate.

APPEND MODE

APPEND MODE

APPEND MODE       4333-REGRABAR-BDIIALE.

APPEND MODE      ******************************************************************

APPEND MODE      * Regraba un registro modificado en BDIIALE

APPEND MODE      ******************************************************************

APPEND MODE           if not PROCESO-REAL

APPEND MODE               exit paragraph

APPEND MODE           end-if

APPEND MODE           rewrite REG-BDIIALE

APPEND MODE           evaluate EST-BDIIALE

APPEND MODE           when "00"

APPEND MODE               add 1 to N-ale-modificadas

APPEND MODE           when other

APPEND MODE               display "Error al regrabar BDIIALE fs: " EST-BDIIALE

APPEND MODE               " key: " LLAVE-BDIIALE

APPEND MODE               display "Registro BDIIALE: "

APPEND MODE               display REG-BDIIALE

APPEND MODE               perform 9000-CANCELAR-PROGRAMA

APPEND MODE           end-evaluate.

APPEND MODE

APPEND MODE

APPEND MODE       4333-ELIMINAR-BDIIALE.

APPEND MODE      ******************************************************************

APPEND MODE      * Elimina un registro de BDIIALE

APPEND MODE      ******************************************************************

APPEND MODE           if not PROCESO-REAL

APPEND MODE               exit paragraph

APPEND MODE           end-if

APPEND MODE           delete BDIIALE

APPEND MODE           evaluate EST-BDIIALE

APPEND MODE           when "00"

APPEND MODE               add 1 to N-ale-eliminadas

APPEND MODE           when other

APPEND MODE               display "Error al regrabar BDIIALE fs: " EST-BDIIALE

APPEND MODE               " key: " LLAVE-BDIIALE

APPEND MODE               display "Registro BDIIALE: "

APPEND MODE               display REG-BDIIALE

APPEND MODE               perform 9000-CANCELAR-PROGRAMA

APPEND MODE           end-evaluate.

APPEND MODE

APPEND MODE

APPEND MODE       4900-GRABAR-ERROR.

APPEND MODE      ******************************************************************

APPEND MODE      * El registro de JURAD tiene error: se graba en el archivo ERRS

APPEND MODE      * con indicacion del error detectado

APPEND MODE      ******************************************************************

APPEND MODE           move JURAD-reg to ERRS-reg

APPEND MODE      *    lista de los codigos de los errores del registro

APPEND MODE           move E-errores-reg to ERRS-causa-rechazo

APPEND MODE           write ERRS

APPEND MODE           evaluate ERRS-fs

APPEND MODE               when "00"

APPEND MODE                   continue

APPEND MODE               when other

APPEND MODE                   display "Error al grabar el archivo de errores "

APPEND MODE                   display "Nombre del archivo: " ERRS-file-name

APPEND MODE                   display "File status: " ERRS-fs

APPEND MODE                   perform 9000-CANCELAR-PROGRAMA

APPEND MODE                   goback

APPEND MODE           end-evaluate.

APPEND MODE 

APPEND MODE

APPEND MODE       4320-ARMAR-TEXTO-ALERTA.

APPEND MODE      ****************************************************************

APPEND MODE      * Hace el reemplazo de los valores adecuados en los templates

APPEND MODE      * de las linea de alerta que corresponde

APPEND MODE      ****************************************************************

APPEND MODE      *    segun se trate de demandas o embargos

APPEND MODE           if JURAD-demandas-vigentes not = 0 

APPEND MODE           or JURAD-demandas-terminadas not = 0

APPEND MODE               set LAx to 1

APPEND MODE               move high-values to LA-valores

APPEND MODE               move JURAD-demandas-vigentes to LA-num

APPEND MODE      * >>>> esto esta anulado x que no se como hacer para que lo compile

APPEND MODE      *        unstring LA-numX into LA-descarte LA-valor(1)

APPEND MODE      *        delimited by all space

APPEND MODE               move LA-numx(9:12) to LA-valor(1)

APPEND MODE               move JURAD-demandas-terminadas to LA-num

APPEND MODE      * >>>> esto esta anulado x que no se como hacer para que lo compile

APPEND MODE      *        unstring LA-numX into LA-descarte LA-valor(2)

APPEND MODE      *        delimited by all space

APPEND MODE               move LA-numx(9:12) to LA-valor(2)

APPEND MODE

APPEND MODE      * >>>> esto esta anulado x que no se como hacer para que lo compile

APPEND MODE      * >>>> da error en el end-if

APPEND MODE      *        string LA-parte(LAx, 1) LA-valor(1)

APPEND MODE      *        LA-parte(LAx, 2) LA-valor(2) LA-parte(LAx, 3) LA-valor(3)

APPEND MODE      *        LA-parte(LAx, 4) LA-valor(4) LA-parte(LAx, 5) LA-valor(5)

APPEND MODE      *        LA-parte(LAx, 6) LA-valor(6) LA-parte(LAx, 7) LA-valor(7)

APPEND MODE      *        LA-parte(LAx, 8) LA-valor(8) LA-parte(LAx, 9) LA-valor(9)

APPEND MODE      *        LA-parte(LAx, 10) LA-valor(10)

APPEND MODE      *        delimited by high-value

APPEND MODE           end-if.

APPEND MODE

APPEND MODE

APPEND MODE       1000-RUTINA-INICIAL.

APPEND MODE      ******************************************************************

APPEND MODE      * Todas las operaciones que se realizan una sola vez, al comienzo

APPEND MODE      * del programa:

APPEND MODE      *   - obtencion de los parametros

APPEND MODE      *   - apertura del archivo de entrada

APPEND MODE      *   - apertura de todos los demas archivos

APPEND MODE      *   - eliminacion de datos existentes si es refresque completo

APPEND MODE      ******************************************************************

APPEND MODE      * Registra hora de inicio

APPEND MODE           accept W-hora-inicio from time

APPEND MODE

APPEND MODE      * Obtiene informacion sobre la corrida de la linea de comando: el

APPEND MODE      * nombre del archivo de entrada (que contiene el tipo de proceso),

APPEND MODE      * el indicador de proceso real o en falso (default)

APPEND MODE           accept P-command-line from COMMAND-LINE

APPEND MODE           display "Parametros: " P-command-line

APPEND MODE           unstring P-command-line delimited by all " " into

APPEND MODE           P-file-name P-proceso-real

APPEND MODE

APPEND MODE      * El programa se anuncia en la consola

APPEND MODE      * TODO: se usa un anuncio mas vistoso

APPEND MODE           if PROCESO-REAL

APPEND MODE               display pgm " Carga de archivo JURAD - proceso REAL"

APPEND MODE           else

APPEND MODE               display pgm " Carga de archivo JURAD - proceso en falso"

APPEND MODE           end-if

APPEND MODE

APPEND MODE      * El indicador de proceso real debe ser SI|si|NO|no

APPEND MODE           if P-proceso-real not = "SI" and "NO" ans "si" and "no"

APPEND MODE               display "El indicador de proceso real es invalido"

APPEND MODE               display "debe ser ""SI"" o ""NO"""

APPEND MODE               perform 9000-CANCELAR-PROGRAMA

APPEND MODE           end-if

APPEND MODE

APPEND MODE      * TODO: controlar los componentes del filename

APPEND MODE           evaluate P-tipo-proceso

APPEND MODE           when "01"

APPEND MODE               display "01 Envio Original - Carga TOTAL 1a vez"

APPEND MODE           when "02"

APPEND MODE               display "02 Archivo Semanal - Carga PARCIAL"

APPEND MODE           when "03"

APPEND MODE               display "03 Archivo Mensual - Carga PARCIAL"

APPEND MODE           when "04"

APPEND MODE               display "04 Refresque Total - Carga TOTAL"

APPEND MODE           when other

APPEND MODE      *        valor invalido

APPEND MODE               display "El tipo de proceso " P-tipo-proceso

APPEND MODE               " es invalido (debe ser 01 02 03 o 04)"

APPEND MODE               perform 9000-CANCELAR-PROGRAMA

APPEND MODE           end-evaluate.

APPEND MODE

APPEND MODE      * Edita la fecha de proceso DDMMAA del parametro en formato

APPEND MODE      * YYYYMMDD 

APPEND MODE           string "20" P-fecha-proceso(5:6) P-fecha-proceso(3:4)

APPEND MODE           P-fecha-proceso(1:2) delimited size 

APPEND MODE           into P-fecha-proceso-YYYYMMDD

APPEND MODE           dusplay "Fecha de proceso: " P-fecha-proceso-YYYYMMDD

APPEND MODE

APPEND MODE      * Calcula una fecha 50 anios posterior a la de proceso

APPEND MODE           move P-fecha-proceso-YYYYMMDD to P-fecha-proceso-50

APPEND MODE           add 50 to P-fecha-proceso-50YYYY

APPEND MODE

APPEND MODE      * Apertura del archivo de entrada

APPEND MODE           open input JURAD

APPEND MODE           evaluate JURAD-fs

APPEND MODE               when "00"

APPEND MODE                    continue

APPEND MODE               when other

APPEND MODE                   display "Error en open del archivo jurad "

APPEND MODE                   display "Nombre del archivo: " P-file-name

APPEND MODE                   display "File status: " JURAD-fs

APPEND MODE                   perform 9000-CANCELAR-PROGRAMA *> no retorna

APPEND MODE                   goback

APPEND MODE           end-evaluate.

APPEND MODE

APPEND MODE      * Apertura del archivo de errores

APPEND MODE           string P-file-name(1:19) "_ERRORES.txt" into

APPEND MODE           ERRS-file-name

APPEND MODE           open output ERRS

APPEND MODE           evaluate ERRS-fs

APPEND MODE               when "00"

APPEND MODE                    continue

APPEND MODE               when other

APPEND MODE                   display "Error en open del archivo de errores "

APPEND MODE                   display "Nombre del archivo: " ERRS-file-name

APPEND MODE                   display "File status: " ERRS-fs

APPEND MODE                   perform 9000-CANCELAR-PROGRAMA *> no retorna

APPEND MODE                   goback

APPEND MODE           end-evaluate.

APPEND MODE

APPEND MODE      * Apertura de los archivos maestros

APPEND MODE      * TODO: falta capturar el status de estas operaciones?

APPEND MODE           open input BDIIREGI

APPEND MODE           open input BDIIDIAN

APPEND MODE           open input BDIIDAS.

APPEND MODE

APPEND MODE      * Apertura del archivo de alertas en linea

APPEND MODE           if PROCESO-REAL

APPEND MODE               open i-o BDIIALE

APPEND MODE           else

APPEND MODE               open input BDIIALE

APPEND MODE           end-if.

APPEND MODE

APPEND MODE      * Si es un refresque total (codigo 04) se eliminan los registros

APPEND MODE      * de Jurad existentes

APPEND MODE           if P-tipo-proceso = "04" and PROCESO-REAL

APPEND MODE               perform 1001-ELIMINAR-TODO

APPEND MODE           end-if.

APPEND MODE

APPEND MODE       1000-NOT-USED.

APPEND MODE      * >>>> esto da un error de compilacion que no puedo resolver

APPEND MODE      * >>>> por ahora esta anulado

APPEND MODE      ******************************************************************

APPEND MODE      * Carga de los templates para armar el texto de alertas

APPEND MODE      * TODO: por ahora los templates son literales

APPEND MODE           set LAx to 0

APPEND MODE           move high-values to LA-templates

APPEND MODE           perform varying LAm from 1 by 1 

APPEND MODE           until LA-modelo(LAm) = high-values

APPEND MODE               set LAx up by 1

APPEND MODE      *        separa las partes de la linea

APPEND MODE      *        unstring LA-modelo(LAm) into LA-parte(LAx, 1)

APPEND MODE      *        LA-parte(LAx, 2) LA-parte(LAx, 3) LA-parte(LAx, 4)

APPEND MODE      *        LA-parte(LAx, 5) LA-parte(LAx, 6) LA-parte(LAx, 7)

APPEND MODE      *        LA-parte(LAx, 8) LA-parte(LAx, 9) LA-parte(LAx, 10)

APPEND MODE      *        delimited by all "&"

APPEND MODE      *        prepara para omitir los espacios al final de c/parte

APPEND MODE               perform varying LAy from 1 by 1 until LAy > 10

APPEND MODE                   inspect LA-parte(LAx, LAy) replacing trailing

APPEND MODE                   spaces by high-values

APPEND MODE                   inspect LA-parte(LAx, LAy) replacing first

APPEND MODE                   high-value by space

APPEND MODE               end-perform

APPEND MODE           end-perform.

APPEND MODE

APPEND MODE

APPEND MODE

APPEND MODE       1001-ELIMINAR-TODO.

APPEND MODE      ******************************************************************

APPEND MODE      * Elimina los registros de alertas existentes en el archivo de

APPEND MODE      * alertas en linea, previo a un refresque total

APPEND MODE      ******************************************************************

APPEND MODE           display "Eliminando toda la informacion con fuente JURAD"

APPEND MODE      *    posiciona en el primer reg de JURAD

APPEND MODE           move zero to TIP-IDE-BDIIALE

APPEND MODE           move zero to NUM-IDE-BDIIALE

APPEND MODE           move P-cod-suscriptor to FUENTE-BDIIALE

APPEND MODE           move zeros to COD-ALERTA-BDIIALE

APPEND MODE           move low-values to LLASEC-BDIIALE

APPEND MODE           start BDIIALE key > LLAVE-BDIIALE invalid key

APPEND MODE      *        no hay registros

APPEND MODE               exit paragraph

APPEND MODE

APPEND MODE      *    lee secuencialmente y elimina los registros de JURAD

APPEND MODE      *    hasta el fin del archivo

APPEND MODE           perform until EST-BDIIALE not = "00"

APPEND MODE               read BDIIALE next record

APPEND MODE               evaluate EST-BDIIALE

APPEND MODE               when "00"

APPEND MODE                   if FUENTE-BDIIALE = P-cod-suscriptor

APPEND MODE      *                es un alerta de JURAD

APPEND MODE                       delete BDIIALE

APPEND MODE                       if EST-BDIIALE = "00"

APPEND MODE                           add 1 to N-ale-borradas

APPEND MODE                       else

APPEND MODE      *                    error en la eliminacion

APPEND MODE                           display "Error al eliminar un registro de "

APPEND MODE                           "BDIIALE vaciando los datos"

APPEND MODE                           display "Clave: " LLAVE-BDIIALE

APPEND MODE                           display "Reg borrados: " N-ale-borradas

APPEND MODE                           perform 9000-CANCELAR-PROGRAMA

APPEND MODE                       end-if

APPEND MODE                   end-if

APPEND MODE               when "10"

APPEND MODE      *            fin de archivo: sale normalmente

APPEND MODE                   continue

APPEND MODE               when other

APPEND MODE      *            lectura anormal: cancelacion del programa

APPEND MODE                   display "Error en lectura del archivo de alertas "

APPEND MODE                   "online"

APPEND MODE                   display "File status: " EST-BDIIALE

APPEND MODE                   perform 9000-CANCELAR-PROGRAMA *> no retorna

APPEND MODE               end-evaluate

APPEND MODE           end-perform.

APPEND MODE           display "Termino la eliminacion total de JURAD"

APPEND MODE           display "Reg borrados: " N-ale-borradas. 

APPEND MODE

APPEND MODE

APPEND MODE       7000-RUTINA-FINAL.

APPEND MODE      ******************************************************************

APPEND MODE      * Registra hora de finalizacion

APPEND MODE           accept W-hora-fin from time

APPEND MODE

APPEND MODE      * Leer JURAD a ver si hay registros despues del "T"

APPEND MODE

APPEND MODE      * Close todos los archivos

APPEND MODE           close JURAD ERRS BDIIREGI BDIIDIAN BDIIDAS BDIIALE.

APPEND MODE      

APPEND MODE      * Emision de contadores de registros

APPEND MODE           display " "

APPEND MODE           display "Totales de registros:"

APPEND MODE           move N-reg-leidos to N-edit 

APPEND MODE           display N-edit "Registros IME en el archivo de entrada"

APPEND MODE           move N-reg-OK to N-edit 

APPEND MODE           display N-edit "Registros procesados sin error"

APPEND MODE

APPEND MODE           move N-reg-tipo-I-OK to N-edit

APPEND MODE           display N-edit "Registros tipo I aceptados"

APPEND MODE           move N-reg-tipo-M-OK to N-edit

APPEND MODE           display N-edit "Registros tipo M aceptados"

APPEND MODE           move N-reg-tipo-E-OK to N-edit

APPEND MODE           display N-edit "Registros tipo E aceptados"

APPEND MODE

APPEND MODE           move E-cont-regs-con-error to N-reg-con-error

APPEND MODE           move N-reg-con-error to N-edit 

APPEND MODE           display N-edit "Registros con error"

APPEND MODE           move N-ale-borradas to N-edit 

APPEND MODE           display N-edit "Alertas borradas previo al refresque total"

APPEND MODE           move N-ale-insertadas to N-edit 

APPEND MODE           display N-edit "Alertas insertadas"

APPEND MODE           move N-ale-modificadas to N-edit 

APPEND MODE           display N-edit "Alertas modificadas"

APPEND MODE           move N-ale-eliminadas to N-edit 

APPEND MODE           display N-edit "Alertas eliminadas"

APPEND MODE           move N-ale-ya-existe to N-edit 

APPEND MODE           display N-edit "Insercion de alerta existente"

APPEND MODE           move N-ale-no-existe to N-edit 

APPEND MODE           display N-edit "Modif o elim de alerta inexistente".

APPEND MODE

APPEND MODE      * Emision del reporte de errores

APPEND MODE           display " "

APPEND MODE           display "Totales por tipo de error detectado:"

APPEND MODE           perform varying Ex from 1 by 1 until Ex > 50

APPEND MODE           or E-codigo(Ex) = "00"

APPEND MODE               if E-contador(Ex) not = 0 

APPEND MODE                   move E-contador(ex) to E-edit

APPEND MODE                   display E-edit E-codigo(Ex) "-" E-descripcion(Ex)

APPEND MODE               end-if

APPEND MODE           end-perform.

APPEND MODE

APPEND MODE

APPEND MODE       9000-CANCELAR-PROGRAMA.

APPEND MODE      ******************************************************************

APPEND MODE      * Procedimiento standard de cancelacion de programa batch

APPEND MODE      ******************************************************************

APPEND MODE      * TODO: hay un standard para comunicar una cancelacion de proceso?

APPEND MODE           display " "

APPEND MODE           display pgm " - proceso cancelado"

APPEND MODE           goback returning 99.

APPEND MODE

APPEND MODE

APPEND MODE           copy BDIIVIDE.PROC.

APPEND MODE

APPEND MODE

APPEND MODE           copy VALNOM.PROC.

APPEND MODE

APPEND MODE

APPEND MODE      /

APPEND MODE       IDENTIFICATION DIVISION.

APPEND MODE       PROGRAM-ID. PONERR.

APPEND MODE      ******************************************************************

APPEND MODE      * Rutina de conveniencia para procesar un error detectado en un

APPEND MODE      * registro de input

APPEND MODE      * Contabiliza el error en la tabla de errores, activa el indicador

APPEND MODE      * de registro con error, muestra el mensaje en la pantalla, cuenta

APPEND MODE      * el registro erroneo

APPEND MODE      ******************************************************************

APPEND MODE       ENVIRONMENT DIVISION.

APPEND MODE       DATA DIVISION.

APPEND MODE       WORKING-STORAGE SECTION.

APPEND MODE      ******************************************************************

APPEND MODE      * Registro de input (primeros 86 caracteres)

APPEND MODE       01  reg-input-anterior           pic x(86) value low-values.

APPEND MODE      * Posicion del proximo error en la lista de errores del reg

APPEND MODE       01  errIndex                     pic 999 comp.

APPEND MODE      ******************************************************************

APPEND MODE

APPEND MODE       LINKAGE SECTION.

APPEND MODE      ******************************************************************

APPEND MODE      * Codigo del error detectado

APPEND MODE       01  cod-error                    pic xx.

APPEND MODE      ******************************************************************

APPEND MODE      * Registro de input (primeros 86 caracteres)

APPEND MODE       01  reg-input                    pic x(86).

APPEND MODE      ******************************************************************

APPEND MODE      * Tabla de errores de consistencia del input

APPEND MODE       01 E-errores.

APPEND MODE      *    indica si el registro actual tiene error

APPEND MODE           03 E-hay-error               pic xx.

APPEND MODE      *    errores del registro actual

APPEND MODE           03 E-errores-reg             pic x(100).

APPEND MODE      *    contador de registros con error

APPEND MODE           03 E-cont-regs-con-error     pic 9(8).

APPEND MODE      *    tabla de errores

APPEND MODE           03 E-error                   occurs 50 indexed Ex.

APPEND MODE               05 E-codigo              pic xx.

APPEND MODE               05                       pic x.

APPEND MODE               05 E-contador            pic 9(7).

APPEND MODE               05                       pic x.

APPEND MODE               05 E-descripcion         pic x(59).

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE

APPEND MODE       PROCEDURE DIVISION using cod-error reg-input E-errores.

APPEND MODE       00.

APPEND MODE      *    marca al reg actual como erroneo

APPEND MODE           move "SI" to E-hay-error

APPEND MODE

APPEND MODE      *    cuenta y muestra el registro de input

APPEND MODE           if reg-input(1:86) not = reg-input-anterior

APPEND MODE               add 1 to E-cont-regs-con-error

APPEND MODE               display " "

APPEND MODE               display reg-input(1:86)

APPEND MODE               move reg-input(1:86) to reg-input-anterior

APPEND MODE               move spaces to E-errores

APPEND MODE           end-if

APPEND MODE

APPEND MODE      *    contabiliza el error en la tabla de errores

APPEND MODE           set Ex to 1

APPEND MODE           search E-error varying Ex

APPEND MODE           at end

APPEND MODE               display "--- falla en la tabla de errores ---" cod-error

APPEND MODE           when E-codigo(Ex) = "00"

APPEND MODE               add 1 to E-contador(Ex)

APPEND MODE               display "--- error tipo exotico: " cod-error

APPEND MODE           when E-codigo(Ex) = cod-error

APPEND MODE               add 1 to E-contador(Ex)

APPEND MODE               display "Error " cod-error " " E-descripcion(Ex)

APPEND MODE           end-search

APPEND MODE

APPEND MODE      *    agrega a la lista de errores del registro

APPEND MODE           if errIndex < 99

APPEND MODE               move cod-error to E-errores(errIndex:2)

APPEND MODE               add 3 to errindex

APPEND MODE           end-if

APPEND MODE

APPEND MODE           exit program.

APPEND MODE

APPEND MODE

APPEND MODE       end program PONERR.

APPEND MODE

APPEND MODE       end program ACTALEJUR.

APPEND MODE

APPEND MODE      ******************************************************************

APPEND MODE      ******************************************************************

APPEND MODE

:w"CARGAJUR.CBL" 1226 lines, 51879 characters 
[1] + Stopped (SIGTSTP)        vi CARGAJUR.CBL
/d/iccol/desarrollo $^[  /d/iccol/desarrollo $fgx CARGAJUR 9999991000905140101.txt/d/iccol/desarrollo $des-c-v CARGAJUR                  /d/iccol/desarrollo $
Ejecucion de la macro de compilacion cobol para desarrollo
cob64 -C nolist -CC -KPIC -A -KPIC -N PIC -uv -g -P -C sourceasm /d/iccol/desarrollo/fuentes/CARGAJUR.CBL 
* Micro Focus Server Express         V5.1 revision 000           Compiler
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
* Accepted - VERBOSE
* Accepted - NOANIM
* Accepted - NOBOUND
* Accepted - NOALTER
* Accepted - COMP
* Accepted - TRUNC
* Accepted - int("CARGAJUR.int")
* Accepted - anim
* Accepted - csi
* Accepted - verbose
* Accepted - nolist
* Accepted - sourceasm
* Accepted - list("CARGAJUR.lst")
* Compiling /d/iccol/desarrollo/fuentes/CARGAJUR.CBL
".............COMPILANDO BDIIREGI SIN STATUS.........."
".............COMPILANDO BDIIDIAN SIN STATUS.........."
".............COMPILANDO BDIIDAS SIN STATUS.........."
".............COMPILANDO BDIIALE SIN STATUS.........."
* Total Messages:     4
* Unrecoverable :     0                    Severe  :     4
* Errors        :     0                    Warnings:     0
* Informational :     0                    Flags   :     0
* Data:       23580     Code:           0

>>> DATACREDITO: ** COMPILANDO CARGAJUR.CBL HUBO ERRORES...
** ESTAN EN EL ARCHIVO CARGAJUR.CBL.err


/d/iccol/desarrollo $^[  /d/iccol/desarrollo $des-c-v CARGAJURfg              x CARGAJUR 9999991000905140101.txt/d/iccol/desarrollo $des-c-v CARGAJUR                  /d/iccol/desarrollo $fg              cat  CARGAJUR.CBL.err
* Rejected - OPT
  1588     write ERRS
* 330-S**************                                                  (   0)**
**    Not a record name
  1663     if P-proceso-real not = "SI" and "NO" ans "si" and "no"
*  54-S*********************************************                   (  29)**
**    Class name required
  1667     end-if
* 564-S**********                                                      (  30)**
**    A scope-delimiter did not have a matching verb and was discarded.
  1691     dusplay "Fecha de proceso: " P-fecha-proceso-YYYYMMDD
* 301-S***********                                                     (  30)**
**    Unrecognized verb
cob64: error(s) in compilation: /d/iccol/desarrollo/fuentes/CARGAJUR.CBL
/d/iccol/desarrollo $fg
vi CARGAJUR.CBL
05 E-contadorpic 9(7).05pic x.05 E-descripcionpic x(59).******************************************************************PROCEDURE DIVISION using cod-error reg-input E-errores.
00.
*    marca al reg actual como erroneomove "SI" to E-hay-error*    cuenta y muestra el registro de inputif reg-input(1:86) not = reg-input-anterioradd 1 to E-cont-regs-con-errordisplay " "
display reg-input(1:86)move reg-input(1:86) to reg-input-anteriormove spaces to E-erroresend-if*    contabiliza el error en la tabla de erroresset Ex to 1
search E-error varying Exat end
display "--- falla en la tabla de errores ---" cod-errorwhen E-codigo(Ex) = "00"add 1 to E-contador(Ex)display "--- error tipo exotico: " cod-errorwhen E-codigo(Ex) = cod-erroradd 1 to E-contador(Ex)display "Error " cod-error " " E-descripcion(Ex)end-search*    agrega a la lista de errores del registroif errIndex < 99
move cod-error to E-errores(errIndex:2)add 3 to errindexend-if

exit program.end program PONERR.end program ACTALEJUR.******************************************************************
******************************************************************
$SET LIST SETTINGIDENTIFICATION DIVISION.
PROGRAM-ID.    ACTALEJUR.
******************************************************************
* Actualizacion del archivo de alertas con los datos provistos
* por Jurad
* Procesa el archivo JURAD. Controla cada registro: si es OK usa
* los datos para actualizar BDIIALE, si tiene defecto lo graba en
* el archivo ERRS.
******************************************************************
AUTHOR.Globant JL.
DATE-WRITTEN.
DATE-COMPILED.
CONFIGURATION section.
SOURCE-COMPUTER. microfocus.
OBJECT-COMPUTER. microfocus.
INPUT-OUTPUT section.
FILE-CONTROL.******************************************************************
******************************************************************
select JURAD assign to P-file-nameorganization is line sequentialfile status is JURAD-fs.******************************************************************
******************************************************************
select ERRS assign to ERRS-file-nameorganization is line sequentialfile status is ERRS-fs.******************************************************************
******************************************************************copy BDIIREGI.FS.
* TODO: debe compilar con file status******************************************************************
******************************************************************
copy BDIIDIAN.FS.******************************************************************
******************************************************************
copy BDIIDAS.FS.******************************************************************
******************************************************************copy BDIIALE.FS replacing == on record.== by == on recordfile status is EST-BDIIALE.==./write errsexit paragraphend-if
delete BDIIALEevaluate EST-BDIIALEwhen "00"
add 1 to N-ale-eliminadaswhen other
display "Error al regrabar BDIIALE fs: " EST-BDIIALE" key: " LLAVE-BDIIALEdisplay "Registro BDIIALE: "display REG-BDIIALEperform 9000-CANCELAR-PROGRAMAend-evaluate.4900-GRABAR-ERROR.
******************************************************************
* El registro de JURAD tiene error: se graba en el archivo ERRS
* con indicacion del error detectado
******************************************************************move JURAD-reg to ERRS-reg
*    lista de los codigos de los errores del registromove E-errores-reg to ERRS-causa-rechazowrite ERRS
evaluate ERRS-fs
when "00"
continue
when other
display "Error al grabar el archivo de errores "display "Nombre del archivo: " ERRS-file-namedisplay "File status: " ERRS-fsperform 9000-CANCELAR-PROGRAMAgobackend-evaluate.4320-ARMAR-TEXTO-ALERTA.
****************************************************************
* Hace el reemplazo de los valores adecuados en los templates
* de las linea de alerta que corresponde
****************************************************************
*    segun se trate de demandas o embargosif JURAD-demandas-vigentes not = 0or JURAD-demandas-terminadas not = 0set LAx to 1
move high-values to LA-valoresmove JURAD-demandas-vigentes to LA-num
* >>>> esto esta anulado x que no se como hacer para que lo compile
*unstring LA-numX into LA-descarte LA-valor(1)SAPPEND MODE-reg/\<ans\>*   - apertura de todos los demas archivos*   - eliminacion de datos existentes si es refresque completo
******************************************************************
* Registra hora de inicioaccept W-hora-inicio from time* Obtiene informacion sobre la corrida de la linea de comando: el
* nombre del archivo de entrada (que contiene el tipo de proceso),
* el indicador de proceso real o en falso (default)accept P-command-line from COMMAND-LINEdisplay "Parametros: " P-command-lineunstring P-command-line delimited by all " " intoP-file-name P-proceso-real* El programa se anuncia en la consola
* TODO: se usa un anuncio mas vistosoif PROCESO-REAL
display pgm " Carga de archivo JURAD - proceso REAL"else
display pgm " Carga de archivo JURAD - proceso en falso"end-if* El indicador de proceso real debe ser SI|si|NO|noif P-proceso-real not = "SI" and "NO" ans "si" and "no"display "El indicador de proceso real es invalido"display "debe ser ""SI"" o ""NO"""perform 9000-CANCELAR-PROGRAMAend-if* TODO: controlar los componentes del filenameevaluate P-tipo-procesowhen "01"
display "01 Envio Original - Carga TOTAL 1a vez"when "02"
display "02 Archivo Semanal - Carga PARCIAL"when "03"
display "03 Archivo Mensual - Carga PARCIAL"when "04"
display "04 Refresque Total - Carga TOTAL"when other
*valor invalido
display "El tipo de proceso " P-tipo-proceso" es invalido (debe ser 01 02 03 o 04)"perform 9000-CANCELAR-PROGRAMAend-evaluate.* Edita la fecha de proceso DDMMAA del parametro en formato
* YYYYMMDD
string "20" P-fecha-proceso(5:6) P-fecha-proceso(3:4)P-fecha-proceso(1:2) delimited size
into P-fecha-proceso-YYYYMMDD
dusplay "Fecha de proceso: " P-fecha-proceso-YYYYMMDD

* Calcula una fecha 50 anios posterior a la de proceso
move P-fecha-proceso-YYYYMMDD to P-fecha-proceso-50
add 50 to P-fecha-proceso-50YYYY

* Apertura del archivo de entradadisplay "02 Archivo Semanal - Carga PARCIAL"when "03"
display "03 Archivo Mensual - Carga PARCIAL"when "04"
display "04 Refresque Total - Carga TOTAL"when other
*valor invalido
display "El tipo de proceso " P-tipo-proceso" es invalido (debe ser 01 02 03 o 04)"perform 9000-CANCELAR-PROGRAMAend-evaluate.* Edita la fecha de proceso DDMMAA del parametro en formato
* YYYYMMDD
string "20" P-fecha-proceso(5:6) P-fecha-proceso(3:4)P-fecha-proceso(1:2) delimited sizeinto P-fecha-proceso-YYYYMMDDdusplay "Fecha de proceso: " P-fecha-proceso-YYYYMMDD* Calcula una fecha 50 anios posterior a la de procesomove P-fecha-proceso-YYYYMMDD to P-fecha-proceso-50add 50 to P-fecha-proceso-50YYYY* Apertura del archivo de entradaopen input JURADevaluate JURAD-fs
when "00"
continue
when other
display "Error en open del archivo jurad "display "Nombre del archivo: " P-file-namedisplay "File status: " JURAD-fsperform 9000-CANCELAR-PROGRAMA *> no retornagobackend-evaluate.* Apertura del archivo de erroresstring P-file-name(1:19) "_ERRORES.txt" intoERRS-file-nameopen output ERRSevaluate ERRS-fs
when "00"
continue
when other
display "Error en open del archivo de errores "display "Nombre del archivo: " ERRS-file-namedisplay "File status: " ERRS-fsperform 9000-CANCELAR-PROGRAMA *> no retornagobackperform 9000-CANCELAR-PROGRAMA *> no retornagobackend-evaluate.* Apertura de los archivos maestros
* TODO: falta capturar el status de estas operaciones?open input BDIIREGIopen input BDIIDIANopen input BDIIDAS.* Apertura del archivo de alertas en lineaif PROCESO-REAL
open i-o BDIIALEelse
open input BDIIALEend-if.* Si es un refresque total (codigo 04) se eliminan los registros
* de Jurad existentesif P-tipo-proceso = "04" and PROCESO-REALperform 1001-ELIMINAR-TODOend-if.1000-NOT-USED.
* >>>> esto da un error de compilacion que no puedo resolver
* >>>> por ahora esta anulado
******************************************************************
* Carga de los templates para armar el texto de alertas
* TODO: por ahora los templates son literalesset LAx to 0
move high-values to LA-templatesperform varying LAm from 1 by 1until LA-modelo(LAm) = high-valuesset LAx up by 1
*separa las partes de la linea
*unstring LA-modelo(LAm) into LA-parte(LAx, 1)
*LA-parte(LAx, 2) LA-parte(LAx, 3) LA-parte(LAx, 4)
*LA-parte(LAx, 5) LA-parte(LAx, 6) LA-parte(LAx, 7)
*LA-parte(LAx, 8) LA-parte(LAx, 9) LA-parte(LAx, 10)
*delimited by all "&"
*prepara para omitir los espacios al final de c/parteperform varying LAy from 1 by 1 until LAy > 10inspect LA-parte(LAx, LAy) replacing trailingspaces by high-valuesinspect LA-parte(LAx, LAy) replacing firsthigh-value by spaceend-performend-perform.display "02 Archivo Semanal - Carga PARCIAL"when "03"
display "03 Archivo Mensual - Carga PARCIAL"when "04"
display "04 Refresque Total - Carga TOTAL"when other
*valor invalido
display "El tipo de proceso " P-tipo-proceso" es invalido (debe ser 01 02 03 o 04)"perform 9000-CANCELAR-PROGRAMAend-evaluate.* Edita la fecha de proceso DDMMAA del parametro en formato
* YYYYMMDD
string "20" P-fecha-proceso(5:6) P-fecha-proceso(3:4)P-fecha-proceso(1:2) delimited sizeinto P-fecha-proceso-YYYYMMDDdusplay "Fecha de proceso: " P-fecha-proceso-YYYYMMDD* Calcula una fecha 50 anios posterior a la de procesomove P-fecha-proceso-YYYYMMDD to P-fecha-proceso-50add 50 to P-fecha-proceso-50YYYY* Apertura del archivo de entradaopen input JURADevaluate JURAD-fs
when "00"
continue
when other
display "Error en open del archivo jurad "display "Nombre del archivo: " P-file-namedisplay "File status: " JURAD-fsperform 9000-CANCELAR-PROGRAMA *> no retornagobackend-evaluate.* Apertura del archivo de erroresstring P-file-name(1:19) "_ERRORES.txt" intoERRS-file-nameopen output ERRSevaluate ERRS-fs
when "00"
continue
when other
display "Error en open del archivo de errores "display "Nombre del archivo: " ERRS-file-namedisplay "File status: " ERRS-fsperform 9000-CANCELAR-PROGRAMA *> no retornagoback*LA-parte(LAx, 6) LA-valor(6) LA-parte(LAx, 7) LA-valor(7)*LA-parte(LAx, 8) LA-valor(8) LA-parte(LAx, 9) LA-valor(9)
*LA-parte(LAx, 10) LA-valor(10)
*delimited by high-valueend-if.1000-RUTINA-INICIAL.
******************************************************************
* Todas las operaciones que se realizan una sola vez, al comienzo
* del programa:
*   - obtencion de los parametros
*   - apertura del archivo de entrada
*   - apertura de todos los demas archivos
*   - eliminacion de datos existentes si es refresque completo
******************************************************************
* Registra hora de inicioaccept W-hora-inicio from time* Obtiene informacion sobre la corrida de la linea de comando: el
* nombre del archivo de entrada (que contiene el tipo de proceso),
* el indicador de proceso real o en falso (default)accept P-command-line from COMMAND-LINEdisplay "Parametros: " P-command-lineunstring P-command-line delimited by all " " intoP-file-name P-proceso-real* El programa se anuncia en la consola
* TODO: se usa un anuncio mas vistosoif PROCESO-REAL
display pgm " Carga de archivo JURAD - proceso REAL"else
display pgm " Carga de archivo JURAD - proceso en falso"end-if* El indicador de proceso real debe ser SI|si|NO|noif P-proceso-real not = "SI" and "NO"display "El indicador de proceso real es invalido"display "debe ser ""SI"" o ""NO"""perform 9000-CANCELAR-PROGRAMAend-if* TODO: controlar los componentes del filenameevaluate P-tipo-procesowhen "01"
display "01 Envio Original - Carga TOTAL 1a vez"when "02"
display "02 Archivo Semanal - Carga PARCIAL"when "03"
    SI o NO/dusplaydisplay "03 Archivo Mensual - Carga PARCIAL"
when "04"
display "04 Refresque Total - Carga TOTAL"
when other
*valor invalido
display "El tipo de proceso " P-tipo-proceso
" es invalido (debe ser 01 02 03 o 04)"
perform 9000-CANCELAR-PROGRAMA
end-evaluate.

* Edita la fecha de proceso DDMMAA del parametro en formato
* YYYYMMDD
string "20" P-fecha-proceso(5:6) P-fecha-proceso(3:4)
P-fecha-proceso(1:2) delimited size
into P-fecha-proceso-YYYYMMDD
dusplay "Fecha de proceso: " P-fecha-proceso-YYYYMMDD
REPLACE MODEdi

:w"CARGAJUR.CBL" 1226 lines, 51857 characters 
[1] + Stopped (SIGTSTP)        vi CARGAJUR.CBL
/d/iccol/desarrollo $^[  /d/iccol/desarrollo $fgcat  CARGAJUR.CBL.errdes-c-v CARGAJUR     
Ejecucion de la macro de compilacion cobol para desarrollo
cob64 -C nolist -CC -KPIC -A -KPIC -N PIC -uv -g -P -C sourceasm /d/iccol/desarrollo/fuentes/CARGAJUR.CBL 
* Micro Focus Server Express         V5.1 revision 000           Compiler
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
* Accepted - VERBOSE
* Accepted - NOANIM
* Accepted - NOBOUND
* Accepted - NOALTER
* Accepted - COMP
* Accepted - TRUNC
* Accepted - int("CARGAJUR.int")
* Accepted - anim
* Accepted - csi
* Accepted - verbose
* Accepted - nolist
* Accepted - sourceasm
* Accepted - list("CARGAJUR.lst")
* Compiling /d/iccol/desarrollo/fuentes/CARGAJUR.CBL
".............COMPILANDO BDIIREGI SIN STATUS.........."
".............COMPILANDO BDIIDIAN SIN STATUS.........."
".............COMPILANDO BDIIDAS SIN STATUS.........."
".............COMPILANDO BDIIALE SIN STATUS.........."
* Total Messages:     0
* Data:       23800     Code:       23753
* Micro Focus Server Express V5.1.00 Code Generator
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
* Accepted - verbose
* Accepted - anim
* Accepted - PIC
* Generating CARGAJUR
* Data:     23536  Code:     45412  Literals:      2056  Dynamic:   1441792

>>> DATACREDITO: TERMINO OK COMPILACION DE CARGAJUR.CBL

/d/iccol/desarrollo $^[  /d/iccol/desarrollo $des-c-v CARGAJURfg              cat  CARGAJUR.CBL.errdes-c-v CARGAJUR     fg              x CARGAJUR 9999991000905140101.txt/d/iccol/desarrollo $
Parametros: 9999991000905140101.txt                                                         
CARGAJUR   Carga de archivo JURAD - proceso en falso
01 Envio Original - Carga TOTAL 1a vez
Fecha de proceso: 20140101
 
I100000149123JOSE MISAEL AREVALO SANCHEZ                  0010012013040500905720130411
--- falla en la tabla de errores ---14
 
I100000262135LIBARDO ANTONIO GARZON TORRE                 0150202013020602204520120406
--- falla en la tabla de errores ---14
 
I100000958212LUIS GUILLERMO AVENDAnO RODR                 0020442013050603302020000406
--- falla en la tabla de errores ---14
 
I100001327130GONZALO PATInO MORENO                        0030062013010604407619984069
--- falla en la tabla de errores ---13
--- falla en la tabla de errores ---14
 
I100002859753ERNESTO RICO                                 0050672013040602206720100435
--- falla en la tabla de errores ---13
 
I100002865767MIGUEL ANTONIO LAVERDE NIETO                 0060452011040603303320111406
--- falla en la tabla de errores ---13
 
I100003044362MANUEL CASTRO MUnETON                        0070rt2011010605300120130406
--- falla en la tabla de errores ---07
 
I100003448867JAIRO DE JESUS HENAO VILLEGA                 0090572013041104550030100806
--- falla en la tabla de errores ---13
 
I200811046741SALUD AXIAL LTDA                             0440761998406903400219990101
--- falla en la tabla de errores ---09
 
I200860013816INSTITUTO DE SEGUROS SOCIALE                 0220672010043503300220131206
--- falla en la tabla de errores ---09
 
I200860024151COMPUTEC SA                                  0330332011140604500120110402
--- falla en la tabla de errores ---09
 
I200860034313BANCO DAVIVIENDA SA                          0533000013040601102320110411
--- falla en la tabla de errores ---09
 
I200890300546COLGATE PALMOLIVE COMPAIA                    2322000011050603304320131010
--- falla en la tabla de errores ---09
 
I300600003115xxxxxx                                       0150542014010600400320120406
--- falla en la tabla de errores ---15
novedad:  xxxxxx                                       
registro: FERNANDEZ PENA JULIO ANTONIO                                     
 
I400000266423SIMONE MARTINEZ                              033002201312060070rt20110106
--- falla en la tabla de errores ---11
 
I400000244359PATRICIO ALEJANDRO HERRERA C                 0450012011040200804520130111
--- falla en la tabla de errores ---14
 
I400000163598xxxxxx                                       0330432013101002204520120406
--- falla en la tabla de errores ---15
novedad:  xxxxxx                                       
registro: KARAN  ABBOUD NAJAH                                              
 
Totales de registros:
      27 Registros IME en el archivo de entrada
      26 Registros procesados sin error
      52 Registros tipo I aceptados
         Registros tipo M aceptados
         Registros tipo E aceptados
         Registros con error
         Alertas borradas previo al refresque total
         Alertas insertadas
         Alertas modificadas
         Alertas eliminadas
         Insercion de alerta existente
         Modif o elim de alerta inexistente
 
Totales por tipo de error detectado:
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           

real    0m0.03s
user    0m0.01s
sys     0m0.01s

Inicio de Programa:  2014/05/16 11:42:33
Fin de Programa:     2014/05/16 11:42:33

/d/iccol/desarrollo $fg
vi CARGAJUR.CBL
* Registra hora de inicioaccept W-hora-inicio from time* Obtiene informacion sobre la corrida de la linea de comando: el
* nombre del archivo de entrada (que contiene el tipo de proceso),
* el indicador de proceso real o en falso (default)accept P-command-line from COMMAND-LINEdisplay "Parametros: " P-command-lineunstring P-command-line delimited by all " " intoP-file-name P-proceso-real* El programa se anuncia en la consola
* TODO: se usa un anuncio mas vistosoif PROCESO-REAL
display pgm " Carga de archivo JURAD - proceso REAL"else
display pgm " Carga de archivo JURAD - proceso en falso"end-if* El indicador de proceso real debe ser SI|si|NO|noif P-proceso-real not = "SI" and "NO"display "El indicador de proceso real es invalido"display "debe ser SI o NO"perform 9000-CANCELAR-PROGRAMAend-if* TODO: controlar los componentes del filenameevaluate P-tipo-procesowhen "01"
display "01 Envio Original - Carga TOTAL 1a vez"when "02"
display "02 Archivo Semanal - Carga PARCIAL"when "03"
display "03 Archivo Mensual - Carga PARCIAL"when "04"
display "04 Refresque Total - Carga TOTAL"when other
*valor invalido
display "El tipo de proceso " P-tipo-proceso" es invalido (debe ser 01 02 03 o 04)"perform 9000-CANCELAR-PROGRAMAend-evaluate.* Edita la fecha de proceso DDMMAA del parametro en formato
* YYYYMMDD
string "20" P-fecha-proceso(5:6) P-fecha-proceso(3:4)P-fecha-proceso(1:2) delimited sizeinto P-fecha-proceso-YYYYMMDDdisplay "Fecha de proceso: " P-fecha-proceso-YYYYMMDD
/display e-editmove E-cont-regs-con-error to N-reg-con-errormove N-reg-con-error to N-editdisplay N-edit "Registros con error"move N-ale-borradas to N-editdisplay N-edit "Alertas borradas previo al refresque total"move N-ale-insertadas to N-editdisplay N-edit "Alertas insertadas"move N-ale-modificadas to N-editdisplay N-edit "Alertas modificadas"move N-ale-eliminadas to N-editdisplay N-edit "Alertas eliminadas"move N-ale-ya-existe to N-editdisplay N-edit "Insercion de alerta existente"move N-ale-no-existe to N-editdisplay N-edit "Modif o elim de alerta inexistente".* Emision del reporte de erroresdisplay " "
display "Totales por tipo de error detectado:"perform varying Ex from 1 by 1 until Ex > 50or E-codigo(Ex) = "00"if E-contador(Ex) not = 0move E-contador(ex) to E-editdisplay E-edit E-codigo(Ex) "-" E-descripcion(Ex)end-if
end-perform.9000-CANCELAR-PROGRAMA.
******************************************************************
* Procedimiento standard de cancelacion de programa batch
******************************************************************
* TODO: hay un standard para comunicar una cancelacion de proceso?display " "
display pgm " - proceso cancelado"goback returning 99.copy BDIIVIDE.PROC.copy VALNOM.PROC./
IDENTIFICATION DIVISION.
PROGRAM-ID. PONERR.
******************************************************************
* Rutina de conveniencia para procesar un error detectado en un$SET LIST SETTINGIDENTIFICATION DIVISION.
PROGRAM-ID.    ACTALEJUR.
******************************************************************
* Actualizacion del archivo de alertas con los datos provistos
* por Jurad
* Procesa el archivo JURAD. Controla cada registro: si es OK usa
* los datos para actualizar BDIIALE, si tiene defecto lo graba en
* el archivo ERRS.
******************************************************************
AUTHOR.Globant JL.
DATE-WRITTEN.
DATE-COMPILED.
CONFIGURATION section.
SOURCE-COMPUTER. microfocus.
OBJECT-COMPUTER. microfocus.
INPUT-OUTPUT section.
FILE-CONTROL.******************************************************************
******************************************************************
select JURAD assign to P-file-nameorganization is line sequentialfile status is JURAD-fs.******************************************************************
******************************************************************
select ERRS assign to ERRS-file-nameorganization is line sequentialfile status is ERRS-fs.******************************************************************
******************************************************************copy BDIIREGI.FS.
* TODO: debe compilar con file status******************************************************************
******************************************************************
copy BDIIDIAN.FS.******************************************************************
******************************************************************
copy BDIIDAS.FS.******************************************************************
******************************************************************copy BDIIALE.FS replacing == on record.== by == on recordfile status is EST-BDIIALE.==./e-error03 LA-templates.
05 LA-templateoccurs 4 indexed LAx.07 LA-partepic x(50)
occurs 10 indexed LAy.
*    Las dos lineas armadas03 LA-lineas.
05 LA-linea1pic x(50).05 LA-linea2pic x(50).
*    Los valores a insertar en una linea03 LA-valores.
05 LA-valorpic x(50)
occurs 10 indexed LAv.
*    Datos para editar valores a insertar03 LA-numpic -(11)0.03 LA-numXredefines LA-num
pic x(12).03 LA-descartepic x(50).******************************************************************
* Errores de consistencia del input
* Cada error tiene un codigo de 2 digitos, un espacio, contador
* de ocurrencias de 7 digitos, un espacio, y descripcion de 59
01 E-errores.
*    indica si el registro actual tiene error03 E-hay-errorpic xx value "NO".
*    errores del registro actual03 E-errores-regpic x(100) value spaces.
*    contador de registros con error03 E-cont-regs-con-error     pic 9(8) value zero.
*    tabla de errores03 pic x(11) value "01 0000000 ".03 pic x(59) value"Tipo de movimiento invalido, debe ser I M E T".03 pic x(11) value "02 0000000 ".03 pic x(59) value"Tipo de identificacion invalido, debe ser 1 2 3 4".03 pic x(11) value "03 0000000 ".03 pic x(59) value"Numero de identificacion invalido, debe ser numerico".03 pic x(11) value "04 0000000 ".03 pic x(59) value"Tipo de identificacion debe ser mayor que cero".03 pic x(11) value "05 0000000 ".03 pic x(59) value"Falta el nombre o denominacion".03 pic x(11) value "06 0000000 ".03 pic x(59) value"Numero de demandas vigentes: debe ser numerico".01 E-errores.*    indica si el registro actual tiene error03 E-hay-errorpic xx value "NO".
*    errores del registro actual03 E-errores-regpic x(100) value spaces.
*    contador de registros con error03 E-cont-regs-con-error     pic 9(8) value zero.
*    tabla de errores03 pic x(11) value "01 0000000 ".03 pic x(59) value"Tipo de movimiento invalido, debe ser I M E T".03 pic x(11) value "02 0000000 ".03 pic x(59) value"Tipo de identificacion invalido, debe ser 1 2 3 4".03 pic x(11) value "03 0000000 ".03 pic x(59) value"Numero de identificacion invalido, debe ser numerico".03 pic x(11) value "04 0000000 ".03 pic x(59) value"Tipo de identificacion debe ser mayor que cero".03 pic x(11) value "05 0000000 ".03 pic x(59) value"Falta el nombre o denominacion".03 pic x(11) value "06 0000000 ".03 pic x(59) value"Numero de demandas vigentes: debe ser numerico".03 pic x(11) value "07 0000000 ".03 pic x(59) value"Numero de demandas terminadas: debe ser numerico".03 pic x(11) value "08 0000000 ".03 pic x(59) value"Fecha ultima demanda vigente YYYYMMDD: debe ser numerica".03 pic x(11) value "09 0000000 ".03 pic x(59) value"Fecha ultima demanda vigente YYYYMMDD: fuera de rango".03 pic x(11) value "10 0000000 ".03 pic x(59) value"Numero de embargos vigentes: debe ser numerico".03 pic x(11) value "11 0000000 ".03 pic x(59) value"Numero de embargos terminados: debe ser numerico".03 pic x(11) value "12 0000000 ".03 pic x(59) value"Fecha ultimo embargo vigente YYYYMMDD: debe ser numerica".03 pic x(11) value "13 0000000 ".03 pic x(59) value"Fecha ultimo embargo vigente YYYYMMDD: fuera de rango".03 pic x(11) value "14 0000000 ".03 pic x(59) value03 pic x(11) value "14 0000000 ".03 pic x(59) value"El numero de id no se encuentra en el archivo maestro".03 pic x(11) value "15 0000000 ".03 pic x(59) value"El nombre en el input no coincide con el registrado".03 pic x(11) value "16 0000000 ".03 pic x(59) value"Numero de id fuera del rango del tipo de id informado".
*----------------- insertar nuevos items aqui -------------------03 pic x(11) value "00 0000000 ".03 pic x(59) value "--- fin de la lista (cod 00) ---".03pic x(3500). *> los 50 items
01 E-errores-2redefines E-errores.03pic xx.03pic 9(8).03 E-erroroccurs 50 indexed Ex.05 E-codigopic xx.05pic x.05 E-contadorpic 9(7).05pic x.05 E-descripcionpic x(59).
01 E-editpic z(8)B.******************************************************************
* Control de rangos de valores de las fechas del input
01 VALIDACIONES-FECHAS.02 ANO-VAL-Xpic 9(04).88 ANO-VALvalue 1900 thru 2050.02 MES-VAL-Xpic 9(02).88 MES-VALvalue 01   thru 12.02 DIA-VAL-Xpic 9(02).88 DIA-VALvalue 01   thru 31./*****************************************************************
******************************************************************
PROCEDURE DIVISION.
*    0000-PROGRAMA-PRINCIPAL
*    4000-PROCESAR-REGISTRO
*    4000-PROCESAR-REGISTRO-2
*    4100-VALIDACION-FORMAL
*    4200-VALIDACION-SEMANTICA
*    4300-MODIFICAR-BDIIALE
*    4300-MODIFICAR-BDIIALE-DATOS
*    4300-MODIFICAR-BDIIALE-I
*    4300-MODIFICAR-BDIIALE-M
*    4300-MODIFICAR-BDIIALE-E
*    4333-LEER-BDIIALE-RANDOM
*    4333-GRABAR-BDIIALEOPEN MODE Nothing in register + APPEND MODE           03                           pic x(100).end-evaluateend-perform.
display "Termino la eliminacion total de JURAD"display "Reg borrados: " N-ale-borradas.7000-RUTINA-FINAL.
******************************************************************
* Registra hora de finalizacionaccept W-hora-fin from time* Leer JURAD a ver si hay registros despues del "T"* Close todos los archivosclose JURAD ERRS BDIIREGI BDIIDIAN BDIIDAS BDIIALE.* Emision de contadores de registrosdisplay " "
display "Totales de registros:"move N-reg-leidos to N-editdisplay N-edit "Registros IME en el archivo de entrada"move N-reg-OK to N-editdisplay N-edit "Registros procesados sin error"move N-reg-tipo-I-OK to N-editdisplay N-edit "Registros tipo I aceptados"move N-reg-tipo-M-OK to N-editdisplay N-edit "Registros tipo M aceptados"move N-reg-tipo-E-OK to N-editdisplay N-edit "Registros tipo E aceptados"move E-cont-regs-con-error to N-reg-con-errormove N-reg-con-error to N-editdisplay N-edit "Registros con error"move N-ale-borradas to N-editdisplay N-edit "Alertas borradas previo al refresque total"move N-ale-insertadas to N-editdisplay N-edit "Alertas insertadas"move N-ale-modificadas to N-editdisplay N-edit "Alertas modificadas"move N-ale-eliminadas to N-editdisplay N-edit "Alertas eliminadas"move N-ale-ya-existe to N-editdisplay N-edit "Insercion de alerta existente"move N-ale-no-existe to N-editdisplay N-edit "Modif o elim de alerta inexistente".* Emision del reporte de erroresdisplay " "

      REPLACE 1 CHAR*
*
*
*
*
*
OPEN MODE      * >>>> not OK: suma para J001 y tambien J002, hay que cambiar la
OPEN MODE      * definicion de estos contadores
OPEN MODE:w"CARGAJUR.CBL" 1229 lines, 52019 characters [1] + Stopped (SIGTSTP)        vi CARGAJUR.CBL
/d/iccol/desarrollo $^[  /d/iccol/desarrollo $fgx CARGAJUR 9999991000905140101.txt/d/iccol/desarrollo $des-c-v CARGAJUR                  /d/iccol/desarrollo $
Ejecucion de la macro de compilacion cobol para desarrollo
cob64 -C nolist -CC -KPIC -A -KPIC -N PIC -uv -g -P -C sourceasm /d/iccol/desarrollo/fuentes/CARGAJUR.CBL 
* Micro Focus Server Express         V5.1 revision 000           Compiler
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
* Accepted - VERBOSE
* Accepted - NOANIM
* Accepted - NOBOUND
* Accepted - NOALTER
* Accepted - COMP
* Accepted - TRUNC
* Accepted - int("CARGAJUR.int")
* Accepted - anim
* Accepted - csi
* Accepted - verbose
* Accepted - nolist
* Accepted - sourceasm
* Accepted - list("CARGAJUR.lst")
* Compiling /d/iccol/desarrollo/fuentes/CARGAJUR.CBL
".............COMPILANDO BDIIREGI SIN STATUS.........."
".............COMPILANDO BDIIDIAN SIN STATUS.........."
".............COMPILANDO BDIIDAS SIN STATUS.........."
".............COMPILANDO BDIIALE SIN STATUS.........."
* Total Messages:     0
* Data:       23800     Code:       23594
* Micro Focus Server Express V5.1.00 Code Generator
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
* Accepted - verbose
* Accepted - anim
* Accepted - PIC
* Generating CARGAJUR
* Data:     23536  Code:     45140  Literals:      1976  Dynamic:   1425408

>>> DATACREDITO: TERMINO OK COMPILACION DE CARGAJUR.CBL

/d/iccol/desarrollo $^[  /d/iccol/desarrollo $des-c-v CARGAJURfg              x CARGAJUR 9999991000905140101.txt/d/iccol/desarrollo $
Parametros: 9999991000905140101.txt                                                         
CARGAJUR   Carga de archivo JURAD - proceso en falso
01 Envio Original - Carga TOTAL 1a vez
Fecha de proceso: 20140101
 
I100000149123JOSE MISAEL AREVALO SANCHEZ                  0010012013040500905720130411
--- falla en la tabla de errores ---14
 
I100000262135LIBARDO ANTONIO GARZON TORRE                 0150202013020602204520120406
--- falla en la tabla de errores ---14
 
I100000958212LUIS GUILLERMO AVENDAnO RODR                 0020442013050603302020000406
--- falla en la tabla de errores ---14
 
I100001327130GONZALO PATInO MORENO                        0030062013010604407619984069
--- falla en la tabla de errores ---13
--- falla en la tabla de errores ---14
 
I100002859753ERNESTO RICO                                 0050672013040602206720100435
--- falla en la tabla de errores ---13
 
I100002865767MIGUEL ANTONIO LAVERDE NIETO                 0060452011040603303320111406
--- falla en la tabla de errores ---13
 
I100003044362MANUEL CASTRO MUnETON                        0070rt2011010605300120130406
--- falla en la tabla de errores ---07
 
I100003448867JAIRO DE JESUS HENAO VILLEGA                 0090572013041104550030100806
--- falla en la tabla de errores ---13
 
I200811046741SALUD AXIAL LTDA                             0440761998406903400219990101
--- falla en la tabla de errores ---09
 
I200860013816INSTITUTO DE SEGUROS SOCIALE                 0220672010043503300220131206
--- falla en la tabla de errores ---09
 
I200860024151COMPUTEC SA                                  0330332011140604500120110402
--- falla en la tabla de errores ---09
 
I200860034313BANCO DAVIVIENDA SA                          0533000013040601102320110411
--- falla en la tabla de errores ---09
 
I200890300546COLGATE PALMOLIVE COMPAIA                    2322000011050603304320131010
--- falla en la tabla de errores ---09
 
I300600003115xxxxxx                                       0150542014010600400320120406
--- falla en la tabla de errores ---15
novedad:  xxxxxx                                       
registro: FERNANDEZ PENA JULIO ANTONIO                                     
 
I400000266423SIMONE MARTINEZ                              033002201312060070rt20110106
--- falla en la tabla de errores ---11
 
I400000244359PATRICIO ALEJANDRO HERRERA C                 0450012011040200804520130111
--- falla en la tabla de errores ---14
 
I400000163598xxxxxx                                       0330432013101002204520120406
--- falla en la tabla de errores ---15
novedad:  xxxxxx                                       
registro: KARAN  ABBOUD NAJAH                                              
 
Totales de registros:
      27 Registros IME en el archivo de entrada
      26 Registros procesados sin error
         Registros con error
         Alertas borradas previo al refresque total
         Alertas insertadas
         Alertas modificadas
         Alertas eliminadas
         Insercion de alerta existente
         Modif o elim de alerta inexistente
 
Totales por tipo de error detectado:
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           

real    0m0.03s
user    0m0.01s
sys     0m0.01s

Inicio de Programa:  2014/05/16 11:51:29
Fin de Programa:     2014/05/16 11:51:29

/d/iccol/desarrollo $fg
vi CARGAJUR.CBL
end-evaluateend-perform.
display "Termino la eliminacion total de JURAD"display "Reg borrados: " N-ale-borradas.7000-RUTINA-FINAL.
******************************************************************
* Registra hora de finalizacionaccept W-hora-fin from time* Leer JURAD a ver si hay registros despues del "T"* Close todos los archivosclose JURAD ERRS BDIIREGI BDIIDIAN BDIIDAS BDIIALE.* Emision de contadores de registrosdisplay " "
display "Totales de registros:"move N-reg-leidos to N-editdisplay N-edit "Registros IME en el archivo de entrada"move N-reg-OK to N-editdisplay N-edit "Registros procesados sin error"* >>>> not OK: suma para J001 y tambien J002, hay que cambiar la
* definicion de estos contadores
*    move N-reg-tipo-I-OK to N-edit
*    display N-edit "Registros tipo I aceptados"
*    move N-reg-tipo-M-OK to N-edit
*    display N-edit "Registros tipo M aceptados"
*    move N-reg-tipo-E-OK to N-edit
*    display N-edit "Registros tipo E aceptados"move E-cont-regs-con-error to N-reg-con-errormove N-reg-con-error to N-editdisplay N-edit "Registros con error"move N-ale-borradas to N-editdisplay N-edit "Alertas borradas previo al refresque total"move N-ale-insertadas to N-editdisplay N-edit "Alertas insertadas"move N-ale-modificadas to N-editdisplay N-edit "Alertas modificadas"move N-ale-eliminadas to N-editdisplay N-edit "Alertas eliminadas"move N-ale-ya-existe to N-editdisplay N-edit "Insercion de alerta existente"move N-ale-no-existe to N-editdisplay N-edit "Modif o elim de alerta inexistente".$SET LIST SETTINGIDENTIFICATION DIVISION.
PROGRAM-ID.    ACTALEJUR.
******************************************************************
* Actualizacion del archivo de alertas con los datos provistos
* por Jurad
* Procesa el archivo JURAD. Controla cada registro: si es OK usa
* los datos para actualizar BDIIALE, si tiene defecto lo graba en
* el archivo ERRS.
******************************************************************
AUTHOR.Globant JL.
DATE-WRITTEN.
DATE-COMPILED.
CONFIGURATION section.
SOURCE-COMPUTER. microfocus.
OBJECT-COMPUTER. microfocus.
INPUT-OUTPUT section.
FILE-CONTROL.******************************************************************
******************************************************************
select JURAD assign to P-file-nameorganization is line sequentialfile status is JURAD-fs.******************************************************************
******************************************************************
select ERRS assign to ERRS-file-nameorganization is line sequentialfile status is ERRS-fs.******************************************************************
******************************************************************copy BDIIREGI.FS.
* TODO: debe compilar con file status******************************************************************
******************************************************************
copy BDIIDIAN.FS.******************************************************************
******************************************************************
copy BDIIDAS.FS.******************************************************************
******************************************************************copy BDIIALE.FS replacing == on record.== by == on recordfile status is EST-BDIIALE.==./e-errores03 LA-templates.
05 LA-templateoccurs 4 indexed LAx.07 LA-partepic x(50)
occurs 10 indexed LAy.
*    Las dos lineas armadas03 LA-lineas.
05 LA-linea1pic x(50).05 LA-linea2pic x(50).
*    Los valores a insertar en una linea03 LA-valores.
05 LA-valorpic x(50)
occurs 10 indexed LAv.
*    Datos para editar valores a insertar03 LA-numpic -(11)0.03 LA-numXredefines LA-num
pic x(12).03 LA-descartepic x(50).******************************************************************
* Errores de consistencia del input
* Cada error tiene un codigo de 2 digitos, un espacio, contador
* de ocurrencias de 7 digitos, un espacio, y descripcion de 59
01 E-errores.
*    indica si el registro actual tiene error03 E-hay-errorpic xx value "NO".
*    errores del registro actual03 E-errores-regpic x(100) value spaces.
*    contador de registros con error03 E-cont-regs-con-error     pic 9(8) value zero.
*    tabla de errores03 pic x(11) value "01 0000000 ".03 pic x(59) value"Tipo de movimiento invalido, debe ser I M E T".03 pic x(11) value "02 0000000 ".03 pic x(59) value"Tipo de identificacion invalido, debe ser 1 2 3 4".03 pic x(11) value "03 0000000 ".03 pic x(59) value"Numero de identificacion invalido, debe ser numerico".03 pic x(11) value "04 0000000 ".03 pic x(59) value"Tipo de identificacion debe ser mayor que cero".03 pic x(11) value "05 0000000 ".03 pic x(59) value"Falta el nombre o denominacion".03 pic x(11) value "06 0000000 ".03 pic x(59) value"Numero de demandas vigentes: debe ser numerico".01 E-errores.*    indica si el registro actual tiene error03 E-hay-errorpic xx value "NO".
*    errores del registro actual03 E-errores-regpic x(100) value spaces.
*    contador de registros con error03 E-cont-regs-con-error     pic 9(8) value zero.
*    tabla de errores03 pic x(11) value "01 0000000 ".03 pic x(59) value"Tipo de movimiento invalido, debe ser I M E T".03 pic x(11) value "02 0000000 ".03 pic x(59) value"Tipo de identificacion invalido, debe ser 1 2 3 4".03 pic x(11) value "03 0000000 ".03 pic x(59) value"Numero de identificacion invalido, debe ser numerico".03 pic x(11) value "04 0000000 ".03 pic x(59) value"Tipo de identificacion debe ser mayor que cero".03 pic x(11) value "05 0000000 ".03 pic x(59) value"Falta el nombre o denominacion".03 pic x(11) value "06 0000000 ".03 pic x(59) value"Numero de demandas vigentes: debe ser numerico".03 pic x(11) value "07 0000000 ".03 pic x(59) value"Numero de demandas terminadas: debe ser numerico".03 pic x(11) value "08 0000000 ".03 pic x(59) value"Fecha ultima demanda vigente YYYYMMDD: debe ser numerica".03 pic x(11) value "09 0000000 ".03 pic x(59) value"Fecha ultima demanda vigente YYYYMMDD: fuera de rango".03 pic x(11) value "10 0000000 ".03 pic x(59) value"Numero de embargos vigentes: debe ser numerico".03 pic x(11) value "11 0000000 ".03 pic x(59) value"Numero de embargos terminados: debe ser numerico".03 pic x(11) value "12 0000000 ".03 pic x(59) value"Fecha ultimo embargo vigente YYYYMMDD: debe ser numerica".03 pic x(11) value "13 0000000 ".03 pic x(59) value"Fecha ultimo embargo vigente YYYYMMDD: fuera de rango".03 pic x(11) value "14 0000000 ".03 pic x(59) value* de ocurrencias de 7 digitos, un espacio, y descripcion de 59"Fecha ultimo embargo vigente YYYYMMDD: fuera de rango".03 pic x(11) value "14 0000000 ".03 pic x(59) value"El numero de id no se encuentra en el archivo maestro".03 pic x(11) value "15 0000000 ".03 pic x(59) value"El nombre en el input no coincide con el registrado".03 pic x(11) value "16 0000000 ".03 pic x(59) value"Numero de id fuera del rango del tipo de id informado".
*----------------- insertar nuevos items aqui -------------------03 pic x(11) value "00 0000000 ".03 pic x(59) value "--- fin de la lista (cod 00) ---".03pic x(3500). *> los 50 items
01 E-errores-2redefines E-errores.03pic xx.03pic x(100).03pic 9(8).03 E-erroroccurs 50 indexed Ex.05 E-codigopic xx.05pic x.05 E-contadorpic 9(7).05pic x.05 E-descripcionpic x(59).
01 E-editpic z(8)B.******************************************************************
* Control de rangos de valores de las fechas del input
01 VALIDACIONES-FECHAS.02 ANO-VAL-Xpic 9(04).88 ANO-VALvalue 1900 thru 2050.02 MES-VAL-Xpic 9(02).88 MES-VALvalue 01   thru 12.02 DIA-VAL-Xpic 9(02).88 DIA-VALvalue 01   thru 31./*****************************************************************
******************************************************************
PROCEDURE DIVISION.
*    0000-PROGRAMA-PRINCIPAL
*    4000-PROCESAR-REGISTRO
*    4000-PROCESAR-REGISTRO-2
*    4100-VALIDACION-FORMAL
*    4200-VALIDACION-SEMANTICA
*    4300-MODIFICAR-BDIIALE
*    4300-MODIFICAR-BDIIALE-DATOS
*    4300-MODIFICAR-BDIIALE-I
*    4300-MODIFICAR-BDIIALE-M
*    4300-MODIFICAR-BDIIALE-Edisplay "Reg borrados: " N-ale-borradas.7000-RUTINA-FINAL.
******************************************************************
* Registra hora de finalizacionaccept W-hora-fin from time* Leer JURAD a ver si hay registros despues del "T"* Close todos los archivosclose JURAD ERRS BDIIREGI BDIIDIAN BDIIDAS BDIIALE.* Emision de contadores de registrosdisplay " "
display "Totales de registros:"move N-reg-leidos to N-editdisplay N-edit "Registros IME en el archivo de entrada"move N-reg-OK to N-editdisplay N-edit "Registros procesados sin error"* >>>> not OK: suma para J001 y tambien J002, hay que cambiar la
* definicion de estos contadores*    move N-reg-tipo-I-OK to N-edit
*    display N-edit "Registros tipo I aceptados"
*    move N-reg-tipo-M-OK to N-edit
*    display N-edit "Registros tipo M aceptados"
*    move N-reg-tipo-E-OK to N-edit
*    display N-edit "Registros tipo E aceptados"move E-cont-regs-con-error to N-reg-con-errormove N-reg-con-error to N-editdisplay N-edit "Registros con error"move N-ale-borradas to N-editdisplay N-edit "Alertas borradas previo al refresque total"move N-ale-insertadas to N-editdisplay N-edit "Alertas insertadas"move N-ale-modificadas to N-editdisplay N-edit "Alertas modificadas"move N-ale-eliminadas to N-editdisplay N-edit "Alertas eliminadas"move N-ale-ya-existe to N-editdisplay N-edit "Insercion de alerta existente"move N-ale-no-existe to N-editdisplay N-edit "Modif o elim de alerta inexistente".* Emision del reporte de erroresdisplay " "
1 more line           display "Totales por tipo de error detectado:"$SET LIST SETTINGIDENTIFICATION DIVISION.
PROGRAM-ID.    ACTALEJUR.
******************************************************************
* Actualizacion del archivo de alertas con los datos provistos
* por Jurad
* Procesa el archivo JURAD. Controla cada registro: si es OK usa
* los datos para actualizar BDIIALE, si tiene defecto lo graba en
* el archivo ERRS.
******************************************************************
AUTHOR.Globant JL.
DATE-WRITTEN.
DATE-COMPILED.
CONFIGURATION section.
SOURCE-COMPUTER. microfocus.
OBJECT-COMPUTER. microfocus.
INPUT-OUTPUT section.
FILE-CONTROL.******************************************************************
******************************************************************
select JURAD assign to P-file-nameorganization is line sequentialfile status is JURAD-fs.******************************************************************
******************************************************************
select ERRS assign to ERRS-file-nameorganization is line sequentialfile status is ERRS-fs.******************************************************************
******************************************************************copy BDIIREGI.FS.
* TODO: debe compilar con file status******************************************************************
******************************************************************
copy BDIIDIAN.FS.******************************************************************
******************************************************************
copy BDIIDAS.FS.******************************************************************
******************************************************************copy BDIIALE.FS replacing == on record.== by == on recordfile status is EST-BDIIALE.==./03 LA-templates.
05 LA-templateoccurs 4 indexed LAx.07 LA-partepic x(50)
occurs 10 indexed LAy.
*    Las dos lineas armadas03 LA-lineas.
05 LA-linea1pic x(50).05 LA-linea2pic x(50).
*    Los valores a insertar en una linea03 LA-valores.
05 LA-valorpic x(50)
occurs 10 indexed LAv.
*    Datos para editar valores a insertar03 LA-numpic -(11)0.03 LA-numXredefines LA-num
pic x(12).03 LA-descartepic x(50).******************************************************************
* Errores de consistencia del input
* Cada error tiene un codigo de 2 digitos, un espacio, contador
* de ocurrencias de 7 digitos, un espacio, y descripcion de 59
01 E-errores.
*    indica si el registro actual tiene error03 E-hay-errorpic xx value "NO".
*    errores del registro actual03 E-errores-regpic x(100) value spaces.
*    contador de registros con error03 E-cont-regs-con-error     pic 9(8) value zero.
*    tabla de errores03 pic x(11) value "01 0000000 ".03 pic x(59) value"Tipo de movimiento invalido, debe ser I M E T".03 pic x(11) value "02 0000000 ".03 pic x(59) value"Tipo de identificacion invalido, debe ser 1 2 3 4".03 pic x(11) value "03 0000000 ".03 pic x(59) value"Numero de identificacion invalido, debe ser numerico".03 pic x(11) value "04 0000000 ".03 pic x(59) value"Tipo de identificacion debe ser mayor que cero".03 pic x(11) value "05 0000000 ".03 pic x(59) value"Falta el nombre o denominacion".03 pic x(11) value "06 0000000 ".03 pic x(59) value"Numero de demandas vigentes: debe ser numerico".* de ocurrencias de 7 digitos, un espacio, y descripcion de 5901 E-errores.
*    indica si el registro actual tiene error03 E-hay-errorpic xx value "NO".
*    errores del registro actual03 E-errores-regpic x(100) value spaces.
*    contador de registros con error03 E-cont-regs-con-error     pic 9(8) value zero.
*    tabla de errores03 pic x(11) value "01 0000000 ".03 pic x(59) value"Tipo de movimiento invalido, debe ser I M E T".03 pic x(11) value "02 0000000 ".03 pic x(59) value"Tipo de identificacion invalido, debe ser 1 2 3 4".03 pic x(11) value "03 0000000 ".03 pic x(59) value"Numero de identificacion invalido, debe ser numerico".03 pic x(11) value "04 0000000 ".03 pic x(59) value"Tipo de identificacion debe ser mayor que cero".03 pic x(11) value "05 0000000 ".03 pic x(59) value"Falta el nombre o denominacion".03 pic x(11) value "06 0000000 ".03 pic x(59) value"Numero de demandas vigentes: debe ser numerico".03 pic x(11) value "07 0000000 ".03 pic x(59) value"Numero de demandas terminadas: debe ser numerico".03 pic x(11) value "08 0000000 ".03 pic x(59) value"Fecha ultima demanda vigente YYYYMMDD: debe ser numerica".03 pic x(11) value "09 0000000 ".03 pic x(59) value"Fecha ultima demanda vigente YYYYMMDD: fuera de rango".03 pic x(11) value "10 0000000 ".03 pic x(59) value"Numero de embargos vigentes: debe ser numerico".03 pic x(11) value "11 0000000 ".03 pic x(59) value"Numero de embargos terminados: debe ser numerico".03 pic x(11) value "12 0000000 ".03 pic x(59) value"Fecha ultimo embargo vigente YYYYMMDD: debe ser numerica".03 pic x(11) value "13 0000000 ".03 pic x(59) value"Fecha ultimo embargo vigente YYYYMMDD: fuera de rango".03 pic x(11) value "14 0000000 ".///03 pic x(59) value
"El numero de id no se encuentra en el archivo maestro".
03 pic x(11) value "15 0000000 ".
03 pic x(59) value
"El nombre en el input no coincide con el registrado".
03 pic x(11) value "16 0000000 ".
03 pic x(59) value
"Numero de id fuera del rango del tipo de id informado".
*----------------- insertar nuevos items aqui -------------------
03 pic x(11) value "00 0000000 ".
03 pic x(59) value "--- fin de la lista (cod 00) ---".
03pic x(3500). *> los 50 items
01 E-errores-2redefines E-errores.01 E-errores-2redefines E-errores.03pic xx.03pic x(100).03pic 9(8).03 E-erroroccurs 50 indexed Ex.05 E-codigopic xx.05pic x.05 E-contadorpic 9(7).05pic x.05 E-descripcionpic x(59).
01 E-editpic z(8)B.******************************************************************
* Control de rangos de valores de las fechas del input
01 VALIDACIONES-FECHAS.02 ANO-VAL-Xpic 9(04).88 ANO-VALvalue 1900 thru 2050.02 MES-VAL-Xpic 9(02).88 MES-VALvalue 01   thru 12.02 DIA-VAL-Xpic 9(02).88 DIA-VALvalue 01   thru 31./*****************************************************************
******************************************************************
PROCEDURE DIVISION.
*    0000-PROGRAMA-PRINCIPAL
*    4000-PROCESAR-REGISTRO
*    4000-PROCESAR-REGISTRO-2
*    4100-VALIDACION-FORMAL
*    4200-VALIDACION-SEMANTICA
*    4300-MODIFICAR-BDIIALE
*    4300-MODIFICAR-BDIIALE-DATOS
*    4300-MODIFICAR-BDIIALE-I
*    4300-MODIFICAR-BDIIALE-M
*    4300-MODIFICAR-BDIIALE-E
*    4333-LEER-BDIIALE-RANDOM
*    4333-GRABAR-BDIIALE
*    4333-REGRABAR-BDIIALE
*    4333-ELIMINAR-BDIIALE
*    4900-GRABAR-ERROR
*    4320-ARMAR-TEXTO-ALERTA
*    1000-RUTINA-INICIAL
*    1001-ELIMINAR-TODO
*    7000-RUTINA-FINAL
*    9000-CANCELAR-PROGRAMA0000-PROGRAMA-PRINCIPAL.
******************************************************************when E-codigo(Ex) = "00"add 1 to E-contador(Ex)display "--- error tipo exotico: " cod-errorwhen E-codigo(Ex) = cod-erroradd 1 to E-contador(Ex)display "Error " cod-error " " E-descripcion(Ex)end-search*    agrega a la lista de errores del registroif errIndex < 99
move cod-error to E-errores(errIndex:2)add 3 to errindexend-if

exit program.end program PONERR.end program ACTALEJUR.******************************************************************
******************************************************************

~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~
~05 E-descripcionpic x(59).******************************************************************PROCEDURE DIVISION using cod-error reg-input E-errores.
00.
*    marca al reg actual como erroneomove "SI" to E-hay-error*    cuenta y muestra el registro de inputif reg-input(1:86) not = reg-input-anterioradd 1 to E-cont-regs-con-errordisplay " "
display reg-input(1:86)move reg-input(1:86) to reg-input-anteriormove spaces to E-erroresend-if*    contabiliza el error en la tabla de erroresset Ex to 1
search E-error varying Exat end
display "--- falla en la tabla de errores ---" cod-errorwhen E-codigo(Ex) = "00"add 1 to E-contador(Ex)display "--- error tipo exotico: " cod-errorwhen E-codigo(Ex) = cod-erroradd 1 to E-contador(Ex)display "Error " cod-error " " E-descripcion(Ex)end-search*    agrega a la lista de errores del registroif errIndex < 99
move cod-error to E-errores(errIndex:2)add 3 to errindexend-if

exit program.end program PONERR.end program ACTALEJUR.******************************************************************
******************************************************************

~
~EsAPPEND MODE-reg:w"CARGAJUR.CBL" 1229 lines, 52023 characters e[1] + Stopped (SIGTSTP)        vi CARGAJUR.CBL
/d/iccol/desarrollo $^[  /d/iccol/desarrollo $fgx CARGAJUR 9999991000905140101.txt/d/iccol/desarrollo $des-c-v CARGAJUR                  /d/iccol/desarrollo $
Ejecucion de la macro de compilacion cobol para desarrollo
cob64 -C nolist -CC -KPIC -A -KPIC -N PIC -uv -g -P -C sourceasm /d/iccol/desarrollo/fuentes/CARGAJUR.CBL 
* Micro Focus Server Express         V5.1 revision 000           Compiler
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
* Accepted - VERBOSE
* Accepted - NOANIM
* Accepted - NOBOUND
* Accepted - NOALTER
* Accepted - COMP
* Accepted - TRUNC
* Accepted - int("CARGAJUR.int")
* Accepted - anim
* Accepted - csi
* Accepted - verbose
* Accepted - nolist
* Accepted - sourceasm
* Accepted - list("CARGAJUR.lst")
* Compiling /d/iccol/desarrollo/fuentes/CARGAJUR.CBL
".............COMPILANDO BDIIREGI SIN STATUS.........."
".............COMPILANDO BDIIDIAN SIN STATUS.........."
".............COMPILANDO BDIIDAS SIN STATUS.........."
".............COMPILANDO BDIIALE SIN STATUS.........."
* Total Messages:     0
* Data:       23800     Code:       23594
* Micro Focus Server Express V5.1.00 Code Generator
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
* Accepted - verbose
* Accepted - anim
* Accepted - PIC
* Generating CARGAJUR
* Data:     23536  Code:     45140  Literals:      1976  Dynamic:   1425408

>>> DATACREDITO: TERMINO OK COMPILACION DE CARGAJUR.CBL

/d/iccol/desarrollo $^[  /d/iccol/desarrollo $des-c-v CARGAJURfg              x CARGAJUR 9999991000905140101.txt/d/iccol/desarrollo $
Parametros: 9999991000905140101.txt                                                         
CARGAJUR   Carga de archivo JURAD - proceso en falso
01 Envio Original - Carga TOTAL 1a vez
Fecha de proceso: 20140101
 
I100000149123JOSE MISAEL AREVALO SANCHEZ                  0010012013040500905720130411
--- falla en la tabla de errores ---14
 
I100000262135LIBARDO ANTONIO GARZON TORRE                 0150202013020602204520120406
--- falla en la tabla de errores ---14
 
I100000958212LUIS GUILLERMO AVENDAnO RODR                 0020442013050603302020000406
--- falla en la tabla de errores ---14
 
I100001327130GONZALO PATInO MORENO                        0030062013010604407619984069
--- falla en la tabla de errores ---13
--- falla en la tabla de errores ---14
 
I100002859753ERNESTO RICO                                 0050672013040602206720100435
--- falla en la tabla de errores ---13
 
I100002865767MIGUEL ANTONIO LAVERDE NIETO                 0060452011040603303320111406
--- falla en la tabla de errores ---13
 
I100003044362MANUEL CASTRO MUnETON                        0070rt2011010605300120130406
--- falla en la tabla de errores ---07
 
I100003448867JAIRO DE JESUS HENAO VILLEGA                 0090572013041104550030100806
--- falla en la tabla de errores ---13
 
I200811046741SALUD AXIAL LTDA                             0440761998406903400219990101
--- falla en la tabla de errores ---09
 
I200860013816INSTITUTO DE SEGUROS SOCIALE                 0220672010043503300220131206
--- falla en la tabla de errores ---09
 
I200860024151COMPUTEC SA                                  0330332011140604500120110402
--- falla en la tabla de errores ---09
 
I200860034313BANCO DAVIVIENDA SA                          0533000013040601102320110411
--- falla en la tabla de errores ---09
 
I200890300546COLGATE PALMOLIVE COMPAIA                    2322000011050603304320131010
--- falla en la tabla de errores ---09
 
I300600003115xxxxxx                                       0150542014010600400320120406
--- falla en la tabla de errores ---15
novedad:  xxxxxx                                       
registro: FERNANDEZ PENA JULIO ANTONIO                                     
 
I400000266423SIMONE MARTINEZ                              033002201312060070rt20110106
--- falla en la tabla de errores ---11
 
I400000244359PATRICIO ALEJANDRO HERRERA C                 0450012011040200804520130111
--- falla en la tabla de errores ---14
 
I400000163598xxxxxx                                       0330432013101002204520120406
--- falla en la tabla de errores ---15
novedad:  xxxxxx                                       
registro: KARAN  ABBOUD NAJAH                                              
 
Totales de registros:
      27 Registros IME en el archivo de entrada
      26 Registros procesados sin error
         Registros con error
         Alertas borradas previo al refresque total
         Alertas insertadas
         Alertas modificadas
         Alertas eliminadas
         Insercion de alerta existente
         Modif o elim de alerta inexistente
 
Totales por tipo de error detectado:
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           
           -                                                           

real    0m0.03s
user    0m0.01s
sys     0m0.01s

Inicio de Programa:  2014/05/16 11:58:33
Fin de Programa:     2014/05/16 11:58:33

/d/iccol/desarrollo $fg
vi CARGAJUR.CBL
05 E-descripcionpic x(59).******************************************************************PROCEDURE DIVISION using cod-error reg-input E-errores.
00.
*    marca al reg actual como erroneomove "SI" to E-hay-error*    cuenta y muestra el registro de inputif reg-input(1:86) not = reg-input-anterioradd 1 to E-cont-regs-con-errordisplay " "
display reg-input(1:86)move reg-input(1:86) to reg-input-anteriormove spaces to E-erroresend-if*    contabiliza el error en la tabla de erroresset Ex to 1
search E-error varying Exat end
display "--- falla en la tabla de errores ---" cod-errorwhen E-codigo(Ex) = "00"add 1 to E-contador(Ex)display "--- error tipo exotico: " cod-errorwhen E-codigo(Ex) = cod-erroradd 1 to E-contador(Ex)display "Error " cod-error " " E-descripcion(Ex)end-search*    agrega a la lista de errores del registroif errIndex < 99
move cod-error to E-errores-reg(errIndex:2)add 3 to errindexend-if

exit program.end program PONERR.end program ACTALEJUR.******************************************************************
******************************************************************

~
~


sAPPEND MODE-reg:w"CARGAJUR.CBL" 1229 lines, 52027 characters [1] + Stopped (SIGTSTP)        vi CARGAJUR.CBL
/d/iccol/desarrollo $^[  /d/iccol/desarrollo $fgx CARGAJUR 9999991000905140101.txt/d/iccol/desarrollo $des-c-v CARGAJUR                  /d/iccol/desarrollo $
Ejecucion de la macro de compilacion cobol para desarrollo
cob64 -C nolist -CC -KPIC -A -KPIC -N PIC -uv -g -P -C sourceasm /d/iccol/desarrollo/fuentes/CARGAJUR.CBL 
* Micro Focus Server Express         V5.1 revision 000           Compiler
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
* Accepted - VERBOSE
* Accepted - NOANIM
* Accepted - NOBOUND
* Accepted - NOALTER
* Accepted - COMP
* Accepted - TRUNC
* Accepted - int("CARGAJUR.int")
* Accepted - anim
* Accepted - csi
* Accepted - verbose
* Accepted - nolist
* Accepted - sourceasm
* Accepted - list("CARGAJUR.lst")
* Compiling /d/iccol/desarrollo/fuentes/CARGAJUR.CBL
".............COMPILANDO BDIIREGI SIN STATUS.........."
".............COMPILANDO BDIIDIAN SIN STATUS.........."
".............COMPILANDO BDIIDAS SIN STATUS.........."
".............COMPILANDO BDIIALE SIN STATUS.........."
* Total Messages:     0
* Data:       23800     Code:       23594
* Micro Focus Server Express V5.1.00 Code Generator
* Copyright (C) Micro Focus IP Development Limited 1984-2012.
* Accepted - verbose
* Accepted - anim
* Accepted - PIC
* Generating CARGAJUR
* Data:     23536  Code:     45140  Literals:      1976  Dynamic:   1425408

>>> DATACREDITO: TERMINO OK COMPILACION DE CARGAJUR.CBL

/d/iccol/desarrollo $^[  /d/iccol/desarrollo $des-c-v CARGAJURfg              x CARGAJUR 9999991000905140101.txt/d/iccol/desarrollo $
Parametros: 9999991000905140101.txt                                                         
CARGAJUR   Carga de archivo JURAD - proceso en falso
01 Envio Original - Carga TOTAL 1a vez
Fecha de proceso: 20140101
 
I100000149123JOSE MISAEL AREVALO SANCHEZ                  0010012013040500905720130411
Error 14 El numero de id no se encuentra en el archivo maestro      
 
I100000262135LIBARDO ANTONIO GARZON TORRE                 0150202013020602204520120406
Error 14 El numero de id no se encuentra en el archivo maestro      
 
I100000958212LUIS GUILLERMO AVENDAnO RODR                 0020442013050603302020000406
Error 14 El numero de id no se encuentra en el archivo maestro      
 
I100001327130GONZALO PATInO MORENO                        0030062013010604407619984069
Error 13 Fecha ultimo embargo vigente YYYYMMDD: fuera de rango      
 
I100002859753ERNESTO RICO                                 0050672013040602206720100435
Error 13 Fecha ultimo embargo vigente YYYYMMDD: fuera de rango      
 
I100002865767MIGUEL ANTONIO LAVERDE NIETO                 0060452011040603303320111406
Error 13 Fecha ultimo embargo vigente YYYYMMDD: fuera de rango      
 
I100003044362MANUEL CASTRO MUnETON                        0070rt2011010605300120130406
Error 07 Numero de demandas terminadas: debe ser numerico           
 
I100003448867JAIRO DE JESUS HENAO VILLEGA                 0090572013041104550030100806
Error 13 Fecha ultimo embargo vigente YYYYMMDD: fuera de rango      
 
I200811046741SALUD AXIAL LTDA                             0440761998406903400219990101
Error 09 Fecha ultima demanda vigente YYYYMMDD: fuera de rango      
 
I200860013816INSTITUTO DE SEGUROS SOCIALE                 0220672010043503300220131206
Error 09 Fecha ultima demanda vigente YYYYMMDD: fuera de rango      
 
I200860024151COMPUTEC SA                                  0330332011140604500120110402
Error 09 Fecha ultima demanda vigente YYYYMMDD: fuera de rango      
 
I200860034313BANCO DAVIVIENDA SA                          0533000013040601102320110411
Error 09 Fecha ultima demanda vigente YYYYMMDD: fuera de rango      
 
I200890300546COLGATE PALMOLIVE COMPAIA                    2322000011050603304320131010
Error 09 Fecha ultima demanda vigente YYYYMMDD: fuera de rango      
 
I300600003115xxxxxx                                       0150542014010600400320120406
Error 15 El nombre en el input no coincide con el registrado        
novedad:  xxxxxx                                       
registro: FERNANDEZ PENA JULIO ANTONIO                                     
 
I400000266423SIMONE MARTINEZ                              033002201312060070rt20110106
Error 11 Numero de embargos terminados: debe ser numerico           
 
I400000244359PATRICIO ALEJANDRO HERRERA C                 0450012011040200804520130111
Error 14 El numero de id no se encuentra en el archivo maestro      
 
I400000163598xxxxxx                                       0330432013101002204520120406
Error 15 El nombre en el input no coincide con el registrado        
novedad:  xxxxxx                                       
registro: KARAN  ABBOUD NAJAH                                              
 
Totales de registros:
      27 Registros IME en el archivo de entrada
      10 Registros procesados sin error
      17 Registros con error
         Alertas borradas previo al refresque total
         Alertas insertadas
         Alertas modificadas
         Alertas eliminadas
         Insercion de alerta existente
         Modif o elim de alerta inexistente
 
Totales por tipo de error detectado:
       1 07-Numero de demandas terminadas: debe ser numerico           
       5 09-Fecha ultima demanda vigente YYYYMMDD: fuera de rango      
       1 11-Numero de embargos terminados: debe ser numerico           
       4 13-Fecha ultimo embargo vigente YYYYMMDD: fuera de rango      
       4 14-El numero de id no se encuentra en el archivo maestro      
       2 15-El nombre en el input no coincide con el registrado        

real    0m0.02s
user    0m0.01s
sys     0m0.01s

Inicio de Programa:  2014/05/16 12:00:26
Fin de Programa:     2014/05/16 12:00:26

/d/iccol/desarrollo $fg
vi CARGAJUR.CBL
05 E-descripcionpic x(59).******************************************************************PROCEDURE DIVISION using cod-error reg-input E-errores.
00.
*    marca al reg actual como erroneomove "SI" to E-hay-error*    cuenta y muestra el registro de inputif reg-input(1:86) not = reg-input-anterioradd 1 to E-cont-regs-con-errordisplay " "
display reg-input(1:86)move reg-input(1:86) to reg-input-anteriormove spaces to E-errores-regend-if*    contabiliza el error en la tabla de erroresset Ex to 1
search E-error varying Exat end
display "--- falla en la tabla de errores ---" cod-errorwhen E-codigo(Ex) = "00"add 1 to E-contador(Ex)display "--- error tipo exotico: " cod-errorwhen E-codigo(Ex) = cod-erroradd 1 to E-contador(Ex)display "Error " cod-error " " E-descripcion(Ex)end-search*    agrega a la lista de errores del registroif errIndex < 99
move cod-error to E-errores-reg(errIndex:2)add 3 to errindexend-if

exit program.end program PONERR.end program ACTALEJUR.******************************************************************
******************************************************************

~
~:q/d/iccol/desarrollo $^D
